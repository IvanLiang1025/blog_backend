2022-01-19 00:39:09:058 [HikariPool-1 housekeeper] WARN  com.zaxxer.hikari.pool.HikariPool HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=1h26m48s979ms).
2022-01-19 02:08:35:289 [HikariPool-1 housekeeper] WARN  com.zaxxer.hikari.pool.HikariPool HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=1h29m26s232ms).
2022-01-19 03:26:55:055 [HikariPool-1 housekeeper] WARN  com.zaxxer.hikari.pool.HikariPool HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=1h18m19s766ms).
2022-01-19 05:27:04:065 [HikariPool-1 housekeeper] WARN  com.zaxxer.hikari.pool.HikariPool HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=2h9s10ms).
2022-01-19 07:11:49:939 [HikariPool-1 housekeeper] WARN  com.zaxxer.hikari.pool.HikariPool HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=1h44m45s874ms).
2022-01-19 09:15:00:281 [HikariPool-1 housekeeper] WARN  com.zaxxer.hikari.pool.HikariPool HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=2h3m10s342ms).
2022-01-19 10:12:34:345 [HikariPool-1 housekeeper] WARN  com.zaxxer.hikari.pool.HikariPool HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=57m34s63ms).
2022-01-19 10:45:57:263 [HikariPool-1 housekeeper] WARN  com.zaxxer.hikari.pool.HikariPool HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=33m22s918ms).
2022-01-19 10:46:34:058 [Thread-46] INFO  org.springframework.scheduling.concurrent.ThreadPoolTaskScheduler Shutting down ExecutorService 'taskScheduler'
2022-01-19 10:46:34:060 [Thread-46] INFO  org.springframework.scheduling.concurrent.ThreadPoolTaskExecutor Shutting down ExecutorService 'applicationTaskExecutor'
2022-01-19 10:46:34:062 [Thread-46] INFO  com.zaxxer.hikari.HikariDataSource HikariPool-1 - Shutdown initiated...
2022-01-19 10:46:34:063 [Thread-46] INFO  com.zaxxer.hikari.HikariDataSource HikariPool-1 - Shutdown completed.
2022-01-19 10:57:42:121 [restartedMain] INFO  com.ivan.sunnyblog.SunnyBlogApplication Starting SunnyBlogApplication on Jinghaos-MacBook-Air.local with PID 2219 (/Users/jinghaoliang/Documents/tech/Project/gitproject/blog/blog_backend/target/classes started by jinghaoliang in /Users/jinghaoliang/Documents/tech/Project/gitproject/blog/blog_backend)
2022-01-19 10:57:42:123 [restartedMain] INFO  com.ivan.sunnyblog.SunnyBlogApplication No active profile set, falling back to default profiles: default
2022-01-19 10:57:42:144 [restartedMain] INFO  org.springframework.boot.devtools.env.DevToolsPropertyDefaultsPostProcessor Devtools property defaults active! Set 'spring.devtools.add-properties' to 'false' to disable
2022-01-19 10:57:42:144 [restartedMain] INFO  org.springframework.boot.devtools.env.DevToolsPropertyDefaultsPostProcessor For additional web related logging consider setting the 'logging.level.web' property to 'DEBUG'
2022-01-19 10:57:42:513 [restartedMain] INFO  org.springframework.data.repository.config.RepositoryConfigurationDelegate Multiple Spring Data modules found, entering strict repository configuration mode!
2022-01-19 10:57:42:515 [restartedMain] INFO  org.springframework.data.repository.config.RepositoryConfigurationDelegate Bootstrapping Spring Data repositories in DEFAULT mode.
2022-01-19 10:57:42:542 [restartedMain] INFO  org.springframework.data.repository.config.RepositoryConfigurationDelegate Finished Spring Data repository scanning in 20ms. Found 0 repository interfaces.
2022-01-19 10:57:42:737 [restartedMain] INFO  o.s.context.support.PostProcessorRegistrationDelegate$BeanPostProcessorChecker Bean 'org.springframework.transaction.annotation.ProxyTransactionManagementConfiguration' of type [org.springframework.transaction.annotation.ProxyTransactionManagementConfiguration$$EnhancerBySpringCGLIB$$953b437a] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2022-01-19 10:57:42:917 [restartedMain] INFO  org.springframework.boot.web.embedded.tomcat.TomcatWebServer Tomcat initialized with port(s): 8081 (http)
2022-01-19 10:57:42:923 [restartedMain] INFO  org.apache.coyote.http11.Http11NioProtocol Initializing ProtocolHandler ["http-nio-8081"]
2022-01-19 10:57:42:929 [restartedMain] INFO  org.apache.catalina.core.StandardService Starting service [Tomcat]
2022-01-19 10:57:42:929 [restartedMain] INFO  org.apache.catalina.core.StandardEngine Starting Servlet engine: [Apache Tomcat/9.0.21]
2022-01-19 10:57:43:005 [restartedMain] INFO  org.apache.catalina.core.ContainerBase.[Tomcat].[localhost].[/] Initializing Spring embedded WebApplicationContext
2022-01-19 10:57:43:005 [restartedMain] INFO  org.springframework.web.context.ContextLoader Root WebApplicationContext: initialization completed in 861 ms
2022-01-19 10:57:43:168 [restartedMain] INFO  com.zaxxer.hikari.HikariDataSource HikariPool-1 - Starting...
2022-01-19 10:57:43:224 [restartedMain] INFO  com.zaxxer.hikari.HikariDataSource HikariPool-1 - Start completed.
2022-01-19 10:58:03:139 [restartedMain] INFO  org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor Autowired annotation is not supported on static fields: static com.amazonaws.services.s3.AmazonS3 com.ivan.sunnyblog.web.res.S3ResourceManager.s3Client
2022-01-19 10:58:03:531 [restartedMain] INFO  org.springframework.scheduling.concurrent.ThreadPoolTaskExecutor Initializing ExecutorService 'applicationTaskExecutor'
2022-01-19 10:58:03:704 [restartedMain] INFO  org.springframework.scheduling.concurrent.ThreadPoolTaskScheduler Initializing ExecutorService 'taskScheduler'
2022-01-19 10:58:03:724 [restartedMain] INFO  org.springframework.boot.devtools.autoconfigure.OptionalLiveReloadServer LiveReload server is running on port 35729
2022-01-19 10:58:03:766 [restartedMain] INFO  org.apache.coyote.http11.Http11NioProtocol Starting ProtocolHandler ["http-nio-8081"]
2022-01-19 10:58:03:780 [restartedMain] INFO  org.springframework.boot.web.embedded.tomcat.TomcatWebServer Tomcat started on port(s): 8081 (http) with context path ''
2022-01-19 10:58:03:782 [restartedMain] INFO  com.ivan.sunnyblog.SunnyBlogApplication Started SunnyBlogApplication in 21.894 seconds (JVM running for 22.554)
2022-01-19 11:02:41:362 [http-nio-8081-exec-2] INFO  org.apache.catalina.core.ContainerBase.[Tomcat].[localhost].[/] Initializing Spring DispatcherServlet 'dispatcherServlet'
2022-01-19 11:02:41:362 [http-nio-8081-exec-2] INFO  org.springframework.web.servlet.DispatcherServlet Initializing Servlet 'dispatcherServlet'
2022-01-19 11:02:41:367 [http-nio-8081-exec-2] INFO  org.springframework.web.servlet.DispatcherServlet Completed initialization in 5 ms
2022-01-19 11:02:41:569 [http-nio-8081-exec-6] INFO  org.jooq.Constants 
                                      
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@  @@        @@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@        @@@@@@@@@@
@@@@@@@@@@@@@@@@  @@  @@    @@@@@@@@@@
@@@@@@@@@@  @@@@  @@  @@    @@@@@@@@@@
@@@@@@@@@@        @@        @@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@        @@        @@@@@@@@@@
@@@@@@@@@@    @@  @@  @@@@  @@@@@@@@@@
@@@@@@@@@@    @@  @@  @@@@  @@@@@@@@@@
@@@@@@@@@@        @@  @  @  @@@@@@@@@@
@@@@@@@@@@        @@        @@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@  @@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@  Thank you for using jOOQ 3.11.11
                                      
2022-01-19 11:02:41:629 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:02:41:629 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:02:41:629 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:02:41:629 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:02:41:629 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/categories
2022-01-19 11:02:41:629 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CategoryContoller.getCategories
2022-01-19 11:02:41:629 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:02:41:629 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: {}
2022-01-19 11:02:41:629 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:02:41:629 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/articles/hot
2022-01-19 11:02:41:629 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.ArticleController.getHotArticles
2022-01-19 11:02:41:629 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CategoryVo{categoryId=2, name='liddffd', articleCount=1}, CategoryVo{categoryId=1, name='Life ', articleCount=2}], total=null}
2022-01-19 11:02:41:629 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: {}
2022-01-19 11:02:41:629 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 236ms
2022-01-19 11:02:41:629 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:02:41:629 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[ArticleVo{userInfo=null, category=null, BaseArticleVo{articleId=10004, status=null, type=null, title='Spring boot', description='null', content='null', firstPicture='null', viewCount=174, createDate='Tue Oct 12 15:58:26 EDT 2021', updateDate='null'}}, ArticleVo{userInfo=null, category=null, BaseArticleVo{articleId=10005, status=null, type=null, title='dd', description='null', content='null', firstPicture='null', viewCount=83, createDate='Sun Nov 07 14:09:29 EST 2021', updateDate='null'}}, ArticleVo{userInfo=null, category=null, BaseArticleVo{articleId=10003, status=null, type=null, title='dd', description='null', content='null', firstPicture='null', viewCount=0, createDate='Tue Oct 12 15:57:33 EDT 2021', updateDate='null'}}], total=null}
2022-01-19 11:02:41:629 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 236ms
2022-01-19 11:02:41:630 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:02:41:653 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:02:41:654 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:02:41:654 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:02:41:654 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/articles
2022-01-19 11:02:41:654 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.ArticleController.getPublicArticles
2022-01-19 11:02:41:654 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: SearchVo{page=1, limit=10, categoryId=null, total=null}
2022-01-19 11:02:41:654 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[ArticleVo{userInfo=UserInfoVo{userId=100001, nickName='ivan', userName='ivan', avatar='https://res-blog-public.s3.ca-central-1.amazonaws.com/default_avatar.jpg'}, category=CategoryVo{categoryId=1, name='Life ', articleCount=null}, BaseArticleVo{articleId=10005, status=1, type=1, title='dd', description='This is the doc of React markdown editor lite.
Enjoy!!', content='null', firstPicture='', viewCount=83, createDate='Sun Nov 07 14:09:29 EST 2021', updateDate='Tue Jan 18 22:54:08 EST 2022'}}, ArticleVo{userInfo=UserInfoVo{userId=100001, nickName='ivan', userName='ivan', avatar='https://res-blog-public.s3.ca-central-1.amazonaws.com/default_avatar.jpg'}, category=CategoryVo{categoryId=2, name='liddffd', articleCount=null}, BaseArticleVo{articleId=10004, status=1, type=2, title='Spring boot', description='rerwerwer', content='null', firstPicture='', viewCount=174, createDate='Tue Oct 12 15:58:26 EDT 2021', updateDate='Tue Jan 18 22:56:37 EST 2022'}}, ArticleVo{userInfo=UserInfoVo{userId=100001, nickName='ivan', userName='ivan', avatar='https://res-blog-public.s3.ca-central-1.amazonaws.com/default_avatar.jpg'}, category=CategoryVo{categoryId=1, name='Life ', articleCount=null}, BaseArticleVo{articleId=10003, status=1, type=1, title='dd', description='test', content='null', firstPicture='', viewCount=0, createDate='Tue Oct 12 15:57:33 EDT 2021', updateDate='Tue Jan 18 22:53:20 EST 2022'}}], total=3}
2022-01-19 11:02:41:654 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 254ms
2022-01-19 11:02:41:654 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:04:00:392 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:04:00:393 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:04:00:393 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:04:00:393 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/categories
2022-01-19 11:04:00:393 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:04:00:393 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CategoryContoller.getCategories
2022-01-19 11:04:00:393 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:04:00:393 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: {}
2022-01-19 11:04:00:393 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:04:00:393 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CategoryVo{categoryId=2, name='liddffd', articleCount=1}, CategoryVo{categoryId=1, name='Life ', articleCount=2}], total=null}
2022-01-19 11:04:00:393 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/articles/hot
2022-01-19 11:04:00:393 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 14ms
2022-01-19 11:04:00:393 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.ArticleController.getHotArticles
2022-01-19 11:04:00:393 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: {}
2022-01-19 11:04:00:393 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:04:00:394 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[ArticleVo{userInfo=null, category=null, BaseArticleVo{articleId=10004, status=null, type=null, title='Spring boot', description='null', content='null', firstPicture='null', viewCount=174, createDate='Tue Oct 12 15:58:26 EDT 2021', updateDate='null'}}, ArticleVo{userInfo=null, category=null, BaseArticleVo{articleId=10005, status=null, type=null, title='dd', description='null', content='null', firstPicture='null', viewCount=83, createDate='Sun Nov 07 14:09:29 EST 2021', updateDate='null'}}, ArticleVo{userInfo=null, category=null, BaseArticleVo{articleId=10003, status=null, type=null, title='dd', description='null', content='null', firstPicture='null', viewCount=0, createDate='Tue Oct 12 15:57:33 EDT 2021', updateDate='null'}}], total=null}
2022-01-19 11:04:00:394 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 15ms
2022-01-19 11:04:00:394 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:04:00:408 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:04:00:408 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:04:00:409 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:04:00:409 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/articles
2022-01-19 11:04:00:409 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.ArticleController.getPublicArticles
2022-01-19 11:04:00:409 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: SearchVo{page=1, limit=10, categoryId=null, total=null}
2022-01-19 11:04:00:409 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[ArticleVo{userInfo=UserInfoVo{userId=100001, nickName='ivan', userName='ivan', avatar='https://res-blog-public.s3.ca-central-1.amazonaws.com/default_avatar.jpg'}, category=CategoryVo{categoryId=1, name='Life ', articleCount=null}, BaseArticleVo{articleId=10005, status=1, type=1, title='dd', description='This is the doc of React markdown editor lite.
Enjoy!!', content='null', firstPicture='', viewCount=83, createDate='Sun Nov 07 14:09:29 EST 2021', updateDate='Tue Jan 18 22:54:08 EST 2022'}}, ArticleVo{userInfo=UserInfoVo{userId=100001, nickName='ivan', userName='ivan', avatar='https://res-blog-public.s3.ca-central-1.amazonaws.com/default_avatar.jpg'}, category=CategoryVo{categoryId=2, name='liddffd', articleCount=null}, BaseArticleVo{articleId=10004, status=1, type=2, title='Spring boot', description='rerwerwer', content='null', firstPicture='', viewCount=174, createDate='Tue Oct 12 15:58:26 EDT 2021', updateDate='Tue Jan 18 22:56:37 EST 2022'}}, ArticleVo{userInfo=UserInfoVo{userId=100001, nickName='ivan', userName='ivan', avatar='https://res-blog-public.s3.ca-central-1.amazonaws.com/default_avatar.jpg'}, category=CategoryVo{categoryId=1, name='Life ', articleCount=null}, BaseArticleVo{articleId=10003, status=1, type=1, title='dd', description='test', content='null', firstPicture='', viewCount=0, createDate='Tue Oct 12 15:57:33 EDT 2021', updateDate='Tue Jan 18 22:53:20 EST 2022'}}], total=3}
2022-01-19 11:04:00:409 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 30ms
2022-01-19 11:04:00:409 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:04:32:496 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:04:32:497 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:04:32:497 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:04:32:497 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:04:32:497 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/categories
2022-01-19 11:04:32:497 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:04:32:497 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CategoryContoller.getCategories
2022-01-19 11:04:32:497 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:04:32:497 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: {}
2022-01-19 11:04:32:497 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/articles/hot
2022-01-19 11:04:32:497 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CategoryVo{categoryId=2, name='liddffd', articleCount=1}, CategoryVo{categoryId=1, name='Life ', articleCount=2}], total=null}
2022-01-19 11:04:32:497 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.ArticleController.getHotArticles
2022-01-19 11:04:32:497 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 5ms
2022-01-19 11:04:32:497 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: {}
2022-01-19 11:04:32:497 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:04:32:497 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[ArticleVo{userInfo=null, category=null, BaseArticleVo{articleId=10004, status=null, type=null, title='Spring boot', description='null', content='null', firstPicture='null', viewCount=174, createDate='Tue Oct 12 15:58:26 EDT 2021', updateDate='null'}}, ArticleVo{userInfo=null, category=null, BaseArticleVo{articleId=10005, status=null, type=null, title='dd', description='null', content='null', firstPicture='null', viewCount=83, createDate='Sun Nov 07 14:09:29 EST 2021', updateDate='null'}}, ArticleVo{userInfo=null, category=null, BaseArticleVo{articleId=10003, status=null, type=null, title='dd', description='null', content='null', firstPicture='null', viewCount=0, createDate='Tue Oct 12 15:57:33 EDT 2021', updateDate='null'}}], total=null}
2022-01-19 11:04:32:497 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 6ms
2022-01-19 11:04:32:497 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:04:32:522 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:04:32:523 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:04:32:523 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:04:32:523 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/articles
2022-01-19 11:04:32:523 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.ArticleController.getPublicArticles
2022-01-19 11:04:32:523 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: SearchVo{page=1, limit=10, categoryId=null, total=null}
2022-01-19 11:04:32:523 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[ArticleVo{userInfo=UserInfoVo{userId=100001, nickName='ivan', userName='ivan', avatar='https://res-blog-public.s3.ca-central-1.amazonaws.com/default_avatar.jpg'}, category=CategoryVo{categoryId=1, name='Life ', articleCount=null}, BaseArticleVo{articleId=10005, status=1, type=1, title='dd', description='This is the doc of React markdown editor lite.
Enjoy!!', content='null', firstPicture='', viewCount=83, createDate='Sun Nov 07 14:09:29 EST 2021', updateDate='Tue Jan 18 22:54:08 EST 2022'}}, ArticleVo{userInfo=UserInfoVo{userId=100001, nickName='ivan', userName='ivan', avatar='https://res-blog-public.s3.ca-central-1.amazonaws.com/default_avatar.jpg'}, category=CategoryVo{categoryId=2, name='liddffd', articleCount=null}, BaseArticleVo{articleId=10004, status=1, type=2, title='Spring boot', description='rerwerwer', content='null', firstPicture='', viewCount=174, createDate='Tue Oct 12 15:58:26 EDT 2021', updateDate='Tue Jan 18 22:56:37 EST 2022'}}, ArticleVo{userInfo=UserInfoVo{userId=100001, nickName='ivan', userName='ivan', avatar='https://res-blog-public.s3.ca-central-1.amazonaws.com/default_avatar.jpg'}, category=CategoryVo{categoryId=1, name='Life ', articleCount=null}, BaseArticleVo{articleId=10003, status=1, type=1, title='dd', description='test', content='null', firstPicture='', viewCount=0, createDate='Tue Oct 12 15:57:33 EDT 2021', updateDate='Tue Jan 18 22:53:20 EST 2022'}}], total=3}
2022-01-19 11:04:32:523 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 31ms
2022-01-19 11:04:32:523 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:04:36:816 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:04:36:816 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:04:36:816 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:04:36:816 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:04:36:816 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:04:36:816 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:04:36:816 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10004
2022-01-19 11:04:36:816 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10004
2022-01-19 11:04:36:816 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 11:04:36:816 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 11:04:36:816 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10004
2022-01-19 11:04:36:816 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10004
2022-01-19 11:04:36:816 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=18createdate=Sun Jan 09 10:06:04 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/81.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsdf@qq.com', nickname='sf', parentCommentNickname='null', content='sdfsf', status='0'}}, CommentListVo{commentId=17createdate=Sun Jan 09 10:05:33 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/57.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsd@Ck.com', nickname='sfsf', parentCommentNickname='null', content='hdsfsd', status='0'}}, CommentListVo{commentId=16createdate=Sun Jan 09 10:03:48 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/90.png, replyComments=[CommentListVo{commentId=19createdate=Mon Jan 10 09:47:47 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/73.png, replyComments=[], CommentVo=CommentVo{parentCommentId=16, articleId=10004, email='sdfsd@Ck.com', nickname='ivan', parentCommentNickname='sfs@ss.c', content='dfjgg', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='null', content='what?', status='0'}}, CommentListVo{commentId=11createdate=Wed Dec 01 22:44:50 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=12createdate=Wed Dec 01 22:45:18 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=15createdate=Wed Dec 01 23:42:17 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='555@test.com', nickname='555', parentCommentNickname='jess', content='555', status='0'}}, CommentListVo{commentId=13createdate=Wed Dec 01 22:45:56 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=14createdate=Wed Dec 01 22:46:22 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=13, articleId=10004, email='hah@gmail.com', nickname='haha', parentCommentNickname='test', content='hahah', status='0'}}], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='test@gg.com', nickname='test', parentCommentNickname='jess', content='great!', status='0'}}], CommentVo=CommentVo{parentCommentId=11, articleId=10004, email='jess@gmail.com', nickname='jess', parentCommentNickname='ivan', content='I am doing well. You?', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='ivanliang0818@gmail.com', nickname='ivan', parentCommentNickname='null', content='How are you doing today?', status='0'}}], total=4}
2022-01-19 11:04:36:816 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=18createdate=Sun Jan 09 10:06:04 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/81.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsdf@qq.com', nickname='sf', parentCommentNickname='null', content='sdfsf', status='0'}}, CommentListVo{commentId=17createdate=Sun Jan 09 10:05:33 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/57.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsd@Ck.com', nickname='sfsf', parentCommentNickname='null', content='hdsfsd', status='0'}}, CommentListVo{commentId=16createdate=Sun Jan 09 10:03:48 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/90.png, replyComments=[CommentListVo{commentId=19createdate=Mon Jan 10 09:47:47 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/73.png, replyComments=[], CommentVo=CommentVo{parentCommentId=16, articleId=10004, email='sdfsd@Ck.com', nickname='ivan', parentCommentNickname='sfs@ss.c', content='dfjgg', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='null', content='what?', status='0'}}, CommentListVo{commentId=11createdate=Wed Dec 01 22:44:50 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=12createdate=Wed Dec 01 22:45:18 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=15createdate=Wed Dec 01 23:42:17 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='555@test.com', nickname='555', parentCommentNickname='jess', content='555', status='0'}}, CommentListVo{commentId=13createdate=Wed Dec 01 22:45:56 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=14createdate=Wed Dec 01 22:46:22 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=13, articleId=10004, email='hah@gmail.com', nickname='haha', parentCommentNickname='test', content='hahah', status='0'}}], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='test@gg.com', nickname='test', parentCommentNickname='jess', content='great!', status='0'}}], CommentVo=CommentVo{parentCommentId=11, articleId=10004, email='jess@gmail.com', nickname='jess', parentCommentNickname='ivan', content='I am doing well. You?', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='ivanliang0818@gmail.com', nickname='ivan', parentCommentNickname='null', content='How are you doing today?', status='0'}}], total=4}
2022-01-19 11:04:36:817 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 52ms
2022-01-19 11:04:36:817 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 52ms
2022-01-19 11:04:36:817 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:04:36:817 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:04:36:851 [http-nio-8081-exec-3] INFO  io.lettuce.core.EpollProvider Starting without optional epoll library
2022-01-19 11:04:36:852 [http-nio-8081-exec-3] INFO  io.lettuce.core.KqueueProvider Starting without optional kqueue library
2022-01-19 11:04:37:159 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:04:37:159 [http-nio-8081-exec-3] ERROR com.ivan.sunnyblog.web.aop.ControllerAspect Request failed
2022-01-19 11:04:37:159 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:04:37:159 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/article/10004
2022-01-19 11:04:37:159 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.ArticleController.getPublicArticleDetail
2022-01-19 11:04:37:159 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10004
2022-01-19 11:04:37:159 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: null
2022-01-19 11:04:37:160 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 397ms
2022-01-19 11:04:37:160 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:04:37:161 [http-nio-8081-exec-3] WARN  org.springframework.web.servlet.mvc.method.annotation.ExceptionHandlerExceptionResolver Resolved [org.springframework.data.redis.RedisConnectionFailureException: Unable to connect to Redis; nested exception is io.lettuce.core.RedisConnectionException: Unable to connect to localhost:6379]
2022-01-19 11:05:31:799 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:05:31:800 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:05:31:800 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:05:31:800 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10004
2022-01-19 11:05:31:800 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 11:05:31:800 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10004
2022-01-19 11:05:31:800 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=18createdate=Sun Jan 09 10:06:04 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/81.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsdf@qq.com', nickname='sf', parentCommentNickname='null', content='sdfsf', status='0'}}, CommentListVo{commentId=17createdate=Sun Jan 09 10:05:33 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/57.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsd@Ck.com', nickname='sfsf', parentCommentNickname='null', content='hdsfsd', status='0'}}, CommentListVo{commentId=16createdate=Sun Jan 09 10:03:48 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/90.png, replyComments=[CommentListVo{commentId=19createdate=Mon Jan 10 09:47:47 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/73.png, replyComments=[], CommentVo=CommentVo{parentCommentId=16, articleId=10004, email='sdfsd@Ck.com', nickname='ivan', parentCommentNickname='sfs@ss.c', content='dfjgg', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='null', content='what?', status='0'}}, CommentListVo{commentId=11createdate=Wed Dec 01 22:44:50 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=12createdate=Wed Dec 01 22:45:18 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=15createdate=Wed Dec 01 23:42:17 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='555@test.com', nickname='555', parentCommentNickname='jess', content='555', status='0'}}, CommentListVo{commentId=13createdate=Wed Dec 01 22:45:56 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=14createdate=Wed Dec 01 22:46:22 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=13, articleId=10004, email='hah@gmail.com', nickname='haha', parentCommentNickname='test', content='hahah', status='0'}}], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='test@gg.com', nickname='test', parentCommentNickname='jess', content='great!', status='0'}}], CommentVo=CommentVo{parentCommentId=11, articleId=10004, email='jess@gmail.com', nickname='jess', parentCommentNickname='ivan', content='I am doing well. You?', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='ivanliang0818@gmail.com', nickname='ivan', parentCommentNickname='null', content='How are you doing today?', status='0'}}], total=4}
2022-01-19 11:05:31:800 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 24ms
2022-01-19 11:05:31:800 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:05:31:802 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:05:31:802 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:05:31:802 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:05:31:802 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10004
2022-01-19 11:05:31:802 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 11:05:31:802 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10004
2022-01-19 11:05:31:802 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=18createdate=Sun Jan 09 10:06:04 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/81.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsdf@qq.com', nickname='sf', parentCommentNickname='null', content='sdfsf', status='0'}}, CommentListVo{commentId=17createdate=Sun Jan 09 10:05:33 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/57.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsd@Ck.com', nickname='sfsf', parentCommentNickname='null', content='hdsfsd', status='0'}}, CommentListVo{commentId=16createdate=Sun Jan 09 10:03:48 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/90.png, replyComments=[CommentListVo{commentId=19createdate=Mon Jan 10 09:47:47 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/73.png, replyComments=[], CommentVo=CommentVo{parentCommentId=16, articleId=10004, email='sdfsd@Ck.com', nickname='ivan', parentCommentNickname='sfs@ss.c', content='dfjgg', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='null', content='what?', status='0'}}, CommentListVo{commentId=11createdate=Wed Dec 01 22:44:50 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=12createdate=Wed Dec 01 22:45:18 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=15createdate=Wed Dec 01 23:42:17 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='555@test.com', nickname='555', parentCommentNickname='jess', content='555', status='0'}}, CommentListVo{commentId=13createdate=Wed Dec 01 22:45:56 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=14createdate=Wed Dec 01 22:46:22 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=13, articleId=10004, email='hah@gmail.com', nickname='haha', parentCommentNickname='test', content='hahah', status='0'}}], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='test@gg.com', nickname='test', parentCommentNickname='jess', content='great!', status='0'}}], CommentVo=CommentVo{parentCommentId=11, articleId=10004, email='jess@gmail.com', nickname='jess', parentCommentNickname='ivan', content='I am doing well. You?', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='ivanliang0818@gmail.com', nickname='ivan', parentCommentNickname='null', content='How are you doing today?', status='0'}}], total=4}
2022-01-19 11:05:31:802 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 25ms
2022-01-19 11:05:31:802 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:05:31:811 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:05:31:811 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:05:31:811 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:05:31:811 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/article/10004
2022-01-19 11:05:31:811 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.ArticleController.getPublicArticleDetail
2022-01-19 11:05:31:811 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10004
2022-01-19 11:05:31:811 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=ArticleVo{userInfo=UserInfoVo{userId=100001, nickName='ivan', userName='ivan', avatar='https://res-blog-public.s3.ca-central-1.amazonaws.com/default_avatar.jpg'}, category=CategoryVo{categoryId=2, name='liddffd', articleCount=null}, BaseArticleVo{articleId=10004, status=1, type=2, title='Spring boot', description='rerwerwer', content='rererer![test.png](https://s3.ca-central-1.amazonaws.com/res-blog-public/res-dev/blog_1636947281578_test.png)', firstPicture='', viewCount=174, createDate='Tue Oct 12 15:58:26 EDT 2021', updateDate='Tue Jan 18 22:56:37 EST 2022'}}, total=null}
2022-01-19 11:05:31:811 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 37ms
2022-01-19 11:05:31:811 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:05:32:245 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:05:32:245 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:05:32:245 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:05:32:246 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10004
2022-01-19 11:05:32:246 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 11:05:32:246 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10004
2022-01-19 11:05:32:246 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=18createdate=Sun Jan 09 10:06:04 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/81.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsdf@qq.com', nickname='sf', parentCommentNickname='null', content='sdfsf', status='0'}}, CommentListVo{commentId=17createdate=Sun Jan 09 10:05:33 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/57.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsd@Ck.com', nickname='sfsf', parentCommentNickname='null', content='hdsfsd', status='0'}}, CommentListVo{commentId=16createdate=Sun Jan 09 10:03:48 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/90.png, replyComments=[CommentListVo{commentId=19createdate=Mon Jan 10 09:47:47 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/73.png, replyComments=[], CommentVo=CommentVo{parentCommentId=16, articleId=10004, email='sdfsd@Ck.com', nickname='ivan', parentCommentNickname='sfs@ss.c', content='dfjgg', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='null', content='what?', status='0'}}, CommentListVo{commentId=11createdate=Wed Dec 01 22:44:50 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=12createdate=Wed Dec 01 22:45:18 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=15createdate=Wed Dec 01 23:42:17 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='555@test.com', nickname='555', parentCommentNickname='jess', content='555', status='0'}}, CommentListVo{commentId=13createdate=Wed Dec 01 22:45:56 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=14createdate=Wed Dec 01 22:46:22 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=13, articleId=10004, email='hah@gmail.com', nickname='haha', parentCommentNickname='test', content='hahah', status='0'}}], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='test@gg.com', nickname='test', parentCommentNickname='jess', content='great!', status='0'}}], CommentVo=CommentVo{parentCommentId=11, articleId=10004, email='jess@gmail.com', nickname='jess', parentCommentNickname='ivan', content='I am doing well. You?', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='ivanliang0818@gmail.com', nickname='ivan', parentCommentNickname='null', content='How are you doing today?', status='0'}}], total=4}
2022-01-19 11:05:32:246 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 8ms
2022-01-19 11:05:32:246 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:06:10:021 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:06:10:021 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:06:10:021 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:06:10:021 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/article/10004
2022-01-19 11:06:10:021 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.ArticleController.getPublicArticleDetail
2022-01-19 11:06:10:021 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10004
2022-01-19 11:06:10:021 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=ArticleVo{userInfo=UserInfoVo{userId=100001, nickName='ivan', userName='ivan', avatar='https://res-blog-public.s3.ca-central-1.amazonaws.com/default_avatar.jpg'}, category=CategoryVo{categoryId=2, name='liddffd', articleCount=null}, BaseArticleVo{articleId=10004, status=1, type=2, title='Spring boot', description='rerwerwer', content='rererer![test.png](https://s3.ca-central-1.amazonaws.com/res-blog-public/res-dev/blog_1636947281578_test.png)', firstPicture='', viewCount=174, createDate='Tue Oct 12 15:58:26 EDT 2021', updateDate='Tue Jan 18 22:56:37 EST 2022'}}, total=null}
2022-01-19 11:06:10:021 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 10ms
2022-01-19 11:06:10:021 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:06:10:026 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:06:10:026 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:06:10:026 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:06:10:027 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10004
2022-01-19 11:06:10:027 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 11:06:10:027 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10004
2022-01-19 11:06:10:027 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=18createdate=Sun Jan 09 10:06:04 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/81.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsdf@qq.com', nickname='sf', parentCommentNickname='null', content='sdfsf', status='0'}}, CommentListVo{commentId=17createdate=Sun Jan 09 10:05:33 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/57.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsd@Ck.com', nickname='sfsf', parentCommentNickname='null', content='hdsfsd', status='0'}}, CommentListVo{commentId=16createdate=Sun Jan 09 10:03:48 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/90.png, replyComments=[CommentListVo{commentId=19createdate=Mon Jan 10 09:47:47 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/73.png, replyComments=[], CommentVo=CommentVo{parentCommentId=16, articleId=10004, email='sdfsd@Ck.com', nickname='ivan', parentCommentNickname='sfs@ss.c', content='dfjgg', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='null', content='what?', status='0'}}, CommentListVo{commentId=11createdate=Wed Dec 01 22:44:50 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=12createdate=Wed Dec 01 22:45:18 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=15createdate=Wed Dec 01 23:42:17 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='555@test.com', nickname='555', parentCommentNickname='jess', content='555', status='0'}}, CommentListVo{commentId=13createdate=Wed Dec 01 22:45:56 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=14createdate=Wed Dec 01 22:46:22 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=13, articleId=10004, email='hah@gmail.com', nickname='haha', parentCommentNickname='test', content='hahah', status='0'}}], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='test@gg.com', nickname='test', parentCommentNickname='jess', content='great!', status='0'}}], CommentVo=CommentVo{parentCommentId=11, articleId=10004, email='jess@gmail.com', nickname='jess', parentCommentNickname='ivan', content='I am doing well. You?', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='ivanliang0818@gmail.com', nickname='ivan', parentCommentNickname='null', content='How are you doing today?', status='0'}}], total=4}
2022-01-19 11:06:10:027 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 15ms
2022-01-19 11:06:10:027 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:06:10:030 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:06:10:030 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:06:10:030 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:06:10:030 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10004
2022-01-19 11:06:10:030 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 11:06:10:030 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10004
2022-01-19 11:06:10:030 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=18createdate=Sun Jan 09 10:06:04 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/81.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsdf@qq.com', nickname='sf', parentCommentNickname='null', content='sdfsf', status='0'}}, CommentListVo{commentId=17createdate=Sun Jan 09 10:05:33 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/57.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsd@Ck.com', nickname='sfsf', parentCommentNickname='null', content='hdsfsd', status='0'}}, CommentListVo{commentId=16createdate=Sun Jan 09 10:03:48 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/90.png, replyComments=[CommentListVo{commentId=19createdate=Mon Jan 10 09:47:47 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/73.png, replyComments=[], CommentVo=CommentVo{parentCommentId=16, articleId=10004, email='sdfsd@Ck.com', nickname='ivan', parentCommentNickname='sfs@ss.c', content='dfjgg', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='null', content='what?', status='0'}}, CommentListVo{commentId=11createdate=Wed Dec 01 22:44:50 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=12createdate=Wed Dec 01 22:45:18 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=15createdate=Wed Dec 01 23:42:17 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='555@test.com', nickname='555', parentCommentNickname='jess', content='555', status='0'}}, CommentListVo{commentId=13createdate=Wed Dec 01 22:45:56 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=14createdate=Wed Dec 01 22:46:22 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=13, articleId=10004, email='hah@gmail.com', nickname='haha', parentCommentNickname='test', content='hahah', status='0'}}], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='test@gg.com', nickname='test', parentCommentNickname='jess', content='great!', status='0'}}], CommentVo=CommentVo{parentCommentId=11, articleId=10004, email='jess@gmail.com', nickname='jess', parentCommentNickname='ivan', content='I am doing well. You?', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='ivanliang0818@gmail.com', nickname='ivan', parentCommentNickname='null', content='How are you doing today?', status='0'}}], total=4}
2022-01-19 11:06:10:030 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 19ms
2022-01-19 11:06:10:031 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:06:10:480 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:06:10:480 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:06:10:480 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:06:10:480 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10004
2022-01-19 11:06:10:480 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 11:06:10:480 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10004
2022-01-19 11:06:10:480 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=18createdate=Sun Jan 09 10:06:04 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/81.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsdf@qq.com', nickname='sf', parentCommentNickname='null', content='sdfsf', status='0'}}, CommentListVo{commentId=17createdate=Sun Jan 09 10:05:33 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/57.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsd@Ck.com', nickname='sfsf', parentCommentNickname='null', content='hdsfsd', status='0'}}, CommentListVo{commentId=16createdate=Sun Jan 09 10:03:48 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/90.png, replyComments=[CommentListVo{commentId=19createdate=Mon Jan 10 09:47:47 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/73.png, replyComments=[], CommentVo=CommentVo{parentCommentId=16, articleId=10004, email='sdfsd@Ck.com', nickname='ivan', parentCommentNickname='sfs@ss.c', content='dfjgg', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='null', content='what?', status='0'}}, CommentListVo{commentId=11createdate=Wed Dec 01 22:44:50 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=12createdate=Wed Dec 01 22:45:18 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=15createdate=Wed Dec 01 23:42:17 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='555@test.com', nickname='555', parentCommentNickname='jess', content='555', status='0'}}, CommentListVo{commentId=13createdate=Wed Dec 01 22:45:56 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=14createdate=Wed Dec 01 22:46:22 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=13, articleId=10004, email='hah@gmail.com', nickname='haha', parentCommentNickname='test', content='hahah', status='0'}}], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='test@gg.com', nickname='test', parentCommentNickname='jess', content='great!', status='0'}}], CommentVo=CommentVo{parentCommentId=11, articleId=10004, email='jess@gmail.com', nickname='jess', parentCommentNickname='ivan', content='I am doing well. You?', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='ivanliang0818@gmail.com', nickname='ivan', parentCommentNickname='null', content='How are you doing today?', status='0'}}], total=4}
2022-01-19 11:06:10:481 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 12ms
2022-01-19 11:06:10:481 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:06:34:468 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:06:34:468 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:06:34:468 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:06:34:468 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/article/10004
2022-01-19 11:06:34:468 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.ArticleController.getPublicArticleDetail
2022-01-19 11:06:34:468 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10004
2022-01-19 11:06:34:468 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=ArticleVo{userInfo=UserInfoVo{userId=100001, nickName='ivan', userName='ivan', avatar='https://res-blog-public.s3.ca-central-1.amazonaws.com/default_avatar.jpg'}, category=CategoryVo{categoryId=2, name='liddffd', articleCount=null}, BaseArticleVo{articleId=10004, status=1, type=2, title='Spring boot', description='rerwerwer', content='rererer![test.png](https://s3.ca-central-1.amazonaws.com/res-blog-public/res-dev/blog_1636947281578_test.png)', firstPicture='', viewCount=174, createDate='Tue Oct 12 15:58:26 EDT 2021', updateDate='Tue Jan 18 22:56:37 EST 2022'}}, total=null}
2022-01-19 11:06:34:468 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 7ms
2022-01-19 11:06:34:468 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:06:34:477 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:06:34:478 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:06:34:478 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:06:34:478 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10004
2022-01-19 11:06:34:478 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 11:06:34:478 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10004
2022-01-19 11:06:34:478 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=18createdate=Sun Jan 09 10:06:04 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/81.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsdf@qq.com', nickname='sf', parentCommentNickname='null', content='sdfsf', status='0'}}, CommentListVo{commentId=17createdate=Sun Jan 09 10:05:33 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/57.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsd@Ck.com', nickname='sfsf', parentCommentNickname='null', content='hdsfsd', status='0'}}, CommentListVo{commentId=16createdate=Sun Jan 09 10:03:48 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/90.png, replyComments=[CommentListVo{commentId=19createdate=Mon Jan 10 09:47:47 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/73.png, replyComments=[], CommentVo=CommentVo{parentCommentId=16, articleId=10004, email='sdfsd@Ck.com', nickname='ivan', parentCommentNickname='sfs@ss.c', content='dfjgg', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='null', content='what?', status='0'}}, CommentListVo{commentId=11createdate=Wed Dec 01 22:44:50 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=12createdate=Wed Dec 01 22:45:18 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=15createdate=Wed Dec 01 23:42:17 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='555@test.com', nickname='555', parentCommentNickname='jess', content='555', status='0'}}, CommentListVo{commentId=13createdate=Wed Dec 01 22:45:56 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=14createdate=Wed Dec 01 22:46:22 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=13, articleId=10004, email='hah@gmail.com', nickname='haha', parentCommentNickname='test', content='hahah', status='0'}}], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='test@gg.com', nickname='test', parentCommentNickname='jess', content='great!', status='0'}}], CommentVo=CommentVo{parentCommentId=11, articleId=10004, email='jess@gmail.com', nickname='jess', parentCommentNickname='ivan', content='I am doing well. You?', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='ivanliang0818@gmail.com', nickname='ivan', parentCommentNickname='null', content='How are you doing today?', status='0'}}], total=4}
2022-01-19 11:06:34:478 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 16ms
2022-01-19 11:06:34:478 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:06:34:480 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:06:34:480 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:06:34:480 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:06:34:480 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10004
2022-01-19 11:06:34:480 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 11:06:34:480 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10004
2022-01-19 11:06:34:480 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=18createdate=Sun Jan 09 10:06:04 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/81.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsdf@qq.com', nickname='sf', parentCommentNickname='null', content='sdfsf', status='0'}}, CommentListVo{commentId=17createdate=Sun Jan 09 10:05:33 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/57.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsd@Ck.com', nickname='sfsf', parentCommentNickname='null', content='hdsfsd', status='0'}}, CommentListVo{commentId=16createdate=Sun Jan 09 10:03:48 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/90.png, replyComments=[CommentListVo{commentId=19createdate=Mon Jan 10 09:47:47 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/73.png, replyComments=[], CommentVo=CommentVo{parentCommentId=16, articleId=10004, email='sdfsd@Ck.com', nickname='ivan', parentCommentNickname='sfs@ss.c', content='dfjgg', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='null', content='what?', status='0'}}, CommentListVo{commentId=11createdate=Wed Dec 01 22:44:50 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=12createdate=Wed Dec 01 22:45:18 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=15createdate=Wed Dec 01 23:42:17 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='555@test.com', nickname='555', parentCommentNickname='jess', content='555', status='0'}}, CommentListVo{commentId=13createdate=Wed Dec 01 22:45:56 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=14createdate=Wed Dec 01 22:46:22 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=13, articleId=10004, email='hah@gmail.com', nickname='haha', parentCommentNickname='test', content='hahah', status='0'}}], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='test@gg.com', nickname='test', parentCommentNickname='jess', content='great!', status='0'}}], CommentVo=CommentVo{parentCommentId=11, articleId=10004, email='jess@gmail.com', nickname='jess', parentCommentNickname='ivan', content='I am doing well. You?', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='ivanliang0818@gmail.com', nickname='ivan', parentCommentNickname='null', content='How are you doing today?', status='0'}}], total=4}
2022-01-19 11:06:34:480 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 19ms
2022-01-19 11:06:34:480 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:06:34:929 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:06:34:929 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:06:34:929 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:06:34:929 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10004
2022-01-19 11:06:34:929 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 11:06:34:929 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10004
2022-01-19 11:06:34:929 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=18createdate=Sun Jan 09 10:06:04 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/81.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsdf@qq.com', nickname='sf', parentCommentNickname='null', content='sdfsf', status='0'}}, CommentListVo{commentId=17createdate=Sun Jan 09 10:05:33 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/57.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsd@Ck.com', nickname='sfsf', parentCommentNickname='null', content='hdsfsd', status='0'}}, CommentListVo{commentId=16createdate=Sun Jan 09 10:03:48 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/90.png, replyComments=[CommentListVo{commentId=19createdate=Mon Jan 10 09:47:47 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/73.png, replyComments=[], CommentVo=CommentVo{parentCommentId=16, articleId=10004, email='sdfsd@Ck.com', nickname='ivan', parentCommentNickname='sfs@ss.c', content='dfjgg', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='null', content='what?', status='0'}}, CommentListVo{commentId=11createdate=Wed Dec 01 22:44:50 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=12createdate=Wed Dec 01 22:45:18 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=15createdate=Wed Dec 01 23:42:17 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='555@test.com', nickname='555', parentCommentNickname='jess', content='555', status='0'}}, CommentListVo{commentId=13createdate=Wed Dec 01 22:45:56 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=14createdate=Wed Dec 01 22:46:22 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=13, articleId=10004, email='hah@gmail.com', nickname='haha', parentCommentNickname='test', content='hahah', status='0'}}], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='test@gg.com', nickname='test', parentCommentNickname='jess', content='great!', status='0'}}], CommentVo=CommentVo{parentCommentId=11, articleId=10004, email='jess@gmail.com', nickname='jess', parentCommentNickname='ivan', content='I am doing well. You?', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='ivanliang0818@gmail.com', nickname='ivan', parentCommentNickname='null', content='How are you doing today?', status='0'}}], total=4}
2022-01-19 11:06:34:930 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 13ms
2022-01-19 11:06:34:930 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:07:36:773 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:07:36:773 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:07:36:773 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:07:36:774 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/article/10004
2022-01-19 11:07:36:774 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.ArticleController.getPublicArticleDetail
2022-01-19 11:07:36:774 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10004
2022-01-19 11:07:36:774 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=ArticleVo{userInfo=UserInfoVo{userId=100001, nickName='ivan', userName='ivan', avatar='https://res-blog-public.s3.ca-central-1.amazonaws.com/default_avatar.jpg'}, category=CategoryVo{categoryId=2, name='liddffd', articleCount=null}, BaseArticleVo{articleId=10004, status=1, type=2, title='Spring boot', description='rerwerwer', content='rererer![test.png](https://s3.ca-central-1.amazonaws.com/res-blog-public/res-dev/blog_1636947281578_test.png)', firstPicture='', viewCount=174, createDate='Tue Oct 12 15:58:26 EDT 2021', updateDate='Tue Jan 18 22:56:37 EST 2022'}}, total=null}
2022-01-19 11:07:36:774 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 9ms
2022-01-19 11:07:36:774 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:07:36:774 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:07:36:774 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:07:36:774 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:07:36:774 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:07:36:774 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:07:36:774 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:07:36:774 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10004
2022-01-19 11:07:36:774 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 11:07:36:775 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10004
2022-01-19 11:07:36:774 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10004
2022-01-19 11:07:36:775 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=18createdate=Sun Jan 09 10:06:04 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/81.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsdf@qq.com', nickname='sf', parentCommentNickname='null', content='sdfsf', status='0'}}, CommentListVo{commentId=17createdate=Sun Jan 09 10:05:33 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/57.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsd@Ck.com', nickname='sfsf', parentCommentNickname='null', content='hdsfsd', status='0'}}, CommentListVo{commentId=16createdate=Sun Jan 09 10:03:48 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/90.png, replyComments=[CommentListVo{commentId=19createdate=Mon Jan 10 09:47:47 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/73.png, replyComments=[], CommentVo=CommentVo{parentCommentId=16, articleId=10004, email='sdfsd@Ck.com', nickname='ivan', parentCommentNickname='sfs@ss.c', content='dfjgg', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='null', content='what?', status='0'}}, CommentListVo{commentId=11createdate=Wed Dec 01 22:44:50 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=12createdate=Wed Dec 01 22:45:18 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=15createdate=Wed Dec 01 23:42:17 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='555@test.com', nickname='555', parentCommentNickname='jess', content='555', status='0'}}, CommentListVo{commentId=13createdate=Wed Dec 01 22:45:56 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=14createdate=Wed Dec 01 22:46:22 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=13, articleId=10004, email='hah@gmail.com', nickname='haha', parentCommentNickname='test', content='hahah', status='0'}}], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='test@gg.com', nickname='test', parentCommentNickname='jess', content='great!', status='0'}}], CommentVo=CommentVo{parentCommentId=11, articleId=10004, email='jess@gmail.com', nickname='jess', parentCommentNickname='ivan', content='I am doing well. You?', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='ivanliang0818@gmail.com', nickname='ivan', parentCommentNickname='null', content='How are you doing today?', status='0'}}], total=4}
2022-01-19 11:07:36:775 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 11:07:36:775 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 11ms
2022-01-19 11:07:36:775 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:07:36:775 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10004
2022-01-19 11:07:36:776 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=18createdate=Sun Jan 09 10:06:04 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/81.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsdf@qq.com', nickname='sf', parentCommentNickname='null', content='sdfsf', status='0'}}, CommentListVo{commentId=17createdate=Sun Jan 09 10:05:33 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/57.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsd@Ck.com', nickname='sfsf', parentCommentNickname='null', content='hdsfsd', status='0'}}, CommentListVo{commentId=16createdate=Sun Jan 09 10:03:48 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/90.png, replyComments=[CommentListVo{commentId=19createdate=Mon Jan 10 09:47:47 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/73.png, replyComments=[], CommentVo=CommentVo{parentCommentId=16, articleId=10004, email='sdfsd@Ck.com', nickname='ivan', parentCommentNickname='sfs@ss.c', content='dfjgg', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='null', content='what?', status='0'}}, CommentListVo{commentId=11createdate=Wed Dec 01 22:44:50 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=12createdate=Wed Dec 01 22:45:18 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=15createdate=Wed Dec 01 23:42:17 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='555@test.com', nickname='555', parentCommentNickname='jess', content='555', status='0'}}, CommentListVo{commentId=13createdate=Wed Dec 01 22:45:56 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=14createdate=Wed Dec 01 22:46:22 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=13, articleId=10004, email='hah@gmail.com', nickname='haha', parentCommentNickname='test', content='hahah', status='0'}}], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='test@gg.com', nickname='test', parentCommentNickname='jess', content='great!', status='0'}}], CommentVo=CommentVo{parentCommentId=11, articleId=10004, email='jess@gmail.com', nickname='jess', parentCommentNickname='ivan', content='I am doing well. You?', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='ivanliang0818@gmail.com', nickname='ivan', parentCommentNickname='null', content='How are you doing today?', status='0'}}], total=4}
2022-01-19 11:07:36:777 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 12ms
2022-01-19 11:07:36:777 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:07:37:230 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:07:37:230 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:07:37:230 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:07:37:230 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10004
2022-01-19 11:07:37:230 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 11:07:37:230 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10004
2022-01-19 11:07:37:230 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=18createdate=Sun Jan 09 10:06:04 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/81.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsdf@qq.com', nickname='sf', parentCommentNickname='null', content='sdfsf', status='0'}}, CommentListVo{commentId=17createdate=Sun Jan 09 10:05:33 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/57.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsd@Ck.com', nickname='sfsf', parentCommentNickname='null', content='hdsfsd', status='0'}}, CommentListVo{commentId=16createdate=Sun Jan 09 10:03:48 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/90.png, replyComments=[CommentListVo{commentId=19createdate=Mon Jan 10 09:47:47 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/73.png, replyComments=[], CommentVo=CommentVo{parentCommentId=16, articleId=10004, email='sdfsd@Ck.com', nickname='ivan', parentCommentNickname='sfs@ss.c', content='dfjgg', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='null', content='what?', status='0'}}, CommentListVo{commentId=11createdate=Wed Dec 01 22:44:50 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=12createdate=Wed Dec 01 22:45:18 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=15createdate=Wed Dec 01 23:42:17 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='555@test.com', nickname='555', parentCommentNickname='jess', content='555', status='0'}}, CommentListVo{commentId=13createdate=Wed Dec 01 22:45:56 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=14createdate=Wed Dec 01 22:46:22 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=13, articleId=10004, email='hah@gmail.com', nickname='haha', parentCommentNickname='test', content='hahah', status='0'}}], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='test@gg.com', nickname='test', parentCommentNickname='jess', content='great!', status='0'}}], CommentVo=CommentVo{parentCommentId=11, articleId=10004, email='jess@gmail.com', nickname='jess', parentCommentNickname='ivan', content='I am doing well. You?', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='ivanliang0818@gmail.com', nickname='ivan', parentCommentNickname='null', content='How are you doing today?', status='0'}}], total=4}
2022-01-19 11:07:37:230 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 11ms
2022-01-19 11:07:37:230 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:09:31:661 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:09:31:661 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:09:31:661 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:09:31:661 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/article/10004
2022-01-19 11:09:31:661 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.ArticleController.getPublicArticleDetail
2022-01-19 11:09:31:661 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10004
2022-01-19 11:09:31:661 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=ArticleVo{userInfo=UserInfoVo{userId=100001, nickName='ivan', userName='ivan', avatar='https://res-blog-public.s3.ca-central-1.amazonaws.com/default_avatar.jpg'}, category=CategoryVo{categoryId=2, name='liddffd', articleCount=null}, BaseArticleVo{articleId=10004, status=1, type=2, title='Spring boot', description='rerwerwer', content='rererer![test.png](https://s3.ca-central-1.amazonaws.com/res-blog-public/res-dev/blog_1636947281578_test.png)', firstPicture='', viewCount=174, createDate='Tue Oct 12 15:58:26 EDT 2021', updateDate='Tue Jan 18 22:56:37 EST 2022'}}, total=null}
2022-01-19 11:09:31:661 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 18ms
2022-01-19 11:09:31:661 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:09:31:674 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:09:31:675 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:09:31:675 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:09:31:675 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10004
2022-01-19 11:09:31:675 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 11:09:31:675 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10004
2022-01-19 11:09:31:675 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=18createdate=Sun Jan 09 10:06:04 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/81.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsdf@qq.com', nickname='sf', parentCommentNickname='null', content='sdfsf', status='0'}}, CommentListVo{commentId=17createdate=Sun Jan 09 10:05:33 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/57.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsd@Ck.com', nickname='sfsf', parentCommentNickname='null', content='hdsfsd', status='0'}}, CommentListVo{commentId=16createdate=Sun Jan 09 10:03:48 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/90.png, replyComments=[CommentListVo{commentId=19createdate=Mon Jan 10 09:47:47 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/73.png, replyComments=[], CommentVo=CommentVo{parentCommentId=16, articleId=10004, email='sdfsd@Ck.com', nickname='ivan', parentCommentNickname='sfs@ss.c', content='dfjgg', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='null', content='what?', status='0'}}, CommentListVo{commentId=11createdate=Wed Dec 01 22:44:50 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=12createdate=Wed Dec 01 22:45:18 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=15createdate=Wed Dec 01 23:42:17 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='555@test.com', nickname='555', parentCommentNickname='jess', content='555', status='0'}}, CommentListVo{commentId=13createdate=Wed Dec 01 22:45:56 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=14createdate=Wed Dec 01 22:46:22 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=13, articleId=10004, email='hah@gmail.com', nickname='haha', parentCommentNickname='test', content='hahah', status='0'}}], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='test@gg.com', nickname='test', parentCommentNickname='jess', content='great!', status='0'}}], CommentVo=CommentVo{parentCommentId=11, articleId=10004, email='jess@gmail.com', nickname='jess', parentCommentNickname='ivan', content='I am doing well. You?', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='ivanliang0818@gmail.com', nickname='ivan', parentCommentNickname='null', content='How are you doing today?', status='0'}}], total=4}
2022-01-19 11:09:31:675 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 31ms
2022-01-19 11:09:31:675 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:09:31:675 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:09:31:675 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:09:31:675 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:09:31:675 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10004
2022-01-19 11:09:31:675 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 11:09:31:675 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10004
2022-01-19 11:09:31:675 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=18createdate=Sun Jan 09 10:06:04 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/81.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsdf@qq.com', nickname='sf', parentCommentNickname='null', content='sdfsf', status='0'}}, CommentListVo{commentId=17createdate=Sun Jan 09 10:05:33 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/57.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsd@Ck.com', nickname='sfsf', parentCommentNickname='null', content='hdsfsd', status='0'}}, CommentListVo{commentId=16createdate=Sun Jan 09 10:03:48 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/90.png, replyComments=[CommentListVo{commentId=19createdate=Mon Jan 10 09:47:47 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/73.png, replyComments=[], CommentVo=CommentVo{parentCommentId=16, articleId=10004, email='sdfsd@Ck.com', nickname='ivan', parentCommentNickname='sfs@ss.c', content='dfjgg', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='null', content='what?', status='0'}}, CommentListVo{commentId=11createdate=Wed Dec 01 22:44:50 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=12createdate=Wed Dec 01 22:45:18 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=15createdate=Wed Dec 01 23:42:17 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='555@test.com', nickname='555', parentCommentNickname='jess', content='555', status='0'}}, CommentListVo{commentId=13createdate=Wed Dec 01 22:45:56 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=14createdate=Wed Dec 01 22:46:22 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=13, articleId=10004, email='hah@gmail.com', nickname='haha', parentCommentNickname='test', content='hahah', status='0'}}], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='test@gg.com', nickname='test', parentCommentNickname='jess', content='great!', status='0'}}], CommentVo=CommentVo{parentCommentId=11, articleId=10004, email='jess@gmail.com', nickname='jess', parentCommentNickname='ivan', content='I am doing well. You?', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='ivanliang0818@gmail.com', nickname='ivan', parentCommentNickname='null', content='How are you doing today?', status='0'}}], total=4}
2022-01-19 11:09:31:675 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 30ms
2022-01-19 11:09:31:675 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:09:31:704 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:09:31:704 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:09:31:704 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:09:31:704 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10004
2022-01-19 11:09:31:704 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 11:09:31:704 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10004
2022-01-19 11:09:31:704 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=18createdate=Sun Jan 09 10:06:04 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/81.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsdf@qq.com', nickname='sf', parentCommentNickname='null', content='sdfsf', status='0'}}, CommentListVo{commentId=17createdate=Sun Jan 09 10:05:33 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/57.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsd@Ck.com', nickname='sfsf', parentCommentNickname='null', content='hdsfsd', status='0'}}, CommentListVo{commentId=16createdate=Sun Jan 09 10:03:48 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/90.png, replyComments=[CommentListVo{commentId=19createdate=Mon Jan 10 09:47:47 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/73.png, replyComments=[], CommentVo=CommentVo{parentCommentId=16, articleId=10004, email='sdfsd@Ck.com', nickname='ivan', parentCommentNickname='sfs@ss.c', content='dfjgg', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='null', content='what?', status='0'}}, CommentListVo{commentId=11createdate=Wed Dec 01 22:44:50 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=12createdate=Wed Dec 01 22:45:18 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=15createdate=Wed Dec 01 23:42:17 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='555@test.com', nickname='555', parentCommentNickname='jess', content='555', status='0'}}, CommentListVo{commentId=13createdate=Wed Dec 01 22:45:56 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=14createdate=Wed Dec 01 22:46:22 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=13, articleId=10004, email='hah@gmail.com', nickname='haha', parentCommentNickname='test', content='hahah', status='0'}}], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='test@gg.com', nickname='test', parentCommentNickname='jess', content='great!', status='0'}}], CommentVo=CommentVo{parentCommentId=11, articleId=10004, email='jess@gmail.com', nickname='jess', parentCommentNickname='ivan', content='I am doing well. You?', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='ivanliang0818@gmail.com', nickname='ivan', parentCommentNickname='null', content='How are you doing today?', status='0'}}], total=4}
2022-01-19 11:09:31:705 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 15ms
2022-01-19 11:09:31:705 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:09:51:775 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:09:51:775 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:09:51:775 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:09:51:775 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10004
2022-01-19 11:09:51:775 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 11:09:51:775 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10004
2022-01-19 11:09:51:775 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=18createdate=Sun Jan 09 10:06:04 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/81.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsdf@qq.com', nickname='sf', parentCommentNickname='null', content='sdfsf', status='0'}}, CommentListVo{commentId=17createdate=Sun Jan 09 10:05:33 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/57.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsd@Ck.com', nickname='sfsf', parentCommentNickname='null', content='hdsfsd', status='0'}}, CommentListVo{commentId=16createdate=Sun Jan 09 10:03:48 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/90.png, replyComments=[CommentListVo{commentId=19createdate=Mon Jan 10 09:47:47 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/73.png, replyComments=[], CommentVo=CommentVo{parentCommentId=16, articleId=10004, email='sdfsd@Ck.com', nickname='ivan', parentCommentNickname='sfs@ss.c', content='dfjgg', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='null', content='what?', status='0'}}, CommentListVo{commentId=11createdate=Wed Dec 01 22:44:50 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=12createdate=Wed Dec 01 22:45:18 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=15createdate=Wed Dec 01 23:42:17 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='555@test.com', nickname='555', parentCommentNickname='jess', content='555', status='0'}}, CommentListVo{commentId=13createdate=Wed Dec 01 22:45:56 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=14createdate=Wed Dec 01 22:46:22 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=13, articleId=10004, email='hah@gmail.com', nickname='haha', parentCommentNickname='test', content='hahah', status='0'}}], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='test@gg.com', nickname='test', parentCommentNickname='jess', content='great!', status='0'}}], CommentVo=CommentVo{parentCommentId=11, articleId=10004, email='jess@gmail.com', nickname='jess', parentCommentNickname='ivan', content='I am doing well. You?', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='ivanliang0818@gmail.com', nickname='ivan', parentCommentNickname='null', content='How are you doing today?', status='0'}}], total=4}
2022-01-19 11:09:51:776 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 10ms
2022-01-19 11:09:51:776 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:09:51:778 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:09:51:778 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:09:51:778 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:09:51:778 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10004
2022-01-19 11:09:51:778 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 11:09:51:778 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10004
2022-01-19 11:09:51:778 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=18createdate=Sun Jan 09 10:06:04 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/81.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsdf@qq.com', nickname='sf', parentCommentNickname='null', content='sdfsf', status='0'}}, CommentListVo{commentId=17createdate=Sun Jan 09 10:05:33 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/57.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsd@Ck.com', nickname='sfsf', parentCommentNickname='null', content='hdsfsd', status='0'}}, CommentListVo{commentId=16createdate=Sun Jan 09 10:03:48 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/90.png, replyComments=[CommentListVo{commentId=19createdate=Mon Jan 10 09:47:47 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/73.png, replyComments=[], CommentVo=CommentVo{parentCommentId=16, articleId=10004, email='sdfsd@Ck.com', nickname='ivan', parentCommentNickname='sfs@ss.c', content='dfjgg', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='null', content='what?', status='0'}}, CommentListVo{commentId=11createdate=Wed Dec 01 22:44:50 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=12createdate=Wed Dec 01 22:45:18 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=15createdate=Wed Dec 01 23:42:17 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='555@test.com', nickname='555', parentCommentNickname='jess', content='555', status='0'}}, CommentListVo{commentId=13createdate=Wed Dec 01 22:45:56 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=14createdate=Wed Dec 01 22:46:22 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=13, articleId=10004, email='hah@gmail.com', nickname='haha', parentCommentNickname='test', content='hahah', status='0'}}], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='test@gg.com', nickname='test', parentCommentNickname='jess', content='great!', status='0'}}], CommentVo=CommentVo{parentCommentId=11, articleId=10004, email='jess@gmail.com', nickname='jess', parentCommentNickname='ivan', content='I am doing well. You?', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='ivanliang0818@gmail.com', nickname='ivan', parentCommentNickname='null', content='How are you doing today?', status='0'}}], total=4}
2022-01-19 11:09:51:779 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 13ms
2022-01-19 11:09:51:779 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:09:51:781 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:09:51:781 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:09:51:781 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:09:51:781 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/article/10004
2022-01-19 11:09:51:782 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.ArticleController.getPublicArticleDetail
2022-01-19 11:09:51:782 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10004
2022-01-19 11:09:51:782 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=ArticleVo{userInfo=UserInfoVo{userId=100001, nickName='ivan', userName='ivan', avatar='https://res-blog-public.s3.ca-central-1.amazonaws.com/default_avatar.jpg'}, category=CategoryVo{categoryId=2, name='liddffd', articleCount=null}, BaseArticleVo{articleId=10004, status=1, type=2, title='Spring boot', description='rerwerwer', content='rererer![test.png](https://s3.ca-central-1.amazonaws.com/res-blog-public/res-dev/blog_1636947281578_test.png)', firstPicture='', viewCount=174, createDate='Tue Oct 12 15:58:26 EDT 2021', updateDate='Tue Jan 18 22:56:37 EST 2022'}}, total=null}
2022-01-19 11:09:51:782 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 16ms
2022-01-19 11:09:51:782 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:09:51:847 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:09:51:847 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:09:51:847 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:09:51:847 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10004
2022-01-19 11:09:51:847 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 11:09:51:847 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10004
2022-01-19 11:09:51:847 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=18createdate=Sun Jan 09 10:06:04 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/81.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsdf@qq.com', nickname='sf', parentCommentNickname='null', content='sdfsf', status='0'}}, CommentListVo{commentId=17createdate=Sun Jan 09 10:05:33 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/57.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsd@Ck.com', nickname='sfsf', parentCommentNickname='null', content='hdsfsd', status='0'}}, CommentListVo{commentId=16createdate=Sun Jan 09 10:03:48 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/90.png, replyComments=[CommentListVo{commentId=19createdate=Mon Jan 10 09:47:47 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/73.png, replyComments=[], CommentVo=CommentVo{parentCommentId=16, articleId=10004, email='sdfsd@Ck.com', nickname='ivan', parentCommentNickname='sfs@ss.c', content='dfjgg', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='null', content='what?', status='0'}}, CommentListVo{commentId=11createdate=Wed Dec 01 22:44:50 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=12createdate=Wed Dec 01 22:45:18 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=15createdate=Wed Dec 01 23:42:17 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='555@test.com', nickname='555', parentCommentNickname='jess', content='555', status='0'}}, CommentListVo{commentId=13createdate=Wed Dec 01 22:45:56 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=14createdate=Wed Dec 01 22:46:22 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=13, articleId=10004, email='hah@gmail.com', nickname='haha', parentCommentNickname='test', content='hahah', status='0'}}], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='test@gg.com', nickname='test', parentCommentNickname='jess', content='great!', status='0'}}], CommentVo=CommentVo{parentCommentId=11, articleId=10004, email='jess@gmail.com', nickname='jess', parentCommentNickname='ivan', content='I am doing well. You?', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='ivanliang0818@gmail.com', nickname='ivan', parentCommentNickname='null', content='How are you doing today?', status='0'}}], total=4}
2022-01-19 11:09:51:847 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 20ms
2022-01-19 11:09:51:847 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:12:25:046 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:12:25:046 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:12:25:046 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:12:25:046 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/article/10004
2022-01-19 11:12:25:046 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.ArticleController.getPublicArticleDetail
2022-01-19 11:12:25:047 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10004
2022-01-19 11:12:25:047 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=ArticleVo{userInfo=UserInfoVo{userId=100001, nickName='ivan', userName='ivan', avatar='https://res-blog-public.s3.ca-central-1.amazonaws.com/default_avatar.jpg'}, category=CategoryVo{categoryId=2, name='liddffd', articleCount=null}, BaseArticleVo{articleId=10004, status=1, type=2, title='Spring boot', description='rerwerwer', content='rererer![test.png](https://s3.ca-central-1.amazonaws.com/res-blog-public/res-dev/blog_1636947281578_test.png)', firstPicture='', viewCount=174, createDate='Tue Oct 12 15:58:26 EDT 2021', updateDate='Tue Jan 18 22:56:37 EST 2022'}}, total=null}
2022-01-19 11:12:25:047 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 21ms
2022-01-19 11:12:25:047 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:12:25:058 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:12:25:059 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:12:25:059 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:12:25:059 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10004
2022-01-19 11:12:25:059 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 11:12:25:059 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10004
2022-01-19 11:12:25:059 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=18createdate=Sun Jan 09 10:06:04 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/81.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsdf@qq.com', nickname='sf', parentCommentNickname='null', content='sdfsf', status='0'}}, CommentListVo{commentId=17createdate=Sun Jan 09 10:05:33 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/57.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsd@Ck.com', nickname='sfsf', parentCommentNickname='null', content='hdsfsd', status='0'}}, CommentListVo{commentId=16createdate=Sun Jan 09 10:03:48 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/90.png, replyComments=[CommentListVo{commentId=19createdate=Mon Jan 10 09:47:47 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/73.png, replyComments=[], CommentVo=CommentVo{parentCommentId=16, articleId=10004, email='sdfsd@Ck.com', nickname='ivan', parentCommentNickname='sfs@ss.c', content='dfjgg', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='null', content='what?', status='0'}}, CommentListVo{commentId=11createdate=Wed Dec 01 22:44:50 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=12createdate=Wed Dec 01 22:45:18 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=15createdate=Wed Dec 01 23:42:17 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='555@test.com', nickname='555', parentCommentNickname='jess', content='555', status='0'}}, CommentListVo{commentId=13createdate=Wed Dec 01 22:45:56 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=14createdate=Wed Dec 01 22:46:22 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=13, articleId=10004, email='hah@gmail.com', nickname='haha', parentCommentNickname='test', content='hahah', status='0'}}], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='test@gg.com', nickname='test', parentCommentNickname='jess', content='great!', status='0'}}], CommentVo=CommentVo{parentCommentId=11, articleId=10004, email='jess@gmail.com', nickname='jess', parentCommentNickname='ivan', content='I am doing well. You?', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='ivanliang0818@gmail.com', nickname='ivan', parentCommentNickname='null', content='How are you doing today?', status='0'}}], total=4}
2022-01-19 11:12:25:059 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 34ms
2022-01-19 11:12:25:059 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:12:25:065 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:12:25:065 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:12:25:066 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:12:25:066 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10004
2022-01-19 11:12:25:066 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 11:12:25:066 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10004
2022-01-19 11:12:25:066 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=18createdate=Sun Jan 09 10:06:04 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/81.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsdf@qq.com', nickname='sf', parentCommentNickname='null', content='sdfsf', status='0'}}, CommentListVo{commentId=17createdate=Sun Jan 09 10:05:33 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/57.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsd@Ck.com', nickname='sfsf', parentCommentNickname='null', content='hdsfsd', status='0'}}, CommentListVo{commentId=16createdate=Sun Jan 09 10:03:48 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/90.png, replyComments=[CommentListVo{commentId=19createdate=Mon Jan 10 09:47:47 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/73.png, replyComments=[], CommentVo=CommentVo{parentCommentId=16, articleId=10004, email='sdfsd@Ck.com', nickname='ivan', parentCommentNickname='sfs@ss.c', content='dfjgg', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='null', content='what?', status='0'}}, CommentListVo{commentId=11createdate=Wed Dec 01 22:44:50 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=12createdate=Wed Dec 01 22:45:18 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=15createdate=Wed Dec 01 23:42:17 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='555@test.com', nickname='555', parentCommentNickname='jess', content='555', status='0'}}, CommentListVo{commentId=13createdate=Wed Dec 01 22:45:56 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=14createdate=Wed Dec 01 22:46:22 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=13, articleId=10004, email='hah@gmail.com', nickname='haha', parentCommentNickname='test', content='hahah', status='0'}}], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='test@gg.com', nickname='test', parentCommentNickname='jess', content='great!', status='0'}}], CommentVo=CommentVo{parentCommentId=11, articleId=10004, email='jess@gmail.com', nickname='jess', parentCommentNickname='ivan', content='I am doing well. You?', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='ivanliang0818@gmail.com', nickname='ivan', parentCommentNickname='null', content='How are you doing today?', status='0'}}], total=4}
2022-01-19 11:12:25:066 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 41ms
2022-01-19 11:12:25:066 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:12:25:513 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:12:25:513 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:12:25:513 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:12:25:513 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10004
2022-01-19 11:12:25:513 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 11:12:25:513 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10004
2022-01-19 11:12:25:513 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=18createdate=Sun Jan 09 10:06:04 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/81.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsdf@qq.com', nickname='sf', parentCommentNickname='null', content='sdfsf', status='0'}}, CommentListVo{commentId=17createdate=Sun Jan 09 10:05:33 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/57.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsd@Ck.com', nickname='sfsf', parentCommentNickname='null', content='hdsfsd', status='0'}}, CommentListVo{commentId=16createdate=Sun Jan 09 10:03:48 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/90.png, replyComments=[CommentListVo{commentId=19createdate=Mon Jan 10 09:47:47 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/73.png, replyComments=[], CommentVo=CommentVo{parentCommentId=16, articleId=10004, email='sdfsd@Ck.com', nickname='ivan', parentCommentNickname='sfs@ss.c', content='dfjgg', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='null', content='what?', status='0'}}, CommentListVo{commentId=11createdate=Wed Dec 01 22:44:50 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=12createdate=Wed Dec 01 22:45:18 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=15createdate=Wed Dec 01 23:42:17 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='555@test.com', nickname='555', parentCommentNickname='jess', content='555', status='0'}}, CommentListVo{commentId=13createdate=Wed Dec 01 22:45:56 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=14createdate=Wed Dec 01 22:46:22 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=13, articleId=10004, email='hah@gmail.com', nickname='haha', parentCommentNickname='test', content='hahah', status='0'}}], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='test@gg.com', nickname='test', parentCommentNickname='jess', content='great!', status='0'}}], CommentVo=CommentVo{parentCommentId=11, articleId=10004, email='jess@gmail.com', nickname='jess', parentCommentNickname='ivan', content='I am doing well. You?', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='ivanliang0818@gmail.com', nickname='ivan', parentCommentNickname='null', content='How are you doing today?', status='0'}}], total=4}
2022-01-19 11:12:25:514 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 4ms
2022-01-19 11:12:25:514 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:12:28:853 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:12:28:853 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:12:28:853 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:12:28:853 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/article/10004
2022-01-19 11:12:28:853 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.ArticleController.getPublicArticleDetail
2022-01-19 11:12:28:853 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10004
2022-01-19 11:12:28:853 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=ArticleVo{userInfo=UserInfoVo{userId=100001, nickName='ivan', userName='ivan', avatar='https://res-blog-public.s3.ca-central-1.amazonaws.com/default_avatar.jpg'}, category=CategoryVo{categoryId=2, name='liddffd', articleCount=null}, BaseArticleVo{articleId=10004, status=1, type=2, title='Spring boot', description='rerwerwer', content='rererer![test.png](https://s3.ca-central-1.amazonaws.com/res-blog-public/res-dev/blog_1636947281578_test.png)', firstPicture='', viewCount=174, createDate='Tue Oct 12 15:58:26 EDT 2021', updateDate='Tue Jan 18 22:56:37 EST 2022'}}, total=null}
2022-01-19 11:12:28:853 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 12ms
2022-01-19 11:12:28:853 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:12:28:864 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:12:28:864 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:12:28:864 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:12:28:864 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10004
2022-01-19 11:12:28:864 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 11:12:28:864 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10004
2022-01-19 11:12:28:864 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=18createdate=Sun Jan 09 10:06:04 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/81.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsdf@qq.com', nickname='sf', parentCommentNickname='null', content='sdfsf', status='0'}}, CommentListVo{commentId=17createdate=Sun Jan 09 10:05:33 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/57.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsd@Ck.com', nickname='sfsf', parentCommentNickname='null', content='hdsfsd', status='0'}}, CommentListVo{commentId=16createdate=Sun Jan 09 10:03:48 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/90.png, replyComments=[CommentListVo{commentId=19createdate=Mon Jan 10 09:47:47 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/73.png, replyComments=[], CommentVo=CommentVo{parentCommentId=16, articleId=10004, email='sdfsd@Ck.com', nickname='ivan', parentCommentNickname='sfs@ss.c', content='dfjgg', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='null', content='what?', status='0'}}, CommentListVo{commentId=11createdate=Wed Dec 01 22:44:50 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=12createdate=Wed Dec 01 22:45:18 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=15createdate=Wed Dec 01 23:42:17 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='555@test.com', nickname='555', parentCommentNickname='jess', content='555', status='0'}}, CommentListVo{commentId=13createdate=Wed Dec 01 22:45:56 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=14createdate=Wed Dec 01 22:46:22 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=13, articleId=10004, email='hah@gmail.com', nickname='haha', parentCommentNickname='test', content='hahah', status='0'}}], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='test@gg.com', nickname='test', parentCommentNickname='jess', content='great!', status='0'}}], CommentVo=CommentVo{parentCommentId=11, articleId=10004, email='jess@gmail.com', nickname='jess', parentCommentNickname='ivan', content='I am doing well. You?', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='ivanliang0818@gmail.com', nickname='ivan', parentCommentNickname='null', content='How are you doing today?', status='0'}}], total=4}
2022-01-19 11:12:28:864 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 22ms
2022-01-19 11:12:28:864 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:12:28:865 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:12:28:865 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:12:28:865 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:12:28:865 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10004
2022-01-19 11:12:28:865 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 11:12:28:865 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10004
2022-01-19 11:12:28:865 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=18createdate=Sun Jan 09 10:06:04 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/81.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsdf@qq.com', nickname='sf', parentCommentNickname='null', content='sdfsf', status='0'}}, CommentListVo{commentId=17createdate=Sun Jan 09 10:05:33 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/57.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsd@Ck.com', nickname='sfsf', parentCommentNickname='null', content='hdsfsd', status='0'}}, CommentListVo{commentId=16createdate=Sun Jan 09 10:03:48 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/90.png, replyComments=[CommentListVo{commentId=19createdate=Mon Jan 10 09:47:47 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/73.png, replyComments=[], CommentVo=CommentVo{parentCommentId=16, articleId=10004, email='sdfsd@Ck.com', nickname='ivan', parentCommentNickname='sfs@ss.c', content='dfjgg', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='null', content='what?', status='0'}}, CommentListVo{commentId=11createdate=Wed Dec 01 22:44:50 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=12createdate=Wed Dec 01 22:45:18 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=15createdate=Wed Dec 01 23:42:17 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='555@test.com', nickname='555', parentCommentNickname='jess', content='555', status='0'}}, CommentListVo{commentId=13createdate=Wed Dec 01 22:45:56 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=14createdate=Wed Dec 01 22:46:22 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=13, articleId=10004, email='hah@gmail.com', nickname='haha', parentCommentNickname='test', content='hahah', status='0'}}], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='test@gg.com', nickname='test', parentCommentNickname='jess', content='great!', status='0'}}], CommentVo=CommentVo{parentCommentId=11, articleId=10004, email='jess@gmail.com', nickname='jess', parentCommentNickname='ivan', content='I am doing well. You?', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='ivanliang0818@gmail.com', nickname='ivan', parentCommentNickname='null', content='How are you doing today?', status='0'}}], total=4}
2022-01-19 11:12:28:866 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 23ms
2022-01-19 11:12:28:866 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:12:29:330 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:12:29:331 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:12:29:331 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:12:29:331 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10004
2022-01-19 11:12:29:331 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 11:12:29:331 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10004
2022-01-19 11:12:29:331 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=18createdate=Sun Jan 09 10:06:04 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/81.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsdf@qq.com', nickname='sf', parentCommentNickname='null', content='sdfsf', status='0'}}, CommentListVo{commentId=17createdate=Sun Jan 09 10:05:33 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/57.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsd@Ck.com', nickname='sfsf', parentCommentNickname='null', content='hdsfsd', status='0'}}, CommentListVo{commentId=16createdate=Sun Jan 09 10:03:48 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/90.png, replyComments=[CommentListVo{commentId=19createdate=Mon Jan 10 09:47:47 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/73.png, replyComments=[], CommentVo=CommentVo{parentCommentId=16, articleId=10004, email='sdfsd@Ck.com', nickname='ivan', parentCommentNickname='sfs@ss.c', content='dfjgg', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='null', content='what?', status='0'}}, CommentListVo{commentId=11createdate=Wed Dec 01 22:44:50 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=12createdate=Wed Dec 01 22:45:18 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=15createdate=Wed Dec 01 23:42:17 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='555@test.com', nickname='555', parentCommentNickname='jess', content='555', status='0'}}, CommentListVo{commentId=13createdate=Wed Dec 01 22:45:56 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=14createdate=Wed Dec 01 22:46:22 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=13, articleId=10004, email='hah@gmail.com', nickname='haha', parentCommentNickname='test', content='hahah', status='0'}}], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='test@gg.com', nickname='test', parentCommentNickname='jess', content='great!', status='0'}}], CommentVo=CommentVo{parentCommentId=11, articleId=10004, email='jess@gmail.com', nickname='jess', parentCommentNickname='ivan', content='I am doing well. You?', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='ivanliang0818@gmail.com', nickname='ivan', parentCommentNickname='null', content='How are you doing today?', status='0'}}], total=4}
2022-01-19 11:12:29:331 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 4ms
2022-01-19 11:12:29:331 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:14:22:167 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:14:22:168 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:14:22:168 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:14:22:168 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/article/10004
2022-01-19 11:14:22:168 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.ArticleController.getPublicArticleDetail
2022-01-19 11:14:22:168 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10004
2022-01-19 11:14:22:168 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=ArticleVo{userInfo=UserInfoVo{userId=100001, nickName='ivan', userName='ivan', avatar='https://res-blog-public.s3.ca-central-1.amazonaws.com/default_avatar.jpg'}, category=CategoryVo{categoryId=2, name='liddffd', articleCount=null}, BaseArticleVo{articleId=10004, status=1, type=2, title='Spring boot', description='rerwerwer', content='rererer![test.png](https://s3.ca-central-1.amazonaws.com/res-blog-public/res-dev/blog_1636947281578_test.png)', firstPicture='', viewCount=174, createDate='Tue Oct 12 15:58:26 EDT 2021', updateDate='Tue Jan 18 22:56:37 EST 2022'}}, total=null}
2022-01-19 11:14:22:168 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 18ms
2022-01-19 11:14:22:168 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:14:22:169 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:14:22:170 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:14:22:170 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:14:22:170 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10004
2022-01-19 11:14:22:170 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 11:14:22:170 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10004
2022-01-19 11:14:22:170 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=18createdate=Sun Jan 09 10:06:04 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/81.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsdf@qq.com', nickname='sf', parentCommentNickname='null', content='sdfsf', status='0'}}, CommentListVo{commentId=17createdate=Sun Jan 09 10:05:33 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/57.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsd@Ck.com', nickname='sfsf', parentCommentNickname='null', content='hdsfsd', status='0'}}, CommentListVo{commentId=16createdate=Sun Jan 09 10:03:48 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/90.png, replyComments=[CommentListVo{commentId=19createdate=Mon Jan 10 09:47:47 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/73.png, replyComments=[], CommentVo=CommentVo{parentCommentId=16, articleId=10004, email='sdfsd@Ck.com', nickname='ivan', parentCommentNickname='sfs@ss.c', content='dfjgg', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='null', content='what?', status='0'}}, CommentListVo{commentId=11createdate=Wed Dec 01 22:44:50 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=12createdate=Wed Dec 01 22:45:18 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=15createdate=Wed Dec 01 23:42:17 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='555@test.com', nickname='555', parentCommentNickname='jess', content='555', status='0'}}, CommentListVo{commentId=13createdate=Wed Dec 01 22:45:56 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=14createdate=Wed Dec 01 22:46:22 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=13, articleId=10004, email='hah@gmail.com', nickname='haha', parentCommentNickname='test', content='hahah', status='0'}}], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='test@gg.com', nickname='test', parentCommentNickname='jess', content='great!', status='0'}}], CommentVo=CommentVo{parentCommentId=11, articleId=10004, email='jess@gmail.com', nickname='jess', parentCommentNickname='ivan', content='I am doing well. You?', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='ivanliang0818@gmail.com', nickname='ivan', parentCommentNickname='null', content='How are you doing today?', status='0'}}], total=4}
2022-01-19 11:14:22:170 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 20ms
2022-01-19 11:14:22:170 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:14:22:174 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:14:22:174 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:14:22:174 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:14:22:174 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10004
2022-01-19 11:14:22:174 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 11:14:22:174 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10004
2022-01-19 11:14:22:174 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=18createdate=Sun Jan 09 10:06:04 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/81.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsdf@qq.com', nickname='sf', parentCommentNickname='null', content='sdfsf', status='0'}}, CommentListVo{commentId=17createdate=Sun Jan 09 10:05:33 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/57.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsd@Ck.com', nickname='sfsf', parentCommentNickname='null', content='hdsfsd', status='0'}}, CommentListVo{commentId=16createdate=Sun Jan 09 10:03:48 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/90.png, replyComments=[CommentListVo{commentId=19createdate=Mon Jan 10 09:47:47 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/73.png, replyComments=[], CommentVo=CommentVo{parentCommentId=16, articleId=10004, email='sdfsd@Ck.com', nickname='ivan', parentCommentNickname='sfs@ss.c', content='dfjgg', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='null', content='what?', status='0'}}, CommentListVo{commentId=11createdate=Wed Dec 01 22:44:50 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=12createdate=Wed Dec 01 22:45:18 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=15createdate=Wed Dec 01 23:42:17 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='555@test.com', nickname='555', parentCommentNickname='jess', content='555', status='0'}}, CommentListVo{commentId=13createdate=Wed Dec 01 22:45:56 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=14createdate=Wed Dec 01 22:46:22 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=13, articleId=10004, email='hah@gmail.com', nickname='haha', parentCommentNickname='test', content='hahah', status='0'}}], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='test@gg.com', nickname='test', parentCommentNickname='jess', content='great!', status='0'}}], CommentVo=CommentVo{parentCommentId=11, articleId=10004, email='jess@gmail.com', nickname='jess', parentCommentNickname='ivan', content='I am doing well. You?', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='ivanliang0818@gmail.com', nickname='ivan', parentCommentNickname='null', content='How are you doing today?', status='0'}}], total=4}
2022-01-19 11:14:22:175 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 22ms
2022-01-19 11:14:22:175 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:14:22:627 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:14:22:627 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:14:22:627 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:14:22:627 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10004
2022-01-19 11:14:22:627 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 11:14:22:627 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10004
2022-01-19 11:14:22:627 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=18createdate=Sun Jan 09 10:06:04 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/81.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsdf@qq.com', nickname='sf', parentCommentNickname='null', content='sdfsf', status='0'}}, CommentListVo{commentId=17createdate=Sun Jan 09 10:05:33 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/57.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsd@Ck.com', nickname='sfsf', parentCommentNickname='null', content='hdsfsd', status='0'}}, CommentListVo{commentId=16createdate=Sun Jan 09 10:03:48 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/90.png, replyComments=[CommentListVo{commentId=19createdate=Mon Jan 10 09:47:47 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/73.png, replyComments=[], CommentVo=CommentVo{parentCommentId=16, articleId=10004, email='sdfsd@Ck.com', nickname='ivan', parentCommentNickname='sfs@ss.c', content='dfjgg', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='null', content='what?', status='0'}}, CommentListVo{commentId=11createdate=Wed Dec 01 22:44:50 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=12createdate=Wed Dec 01 22:45:18 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=15createdate=Wed Dec 01 23:42:17 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='555@test.com', nickname='555', parentCommentNickname='jess', content='555', status='0'}}, CommentListVo{commentId=13createdate=Wed Dec 01 22:45:56 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=14createdate=Wed Dec 01 22:46:22 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=13, articleId=10004, email='hah@gmail.com', nickname='haha', parentCommentNickname='test', content='hahah', status='0'}}], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='test@gg.com', nickname='test', parentCommentNickname='jess', content='great!', status='0'}}], CommentVo=CommentVo{parentCommentId=11, articleId=10004, email='jess@gmail.com', nickname='jess', parentCommentNickname='ivan', content='I am doing well. You?', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='ivanliang0818@gmail.com', nickname='ivan', parentCommentNickname='null', content='How are you doing today?', status='0'}}], total=4}
2022-01-19 11:14:22:627 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 6ms
2022-01-19 11:14:22:627 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:15:05:641 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:15:05:641 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:15:05:641 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:15:05:641 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/article/10004
2022-01-19 11:15:05:641 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.ArticleController.getPublicArticleDetail
2022-01-19 11:15:05:641 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10004
2022-01-19 11:15:05:641 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=ArticleVo{userInfo=UserInfoVo{userId=100001, nickName='ivan', userName='ivan', avatar='https://res-blog-public.s3.ca-central-1.amazonaws.com/default_avatar.jpg'}, category=CategoryVo{categoryId=2, name='liddffd', articleCount=null}, BaseArticleVo{articleId=10004, status=1, type=2, title='Spring boot', description='rerwerwer', content='rererer![test.png](https://s3.ca-central-1.amazonaws.com/res-blog-public/res-dev/blog_1636947281578_test.png)', firstPicture='', viewCount=174, createDate='Tue Oct 12 15:58:26 EDT 2021', updateDate='Tue Jan 18 22:56:37 EST 2022'}}, total=null}
2022-01-19 11:15:05:641 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 6ms
2022-01-19 11:15:05:641 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:15:05:642 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:15:05:643 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:15:05:643 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:15:05:643 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10004
2022-01-19 11:15:05:643 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 11:15:05:643 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10004
2022-01-19 11:15:05:643 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:15:05:643 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:15:05:643 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:15:05:643 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10004
2022-01-19 11:15:05:643 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 11:15:05:643 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10004
2022-01-19 11:15:05:643 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=18createdate=Sun Jan 09 10:06:04 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/81.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsdf@qq.com', nickname='sf', parentCommentNickname='null', content='sdfsf', status='0'}}, CommentListVo{commentId=17createdate=Sun Jan 09 10:05:33 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/57.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsd@Ck.com', nickname='sfsf', parentCommentNickname='null', content='hdsfsd', status='0'}}, CommentListVo{commentId=16createdate=Sun Jan 09 10:03:48 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/90.png, replyComments=[CommentListVo{commentId=19createdate=Mon Jan 10 09:47:47 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/73.png, replyComments=[], CommentVo=CommentVo{parentCommentId=16, articleId=10004, email='sdfsd@Ck.com', nickname='ivan', parentCommentNickname='sfs@ss.c', content='dfjgg', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='null', content='what?', status='0'}}, CommentListVo{commentId=11createdate=Wed Dec 01 22:44:50 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=12createdate=Wed Dec 01 22:45:18 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=15createdate=Wed Dec 01 23:42:17 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='555@test.com', nickname='555', parentCommentNickname='jess', content='555', status='0'}}, CommentListVo{commentId=13createdate=Wed Dec 01 22:45:56 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=14createdate=Wed Dec 01 22:46:22 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=13, articleId=10004, email='hah@gmail.com', nickname='haha', parentCommentNickname='test', content='hahah', status='0'}}], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='test@gg.com', nickname='test', parentCommentNickname='jess', content='great!', status='0'}}], CommentVo=CommentVo{parentCommentId=11, articleId=10004, email='jess@gmail.com', nickname='jess', parentCommentNickname='ivan', content='I am doing well. You?', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='ivanliang0818@gmail.com', nickname='ivan', parentCommentNickname='null', content='How are you doing today?', status='0'}}], total=4}
2022-01-19 11:15:05:643 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 7ms
2022-01-19 11:15:05:643 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=18createdate=Sun Jan 09 10:06:04 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/81.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsdf@qq.com', nickname='sf', parentCommentNickname='null', content='sdfsf', status='0'}}, CommentListVo{commentId=17createdate=Sun Jan 09 10:05:33 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/57.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsd@Ck.com', nickname='sfsf', parentCommentNickname='null', content='hdsfsd', status='0'}}, CommentListVo{commentId=16createdate=Sun Jan 09 10:03:48 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/90.png, replyComments=[CommentListVo{commentId=19createdate=Mon Jan 10 09:47:47 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/73.png, replyComments=[], CommentVo=CommentVo{parentCommentId=16, articleId=10004, email='sdfsd@Ck.com', nickname='ivan', parentCommentNickname='sfs@ss.c', content='dfjgg', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='null', content='what?', status='0'}}, CommentListVo{commentId=11createdate=Wed Dec 01 22:44:50 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=12createdate=Wed Dec 01 22:45:18 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=15createdate=Wed Dec 01 23:42:17 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='555@test.com', nickname='555', parentCommentNickname='jess', content='555', status='0'}}, CommentListVo{commentId=13createdate=Wed Dec 01 22:45:56 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=14createdate=Wed Dec 01 22:46:22 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=13, articleId=10004, email='hah@gmail.com', nickname='haha', parentCommentNickname='test', content='hahah', status='0'}}], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='test@gg.com', nickname='test', parentCommentNickname='jess', content='great!', status='0'}}], CommentVo=CommentVo{parentCommentId=11, articleId=10004, email='jess@gmail.com', nickname='jess', parentCommentNickname='ivan', content='I am doing well. You?', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='ivanliang0818@gmail.com', nickname='ivan', parentCommentNickname='null', content='How are you doing today?', status='0'}}], total=4}
2022-01-19 11:15:05:643 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 8ms
2022-01-19 11:15:05:643 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:15:05:643 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:15:05:692 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:15:05:692 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:15:05:693 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:15:05:693 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10004
2022-01-19 11:15:05:693 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 11:15:05:693 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10004
2022-01-19 11:15:05:693 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=18createdate=Sun Jan 09 10:06:04 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/81.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsdf@qq.com', nickname='sf', parentCommentNickname='null', content='sdfsf', status='0'}}, CommentListVo{commentId=17createdate=Sun Jan 09 10:05:33 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/57.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsd@Ck.com', nickname='sfsf', parentCommentNickname='null', content='hdsfsd', status='0'}}, CommentListVo{commentId=16createdate=Sun Jan 09 10:03:48 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/90.png, replyComments=[CommentListVo{commentId=19createdate=Mon Jan 10 09:47:47 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/73.png, replyComments=[], CommentVo=CommentVo{parentCommentId=16, articleId=10004, email='sdfsd@Ck.com', nickname='ivan', parentCommentNickname='sfs@ss.c', content='dfjgg', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='null', content='what?', status='0'}}, CommentListVo{commentId=11createdate=Wed Dec 01 22:44:50 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=12createdate=Wed Dec 01 22:45:18 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=15createdate=Wed Dec 01 23:42:17 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='555@test.com', nickname='555', parentCommentNickname='jess', content='555', status='0'}}, CommentListVo{commentId=13createdate=Wed Dec 01 22:45:56 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=14createdate=Wed Dec 01 22:46:22 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=13, articleId=10004, email='hah@gmail.com', nickname='haha', parentCommentNickname='test', content='hahah', status='0'}}], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='test@gg.com', nickname='test', parentCommentNickname='jess', content='great!', status='0'}}], CommentVo=CommentVo{parentCommentId=11, articleId=10004, email='jess@gmail.com', nickname='jess', parentCommentNickname='ivan', content='I am doing well. You?', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='ivanliang0818@gmail.com', nickname='ivan', parentCommentNickname='null', content='How are you doing today?', status='0'}}], total=4}
2022-01-19 11:15:05:693 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 7ms
2022-01-19 11:15:05:693 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:17:01:976 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:17:01:976 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:17:01:976 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:17:01:976 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:17:01:976 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/categories
2022-01-19 11:17:01:976 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:17:01:976 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CategoryContoller.getCategories
2022-01-19 11:17:01:976 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:17:01:977 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: {}
2022-01-19 11:17:01:977 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/articles/hot
2022-01-19 11:17:01:977 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CategoryVo{categoryId=2, name='liddffd', articleCount=1}, CategoryVo{categoryId=1, name='Life ', articleCount=2}], total=null}
2022-01-19 11:17:01:977 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.ArticleController.getHotArticles
2022-01-19 11:17:01:977 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 10ms
2022-01-19 11:17:01:977 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: {}
2022-01-19 11:17:01:977 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:17:01:977 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[ArticleVo{userInfo=null, category=null, BaseArticleVo{articleId=10004, status=null, type=null, title='Spring boot', description='null', content='null', firstPicture='null', viewCount=174, createDate='Tue Oct 12 15:58:26 EDT 2021', updateDate='null'}}, ArticleVo{userInfo=null, category=null, BaseArticleVo{articleId=10005, status=null, type=null, title='dd', description='null', content='null', firstPicture='null', viewCount=83, createDate='Sun Nov 07 14:09:29 EST 2021', updateDate='null'}}, ArticleVo{userInfo=null, category=null, BaseArticleVo{articleId=10003, status=null, type=null, title='dd', description='null', content='null', firstPicture='null', viewCount=0, createDate='Tue Oct 12 15:57:33 EDT 2021', updateDate='null'}}], total=null}
2022-01-19 11:17:01:977 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 9ms
2022-01-19 11:17:01:977 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:17:01:984 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:17:01:984 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:17:01:984 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:17:01:984 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/articles
2022-01-19 11:17:01:984 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.ArticleController.getPublicArticles
2022-01-19 11:17:01:984 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: SearchVo{page=1, limit=10, categoryId=null, total=null}
2022-01-19 11:17:01:984 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[ArticleVo{userInfo=UserInfoVo{userId=100001, nickName='ivan', userName='ivan', avatar='https://res-blog-public.s3.ca-central-1.amazonaws.com/default_avatar.jpg'}, category=CategoryVo{categoryId=1, name='Life ', articleCount=null}, BaseArticleVo{articleId=10005, status=1, type=1, title='dd', description='This is the doc of React markdown editor lite.
Enjoy!!', content='null', firstPicture='', viewCount=83, createDate='Sun Nov 07 14:09:29 EST 2021', updateDate='Tue Jan 18 22:54:08 EST 2022'}}, ArticleVo{userInfo=UserInfoVo{userId=100001, nickName='ivan', userName='ivan', avatar='https://res-blog-public.s3.ca-central-1.amazonaws.com/default_avatar.jpg'}, category=CategoryVo{categoryId=2, name='liddffd', articleCount=null}, BaseArticleVo{articleId=10004, status=1, type=2, title='Spring boot', description='rerwerwer', content='null', firstPicture='', viewCount=174, createDate='Tue Oct 12 15:58:26 EDT 2021', updateDate='Tue Jan 18 22:56:37 EST 2022'}}, ArticleVo{userInfo=UserInfoVo{userId=100001, nickName='ivan', userName='ivan', avatar='https://res-blog-public.s3.ca-central-1.amazonaws.com/default_avatar.jpg'}, category=CategoryVo{categoryId=1, name='Life ', articleCount=null}, BaseArticleVo{articleId=10003, status=1, type=1, title='dd', description='test', content='null', firstPicture='', viewCount=0, createDate='Tue Oct 12 15:57:33 EDT 2021', updateDate='Tue Jan 18 22:53:20 EST 2022'}}], total=3}
2022-01-19 11:17:01:984 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 16ms
2022-01-19 11:17:01:984 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:17:04:079 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:17:04:079 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:17:04:079 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:17:04:079 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:17:04:079 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:17:04:079 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:17:04:079 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 11:17:04:079 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 11:17:04:079 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 11:17:04:079 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 11:17:04:079 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 11:17:04:079 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 11:17:04:079 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[], total=4}
2022-01-19 11:17:04:079 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[], total=4}
2022-01-19 11:17:04:079 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 1ms
2022-01-19 11:17:04:079 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 1ms
2022-01-19 11:17:04:079 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:17:04:079 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:17:04:083 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:17:04:083 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:17:04:083 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:17:04:083 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/article/10005
2022-01-19 11:17:04:083 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.ArticleController.getPublicArticleDetail
2022-01-19 11:17:04:083 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 11:17:04:083 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=ArticleVo{userInfo=UserInfoVo{userId=100001, nickName='ivan', userName='ivan', avatar='https://res-blog-public.s3.ca-central-1.amazonaws.com/default_avatar.jpg'}, category=CategoryVo{categoryId=1, name='Life ', articleCount=null}, BaseArticleVo{articleId=10005, status=1, type=1, title='dd', description='This is the doc of React markdown editor lite.
Enjoy!!', content='| Head | Head | Head | Head |
| --- | --- | --- | --- |
| Data | Data | Data | Data |
| Data | Data | Data | Data |

## 手把手教你写一个markdown编辑器

> 笔者在18年年末的时候接到一个开发任务——搭建一个AI项目的开放平台，其中的产品文档为转化为HTML格式的markdown文档。考虑到文档的即时更新，将文档信息做成了Ajax接口的形式。因此管理后台只需将textarea表单的内容通过markdown解析器进行HTML格式转化，然后将markdown内容和经转化的HTML文档都保存到数据库即可。
> 基本需求完成后，为了更好的用户体验，考虑将常用的编辑功能添加进来。改进版不仅支持了常用的文本编辑功能，还实现的UI界面的配置化，自定义语法解析器。本着造福伸手党的目的，以及积累些开源经验，笔者将该react 组件 [react-markdown-editor-lite](https://github.com/HarryChen0506/react-markdown-editor-lite) 进行了封装改造，并且发布到了开源社区。

### 预览
在线体验 [https://harrychen0506.github.io/react-markdown-editor-lite/](https://harrychen0506.github.io/react-markdown-editor-lite/)

![image](https://github.com//HarryChen0506/react-markdown-editor-lite/blob/master/image/react-markdown-editor-lite-v1.0.0.PNG?raw=true)

### 特点
* 轻量、基于React
* UI可配置, 如只显示编辑区或预览区
* 支持自定义markdown语法解析器,语法高亮等
* 支持常用的markdown编辑功能，如加粗，斜体等等...
* 支持功能按钮插拔化，用户可以自定义扩展组件
* 支持编辑区和预览区同步滚动

### 开发心得

- 文本编辑

  大多数常见的编辑器，包括富文本编辑器，利用了某些元素如div的contenteditable属性，配合selection、range、execCommand等API，实现了富文本编辑功能。这里面的实现比较复杂，所以有了"[为什么都说富文本编辑器是天坑？](https://www.zhihu.com/question/38699645)"这个说法。

  而markdown编辑器，核心的处理内容为简单语法的纯文本，复杂度相对来说比较低，并且input标签自带onSelect事件，可以很方便的获取选择信息（选择起始位置和选择文本值），因此要想实现编辑功能，只需将要改动的内容进行文本转换，然后进行重新拼接首尾，大功告成。
  
- markdown解析

  考察了几个社区流行的markdown解析器，比较流行的有[markdown](https://www.npmjs.com/package/markdown), [markdown-it](https://www.npmjs.com/package/markdown-it), [marked](https://www.npmjs.com/package/marked) 等等。综合考虑扩展性以及稳定性，笔者推荐使用markdown-it作为markdown的词法解析器，因为该解析器有比较多的插件，并且支持语法高亮。

- 同步滚动

  当选择分栏编辑的时候，滚动左侧的编辑区，右侧的预览区能自动滚动到对应的区域。方案参考了《[手把手教你用 100行代码实现基于 react的 markdown 输入 + 即时预览在线编辑器（一）](https://github.com/accforgit/blog-data/blob/master/%E5%9C%A8%E7%BA%BF%E7%BC%96%E8%BE%91%E5%99%A8/README/README1.md)》。只需先计算出输入框容器元素与预览框容器元素之间最大scroll范围的比例值，然后根据主动滚动元素自身的scrollTop做相应的比例换算，即可知道对方区域的scrollTop值。

- 关于UI
 
  - 项目的字体库选择了Font Awesome风格，并且只选取了项目所需要的一些图标。
  - 编辑器的整体css均可通过全局覆盖的形式进行自定义。目前暂时只支持灰色主题。
  - 编辑器的显示区域包括菜单栏，编辑器，预览区，工具栏，通过配置组件的config属性，可以选择默认的展示区域。
  
### Install

```js
npm install react-markdown-editor-lite --save
```

### Props

| Property | Description | Type | default | Remarks |
| --- | --- | --- | --- | --- |
| value | markdown content | String | '' | required |
| style | component container style | Object | {height: '100%'} | not required |
| config | component config | Object | {view: {...}, logger: {...}} | not required |
| onChange | emitting when editor has changed | Function | ({html, md}) => {} | not required |
| onImageUpload | when image uploaded, callback emitting will get image markdown text | (file: File, callback: (url: string) => void) => void; | ({file, callback}) => {} | not required |
| renderHTML | Render markdown text to HTML. You can return either string, function or Promise | (text: string) => string|function|Promise | none | **required** |

### Example

``` js
'use strict';
import React from 'react'
import ReactDOM from 'react-dom'
import MdEditor from 'react-markdown-editor-lite'
import MarkdownIt from 'markdown-it'
import emoji from 'markdown-it-emoji'
import subscript from 'markdown-it-sub'
import superscript from 'markdown-it-sup'
import footnote from 'markdown-it-footnote'
import deflist from 'markdown-it-deflist'
import abbreviation from 'markdown-it-abbr'
import insert from 'markdown-it-ins'
import mark from 'markdown-it-mark'
import tasklists from 'markdown-it-task-lists'
import hljs from 'highlight.js'
import 'highlight.js/styles/atom-one-light.css'
// import 'highlight.js/styles/github.css'
import './index.less';

const MOCK_DATA = "I Love React."
export default class Demo extends React.Component {
  mdEditor = null
  mdParser = null
  constructor(props) {
    super(props)
    // initial a parsera
    this.mdParser = new MarkdownIt({
      html: true,
      linkify: true,
      typographer: true,
      highlight: function (str, lang) {
        if (lang && hljs.getLanguage(lang)) {
          try {
            return hljs.highlight(lang, str).value
          } catch (__) {}
        }    
        return '' // use external default escaping
      }
    })
    .use(emoji)
    .use(subscript)
    .use(superscript)
    .use(footnote)
    .use(deflist)
    .use(abbreviation)
    .use(insert)
    .use(mark)
    .use(tasklists, { enabled: this.taskLists })
    this.renderHTML = this.renderHTML.bind(this)
  }
  handleEditorChange({html, md}) {
    console.log('handleEditorChange', html, md)
  }
  handleImageUpload(file, callback) {
    const reader = new FileReader()
    reader.onload = () => {      
      const convertBase64UrlToBlob = (urlData) => {  
        let arr = urlData.split(','), mime = arr[0].match(/:(.*?);/)[1]
        let bstr = atob(arr[1])
        let n = bstr.length
        let u8arr = new Uint8Array(n)
        while (n--) {
          u8arr[n] = bstr.charCodeAt(n)
        }
        return new Blob([u8arr], {type:mime})
      }
      const blob = convertBase64UrlToBlob(reader.result)
      setTimeout(() => {
        // setTimeout 模拟异步上传图片
        // 当异步上传获取图片地址后，执行calback回调（参数为imageUrl字符串），即可将图片地址写入markdown
        callback('https://avatars0.githubusercontent.com/u/21263805?s=40&v=4')
      }, 1000)
    }
    reader.readAsDataURL(file)
  }
  renderHTML(text) {
    // 模拟异步渲染Markdown
    return new Promise((resolve) => {
      setTimeout(() => {
        resolve(this.mdParser.render(text))
      }, 1000)
    })
  }
  handleGetMdValue = () => {   
    this.mdEditor && alert(this.mdEditor.getMdValue())      
  }
  handleGetHtmlValue = () => {    
    this.mdEditor && alert(this.mdEditor.getHtmlValue())
  }
  render() {
    return (      
      <div>
        <nav>
          <button onClick={this.handleGetMdValue} >getMdValue</button>  
          <button onClick={this.handleGetHtmlValue} >getHtmlValue</button>  
        </nav>
        <section style="height: 500px">
          <MdEditor 
            ref={node => this.mdEditor = node}
            value={MOCK_DATA}
            style={{height: '400px'}}
            renderHTML={this.renderHTML}
            config={{
              view: {
                menu: true,
                md: true,
                html: true
              },
              imageUrl: 'https://octodex.github.com/images/minion.png'
            }}
            onChange={this.handleEditorChange} 
            onImageUpload={this.handleImageUpload}
          />
        </section>                        
      </div>      
    )
  }
}
```

### 最后

   欢迎大家使用和反馈，[项目地址](https://github.com/HarryChen0506/react-markdown-editor-lite) (https://github.com/HarryChen0506/react-markdown-editor-lite)， 你的点赞将是我莫大的动力😊

![1.png](https://s3.ca-central-1.amazonaws.com/res-blog-public/res-dev/blog_1636946743939_1.png)', firstPicture='', viewCount=83, createDate='Sun Nov 07 14:09:29 EST 2021', updateDate='Tue Jan 18 22:54:08 EST 2022'}}, total=null}
2022-01-19 11:17:04:084 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 5ms
2022-01-19 11:17:04:085 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:17:04:128 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:17:04:129 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:17:04:129 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:17:04:129 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 11:17:04:129 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 11:17:04:129 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 11:17:04:129 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[], total=4}
2022-01-19 11:17:04:129 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 0ms
2022-01-19 11:17:04:129 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:17:36:258 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:17:36:259 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:17:36:259 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:17:36:259 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 11:17:36:259 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 11:17:36:259 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 11:17:36:258 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:17:36:259 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[], total=0}
2022-01-19 11:17:36:259 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:17:36:259 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:17:36:259 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 11:17:36:259 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 11:17:36:259 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 11:17:36:259 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[], total=0}
2022-01-19 11:17:36:259 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 10ms
2022-01-19 11:17:36:259 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 19ms
2022-01-19 11:17:36:259 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:17:36:259 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:17:36:265 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:17:36:265 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:17:36:265 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:17:36:265 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/article/10005
2022-01-19 11:17:36:265 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.ArticleController.getPublicArticleDetail
2022-01-19 11:17:36:265 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 11:17:36:265 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=ArticleVo{userInfo=UserInfoVo{userId=100001, nickName='ivan', userName='ivan', avatar='https://res-blog-public.s3.ca-central-1.amazonaws.com/default_avatar.jpg'}, category=CategoryVo{categoryId=1, name='Life ', articleCount=null}, BaseArticleVo{articleId=10005, status=1, type=1, title='dd', description='This is the doc of React markdown editor lite.
Enjoy!!', content='| Head | Head | Head | Head |
| --- | --- | --- | --- |
| Data | Data | Data | Data |
| Data | Data | Data | Data |

## 手把手教你写一个markdown编辑器

> 笔者在18年年末的时候接到一个开发任务——搭建一个AI项目的开放平台，其中的产品文档为转化为HTML格式的markdown文档。考虑到文档的即时更新，将文档信息做成了Ajax接口的形式。因此管理后台只需将textarea表单的内容通过markdown解析器进行HTML格式转化，然后将markdown内容和经转化的HTML文档都保存到数据库即可。
> 基本需求完成后，为了更好的用户体验，考虑将常用的编辑功能添加进来。改进版不仅支持了常用的文本编辑功能，还实现的UI界面的配置化，自定义语法解析器。本着造福伸手党的目的，以及积累些开源经验，笔者将该react 组件 [react-markdown-editor-lite](https://github.com/HarryChen0506/react-markdown-editor-lite) 进行了封装改造，并且发布到了开源社区。

### 预览
在线体验 [https://harrychen0506.github.io/react-markdown-editor-lite/](https://harrychen0506.github.io/react-markdown-editor-lite/)

![image](https://github.com//HarryChen0506/react-markdown-editor-lite/blob/master/image/react-markdown-editor-lite-v1.0.0.PNG?raw=true)

### 特点
* 轻量、基于React
* UI可配置, 如只显示编辑区或预览区
* 支持自定义markdown语法解析器,语法高亮等
* 支持常用的markdown编辑功能，如加粗，斜体等等...
* 支持功能按钮插拔化，用户可以自定义扩展组件
* 支持编辑区和预览区同步滚动

### 开发心得

- 文本编辑

  大多数常见的编辑器，包括富文本编辑器，利用了某些元素如div的contenteditable属性，配合selection、range、execCommand等API，实现了富文本编辑功能。这里面的实现比较复杂，所以有了"[为什么都说富文本编辑器是天坑？](https://www.zhihu.com/question/38699645)"这个说法。

  而markdown编辑器，核心的处理内容为简单语法的纯文本，复杂度相对来说比较低，并且input标签自带onSelect事件，可以很方便的获取选择信息（选择起始位置和选择文本值），因此要想实现编辑功能，只需将要改动的内容进行文本转换，然后进行重新拼接首尾，大功告成。
  
- markdown解析

  考察了几个社区流行的markdown解析器，比较流行的有[markdown](https://www.npmjs.com/package/markdown), [markdown-it](https://www.npmjs.com/package/markdown-it), [marked](https://www.npmjs.com/package/marked) 等等。综合考虑扩展性以及稳定性，笔者推荐使用markdown-it作为markdown的词法解析器，因为该解析器有比较多的插件，并且支持语法高亮。

- 同步滚动

  当选择分栏编辑的时候，滚动左侧的编辑区，右侧的预览区能自动滚动到对应的区域。方案参考了《[手把手教你用 100行代码实现基于 react的 markdown 输入 + 即时预览在线编辑器（一）](https://github.com/accforgit/blog-data/blob/master/%E5%9C%A8%E7%BA%BF%E7%BC%96%E8%BE%91%E5%99%A8/README/README1.md)》。只需先计算出输入框容器元素与预览框容器元素之间最大scroll范围的比例值，然后根据主动滚动元素自身的scrollTop做相应的比例换算，即可知道对方区域的scrollTop值。

- 关于UI
 
  - 项目的字体库选择了Font Awesome风格，并且只选取了项目所需要的一些图标。
  - 编辑器的整体css均可通过全局覆盖的形式进行自定义。目前暂时只支持灰色主题。
  - 编辑器的显示区域包括菜单栏，编辑器，预览区，工具栏，通过配置组件的config属性，可以选择默认的展示区域。
  
### Install

```js
npm install react-markdown-editor-lite --save
```

### Props

| Property | Description | Type | default | Remarks |
| --- | --- | --- | --- | --- |
| value | markdown content | String | '' | required |
| style | component container style | Object | {height: '100%'} | not required |
| config | component config | Object | {view: {...}, logger: {...}} | not required |
| onChange | emitting when editor has changed | Function | ({html, md}) => {} | not required |
| onImageUpload | when image uploaded, callback emitting will get image markdown text | (file: File, callback: (url: string) => void) => void; | ({file, callback}) => {} | not required |
| renderHTML | Render markdown text to HTML. You can return either string, function or Promise | (text: string) => string|function|Promise | none | **required** |

### Example

``` js
'use strict';
import React from 'react'
import ReactDOM from 'react-dom'
import MdEditor from 'react-markdown-editor-lite'
import MarkdownIt from 'markdown-it'
import emoji from 'markdown-it-emoji'
import subscript from 'markdown-it-sub'
import superscript from 'markdown-it-sup'
import footnote from 'markdown-it-footnote'
import deflist from 'markdown-it-deflist'
import abbreviation from 'markdown-it-abbr'
import insert from 'markdown-it-ins'
import mark from 'markdown-it-mark'
import tasklists from 'markdown-it-task-lists'
import hljs from 'highlight.js'
import 'highlight.js/styles/atom-one-light.css'
// import 'highlight.js/styles/github.css'
import './index.less';

const MOCK_DATA = "I Love React."
export default class Demo extends React.Component {
  mdEditor = null
  mdParser = null
  constructor(props) {
    super(props)
    // initial a parsera
    this.mdParser = new MarkdownIt({
      html: true,
      linkify: true,
      typographer: true,
      highlight: function (str, lang) {
        if (lang && hljs.getLanguage(lang)) {
          try {
            return hljs.highlight(lang, str).value
          } catch (__) {}
        }    
        return '' // use external default escaping
      }
    })
    .use(emoji)
    .use(subscript)
    .use(superscript)
    .use(footnote)
    .use(deflist)
    .use(abbreviation)
    .use(insert)
    .use(mark)
    .use(tasklists, { enabled: this.taskLists })
    this.renderHTML = this.renderHTML.bind(this)
  }
  handleEditorChange({html, md}) {
    console.log('handleEditorChange', html, md)
  }
  handleImageUpload(file, callback) {
    const reader = new FileReader()
    reader.onload = () => {      
      const convertBase64UrlToBlob = (urlData) => {  
        let arr = urlData.split(','), mime = arr[0].match(/:(.*?);/)[1]
        let bstr = atob(arr[1])
        let n = bstr.length
        let u8arr = new Uint8Array(n)
        while (n--) {
          u8arr[n] = bstr.charCodeAt(n)
        }
        return new Blob([u8arr], {type:mime})
      }
      const blob = convertBase64UrlToBlob(reader.result)
      setTimeout(() => {
        // setTimeout 模拟异步上传图片
        // 当异步上传获取图片地址后，执行calback回调（参数为imageUrl字符串），即可将图片地址写入markdown
        callback('https://avatars0.githubusercontent.com/u/21263805?s=40&v=4')
      }, 1000)
    }
    reader.readAsDataURL(file)
  }
  renderHTML(text) {
    // 模拟异步渲染Markdown
    return new Promise((resolve) => {
      setTimeout(() => {
        resolve(this.mdParser.render(text))
      }, 1000)
    })
  }
  handleGetMdValue = () => {   
    this.mdEditor && alert(this.mdEditor.getMdValue())      
  }
  handleGetHtmlValue = () => {    
    this.mdEditor && alert(this.mdEditor.getHtmlValue())
  }
  render() {
    return (      
      <div>
        <nav>
          <button onClick={this.handleGetMdValue} >getMdValue</button>  
          <button onClick={this.handleGetHtmlValue} >getHtmlValue</button>  
        </nav>
        <section style="height: 500px">
          <MdEditor 
            ref={node => this.mdEditor = node}
            value={MOCK_DATA}
            style={{height: '400px'}}
            renderHTML={this.renderHTML}
            config={{
              view: {
                menu: true,
                md: true,
                html: true
              },
              imageUrl: 'https://octodex.github.com/images/minion.png'
            }}
            onChange={this.handleEditorChange} 
            onImageUpload={this.handleImageUpload}
          />
        </section>                        
      </div>      
    )
  }
}
```

### 最后

   欢迎大家使用和反馈，[项目地址](https://github.com/HarryChen0506/react-markdown-editor-lite) (https://github.com/HarryChen0506/react-markdown-editor-lite)， 你的点赞将是我莫大的动力😊

![1.png](https://s3.ca-central-1.amazonaws.com/res-blog-public/res-dev/blog_1636946743939_1.png)', firstPicture='', viewCount=83, createDate='Sun Nov 07 14:09:29 EST 2021', updateDate='Tue Jan 18 22:54:08 EST 2022'}}, total=null}
2022-01-19 11:17:36:265 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 26ms
2022-01-19 11:17:36:265 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:17:36:828 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:17:36:828 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:17:36:828 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:17:36:828 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 11:17:36:828 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 11:17:36:828 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 11:17:36:828 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[], total=0}
2022-01-19 11:17:36:828 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 2ms
2022-01-19 11:17:36:828 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:18:01:501 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:18:01:502 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:18:01:502 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:18:01:502 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/articles/hot
2022-01-19 11:18:01:502 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.ArticleController.getHotArticles
2022-01-19 11:18:01:502 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: {}
2022-01-19 11:18:01:502 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[ArticleVo{userInfo=null, category=null, BaseArticleVo{articleId=10004, status=null, type=null, title='Spring boot', description='null', content='null', firstPicture='null', viewCount=174, createDate='Tue Oct 12 15:58:26 EDT 2021', updateDate='null'}}, ArticleVo{userInfo=null, category=null, BaseArticleVo{articleId=10005, status=null, type=null, title='dd', description='null', content='null', firstPicture='null', viewCount=83, createDate='Sun Nov 07 14:09:29 EST 2021', updateDate='null'}}, ArticleVo{userInfo=null, category=null, BaseArticleVo{articleId=10003, status=null, type=null, title='dd', description='null', content='null', firstPicture='null', viewCount=0, createDate='Tue Oct 12 15:57:33 EDT 2021', updateDate='null'}}], total=null}
2022-01-19 11:18:01:502 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 3ms
2022-01-19 11:18:01:502 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:18:01:505 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:18:01:505 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:18:01:505 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:18:01:505 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/categories
2022-01-19 11:18:01:505 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CategoryContoller.getCategories
2022-01-19 11:18:01:505 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: {}
2022-01-19 11:18:01:505 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CategoryVo{categoryId=2, name='liddffd', articleCount=1}, CategoryVo{categoryId=1, name='Life ', articleCount=2}], total=null}
2022-01-19 11:18:01:505 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 7ms
2022-01-19 11:18:01:505 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:18:01:512 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:18:01:512 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:18:01:512 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:18:01:512 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/articles
2022-01-19 11:18:01:512 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.ArticleController.getPublicArticles
2022-01-19 11:18:01:512 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: SearchVo{page=1, limit=10, categoryId=null, total=null}
2022-01-19 11:18:01:512 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[ArticleVo{userInfo=UserInfoVo{userId=100001, nickName='ivan', userName='ivan', avatar='https://res-blog-public.s3.ca-central-1.amazonaws.com/default_avatar.jpg'}, category=CategoryVo{categoryId=1, name='Life ', articleCount=null}, BaseArticleVo{articleId=10005, status=1, type=1, title='dd', description='This is the doc of React markdown editor lite.
Enjoy!!', content='null', firstPicture='', viewCount=83, createDate='Sun Nov 07 14:09:29 EST 2021', updateDate='Tue Jan 18 22:54:08 EST 2022'}}, ArticleVo{userInfo=UserInfoVo{userId=100001, nickName='ivan', userName='ivan', avatar='https://res-blog-public.s3.ca-central-1.amazonaws.com/default_avatar.jpg'}, category=CategoryVo{categoryId=2, name='liddffd', articleCount=null}, BaseArticleVo{articleId=10004, status=1, type=2, title='Spring boot', description='rerwerwer', content='null', firstPicture='', viewCount=174, createDate='Tue Oct 12 15:58:26 EDT 2021', updateDate='Tue Jan 18 22:56:37 EST 2022'}}, ArticleVo{userInfo=UserInfoVo{userId=100001, nickName='ivan', userName='ivan', avatar='https://res-blog-public.s3.ca-central-1.amazonaws.com/default_avatar.jpg'}, category=CategoryVo{categoryId=1, name='Life ', articleCount=null}, BaseArticleVo{articleId=10003, status=1, type=1, title='dd', description='test', content='null', firstPicture='', viewCount=0, createDate='Tue Oct 12 15:57:33 EDT 2021', updateDate='Tue Jan 18 22:53:20 EST 2022'}}], total=3}
2022-01-19 11:18:01:512 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 13ms
2022-01-19 11:18:01:512 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:18:03:399 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:18:03:399 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:18:03:399 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:18:03:399 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:18:03:399 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:18:03:399 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:18:03:399 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 11:18:03:399 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 11:18:03:399 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 11:18:03:399 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[], total=0}
2022-01-19 11:18:03:399 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 2ms
2022-01-19 11:18:03:399 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:18:03:399 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 11:18:03:400 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 11:18:03:400 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 11:18:03:400 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[], total=0}
2022-01-19 11:18:03:400 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 2ms
2022-01-19 11:18:03:400 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:18:03:406 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:18:03:406 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:18:03:406 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:18:03:406 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/article/10005
2022-01-19 11:18:03:406 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.ArticleController.getPublicArticleDetail
2022-01-19 11:18:03:406 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 11:18:03:406 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=ArticleVo{userInfo=UserInfoVo{userId=100001, nickName='ivan', userName='ivan', avatar='https://res-blog-public.s3.ca-central-1.amazonaws.com/default_avatar.jpg'}, category=CategoryVo{categoryId=1, name='Life ', articleCount=null}, BaseArticleVo{articleId=10005, status=1, type=1, title='dd', description='This is the doc of React markdown editor lite.
Enjoy!!', content='| Head | Head | Head | Head |
| --- | --- | --- | --- |
| Data | Data | Data | Data |
| Data | Data | Data | Data |

## 手把手教你写一个markdown编辑器

> 笔者在18年年末的时候接到一个开发任务——搭建一个AI项目的开放平台，其中的产品文档为转化为HTML格式的markdown文档。考虑到文档的即时更新，将文档信息做成了Ajax接口的形式。因此管理后台只需将textarea表单的内容通过markdown解析器进行HTML格式转化，然后将markdown内容和经转化的HTML文档都保存到数据库即可。
> 基本需求完成后，为了更好的用户体验，考虑将常用的编辑功能添加进来。改进版不仅支持了常用的文本编辑功能，还实现的UI界面的配置化，自定义语法解析器。本着造福伸手党的目的，以及积累些开源经验，笔者将该react 组件 [react-markdown-editor-lite](https://github.com/HarryChen0506/react-markdown-editor-lite) 进行了封装改造，并且发布到了开源社区。

### 预览
在线体验 [https://harrychen0506.github.io/react-markdown-editor-lite/](https://harrychen0506.github.io/react-markdown-editor-lite/)

![image](https://github.com//HarryChen0506/react-markdown-editor-lite/blob/master/image/react-markdown-editor-lite-v1.0.0.PNG?raw=true)

### 特点
* 轻量、基于React
* UI可配置, 如只显示编辑区或预览区
* 支持自定义markdown语法解析器,语法高亮等
* 支持常用的markdown编辑功能，如加粗，斜体等等...
* 支持功能按钮插拔化，用户可以自定义扩展组件
* 支持编辑区和预览区同步滚动

### 开发心得

- 文本编辑

  大多数常见的编辑器，包括富文本编辑器，利用了某些元素如div的contenteditable属性，配合selection、range、execCommand等API，实现了富文本编辑功能。这里面的实现比较复杂，所以有了"[为什么都说富文本编辑器是天坑？](https://www.zhihu.com/question/38699645)"这个说法。

  而markdown编辑器，核心的处理内容为简单语法的纯文本，复杂度相对来说比较低，并且input标签自带onSelect事件，可以很方便的获取选择信息（选择起始位置和选择文本值），因此要想实现编辑功能，只需将要改动的内容进行文本转换，然后进行重新拼接首尾，大功告成。
  
- markdown解析

  考察了几个社区流行的markdown解析器，比较流行的有[markdown](https://www.npmjs.com/package/markdown), [markdown-it](https://www.npmjs.com/package/markdown-it), [marked](https://www.npmjs.com/package/marked) 等等。综合考虑扩展性以及稳定性，笔者推荐使用markdown-it作为markdown的词法解析器，因为该解析器有比较多的插件，并且支持语法高亮。

- 同步滚动

  当选择分栏编辑的时候，滚动左侧的编辑区，右侧的预览区能自动滚动到对应的区域。方案参考了《[手把手教你用 100行代码实现基于 react的 markdown 输入 + 即时预览在线编辑器（一）](https://github.com/accforgit/blog-data/blob/master/%E5%9C%A8%E7%BA%BF%E7%BC%96%E8%BE%91%E5%99%A8/README/README1.md)》。只需先计算出输入框容器元素与预览框容器元素之间最大scroll范围的比例值，然后根据主动滚动元素自身的scrollTop做相应的比例换算，即可知道对方区域的scrollTop值。

- 关于UI
 
  - 项目的字体库选择了Font Awesome风格，并且只选取了项目所需要的一些图标。
  - 编辑器的整体css均可通过全局覆盖的形式进行自定义。目前暂时只支持灰色主题。
  - 编辑器的显示区域包括菜单栏，编辑器，预览区，工具栏，通过配置组件的config属性，可以选择默认的展示区域。
  
### Install

```js
npm install react-markdown-editor-lite --save
```

### Props

| Property | Description | Type | default | Remarks |
| --- | --- | --- | --- | --- |
| value | markdown content | String | '' | required |
| style | component container style | Object | {height: '100%'} | not required |
| config | component config | Object | {view: {...}, logger: {...}} | not required |
| onChange | emitting when editor has changed | Function | ({html, md}) => {} | not required |
| onImageUpload | when image uploaded, callback emitting will get image markdown text | (file: File, callback: (url: string) => void) => void; | ({file, callback}) => {} | not required |
| renderHTML | Render markdown text to HTML. You can return either string, function or Promise | (text: string) => string|function|Promise | none | **required** |

### Example

``` js
'use strict';
import React from 'react'
import ReactDOM from 'react-dom'
import MdEditor from 'react-markdown-editor-lite'
import MarkdownIt from 'markdown-it'
import emoji from 'markdown-it-emoji'
import subscript from 'markdown-it-sub'
import superscript from 'markdown-it-sup'
import footnote from 'markdown-it-footnote'
import deflist from 'markdown-it-deflist'
import abbreviation from 'markdown-it-abbr'
import insert from 'markdown-it-ins'
import mark from 'markdown-it-mark'
import tasklists from 'markdown-it-task-lists'
import hljs from 'highlight.js'
import 'highlight.js/styles/atom-one-light.css'
// import 'highlight.js/styles/github.css'
import './index.less';

const MOCK_DATA = "I Love React."
export default class Demo extends React.Component {
  mdEditor = null
  mdParser = null
  constructor(props) {
    super(props)
    // initial a parsera
    this.mdParser = new MarkdownIt({
      html: true,
      linkify: true,
      typographer: true,
      highlight: function (str, lang) {
        if (lang && hljs.getLanguage(lang)) {
          try {
            return hljs.highlight(lang, str).value
          } catch (__) {}
        }    
        return '' // use external default escaping
      }
    })
    .use(emoji)
    .use(subscript)
    .use(superscript)
    .use(footnote)
    .use(deflist)
    .use(abbreviation)
    .use(insert)
    .use(mark)
    .use(tasklists, { enabled: this.taskLists })
    this.renderHTML = this.renderHTML.bind(this)
  }
  handleEditorChange({html, md}) {
    console.log('handleEditorChange', html, md)
  }
  handleImageUpload(file, callback) {
    const reader = new FileReader()
    reader.onload = () => {      
      const convertBase64UrlToBlob = (urlData) => {  
        let arr = urlData.split(','), mime = arr[0].match(/:(.*?);/)[1]
        let bstr = atob(arr[1])
        let n = bstr.length
        let u8arr = new Uint8Array(n)
        while (n--) {
          u8arr[n] = bstr.charCodeAt(n)
        }
        return new Blob([u8arr], {type:mime})
      }
      const blob = convertBase64UrlToBlob(reader.result)
      setTimeout(() => {
        // setTimeout 模拟异步上传图片
        // 当异步上传获取图片地址后，执行calback回调（参数为imageUrl字符串），即可将图片地址写入markdown
        callback('https://avatars0.githubusercontent.com/u/21263805?s=40&v=4')
      }, 1000)
    }
    reader.readAsDataURL(file)
  }
  renderHTML(text) {
    // 模拟异步渲染Markdown
    return new Promise((resolve) => {
      setTimeout(() => {
        resolve(this.mdParser.render(text))
      }, 1000)
    })
  }
  handleGetMdValue = () => {   
    this.mdEditor && alert(this.mdEditor.getMdValue())      
  }
  handleGetHtmlValue = () => {    
    this.mdEditor && alert(this.mdEditor.getHtmlValue())
  }
  render() {
    return (      
      <div>
        <nav>
          <button onClick={this.handleGetMdValue} >getMdValue</button>  
          <button onClick={this.handleGetHtmlValue} >getHtmlValue</button>  
        </nav>
        <section style="height: 500px">
          <MdEditor 
            ref={node => this.mdEditor = node}
            value={MOCK_DATA}
            style={{height: '400px'}}
            renderHTML={this.renderHTML}
            config={{
              view: {
                menu: true,
                md: true,
                html: true
              },
              imageUrl: 'https://octodex.github.com/images/minion.png'
            }}
            onChange={this.handleEditorChange} 
            onImageUpload={this.handleImageUpload}
          />
        </section>                        
      </div>      
    )
  }
}
```

### 最后

   欢迎大家使用和反馈，[项目地址](https://github.com/HarryChen0506/react-markdown-editor-lite) (https://github.com/HarryChen0506/react-markdown-editor-lite)， 你的点赞将是我莫大的动力😊

![1.png](https://s3.ca-central-1.amazonaws.com/res-blog-public/res-dev/blog_1636946743939_1.png)', firstPicture='', viewCount=83, createDate='Sun Nov 07 14:09:29 EST 2021', updateDate='Tue Jan 18 22:54:08 EST 2022'}}, total=null}
2022-01-19 11:18:03:406 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 9ms
2022-01-19 11:18:03:406 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:18:03:433 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:18:03:433 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:18:03:433 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:18:03:433 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 11:18:03:433 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 11:18:03:433 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 11:18:03:433 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[], total=0}
2022-01-19 11:18:03:433 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 1ms
2022-01-19 11:18:03:433 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:18:10:593 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:18:10:593 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:18:10:593 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:18:10:593 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:18:10:593 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:18:10:593 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:18:10:593 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/categories
2022-01-19 11:18:10:593 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/articles/hot
2022-01-19 11:18:10:593 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CategoryContoller.getCategories
2022-01-19 11:18:10:593 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.ArticleController.getHotArticles
2022-01-19 11:18:10:593 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: {}
2022-01-19 11:18:10:593 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: {}
2022-01-19 11:18:10:593 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CategoryVo{categoryId=2, name='liddffd', articleCount=1}, CategoryVo{categoryId=1, name='Life ', articleCount=2}], total=null}
2022-01-19 11:18:10:593 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 2ms
2022-01-19 11:18:10:593 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:18:10:593 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[ArticleVo{userInfo=null, category=null, BaseArticleVo{articleId=10004, status=null, type=null, title='Spring boot', description='null', content='null', firstPicture='null', viewCount=174, createDate='Tue Oct 12 15:58:26 EDT 2021', updateDate='null'}}, ArticleVo{userInfo=null, category=null, BaseArticleVo{articleId=10005, status=null, type=null, title='dd', description='null', content='null', firstPicture='null', viewCount=83, createDate='Sun Nov 07 14:09:29 EST 2021', updateDate='null'}}, ArticleVo{userInfo=null, category=null, BaseArticleVo{articleId=10003, status=null, type=null, title='dd', description='null', content='null', firstPicture='null', viewCount=0, createDate='Tue Oct 12 15:57:33 EDT 2021', updateDate='null'}}], total=null}
2022-01-19 11:18:10:594 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 1ms
2022-01-19 11:18:10:594 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:18:10:598 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:18:10:598 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:18:10:598 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:18:10:598 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/articles
2022-01-19 11:18:10:598 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.ArticleController.getPublicArticles
2022-01-19 11:18:10:598 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: SearchVo{page=1, limit=10, categoryId=null, total=null}
2022-01-19 11:18:10:598 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[ArticleVo{userInfo=UserInfoVo{userId=100001, nickName='ivan', userName='ivan', avatar='https://res-blog-public.s3.ca-central-1.amazonaws.com/default_avatar.jpg'}, category=CategoryVo{categoryId=1, name='Life ', articleCount=null}, BaseArticleVo{articleId=10005, status=1, type=1, title='dd', description='This is the doc of React markdown editor lite.
Enjoy!!', content='null', firstPicture='', viewCount=83, createDate='Sun Nov 07 14:09:29 EST 2021', updateDate='Tue Jan 18 22:54:08 EST 2022'}}, ArticleVo{userInfo=UserInfoVo{userId=100001, nickName='ivan', userName='ivan', avatar='https://res-blog-public.s3.ca-central-1.amazonaws.com/default_avatar.jpg'}, category=CategoryVo{categoryId=2, name='liddffd', articleCount=null}, BaseArticleVo{articleId=10004, status=1, type=2, title='Spring boot', description='rerwerwer', content='null', firstPicture='', viewCount=174, createDate='Tue Oct 12 15:58:26 EDT 2021', updateDate='Tue Jan 18 22:56:37 EST 2022'}}, ArticleVo{userInfo=UserInfoVo{userId=100001, nickName='ivan', userName='ivan', avatar='https://res-blog-public.s3.ca-central-1.amazonaws.com/default_avatar.jpg'}, category=CategoryVo{categoryId=1, name='Life ', articleCount=null}, BaseArticleVo{articleId=10003, status=1, type=1, title='dd', description='test', content='null', firstPicture='', viewCount=0, createDate='Tue Oct 12 15:57:33 EDT 2021', updateDate='Tue Jan 18 22:53:20 EST 2022'}}], total=3}
2022-01-19 11:18:10:598 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 7ms
2022-01-19 11:18:10:598 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:18:12:462 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:18:12:462 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:18:12:462 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:18:12:462 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/article/10004
2022-01-19 11:18:12:462 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.ArticleController.getPublicArticleDetail
2022-01-19 11:18:12:462 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10004
2022-01-19 11:18:12:462 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=ArticleVo{userInfo=UserInfoVo{userId=100001, nickName='ivan', userName='ivan', avatar='https://res-blog-public.s3.ca-central-1.amazonaws.com/default_avatar.jpg'}, category=CategoryVo{categoryId=2, name='liddffd', articleCount=null}, BaseArticleVo{articleId=10004, status=1, type=2, title='Spring boot', description='rerwerwer', content='rererer![test.png](https://s3.ca-central-1.amazonaws.com/res-blog-public/res-dev/blog_1636947281578_test.png)', firstPicture='', viewCount=174, createDate='Tue Oct 12 15:58:26 EDT 2021', updateDate='Tue Jan 18 22:56:37 EST 2022'}}, total=null}
2022-01-19 11:18:12:462 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 14ms
2022-01-19 11:18:12:462 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:18:12:463 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:18:12:463 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:18:12:463 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:18:12:463 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:18:12:463 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:18:12:463 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:18:12:463 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10004
2022-01-19 11:18:12:463 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10004
2022-01-19 11:18:12:463 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 11:18:12:463 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 11:18:12:463 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10004
2022-01-19 11:18:12:463 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10004
2022-01-19 11:18:12:463 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=18createdate=Sun Jan 09 10:06:04 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/81.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsdf@qq.com', nickname='sf', parentCommentNickname='null', content='sdfsf', status='0'}}, CommentListVo{commentId=17createdate=Sun Jan 09 10:05:33 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/57.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsd@Ck.com', nickname='sfsf', parentCommentNickname='null', content='hdsfsd', status='0'}}, CommentListVo{commentId=16createdate=Sun Jan 09 10:03:48 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/90.png, replyComments=[CommentListVo{commentId=19createdate=Mon Jan 10 09:47:47 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/73.png, replyComments=[], CommentVo=CommentVo{parentCommentId=16, articleId=10004, email='sdfsd@Ck.com', nickname='ivan', parentCommentNickname='sfs@ss.c', content='dfjgg', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='null', content='what?', status='0'}}, CommentListVo{commentId=11createdate=Wed Dec 01 22:44:50 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=12createdate=Wed Dec 01 22:45:18 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=15createdate=Wed Dec 01 23:42:17 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='555@test.com', nickname='555', parentCommentNickname='jess', content='555', status='0'}}, CommentListVo{commentId=13createdate=Wed Dec 01 22:45:56 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=14createdate=Wed Dec 01 22:46:22 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=13, articleId=10004, email='hah@gmail.com', nickname='haha', parentCommentNickname='test', content='hahah', status='0'}}], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='test@gg.com', nickname='test', parentCommentNickname='jess', content='great!', status='0'}}], CommentVo=CommentVo{parentCommentId=11, articleId=10004, email='jess@gmail.com', nickname='jess', parentCommentNickname='ivan', content='I am doing well. You?', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='ivanliang0818@gmail.com', nickname='ivan', parentCommentNickname='null', content='How are you doing today?', status='0'}}], total=4}
2022-01-19 11:18:12:463 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 14ms
2022-01-19 11:18:12:463 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:18:12:463 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=18createdate=Sun Jan 09 10:06:04 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/81.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsdf@qq.com', nickname='sf', parentCommentNickname='null', content='sdfsf', status='0'}}, CommentListVo{commentId=17createdate=Sun Jan 09 10:05:33 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/57.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsd@Ck.com', nickname='sfsf', parentCommentNickname='null', content='hdsfsd', status='0'}}, CommentListVo{commentId=16createdate=Sun Jan 09 10:03:48 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/90.png, replyComments=[CommentListVo{commentId=19createdate=Mon Jan 10 09:47:47 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/73.png, replyComments=[], CommentVo=CommentVo{parentCommentId=16, articleId=10004, email='sdfsd@Ck.com', nickname='ivan', parentCommentNickname='sfs@ss.c', content='dfjgg', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='null', content='what?', status='0'}}, CommentListVo{commentId=11createdate=Wed Dec 01 22:44:50 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=12createdate=Wed Dec 01 22:45:18 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=15createdate=Wed Dec 01 23:42:17 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='555@test.com', nickname='555', parentCommentNickname='jess', content='555', status='0'}}, CommentListVo{commentId=13createdate=Wed Dec 01 22:45:56 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=14createdate=Wed Dec 01 22:46:22 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=13, articleId=10004, email='hah@gmail.com', nickname='haha', parentCommentNickname='test', content='hahah', status='0'}}], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='test@gg.com', nickname='test', parentCommentNickname='jess', content='great!', status='0'}}], CommentVo=CommentVo{parentCommentId=11, articleId=10004, email='jess@gmail.com', nickname='jess', parentCommentNickname='ivan', content='I am doing well. You?', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='ivanliang0818@gmail.com', nickname='ivan', parentCommentNickname='null', content='How are you doing today?', status='0'}}], total=4}
2022-01-19 11:18:12:463 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 14ms
2022-01-19 11:18:12:463 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:18:12:492 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:18:12:492 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:18:12:492 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:18:12:492 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10004
2022-01-19 11:18:12:492 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 11:18:12:492 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10004
2022-01-19 11:18:12:492 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=18createdate=Sun Jan 09 10:06:04 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/81.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsdf@qq.com', nickname='sf', parentCommentNickname='null', content='sdfsf', status='0'}}, CommentListVo{commentId=17createdate=Sun Jan 09 10:05:33 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/57.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsd@Ck.com', nickname='sfsf', parentCommentNickname='null', content='hdsfsd', status='0'}}, CommentListVo{commentId=16createdate=Sun Jan 09 10:03:48 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/90.png, replyComments=[CommentListVo{commentId=19createdate=Mon Jan 10 09:47:47 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/73.png, replyComments=[], CommentVo=CommentVo{parentCommentId=16, articleId=10004, email='sdfsd@Ck.com', nickname='ivan', parentCommentNickname='sfs@ss.c', content='dfjgg', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='null', content='what?', status='0'}}, CommentListVo{commentId=11createdate=Wed Dec 01 22:44:50 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=12createdate=Wed Dec 01 22:45:18 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=15createdate=Wed Dec 01 23:42:17 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='555@test.com', nickname='555', parentCommentNickname='jess', content='555', status='0'}}, CommentListVo{commentId=13createdate=Wed Dec 01 22:45:56 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=14createdate=Wed Dec 01 22:46:22 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=13, articleId=10004, email='hah@gmail.com', nickname='haha', parentCommentNickname='test', content='hahah', status='0'}}], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='test@gg.com', nickname='test', parentCommentNickname='jess', content='great!', status='0'}}], CommentVo=CommentVo{parentCommentId=11, articleId=10004, email='jess@gmail.com', nickname='jess', parentCommentNickname='ivan', content='I am doing well. You?', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='ivanliang0818@gmail.com', nickname='ivan', parentCommentNickname='null', content='How are you doing today?', status='0'}}], total=4}
2022-01-19 11:18:12:492 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 8ms
2022-01-19 11:18:12:492 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:39:48:367 [Thread-51] INFO  org.springframework.scheduling.concurrent.ThreadPoolTaskScheduler Shutting down ExecutorService 'taskScheduler'
2022-01-19 11:39:48:368 [Thread-51] INFO  org.springframework.scheduling.concurrent.ThreadPoolTaskExecutor Shutting down ExecutorService 'applicationTaskExecutor'
2022-01-19 11:39:48:369 [Thread-51] INFO  com.zaxxer.hikari.HikariDataSource HikariPool-1 - Shutdown initiated...
2022-01-19 11:39:48:371 [Thread-51] INFO  com.zaxxer.hikari.HikariDataSource HikariPool-1 - Shutdown completed.
2022-01-19 11:43:16:181 [restartedMain] INFO  com.ivan.sunnyblog.SunnyBlogApplication Starting SunnyBlogApplication on Jinghaos-MacBook-Air.local with PID 3216 (/Users/jinghaoliang/Documents/tech/Project/gitproject/blog/blog_backend/target/classes started by jinghaoliang in /Users/jinghaoliang/Documents/tech/Project/gitproject/blog/blog_backend)
2022-01-19 11:43:16:182 [restartedMain] INFO  com.ivan.sunnyblog.SunnyBlogApplication No active profile set, falling back to default profiles: default
2022-01-19 11:43:16:202 [restartedMain] INFO  org.springframework.boot.devtools.env.DevToolsPropertyDefaultsPostProcessor Devtools property defaults active! Set 'spring.devtools.add-properties' to 'false' to disable
2022-01-19 11:43:16:202 [restartedMain] INFO  org.springframework.boot.devtools.env.DevToolsPropertyDefaultsPostProcessor For additional web related logging consider setting the 'logging.level.web' property to 'DEBUG'
2022-01-19 11:43:16:562 [restartedMain] INFO  org.springframework.data.repository.config.RepositoryConfigurationDelegate Multiple Spring Data modules found, entering strict repository configuration mode!
2022-01-19 11:43:16:563 [restartedMain] INFO  org.springframework.data.repository.config.RepositoryConfigurationDelegate Bootstrapping Spring Data repositories in DEFAULT mode.
2022-01-19 11:43:16:587 [restartedMain] INFO  org.springframework.data.repository.config.RepositoryConfigurationDelegate Finished Spring Data repository scanning in 17ms. Found 0 repository interfaces.
2022-01-19 11:43:16:739 [restartedMain] INFO  o.s.context.support.PostProcessorRegistrationDelegate$BeanPostProcessorChecker Bean 'org.springframework.transaction.annotation.ProxyTransactionManagementConfiguration' of type [org.springframework.transaction.annotation.ProxyTransactionManagementConfiguration$$EnhancerBySpringCGLIB$$7740a7] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2022-01-19 11:43:16:921 [restartedMain] INFO  org.springframework.boot.web.embedded.tomcat.TomcatWebServer Tomcat initialized with port(s): 8081 (http)
2022-01-19 11:43:16:928 [restartedMain] INFO  org.apache.coyote.http11.Http11NioProtocol Initializing ProtocolHandler ["http-nio-8081"]
2022-01-19 11:43:16:934 [restartedMain] INFO  org.apache.catalina.core.StandardService Starting service [Tomcat]
2022-01-19 11:43:16:934 [restartedMain] INFO  org.apache.catalina.core.StandardEngine Starting Servlet engine: [Apache Tomcat/9.0.21]
2022-01-19 11:43:16:993 [restartedMain] INFO  org.apache.catalina.core.ContainerBase.[Tomcat].[localhost].[/] Initializing Spring embedded WebApplicationContext
2022-01-19 11:43:16:993 [restartedMain] INFO  org.springframework.web.context.ContextLoader Root WebApplicationContext: initialization completed in 791 ms
2022-01-19 11:43:17:136 [restartedMain] INFO  com.zaxxer.hikari.HikariDataSource HikariPool-1 - Starting...
2022-01-19 11:43:17:170 [restartedMain] INFO  com.zaxxer.hikari.HikariDataSource HikariPool-1 - Start completed.
2022-01-19 11:43:34:973 [restartedMain] INFO  org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor Autowired annotation is not supported on static fields: static com.amazonaws.services.s3.AmazonS3 com.ivan.sunnyblog.web.res.S3ResourceManager.s3Client
2022-01-19 11:43:35:279 [restartedMain] INFO  org.springframework.scheduling.concurrent.ThreadPoolTaskExecutor Initializing ExecutorService 'applicationTaskExecutor'
2022-01-19 11:43:35:444 [restartedMain] INFO  org.springframework.scheduling.concurrent.ThreadPoolTaskScheduler Initializing ExecutorService 'taskScheduler'
2022-01-19 11:43:35:463 [restartedMain] INFO  org.springframework.boot.devtools.autoconfigure.OptionalLiveReloadServer LiveReload server is running on port 35729
2022-01-19 11:43:35:502 [restartedMain] INFO  org.apache.coyote.http11.Http11NioProtocol Starting ProtocolHandler ["http-nio-8081"]
2022-01-19 11:43:35:516 [restartedMain] INFO  org.springframework.boot.web.embedded.tomcat.TomcatWebServer Tomcat started on port(s): 8081 (http) with context path ''
2022-01-19 11:43:35:517 [restartedMain] INFO  com.ivan.sunnyblog.SunnyBlogApplication Started SunnyBlogApplication in 19.5 seconds (JVM running for 20.009)
2022-01-19 11:44:33:669 [http-nio-8081-exec-2] INFO  org.apache.catalina.core.ContainerBase.[Tomcat].[localhost].[/] Initializing Spring DispatcherServlet 'dispatcherServlet'
2022-01-19 11:44:33:669 [http-nio-8081-exec-2] INFO  org.springframework.web.servlet.DispatcherServlet Initializing Servlet 'dispatcherServlet'
2022-01-19 11:44:33:675 [http-nio-8081-exec-2] INFO  org.springframework.web.servlet.DispatcherServlet Completed initialization in 6 ms
2022-01-19 11:44:33:927 [http-nio-8081-exec-1] INFO  org.jooq.Constants 
                                      
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@  @@        @@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@        @@@@@@@@@@
@@@@@@@@@@@@@@@@  @@  @@    @@@@@@@@@@
@@@@@@@@@@  @@@@  @@  @@    @@@@@@@@@@
@@@@@@@@@@        @@        @@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@        @@        @@@@@@@@@@
@@@@@@@@@@    @@  @@  @@@@  @@@@@@@@@@
@@@@@@@@@@    @@  @@  @@@@  @@@@@@@@@@
@@@@@@@@@@        @@  @  @  @@@@@@@@@@
@@@@@@@@@@        @@        @@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@  @@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@  Thank you for using jOOQ 3.11.11
                                      
2022-01-19 11:44:33:998 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:44:33:998 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:44:33:998 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:44:33:998 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:44:33:998 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:44:33:999 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:44:33:999 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10004
2022-01-19 11:44:33:999 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 11:44:33:999 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10004
2022-01-19 11:44:33:999 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10004
2022-01-19 11:44:33:999 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 11:44:33:999 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10004
2022-01-19 11:44:33:999 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=18createdate=Sun Jan 09 10:06:04 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/81.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsdf@qq.com', nickname='sf', parentCommentNickname='null', content='sdfsf', status='0'}}, CommentListVo{commentId=17createdate=Sun Jan 09 10:05:33 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/57.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsd@Ck.com', nickname='sfsf', parentCommentNickname='null', content='hdsfsd', status='0'}}, CommentListVo{commentId=16createdate=Sun Jan 09 10:03:48 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/90.png, replyComments=[CommentListVo{commentId=19createdate=Mon Jan 10 09:47:47 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/73.png, replyComments=[], CommentVo=CommentVo{parentCommentId=16, articleId=10004, email='sdfsd@Ck.com', nickname='ivan', parentCommentNickname='sfs@ss.c', content='dfjgg', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='null', content='what?', status='0'}}, CommentListVo{commentId=11createdate=Wed Dec 01 22:44:50 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=15createdate=Wed Dec 01 23:42:17 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='555@test.com', nickname='555', parentCommentNickname='jess', content='555', status='0'}}, CommentListVo{commentId=14createdate=Wed Dec 01 22:46:22 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=13, articleId=10004, email='hah@gmail.com', nickname='haha', parentCommentNickname='test', content='hahah', status='0'}}, CommentListVo{commentId=13createdate=Wed Dec 01 22:45:56 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=14createdate=Wed Dec 01 22:46:22 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=13, articleId=10004, email='hah@gmail.com', nickname='haha', parentCommentNickname='test', content='hahah', status='0'}}], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='test@gg.com', nickname='test', parentCommentNickname='jess', content='great!', status='0'}}, CommentListVo{commentId=12createdate=Wed Dec 01 22:45:18 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=15createdate=Wed Dec 01 23:42:17 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='555@test.com', nickname='555', parentCommentNickname='jess', content='555', status='0'}}, CommentListVo{commentId=13createdate=Wed Dec 01 22:45:56 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=14createdate=Wed Dec 01 22:46:22 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=13, articleId=10004, email='hah@gmail.com', nickname='haha', parentCommentNickname='test', content='hahah', status='0'}}], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='test@gg.com', nickname='test', parentCommentNickname='jess', content='great!', status='0'}}], CommentVo=CommentVo{parentCommentId=11, articleId=10004, email='jess@gmail.com', nickname='jess', parentCommentNickname='ivan', content='I am doing well. You?', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='ivanliang0818@gmail.com', nickname='ivan', parentCommentNickname='null', content='How are you doing today?', status='0'}}], total=4}
2022-01-19 11:44:33:999 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 284ms
2022-01-19 11:44:33:999 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:44:33:999 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=18createdate=Sun Jan 09 10:06:04 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/81.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsdf@qq.com', nickname='sf', parentCommentNickname='null', content='sdfsf', status='0'}}, CommentListVo{commentId=17createdate=Sun Jan 09 10:05:33 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/57.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsd@Ck.com', nickname='sfsf', parentCommentNickname='null', content='hdsfsd', status='0'}}, CommentListVo{commentId=16createdate=Sun Jan 09 10:03:48 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/90.png, replyComments=[CommentListVo{commentId=19createdate=Mon Jan 10 09:47:47 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/73.png, replyComments=[], CommentVo=CommentVo{parentCommentId=16, articleId=10004, email='sdfsd@Ck.com', nickname='ivan', parentCommentNickname='sfs@ss.c', content='dfjgg', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='null', content='what?', status='0'}}, CommentListVo{commentId=11createdate=Wed Dec 01 22:44:50 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=15createdate=Wed Dec 01 23:42:17 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='555@test.com', nickname='555', parentCommentNickname='jess', content='555', status='0'}}, CommentListVo{commentId=14createdate=Wed Dec 01 22:46:22 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=13, articleId=10004, email='hah@gmail.com', nickname='haha', parentCommentNickname='test', content='hahah', status='0'}}, CommentListVo{commentId=13createdate=Wed Dec 01 22:45:56 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=14createdate=Wed Dec 01 22:46:22 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=13, articleId=10004, email='hah@gmail.com', nickname='haha', parentCommentNickname='test', content='hahah', status='0'}}], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='test@gg.com', nickname='test', parentCommentNickname='jess', content='great!', status='0'}}, CommentListVo{commentId=12createdate=Wed Dec 01 22:45:18 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=15createdate=Wed Dec 01 23:42:17 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='555@test.com', nickname='555', parentCommentNickname='jess', content='555', status='0'}}, CommentListVo{commentId=13createdate=Wed Dec 01 22:45:56 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=14createdate=Wed Dec 01 22:46:22 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=13, articleId=10004, email='hah@gmail.com', nickname='haha', parentCommentNickname='test', content='hahah', status='0'}}], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='test@gg.com', nickname='test', parentCommentNickname='jess', content='great!', status='0'}}], CommentVo=CommentVo{parentCommentId=11, articleId=10004, email='jess@gmail.com', nickname='jess', parentCommentNickname='ivan', content='I am doing well. You?', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='ivanliang0818@gmail.com', nickname='ivan', parentCommentNickname='null', content='How are you doing today?', status='0'}}], total=4}
2022-01-19 11:44:33:999 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 284ms
2022-01-19 11:44:33:999 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:44:34:047 [http-nio-8081-exec-1] INFO  io.lettuce.core.EpollProvider Starting without optional epoll library
2022-01-19 11:44:34:048 [http-nio-8081-exec-1] INFO  io.lettuce.core.KqueueProvider Starting without optional kqueue library
2022-01-19 11:44:34:119 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:44:34:120 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:44:34:120 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:44:34:120 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/article/10004
2022-01-19 11:44:34:120 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.ArticleController.getPublicArticleDetail
2022-01-19 11:44:34:120 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10004
2022-01-19 11:44:34:120 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=ArticleVo{userInfo=UserInfoVo{userId=100001, nickName='ivan', userName='ivan', avatar='https://res-blog-public.s3.ca-central-1.amazonaws.com/default_avatar.jpg'}, category=CategoryVo{categoryId=2, name='liddffd', articleCount=null}, BaseArticleVo{articleId=10004, status=1, type=2, title='Spring boot', description='rerwerwer', content='rererer![test.png](https://s3.ca-central-1.amazonaws.com/res-blog-public/res-dev/blog_1636947281578_test.png)', firstPicture='', viewCount=174, createDate='Tue Oct 12 15:58:26 EDT 2021', updateDate='Tue Jan 18 22:56:37 EST 2022'}}, total=null}
2022-01-19 11:44:34:120 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 414ms
2022-01-19 11:44:34:120 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:44:34:187 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:44:34:187 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:44:34:187 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:44:34:187 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10004
2022-01-19 11:44:34:187 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 11:44:34:187 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10004
2022-01-19 11:44:34:187 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=18createdate=Sun Jan 09 10:06:04 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/81.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsdf@qq.com', nickname='sf', parentCommentNickname='null', content='sdfsf', status='0'}}, CommentListVo{commentId=17createdate=Sun Jan 09 10:05:33 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/57.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsd@Ck.com', nickname='sfsf', parentCommentNickname='null', content='hdsfsd', status='0'}}, CommentListVo{commentId=16createdate=Sun Jan 09 10:03:48 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/90.png, replyComments=[CommentListVo{commentId=19createdate=Mon Jan 10 09:47:47 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/73.png, replyComments=[], CommentVo=CommentVo{parentCommentId=16, articleId=10004, email='sdfsd@Ck.com', nickname='ivan', parentCommentNickname='sfs@ss.c', content='dfjgg', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='null', content='what?', status='0'}}, CommentListVo{commentId=11createdate=Wed Dec 01 22:44:50 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=15createdate=Wed Dec 01 23:42:17 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='555@test.com', nickname='555', parentCommentNickname='jess', content='555', status='0'}}, CommentListVo{commentId=14createdate=Wed Dec 01 22:46:22 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=13, articleId=10004, email='hah@gmail.com', nickname='haha', parentCommentNickname='test', content='hahah', status='0'}}, CommentListVo{commentId=13createdate=Wed Dec 01 22:45:56 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=14createdate=Wed Dec 01 22:46:22 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=13, articleId=10004, email='hah@gmail.com', nickname='haha', parentCommentNickname='test', content='hahah', status='0'}}], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='test@gg.com', nickname='test', parentCommentNickname='jess', content='great!', status='0'}}, CommentListVo{commentId=12createdate=Wed Dec 01 22:45:18 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=15createdate=Wed Dec 01 23:42:17 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='555@test.com', nickname='555', parentCommentNickname='jess', content='555', status='0'}}, CommentListVo{commentId=13createdate=Wed Dec 01 22:45:56 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=14createdate=Wed Dec 01 22:46:22 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=13, articleId=10004, email='hah@gmail.com', nickname='haha', parentCommentNickname='test', content='hahah', status='0'}}], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='test@gg.com', nickname='test', parentCommentNickname='jess', content='great!', status='0'}}], CommentVo=CommentVo{parentCommentId=11, articleId=10004, email='jess@gmail.com', nickname='jess', parentCommentNickname='ivan', content='I am doing well. You?', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='ivanliang0818@gmail.com', nickname='ivan', parentCommentNickname='null', content='How are you doing today?', status='0'}}], total=4}
2022-01-19 11:44:34:187 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 20ms
2022-01-19 11:44:34:187 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:46:58:957 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:46:58:957 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:46:58:957 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:46:58:957 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/articles/hot
2022-01-19 11:46:58:957 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.ArticleController.getHotArticles
2022-01-19 11:46:58:957 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: {}
2022-01-19 11:46:58:957 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[ArticleVo{userInfo=null, category=null, BaseArticleVo{articleId=10004, status=null, type=null, title='Spring boot', description='null', content='null', firstPicture='null', viewCount=174, createDate='Tue Oct 12 15:58:26 EDT 2021', updateDate='null'}}, ArticleVo{userInfo=null, category=null, BaseArticleVo{articleId=10005, status=null, type=null, title='dd', description='null', content='null', firstPicture='null', viewCount=83, createDate='Sun Nov 07 14:09:29 EST 2021', updateDate='null'}}, ArticleVo{userInfo=null, category=null, BaseArticleVo{articleId=10003, status=null, type=null, title='dd', description='null', content='null', firstPicture='null', viewCount=0, createDate='Tue Oct 12 15:57:33 EDT 2021', updateDate='null'}}], total=null}
2022-01-19 11:46:58:957 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 16ms
2022-01-19 11:46:58:957 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:46:58:960 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:46:58:960 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:46:58:960 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:46:58:960 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/categories
2022-01-19 11:46:58:960 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CategoryContoller.getCategories
2022-01-19 11:46:58:960 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: {}
2022-01-19 11:46:58:960 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CategoryVo{categoryId=2, name='liddffd', articleCount=1}, CategoryVo{categoryId=1, name='Life ', articleCount=2}], total=null}
2022-01-19 11:46:58:961 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 19ms
2022-01-19 11:46:58:961 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:46:58:965 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:46:58:965 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:46:58:966 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:46:58:966 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/articles
2022-01-19 11:46:58:966 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.ArticleController.getPublicArticles
2022-01-19 11:46:58:966 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: SearchVo{page=1, limit=10, categoryId=null, total=null}
2022-01-19 11:46:58:966 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[ArticleVo{userInfo=UserInfoVo{userId=100001, nickName='ivan', userName='ivan', avatar='https://res-blog-public.s3.ca-central-1.amazonaws.com/default_avatar.jpg'}, category=CategoryVo{categoryId=1, name='Life ', articleCount=null}, BaseArticleVo{articleId=10005, status=1, type=1, title='dd', description='This is the doc of React markdown editor lite.
Enjoy!!', content='null', firstPicture='', viewCount=83, createDate='Sun Nov 07 14:09:29 EST 2021', updateDate='Tue Jan 18 22:54:08 EST 2022'}}, ArticleVo{userInfo=UserInfoVo{userId=100001, nickName='ivan', userName='ivan', avatar='https://res-blog-public.s3.ca-central-1.amazonaws.com/default_avatar.jpg'}, category=CategoryVo{categoryId=2, name='liddffd', articleCount=null}, BaseArticleVo{articleId=10004, status=1, type=2, title='Spring boot', description='rerwerwer', content='null', firstPicture='', viewCount=174, createDate='Tue Oct 12 15:58:26 EDT 2021', updateDate='Tue Jan 18 22:56:37 EST 2022'}}, ArticleVo{userInfo=UserInfoVo{userId=100001, nickName='ivan', userName='ivan', avatar='https://res-blog-public.s3.ca-central-1.amazonaws.com/default_avatar.jpg'}, category=CategoryVo{categoryId=1, name='Life ', articleCount=null}, BaseArticleVo{articleId=10003, status=1, type=1, title='dd', description='test', content='null', firstPicture='', viewCount=0, createDate='Tue Oct 12 15:57:33 EDT 2021', updateDate='Tue Jan 18 22:53:20 EST 2022'}}], total=3}
2022-01-19 11:46:58:966 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 24ms
2022-01-19 11:46:58:966 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:47:00:077 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:47:00:077 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:47:00:077 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:47:00:077 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 11:47:00:077 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 11:47:00:077 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 11:47:00:077 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[], total=4}
2022-01-19 11:47:00:077 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 1ms
2022-01-19 11:47:00:077 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:47:00:083 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:47:00:083 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:47:00:083 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:47:00:083 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 11:47:00:083 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 11:47:00:083 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 11:47:00:083 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[], total=4}
2022-01-19 11:47:00:083 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 7ms
2022-01-19 11:47:00:083 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:47:00:089 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:47:00:089 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:47:00:089 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:47:00:089 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/article/10005
2022-01-19 11:47:00:089 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.ArticleController.getPublicArticleDetail
2022-01-19 11:47:00:089 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 11:47:00:089 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=ArticleVo{userInfo=UserInfoVo{userId=100001, nickName='ivan', userName='ivan', avatar='https://res-blog-public.s3.ca-central-1.amazonaws.com/default_avatar.jpg'}, category=CategoryVo{categoryId=1, name='Life ', articleCount=null}, BaseArticleVo{articleId=10005, status=1, type=1, title='dd', description='This is the doc of React markdown editor lite.
Enjoy!!', content='| Head | Head | Head | Head |
| --- | --- | --- | --- |
| Data | Data | Data | Data |
| Data | Data | Data | Data |

## 手把手教你写一个markdown编辑器

> 笔者在18年年末的时候接到一个开发任务——搭建一个AI项目的开放平台，其中的产品文档为转化为HTML格式的markdown文档。考虑到文档的即时更新，将文档信息做成了Ajax接口的形式。因此管理后台只需将textarea表单的内容通过markdown解析器进行HTML格式转化，然后将markdown内容和经转化的HTML文档都保存到数据库即可。
> 基本需求完成后，为了更好的用户体验，考虑将常用的编辑功能添加进来。改进版不仅支持了常用的文本编辑功能，还实现的UI界面的配置化，自定义语法解析器。本着造福伸手党的目的，以及积累些开源经验，笔者将该react 组件 [react-markdown-editor-lite](https://github.com/HarryChen0506/react-markdown-editor-lite) 进行了封装改造，并且发布到了开源社区。

### 预览
在线体验 [https://harrychen0506.github.io/react-markdown-editor-lite/](https://harrychen0506.github.io/react-markdown-editor-lite/)

![image](https://github.com//HarryChen0506/react-markdown-editor-lite/blob/master/image/react-markdown-editor-lite-v1.0.0.PNG?raw=true)

### 特点
* 轻量、基于React
* UI可配置, 如只显示编辑区或预览区
* 支持自定义markdown语法解析器,语法高亮等
* 支持常用的markdown编辑功能，如加粗，斜体等等...
* 支持功能按钮插拔化，用户可以自定义扩展组件
* 支持编辑区和预览区同步滚动

### 开发心得

- 文本编辑

  大多数常见的编辑器，包括富文本编辑器，利用了某些元素如div的contenteditable属性，配合selection、range、execCommand等API，实现了富文本编辑功能。这里面的实现比较复杂，所以有了"[为什么都说富文本编辑器是天坑？](https://www.zhihu.com/question/38699645)"这个说法。

  而markdown编辑器，核心的处理内容为简单语法的纯文本，复杂度相对来说比较低，并且input标签自带onSelect事件，可以很方便的获取选择信息（选择起始位置和选择文本值），因此要想实现编辑功能，只需将要改动的内容进行文本转换，然后进行重新拼接首尾，大功告成。
  
- markdown解析

  考察了几个社区流行的markdown解析器，比较流行的有[markdown](https://www.npmjs.com/package/markdown), [markdown-it](https://www.npmjs.com/package/markdown-it), [marked](https://www.npmjs.com/package/marked) 等等。综合考虑扩展性以及稳定性，笔者推荐使用markdown-it作为markdown的词法解析器，因为该解析器有比较多的插件，并且支持语法高亮。

- 同步滚动

  当选择分栏编辑的时候，滚动左侧的编辑区，右侧的预览区能自动滚动到对应的区域。方案参考了《[手把手教你用 100行代码实现基于 react的 markdown 输入 + 即时预览在线编辑器（一）](https://github.com/accforgit/blog-data/blob/master/%E5%9C%A8%E7%BA%BF%E7%BC%96%E8%BE%91%E5%99%A8/README/README1.md)》。只需先计算出输入框容器元素与预览框容器元素之间最大scroll范围的比例值，然后根据主动滚动元素自身的scrollTop做相应的比例换算，即可知道对方区域的scrollTop值。

- 关于UI
 
  - 项目的字体库选择了Font Awesome风格，并且只选取了项目所需要的一些图标。
  - 编辑器的整体css均可通过全局覆盖的形式进行自定义。目前暂时只支持灰色主题。
  - 编辑器的显示区域包括菜单栏，编辑器，预览区，工具栏，通过配置组件的config属性，可以选择默认的展示区域。
  
### Install

```js
npm install react-markdown-editor-lite --save
```

### Props

| Property | Description | Type | default | Remarks |
| --- | --- | --- | --- | --- |
| value | markdown content | String | '' | required |
| style | component container style | Object | {height: '100%'} | not required |
| config | component config | Object | {view: {...}, logger: {...}} | not required |
| onChange | emitting when editor has changed | Function | ({html, md}) => {} | not required |
| onImageUpload | when image uploaded, callback emitting will get image markdown text | (file: File, callback: (url: string) => void) => void; | ({file, callback}) => {} | not required |
| renderHTML | Render markdown text to HTML. You can return either string, function or Promise | (text: string) => string|function|Promise | none | **required** |

### Example

``` js
'use strict';
import React from 'react'
import ReactDOM from 'react-dom'
import MdEditor from 'react-markdown-editor-lite'
import MarkdownIt from 'markdown-it'
import emoji from 'markdown-it-emoji'
import subscript from 'markdown-it-sub'
import superscript from 'markdown-it-sup'
import footnote from 'markdown-it-footnote'
import deflist from 'markdown-it-deflist'
import abbreviation from 'markdown-it-abbr'
import insert from 'markdown-it-ins'
import mark from 'markdown-it-mark'
import tasklists from 'markdown-it-task-lists'
import hljs from 'highlight.js'
import 'highlight.js/styles/atom-one-light.css'
// import 'highlight.js/styles/github.css'
import './index.less';

const MOCK_DATA = "I Love React."
export default class Demo extends React.Component {
  mdEditor = null
  mdParser = null
  constructor(props) {
    super(props)
    // initial a parsera
    this.mdParser = new MarkdownIt({
      html: true,
      linkify: true,
      typographer: true,
      highlight: function (str, lang) {
        if (lang && hljs.getLanguage(lang)) {
          try {
            return hljs.highlight(lang, str).value
          } catch (__) {}
        }    
        return '' // use external default escaping
      }
    })
    .use(emoji)
    .use(subscript)
    .use(superscript)
    .use(footnote)
    .use(deflist)
    .use(abbreviation)
    .use(insert)
    .use(mark)
    .use(tasklists, { enabled: this.taskLists })
    this.renderHTML = this.renderHTML.bind(this)
  }
  handleEditorChange({html, md}) {
    console.log('handleEditorChange', html, md)
  }
  handleImageUpload(file, callback) {
    const reader = new FileReader()
    reader.onload = () => {      
      const convertBase64UrlToBlob = (urlData) => {  
        let arr = urlData.split(','), mime = arr[0].match(/:(.*?);/)[1]
        let bstr = atob(arr[1])
        let n = bstr.length
        let u8arr = new Uint8Array(n)
        while (n--) {
          u8arr[n] = bstr.charCodeAt(n)
        }
        return new Blob([u8arr], {type:mime})
      }
      const blob = convertBase64UrlToBlob(reader.result)
      setTimeout(() => {
        // setTimeout 模拟异步上传图片
        // 当异步上传获取图片地址后，执行calback回调（参数为imageUrl字符串），即可将图片地址写入markdown
        callback('https://avatars0.githubusercontent.com/u/21263805?s=40&v=4')
      }, 1000)
    }
    reader.readAsDataURL(file)
  }
  renderHTML(text) {
    // 模拟异步渲染Markdown
    return new Promise((resolve) => {
      setTimeout(() => {
        resolve(this.mdParser.render(text))
      }, 1000)
    })
  }
  handleGetMdValue = () => {   
    this.mdEditor && alert(this.mdEditor.getMdValue())      
  }
  handleGetHtmlValue = () => {    
    this.mdEditor && alert(this.mdEditor.getHtmlValue())
  }
  render() {
    return (      
      <div>
        <nav>
          <button onClick={this.handleGetMdValue} >getMdValue</button>  
          <button onClick={this.handleGetHtmlValue} >getHtmlValue</button>  
        </nav>
        <section style="height: 500px">
          <MdEditor 
            ref={node => this.mdEditor = node}
            value={MOCK_DATA}
            style={{height: '400px'}}
            renderHTML={this.renderHTML}
            config={{
              view: {
                menu: true,
                md: true,
                html: true
              },
              imageUrl: 'https://octodex.github.com/images/minion.png'
            }}
            onChange={this.handleEditorChange} 
            onImageUpload={this.handleImageUpload}
          />
        </section>                        
      </div>      
    )
  }
}
```

### 最后

   欢迎大家使用和反馈，[项目地址](https://github.com/HarryChen0506/react-markdown-editor-lite) (https://github.com/HarryChen0506/react-markdown-editor-lite)， 你的点赞将是我莫大的动力😊

![1.png](https://s3.ca-central-1.amazonaws.com/res-blog-public/res-dev/blog_1636946743939_1.png)', firstPicture='', viewCount=83, createDate='Sun Nov 07 14:09:29 EST 2021', updateDate='Tue Jan 18 22:54:08 EST 2022'}}, total=null}
2022-01-19 11:47:00:090 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 14ms
2022-01-19 11:47:00:090 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:47:00:136 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:47:00:136 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:47:00:136 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:47:00:136 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 11:47:00:136 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 11:47:00:136 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 11:47:00:136 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[], total=4}
2022-01-19 11:47:00:136 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 1ms
2022-01-19 11:47:00:136 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:47:08:764 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:47:08:764 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:47:08:764 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: POST
2022-01-19 11:47:08:764 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment
2022-01-19 11:47:08:764 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.postComment
2022-01-19 11:47:08:764 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: CommentVo{parentCommentId=null, articleId=10005, email='sfs@ss.c', nickname='tet', parentCommentNickname='null', content='etet', status='null'}
2022-01-19 11:47:08:764 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=null, total=null}
2022-01-19 11:47:08:764 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 30ms
2022-01-19 11:47:08:764 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:47:08:779 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:47:08:779 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:47:08:779 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:47:08:779 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 11:47:08:779 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 11:47:08:779 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 11:47:08:779 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=20createdate=Wed Jan 19 11:47:08 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/26.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='tet', parentCommentNickname='null', content='etet', status='0'}}], total=4}
2022-01-19 11:47:08:779 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 1ms
2022-01-19 11:47:08:779 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:47:21:338 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:47:21:339 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:47:21:339 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: POST
2022-01-19 11:47:21:339 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment
2022-01-19 11:47:21:339 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.postComment
2022-01-19 11:47:21:339 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: CommentVo{parentCommentId=20, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='tet', content='ree', status='null'}
2022-01-19 11:47:21:339 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=null, total=null}
2022-01-19 11:47:21:339 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 2ms
2022-01-19 11:47:21:339 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:47:21:361 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:47:21:361 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:47:21:361 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:47:21:361 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 11:47:21:361 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 11:47:21:361 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 11:47:21:361 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=20createdate=Wed Jan 19 11:47:08 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/26.png, replyComments=[CommentListVo{commentId=21createdate=Wed Jan 19 11:47:21 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/89.png, replyComments=[], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='tet', content='ree', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='tet', parentCommentNickname='null', content='etet', status='0'}}], total=4}
2022-01-19 11:47:21:361 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 4ms
2022-01-19 11:47:21:361 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:47:39:337 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:47:39:337 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:47:39:338 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: POST
2022-01-19 11:47:39:338 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment
2022-01-19 11:47:39:338 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.postComment
2022-01-19 11:47:39:338 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: CommentVo{parentCommentId=21, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='sfs@ss.c', content='eeeeee', status='null'}
2022-01-19 11:47:39:338 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=null, total=null}
2022-01-19 11:47:39:338 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 4ms
2022-01-19 11:47:39:338 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:47:39:359 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:47:39:359 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:47:39:359 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:47:39:359 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 11:47:39:359 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 11:47:39:359 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 11:47:39:359 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=20createdate=Wed Jan 19 11:47:08 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/26.png, replyComments=[CommentListVo{commentId=22createdate=Wed Jan 19 11:47:39 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/75.png, replyComments=[], CommentVo=CommentVo{parentCommentId=21, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='sfs@ss.c', content='eeeeee', status='0'}}, CommentListVo{commentId=21createdate=Wed Jan 19 11:47:21 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/89.png, replyComments=[CommentListVo{commentId=22createdate=Wed Jan 19 11:47:39 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/75.png, replyComments=[], CommentVo=CommentVo{parentCommentId=21, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='sfs@ss.c', content='eeeeee', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='tet', content='ree', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='tet', parentCommentNickname='null', content='etet', status='0'}}], total=4}
2022-01-19 11:47:39:359 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 3ms
2022-01-19 11:47:39:359 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:47:50:420 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:47:50:420 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:47:50:420 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:47:50:420 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 11:47:50:420 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 11:47:50:420 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 11:47:50:420 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=20createdate=Wed Jan 19 11:47:08 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/26.png, replyComments=[CommentListVo{commentId=22createdate=Wed Jan 19 11:47:39 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/75.png, replyComments=[], CommentVo=CommentVo{parentCommentId=21, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='sfs@ss.c', content='eeeeee', status='0'}}, CommentListVo{commentId=21createdate=Wed Jan 19 11:47:21 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/89.png, replyComments=[CommentListVo{commentId=22createdate=Wed Jan 19 11:47:39 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/75.png, replyComments=[], CommentVo=CommentVo{parentCommentId=21, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='sfs@ss.c', content='eeeeee', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='tet', content='ree', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='tet', parentCommentNickname='null', content='etet', status='0'}}], total=1}
2022-01-19 11:47:50:420 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 12ms
2022-01-19 11:47:50:420 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:47:50:422 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:47:50:422 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:47:50:422 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:47:50:422 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/article/10005
2022-01-19 11:47:50:422 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.ArticleController.getPublicArticleDetail
2022-01-19 11:47:50:422 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 11:47:50:422 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=ArticleVo{userInfo=UserInfoVo{userId=100001, nickName='ivan', userName='ivan', avatar='https://res-blog-public.s3.ca-central-1.amazonaws.com/default_avatar.jpg'}, category=CategoryVo{categoryId=1, name='Life ', articleCount=null}, BaseArticleVo{articleId=10005, status=1, type=1, title='dd', description='This is the doc of React markdown editor lite.
Enjoy!!', content='| Head | Head | Head | Head |
| --- | --- | --- | --- |
| Data | Data | Data | Data |
| Data | Data | Data | Data |

## 手把手教你写一个markdown编辑器

> 笔者在18年年末的时候接到一个开发任务——搭建一个AI项目的开放平台，其中的产品文档为转化为HTML格式的markdown文档。考虑到文档的即时更新，将文档信息做成了Ajax接口的形式。因此管理后台只需将textarea表单的内容通过markdown解析器进行HTML格式转化，然后将markdown内容和经转化的HTML文档都保存到数据库即可。
> 基本需求完成后，为了更好的用户体验，考虑将常用的编辑功能添加进来。改进版不仅支持了常用的文本编辑功能，还实现的UI界面的配置化，自定义语法解析器。本着造福伸手党的目的，以及积累些开源经验，笔者将该react 组件 [react-markdown-editor-lite](https://github.com/HarryChen0506/react-markdown-editor-lite) 进行了封装改造，并且发布到了开源社区。

### 预览
在线体验 [https://harrychen0506.github.io/react-markdown-editor-lite/](https://harrychen0506.github.io/react-markdown-editor-lite/)

![image](https://github.com//HarryChen0506/react-markdown-editor-lite/blob/master/image/react-markdown-editor-lite-v1.0.0.PNG?raw=true)

### 特点
* 轻量、基于React
* UI可配置, 如只显示编辑区或预览区
* 支持自定义markdown语法解析器,语法高亮等
* 支持常用的markdown编辑功能，如加粗，斜体等等...
* 支持功能按钮插拔化，用户可以自定义扩展组件
* 支持编辑区和预览区同步滚动

### 开发心得

- 文本编辑

  大多数常见的编辑器，包括富文本编辑器，利用了某些元素如div的contenteditable属性，配合selection、range、execCommand等API，实现了富文本编辑功能。这里面的实现比较复杂，所以有了"[为什么都说富文本编辑器是天坑？](https://www.zhihu.com/question/38699645)"这个说法。

  而markdown编辑器，核心的处理内容为简单语法的纯文本，复杂度相对来说比较低，并且input标签自带onSelect事件，可以很方便的获取选择信息（选择起始位置和选择文本值），因此要想实现编辑功能，只需将要改动的内容进行文本转换，然后进行重新拼接首尾，大功告成。
  
- markdown解析

  考察了几个社区流行的markdown解析器，比较流行的有[markdown](https://www.npmjs.com/package/markdown), [markdown-it](https://www.npmjs.com/package/markdown-it), [marked](https://www.npmjs.com/package/marked) 等等。综合考虑扩展性以及稳定性，笔者推荐使用markdown-it作为markdown的词法解析器，因为该解析器有比较多的插件，并且支持语法高亮。

- 同步滚动

  当选择分栏编辑的时候，滚动左侧的编辑区，右侧的预览区能自动滚动到对应的区域。方案参考了《[手把手教你用 100行代码实现基于 react的 markdown 输入 + 即时预览在线编辑器（一）](https://github.com/accforgit/blog-data/blob/master/%E5%9C%A8%E7%BA%BF%E7%BC%96%E8%BE%91%E5%99%A8/README/README1.md)》。只需先计算出输入框容器元素与预览框容器元素之间最大scroll范围的比例值，然后根据主动滚动元素自身的scrollTop做相应的比例换算，即可知道对方区域的scrollTop值。

- 关于UI
 
  - 项目的字体库选择了Font Awesome风格，并且只选取了项目所需要的一些图标。
  - 编辑器的整体css均可通过全局覆盖的形式进行自定义。目前暂时只支持灰色主题。
  - 编辑器的显示区域包括菜单栏，编辑器，预览区，工具栏，通过配置组件的config属性，可以选择默认的展示区域。
  
### Install

```js
npm install react-markdown-editor-lite --save
```

### Props

| Property | Description | Type | default | Remarks |
| --- | --- | --- | --- | --- |
| value | markdown content | String | '' | required |
| style | component container style | Object | {height: '100%'} | not required |
| config | component config | Object | {view: {...}, logger: {...}} | not required |
| onChange | emitting when editor has changed | Function | ({html, md}) => {} | not required |
| onImageUpload | when image uploaded, callback emitting will get image markdown text | (file: File, callback: (url: string) => void) => void; | ({file, callback}) => {} | not required |
| renderHTML | Render markdown text to HTML. You can return either string, function or Promise | (text: string) => string|function|Promise | none | **required** |

### Example

``` js
'use strict';
import React from 'react'
import ReactDOM from 'react-dom'
import MdEditor from 'react-markdown-editor-lite'
import MarkdownIt from 'markdown-it'
import emoji from 'markdown-it-emoji'
import subscript from 'markdown-it-sub'
import superscript from 'markdown-it-sup'
import footnote from 'markdown-it-footnote'
import deflist from 'markdown-it-deflist'
import abbreviation from 'markdown-it-abbr'
import insert from 'markdown-it-ins'
import mark from 'markdown-it-mark'
import tasklists from 'markdown-it-task-lists'
import hljs from 'highlight.js'
import 'highlight.js/styles/atom-one-light.css'
// import 'highlight.js/styles/github.css'
import './index.less';

const MOCK_DATA = "I Love React."
export default class Demo extends React.Component {
  mdEditor = null
  mdParser = null
  constructor(props) {
    super(props)
    // initial a parsera
    this.mdParser = new MarkdownIt({
      html: true,
      linkify: true,
      typographer: true,
      highlight: function (str, lang) {
        if (lang && hljs.getLanguage(lang)) {
          try {
            return hljs.highlight(lang, str).value
          } catch (__) {}
        }    
        return '' // use external default escaping
      }
    })
    .use(emoji)
    .use(subscript)
    .use(superscript)
    .use(footnote)
    .use(deflist)
    .use(abbreviation)
    .use(insert)
    .use(mark)
    .use(tasklists, { enabled: this.taskLists })
    this.renderHTML = this.renderHTML.bind(this)
  }
  handleEditorChange({html, md}) {
    console.log('handleEditorChange', html, md)
  }
  handleImageUpload(file, callback) {
    const reader = new FileReader()
    reader.onload = () => {      
      const convertBase64UrlToBlob = (urlData) => {  
        let arr = urlData.split(','), mime = arr[0].match(/:(.*?);/)[1]
        let bstr = atob(arr[1])
        let n = bstr.length
        let u8arr = new Uint8Array(n)
        while (n--) {
          u8arr[n] = bstr.charCodeAt(n)
        }
        return new Blob([u8arr], {type:mime})
      }
      const blob = convertBase64UrlToBlob(reader.result)
      setTimeout(() => {
        // setTimeout 模拟异步上传图片
        // 当异步上传获取图片地址后，执行calback回调（参数为imageUrl字符串），即可将图片地址写入markdown
        callback('https://avatars0.githubusercontent.com/u/21263805?s=40&v=4')
      }, 1000)
    }
    reader.readAsDataURL(file)
  }
  renderHTML(text) {
    // 模拟异步渲染Markdown
    return new Promise((resolve) => {
      setTimeout(() => {
        resolve(this.mdParser.render(text))
      }, 1000)
    })
  }
  handleGetMdValue = () => {   
    this.mdEditor && alert(this.mdEditor.getMdValue())      
  }
  handleGetHtmlValue = () => {    
    this.mdEditor && alert(this.mdEditor.getHtmlValue())
  }
  render() {
    return (      
      <div>
        <nav>
          <button onClick={this.handleGetMdValue} >getMdValue</button>  
          <button onClick={this.handleGetHtmlValue} >getHtmlValue</button>  
        </nav>
        <section style="height: 500px">
          <MdEditor 
            ref={node => this.mdEditor = node}
            value={MOCK_DATA}
            style={{height: '400px'}}
            renderHTML={this.renderHTML}
            config={{
              view: {
                menu: true,
                md: true,
                html: true
              },
              imageUrl: 'https://octodex.github.com/images/minion.png'
            }}
            onChange={this.handleEditorChange} 
            onImageUpload={this.handleImageUpload}
          />
        </section>                        
      </div>      
    )
  }
}
```

### 最后

   欢迎大家使用和反馈，[项目地址](https://github.com/HarryChen0506/react-markdown-editor-lite) (https://github.com/HarryChen0506/react-markdown-editor-lite)， 你的点赞将是我莫大的动力😊

![1.png](https://s3.ca-central-1.amazonaws.com/res-blog-public/res-dev/blog_1636946743939_1.png)', firstPicture='', viewCount=83, createDate='Sun Nov 07 14:09:29 EST 2021', updateDate='Tue Jan 18 22:54:08 EST 2022'}}, total=null}
2022-01-19 11:47:50:423 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 14ms
2022-01-19 11:47:50:423 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:47:50:424 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:47:50:425 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:47:50:425 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:47:50:425 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 11:47:50:425 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 11:47:50:425 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 11:47:50:425 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=20createdate=Wed Jan 19 11:47:08 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/26.png, replyComments=[CommentListVo{commentId=22createdate=Wed Jan 19 11:47:39 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/75.png, replyComments=[], CommentVo=CommentVo{parentCommentId=21, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='sfs@ss.c', content='eeeeee', status='0'}}, CommentListVo{commentId=21createdate=Wed Jan 19 11:47:21 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/89.png, replyComments=[CommentListVo{commentId=22createdate=Wed Jan 19 11:47:39 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/75.png, replyComments=[], CommentVo=CommentVo{parentCommentId=21, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='sfs@ss.c', content='eeeeee', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='tet', content='ree', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='tet', parentCommentNickname='null', content='etet', status='0'}}], total=1}
2022-01-19 11:47:50:425 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 16ms
2022-01-19 11:47:50:425 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:47:50:942 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:47:50:943 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:47:50:943 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:47:50:943 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 11:47:50:943 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 11:47:50:943 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 11:47:50:943 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=20createdate=Wed Jan 19 11:47:08 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/26.png, replyComments=[CommentListVo{commentId=22createdate=Wed Jan 19 11:47:39 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/75.png, replyComments=[], CommentVo=CommentVo{parentCommentId=21, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='sfs@ss.c', content='eeeeee', status='0'}}, CommentListVo{commentId=21createdate=Wed Jan 19 11:47:21 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/89.png, replyComments=[CommentListVo{commentId=22createdate=Wed Jan 19 11:47:39 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/75.png, replyComments=[], CommentVo=CommentVo{parentCommentId=21, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='sfs@ss.c', content='eeeeee', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='tet', content='ree', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='tet', parentCommentNickname='null', content='etet', status='0'}}], total=1}
2022-01-19 11:47:50:943 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 5ms
2022-01-19 11:47:50:943 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:50:20:563 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:50:20:563 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:50:20:563 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:50:20:563 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/articles/hot
2022-01-19 11:50:20:563 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.ArticleController.getHotArticles
2022-01-19 11:50:20:563 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: {}
2022-01-19 11:50:20:563 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[ArticleVo{userInfo=null, category=null, BaseArticleVo{articleId=10004, status=null, type=null, title='Spring boot', description='null', content='null', firstPicture='null', viewCount=174, createDate='Tue Oct 12 15:58:26 EDT 2021', updateDate='null'}}, ArticleVo{userInfo=null, category=null, BaseArticleVo{articleId=10005, status=null, type=null, title='dd', description='null', content='null', firstPicture='null', viewCount=83, createDate='Sun Nov 07 14:09:29 EST 2021', updateDate='null'}}, ArticleVo{userInfo=null, category=null, BaseArticleVo{articleId=10003, status=null, type=null, title='dd', description='null', content='null', firstPicture='null', viewCount=0, createDate='Tue Oct 12 15:57:33 EDT 2021', updateDate='null'}}], total=null}
2022-01-19 11:50:20:563 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 3ms
2022-01-19 11:50:20:563 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:50:20:563 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:50:20:564 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:50:20:564 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:50:20:564 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/categories
2022-01-19 11:50:20:564 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CategoryContoller.getCategories
2022-01-19 11:50:20:564 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: {}
2022-01-19 11:50:20:564 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CategoryVo{categoryId=2, name='liddffd', articleCount=1}, CategoryVo{categoryId=1, name='Life ', articleCount=2}], total=null}
2022-01-19 11:50:20:564 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 3ms
2022-01-19 11:50:20:564 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:50:20:571 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:50:20:571 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:50:20:571 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:50:20:571 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/articles
2022-01-19 11:50:20:571 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.ArticleController.getPublicArticles
2022-01-19 11:50:20:571 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: SearchVo{page=1, limit=10, categoryId=null, total=null}
2022-01-19 11:50:20:571 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[ArticleVo{userInfo=UserInfoVo{userId=100001, nickName='ivan', userName='ivan', avatar='https://res-blog-public.s3.ca-central-1.amazonaws.com/default_avatar.jpg'}, category=CategoryVo{categoryId=1, name='Life ', articleCount=null}, BaseArticleVo{articleId=10005, status=1, type=1, title='dd', description='This is the doc of React markdown editor lite.
Enjoy!!', content='null', firstPicture='', viewCount=83, createDate='Sun Nov 07 14:09:29 EST 2021', updateDate='Tue Jan 18 22:54:08 EST 2022'}}, ArticleVo{userInfo=UserInfoVo{userId=100001, nickName='ivan', userName='ivan', avatar='https://res-blog-public.s3.ca-central-1.amazonaws.com/default_avatar.jpg'}, category=CategoryVo{categoryId=2, name='liddffd', articleCount=null}, BaseArticleVo{articleId=10004, status=1, type=2, title='Spring boot', description='rerwerwer', content='null', firstPicture='', viewCount=174, createDate='Tue Oct 12 15:58:26 EDT 2021', updateDate='Tue Jan 18 22:56:37 EST 2022'}}, ArticleVo{userInfo=UserInfoVo{userId=100001, nickName='ivan', userName='ivan', avatar='https://res-blog-public.s3.ca-central-1.amazonaws.com/default_avatar.jpg'}, category=CategoryVo{categoryId=1, name='Life ', articleCount=null}, BaseArticleVo{articleId=10003, status=1, type=1, title='dd', description='test', content='null', firstPicture='', viewCount=0, createDate='Tue Oct 12 15:57:33 EDT 2021', updateDate='Tue Jan 18 22:53:20 EST 2022'}}], total=3}
2022-01-19 11:50:20:572 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 11ms
2022-01-19 11:50:20:572 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:50:21:698 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:50:21:699 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:50:21:699 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:50:21:699 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10003
2022-01-19 11:50:21:699 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 11:50:21:699 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10003
2022-01-19 11:50:21:699 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[], total=1}
2022-01-19 11:50:21:699 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 5ms
2022-01-19 11:50:21:699 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:50:21:698 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:50:21:707 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:50:21:717 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:50:21:723 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:50:21:723 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:50:21:741 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:50:21:742 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/article/10003
2022-01-19 11:50:21:743 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.ArticleController.getPublicArticleDetail
2022-01-19 11:50:21:742 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10003
2022-01-19 11:50:21:743 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10003
2022-01-19 11:50:21:743 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 11:50:21:743 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10003
2022-01-19 11:50:21:743 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=ArticleVo{userInfo=UserInfoVo{userId=100001, nickName='ivan', userName='ivan', avatar='https://res-blog-public.s3.ca-central-1.amazonaws.com/default_avatar.jpg'}, category=CategoryVo{categoryId=1, name='Life ', articleCount=null}, BaseArticleVo{articleId=10003, status=1, type=1, title='dd', description='test', content='### test', firstPicture='', viewCount=0, createDate='Tue Oct 12 15:57:33 EDT 2021', updateDate='Tue Jan 18 22:53:20 EST 2022'}}, total=null}
2022-01-19 11:50:21:743 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 16ms
2022-01-19 11:50:21:743 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:50:21:743 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[], total=1}
2022-01-19 11:50:21:743 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 12ms
2022-01-19 11:50:21:743 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:50:21:777 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:50:21:777 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:50:21:777 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:50:21:777 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10003
2022-01-19 11:50:21:777 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 11:50:21:777 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10003
2022-01-19 11:50:21:777 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[], total=1}
2022-01-19 11:50:21:777 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 3ms
2022-01-19 11:50:21:777 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:50:32:789 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:50:32:790 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:50:32:790 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: POST
2022-01-19 11:50:32:790 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment
2022-01-19 11:50:32:790 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.postComment
2022-01-19 11:50:32:790 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: CommentVo{parentCommentId=null, articleId=10003, email='sfs@ss.c', nickname='test', parentCommentNickname='null', content='1', status='null'}
2022-01-19 11:50:32:790 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=null, total=null}
2022-01-19 11:50:32:790 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 3ms
2022-01-19 11:50:32:790 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:50:32:818 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:50:32:818 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:50:32:819 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:50:32:819 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10003
2022-01-19 11:50:32:819 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 11:50:32:819 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10003
2022-01-19 11:50:32:819 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=23createdate=Wed Jan 19 11:50:32 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/28.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10003, email='sfs@ss.c', nickname='test', parentCommentNickname='null', content='1', status='0'}}], total=1}
2022-01-19 11:50:32:819 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 10ms
2022-01-19 11:50:32:819 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:50:45:414 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:50:45:414 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:50:45:415 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: POST
2022-01-19 11:50:45:415 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment
2022-01-19 11:50:45:415 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.postComment
2022-01-19 11:50:45:415 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: CommentVo{parentCommentId=23, articleId=10003, email='ivanliang25@gmail.com', nickname='ivan2', parentCommentNickname='test', content='2', status='null'}
2022-01-19 11:50:45:415 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=null, total=null}
2022-01-19 11:50:45:415 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 3ms
2022-01-19 11:50:45:415 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:50:45:436 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:50:45:436 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:50:45:436 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:50:45:436 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10003
2022-01-19 11:50:45:436 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 11:50:45:436 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10003
2022-01-19 11:50:45:436 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=23createdate=Wed Jan 19 11:50:32 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/28.png, replyComments=[CommentListVo{commentId=24createdate=Wed Jan 19 11:50:45 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/50.png, replyComments=[], CommentVo=CommentVo{parentCommentId=23, articleId=10003, email='ivanliang25@gmail.com', nickname='ivan2', parentCommentNickname='test', content='2', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10003, email='sfs@ss.c', nickname='test', parentCommentNickname='null', content='1', status='0'}}], total=1}
2022-01-19 11:50:45:436 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 2ms
2022-01-19 11:50:45:436 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:51:01:387 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:51:01:388 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:51:01:388 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: POST
2022-01-19 11:51:01:388 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment
2022-01-19 11:51:01:388 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.postComment
2022-01-19 11:51:01:388 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: CommentVo{parentCommentId=24, articleId=10003, email='ivanliang25@gmail.com', nickname='ivan3', parentCommentNickname='ivan2', content='3', status='null'}
2022-01-19 11:51:01:388 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=null, total=null}
2022-01-19 11:51:01:388 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 2ms
2022-01-19 11:51:01:388 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:51:01:411 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:51:01:411 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:51:01:411 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:51:01:411 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10003
2022-01-19 11:51:01:411 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 11:51:01:411 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10003
2022-01-19 11:51:01:411 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=23createdate=Wed Jan 19 11:50:32 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/28.png, replyComments=[CommentListVo{commentId=25createdate=Wed Jan 19 11:51:01 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/29.png, replyComments=[], CommentVo=CommentVo{parentCommentId=24, articleId=10003, email='ivanliang25@gmail.com', nickname='ivan3', parentCommentNickname='ivan2', content='3', status='0'}}, CommentListVo{commentId=24createdate=Wed Jan 19 11:50:45 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/50.png, replyComments=[CommentListVo{commentId=25createdate=Wed Jan 19 11:51:01 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/29.png, replyComments=[], CommentVo=CommentVo{parentCommentId=24, articleId=10003, email='ivanliang25@gmail.com', nickname='ivan3', parentCommentNickname='ivan2', content='3', status='0'}}], CommentVo=CommentVo{parentCommentId=23, articleId=10003, email='ivanliang25@gmail.com', nickname='ivan2', parentCommentNickname='test', content='2', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10003, email='sfs@ss.c', nickname='test', parentCommentNickname='null', content='1', status='0'}}], total=1}
2022-01-19 11:51:01:411 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 3ms
2022-01-19 11:51:01:411 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:54:33:812 [Thread-47] INFO  org.springframework.scheduling.concurrent.ThreadPoolTaskScheduler Shutting down ExecutorService 'taskScheduler'
2022-01-19 11:54:33:812 [Thread-47] INFO  org.springframework.scheduling.concurrent.ThreadPoolTaskExecutor Shutting down ExecutorService 'applicationTaskExecutor'
2022-01-19 11:54:33:813 [Thread-47] INFO  com.zaxxer.hikari.HikariDataSource HikariPool-1 - Shutdown initiated...
2022-01-19 11:54:33:814 [Thread-47] INFO  com.zaxxer.hikari.HikariDataSource HikariPool-1 - Shutdown completed.
2022-01-19 11:54:37:233 [restartedMain] INFO  com.ivan.sunnyblog.SunnyBlogApplication Starting SunnyBlogApplication on Jinghaos-MacBook-Air.local with PID 3313 (/Users/jinghaoliang/Documents/tech/Project/gitproject/blog/blog_backend/target/classes started by jinghaoliang in /Users/jinghaoliang/Documents/tech/Project/gitproject/blog/blog_backend)
2022-01-19 11:54:37:234 [restartedMain] INFO  com.ivan.sunnyblog.SunnyBlogApplication No active profile set, falling back to default profiles: default
2022-01-19 11:54:37:251 [restartedMain] INFO  org.springframework.boot.devtools.env.DevToolsPropertyDefaultsPostProcessor Devtools property defaults active! Set 'spring.devtools.add-properties' to 'false' to disable
2022-01-19 11:54:37:251 [restartedMain] INFO  org.springframework.boot.devtools.env.DevToolsPropertyDefaultsPostProcessor For additional web related logging consider setting the 'logging.level.web' property to 'DEBUG'
2022-01-19 11:54:37:551 [restartedMain] INFO  org.springframework.data.repository.config.RepositoryConfigurationDelegate Multiple Spring Data modules found, entering strict repository configuration mode!
2022-01-19 11:54:37:552 [restartedMain] INFO  org.springframework.data.repository.config.RepositoryConfigurationDelegate Bootstrapping Spring Data repositories in DEFAULT mode.
2022-01-19 11:54:37:574 [restartedMain] INFO  org.springframework.data.repository.config.RepositoryConfigurationDelegate Finished Spring Data repository scanning in 16ms. Found 0 repository interfaces.
2022-01-19 11:54:37:720 [restartedMain] INFO  o.s.context.support.PostProcessorRegistrationDelegate$BeanPostProcessorChecker Bean 'org.springframework.transaction.annotation.ProxyTransactionManagementConfiguration' of type [org.springframework.transaction.annotation.ProxyTransactionManagementConfiguration$$EnhancerBySpringCGLIB$$e5e39db4] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2022-01-19 11:54:37:883 [restartedMain] INFO  org.springframework.boot.web.embedded.tomcat.TomcatWebServer Tomcat initialized with port(s): 8081 (http)
2022-01-19 11:54:37:889 [restartedMain] INFO  org.apache.coyote.http11.Http11NioProtocol Initializing ProtocolHandler ["http-nio-8081"]
2022-01-19 11:54:37:894 [restartedMain] INFO  org.apache.catalina.core.StandardService Starting service [Tomcat]
2022-01-19 11:54:37:894 [restartedMain] INFO  org.apache.catalina.core.StandardEngine Starting Servlet engine: [Apache Tomcat/9.0.21]
2022-01-19 11:54:37:953 [restartedMain] INFO  org.apache.catalina.core.ContainerBase.[Tomcat].[localhost].[/] Initializing Spring embedded WebApplicationContext
2022-01-19 11:54:37:953 [restartedMain] INFO  org.springframework.web.context.ContextLoader Root WebApplicationContext: initialization completed in 702 ms
2022-01-19 11:54:38:095 [restartedMain] INFO  com.zaxxer.hikari.HikariDataSource HikariPool-1 - Starting...
2022-01-19 11:54:38:126 [restartedMain] INFO  com.zaxxer.hikari.HikariDataSource HikariPool-1 - Start completed.
2022-01-19 11:54:47:432 [restartedMain] INFO  org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor Autowired annotation is not supported on static fields: static com.amazonaws.services.s3.AmazonS3 com.ivan.sunnyblog.web.res.S3ResourceManager.s3Client
2022-01-19 11:54:47:751 [restartedMain] INFO  org.springframework.scheduling.concurrent.ThreadPoolTaskExecutor Initializing ExecutorService 'applicationTaskExecutor'
2022-01-19 11:54:47:909 [restartedMain] INFO  org.springframework.scheduling.concurrent.ThreadPoolTaskScheduler Initializing ExecutorService 'taskScheduler'
2022-01-19 11:54:47:927 [restartedMain] INFO  org.springframework.boot.devtools.autoconfigure.OptionalLiveReloadServer LiveReload server is running on port 35729
2022-01-19 11:54:47:968 [restartedMain] INFO  org.apache.coyote.http11.Http11NioProtocol Starting ProtocolHandler ["http-nio-8081"]
2022-01-19 11:54:47:981 [restartedMain] INFO  org.springframework.boot.web.embedded.tomcat.TomcatWebServer Tomcat started on port(s): 8081 (http) with context path ''
2022-01-19 11:54:47:983 [restartedMain] INFO  com.ivan.sunnyblog.SunnyBlogApplication Started SunnyBlogApplication in 10.91 seconds (JVM running for 11.412)
2022-01-19 11:54:50:992 [http-nio-8081-exec-2] INFO  org.apache.catalina.core.ContainerBase.[Tomcat].[localhost].[/] Initializing Spring DispatcherServlet 'dispatcherServlet'
2022-01-19 11:54:50:993 [http-nio-8081-exec-2] INFO  org.springframework.web.servlet.DispatcherServlet Initializing Servlet 'dispatcherServlet'
2022-01-19 11:54:51:000 [http-nio-8081-exec-2] INFO  org.springframework.web.servlet.DispatcherServlet Completed initialization in 7 ms
2022-01-19 11:54:51:254 [http-nio-8081-exec-1] INFO  org.jooq.Constants 
                                      
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@  @@        @@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@        @@@@@@@@@@
@@@@@@@@@@@@@@@@  @@  @@    @@@@@@@@@@
@@@@@@@@@@  @@@@  @@  @@    @@@@@@@@@@
@@@@@@@@@@        @@        @@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@        @@        @@@@@@@@@@
@@@@@@@@@@    @@  @@  @@@@  @@@@@@@@@@
@@@@@@@@@@    @@  @@  @@@@  @@@@@@@@@@
@@@@@@@@@@        @@  @  @  @@@@@@@@@@
@@@@@@@@@@        @@        @@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@  @@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@  Thank you for using jOOQ 3.11.11
                                      
2022-01-19 11:54:51:312 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:54:51:312 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:54:51:312 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:54:51:312 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:54:51:312 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:54:51:313 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10003
2022-01-19 11:54:51:313 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:54:51:313 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 11:54:51:313 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10003
2022-01-19 11:54:51:313 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10003
2022-01-19 11:54:51:313 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 11:54:51:313 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10003
2022-01-19 11:54:51:313 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=23createdate=Wed Jan 19 11:50:32 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/28.png, replyComments=[CommentListVo{commentId=25createdate=Wed Jan 19 11:51:01 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/29.png, replyComments=[], CommentVo=CommentVo{parentCommentId=24, articleId=10003, email='ivanliang25@gmail.com', nickname='ivan3', parentCommentNickname='ivan2', content='3', status='0'}}, CommentListVo{commentId=24createdate=Wed Jan 19 11:50:45 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/50.png, replyComments=[CommentListVo{commentId=25createdate=Wed Jan 19 11:51:01 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/29.png, replyComments=[], CommentVo=CommentVo{parentCommentId=24, articleId=10003, email='ivanliang25@gmail.com', nickname='ivan3', parentCommentNickname='ivan2', content='3', status='0'}}], CommentVo=CommentVo{parentCommentId=23, articleId=10003, email='ivanliang25@gmail.com', nickname='ivan2', parentCommentNickname='test', content='2', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10003, email='sfs@ss.c', nickname='test', parentCommentNickname='null', content='1', status='0'}}], total=1}
2022-01-19 11:54:51:313 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=23createdate=Wed Jan 19 11:50:32 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/28.png, replyComments=[CommentListVo{commentId=25createdate=Wed Jan 19 11:51:01 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/29.png, replyComments=[], CommentVo=CommentVo{parentCommentId=24, articleId=10003, email='ivanliang25@gmail.com', nickname='ivan3', parentCommentNickname='ivan2', content='3', status='0'}}, CommentListVo{commentId=24createdate=Wed Jan 19 11:50:45 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/50.png, replyComments=[CommentListVo{commentId=25createdate=Wed Jan 19 11:51:01 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/29.png, replyComments=[], CommentVo=CommentVo{parentCommentId=24, articleId=10003, email='ivanliang25@gmail.com', nickname='ivan3', parentCommentNickname='ivan2', content='3', status='0'}}], CommentVo=CommentVo{parentCommentId=23, articleId=10003, email='ivanliang25@gmail.com', nickname='ivan2', parentCommentNickname='test', content='2', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10003, email='sfs@ss.c', nickname='test', parentCommentNickname='null', content='1', status='0'}}], total=1}
2022-01-19 11:54:51:314 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 261ms
2022-01-19 11:54:51:314 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:54:51:313 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 261ms
2022-01-19 11:54:51:314 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:54:51:370 [http-nio-8081-exec-1] INFO  io.lettuce.core.EpollProvider Starting without optional epoll library
2022-01-19 11:54:51:371 [http-nio-8081-exec-1] INFO  io.lettuce.core.KqueueProvider Starting without optional kqueue library
2022-01-19 11:54:51:456 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:54:51:456 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:54:51:456 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:54:51:456 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/article/10003
2022-01-19 11:54:51:456 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.ArticleController.getPublicArticleDetail
2022-01-19 11:54:51:456 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10003
2022-01-19 11:54:51:456 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=ArticleVo{userInfo=UserInfoVo{userId=100001, nickName='ivan', userName='ivan', avatar='https://res-blog-public.s3.ca-central-1.amazonaws.com/default_avatar.jpg'}, category=CategoryVo{categoryId=1, name='Life ', articleCount=null}, BaseArticleVo{articleId=10003, status=1, type=1, title='dd', description='test', content='### test', firstPicture='', viewCount=0, createDate='Tue Oct 12 15:57:33 EDT 2021', updateDate='Tue Jan 18 22:53:20 EST 2022'}}, total=null}
2022-01-19 11:54:51:456 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 418ms
2022-01-19 11:54:51:456 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:54:51:521 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:54:51:521 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:54:51:521 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:54:51:521 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10003
2022-01-19 11:54:51:521 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 11:54:51:522 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10003
2022-01-19 11:54:51:522 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=23createdate=Wed Jan 19 11:50:32 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/28.png, replyComments=[CommentListVo{commentId=25createdate=Wed Jan 19 11:51:01 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/29.png, replyComments=[], CommentVo=CommentVo{parentCommentId=24, articleId=10003, email='ivanliang25@gmail.com', nickname='ivan3', parentCommentNickname='ivan2', content='3', status='0'}}, CommentListVo{commentId=24createdate=Wed Jan 19 11:50:45 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/50.png, replyComments=[CommentListVo{commentId=25createdate=Wed Jan 19 11:51:01 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/29.png, replyComments=[], CommentVo=CommentVo{parentCommentId=24, articleId=10003, email='ivanliang25@gmail.com', nickname='ivan3', parentCommentNickname='ivan2', content='3', status='0'}}], CommentVo=CommentVo{parentCommentId=23, articleId=10003, email='ivanliang25@gmail.com', nickname='ivan2', parentCommentNickname='test', content='2', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10003, email='sfs@ss.c', nickname='test', parentCommentNickname='null', content='1', status='0'}}], total=1}
2022-01-19 11:54:51:522 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 24ms
2022-01-19 11:54:51:522 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:54:58:640 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:54:58:640 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:54:58:640 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:54:58:640 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/articles/hot
2022-01-19 11:54:58:640 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.ArticleController.getHotArticles
2022-01-19 11:54:58:640 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: {}
2022-01-19 11:54:58:641 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[ArticleVo{userInfo=null, category=null, BaseArticleVo{articleId=10004, status=null, type=null, title='Spring boot', description='null', content='null', firstPicture='null', viewCount=174, createDate='Tue Oct 12 15:58:26 EDT 2021', updateDate='null'}}, ArticleVo{userInfo=null, category=null, BaseArticleVo{articleId=10005, status=null, type=null, title='dd', description='null', content='null', firstPicture='null', viewCount=83, createDate='Sun Nov 07 14:09:29 EST 2021', updateDate='null'}}, ArticleVo{userInfo=null, category=null, BaseArticleVo{articleId=10003, status=null, type=null, title='dd', description='null', content='null', firstPicture='null', viewCount=0, createDate='Tue Oct 12 15:57:33 EDT 2021', updateDate='null'}}], total=null}
2022-01-19 11:54:58:641 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 5ms
2022-01-19 11:54:58:641 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:54:58:655 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:54:58:655 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:54:58:655 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:54:58:655 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/categories
2022-01-19 11:54:58:655 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CategoryContoller.getCategories
2022-01-19 11:54:58:655 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: {}
2022-01-19 11:54:58:655 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CategoryVo{categoryId=2, name='liddffd', articleCount=1}, CategoryVo{categoryId=1, name='Life ', articleCount=2}], total=null}
2022-01-19 11:54:58:655 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 21ms
2022-01-19 11:54:58:655 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:54:58:661 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:54:58:661 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:54:58:661 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:54:58:661 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/articles
2022-01-19 11:54:58:661 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.ArticleController.getPublicArticles
2022-01-19 11:54:58:661 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: SearchVo{page=1, limit=10, categoryId=null, total=null}
2022-01-19 11:54:58:661 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[ArticleVo{userInfo=UserInfoVo{userId=100001, nickName='ivan', userName='ivan', avatar='https://res-blog-public.s3.ca-central-1.amazonaws.com/default_avatar.jpg'}, category=CategoryVo{categoryId=1, name='Life ', articleCount=null}, BaseArticleVo{articleId=10005, status=1, type=1, title='dd', description='This is the doc of React markdown editor lite.
Enjoy!!', content='null', firstPicture='', viewCount=83, createDate='Sun Nov 07 14:09:29 EST 2021', updateDate='Tue Jan 18 22:54:08 EST 2022'}}, ArticleVo{userInfo=UserInfoVo{userId=100001, nickName='ivan', userName='ivan', avatar='https://res-blog-public.s3.ca-central-1.amazonaws.com/default_avatar.jpg'}, category=CategoryVo{categoryId=2, name='liddffd', articleCount=null}, BaseArticleVo{articleId=10004, status=1, type=2, title='Spring boot', description='rerwerwer', content='null', firstPicture='', viewCount=174, createDate='Tue Oct 12 15:58:26 EDT 2021', updateDate='Tue Jan 18 22:56:37 EST 2022'}}, ArticleVo{userInfo=UserInfoVo{userId=100001, nickName='ivan', userName='ivan', avatar='https://res-blog-public.s3.ca-central-1.amazonaws.com/default_avatar.jpg'}, category=CategoryVo{categoryId=1, name='Life ', articleCount=null}, BaseArticleVo{articleId=10003, status=1, type=1, title='dd', description='test', content='null', firstPicture='', viewCount=0, createDate='Tue Oct 12 15:57:33 EDT 2021', updateDate='Tue Jan 18 22:53:20 EST 2022'}}], total=3}
2022-01-19 11:54:58:661 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 27ms
2022-01-19 11:54:58:661 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:54:59:683 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:54:59:683 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:54:59:683 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:54:59:683 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/article/10004
2022-01-19 11:54:59:683 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.ArticleController.getPublicArticleDetail
2022-01-19 11:54:59:683 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10004
2022-01-19 11:54:59:683 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=ArticleVo{userInfo=UserInfoVo{userId=100001, nickName='ivan', userName='ivan', avatar='https://res-blog-public.s3.ca-central-1.amazonaws.com/default_avatar.jpg'}, category=CategoryVo{categoryId=2, name='liddffd', articleCount=null}, BaseArticleVo{articleId=10004, status=1, type=2, title='Spring boot', description='rerwerwer', content='rererer![test.png](https://s3.ca-central-1.amazonaws.com/res-blog-public/res-dev/blog_1636947281578_test.png)', firstPicture='', viewCount=174, createDate='Tue Oct 12 15:58:26 EDT 2021', updateDate='Tue Jan 18 22:56:37 EST 2022'}}, total=null}
2022-01-19 11:54:59:683 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 13ms
2022-01-19 11:54:59:683 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:54:59:695 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:54:59:695 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:54:59:695 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:54:59:695 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10004
2022-01-19 11:54:59:695 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 11:54:59:695 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10004
2022-01-19 11:54:59:696 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:54:59:695 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=11createdate=Wed Dec 01 22:44:50 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=14createdate=Wed Dec 01 22:46:22 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=13, articleId=10004, email='hah@gmail.com', nickname='haha', parentCommentNickname='test', content='hahah', status='0'}}, CommentListVo{commentId=13createdate=Wed Dec 01 22:45:56 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=14createdate=Wed Dec 01 22:46:22 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=13, articleId=10004, email='hah@gmail.com', nickname='haha', parentCommentNickname='test', content='hahah', status='0'}}], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='test@gg.com', nickname='test', parentCommentNickname='jess', content='great!', status='0'}}, CommentListVo{commentId=15createdate=Wed Dec 01 23:42:17 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='555@test.com', nickname='555', parentCommentNickname='jess', content='555', status='0'}}, CommentListVo{commentId=12createdate=Wed Dec 01 22:45:18 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=13createdate=Wed Dec 01 22:45:56 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=14createdate=Wed Dec 01 22:46:22 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=13, articleId=10004, email='hah@gmail.com', nickname='haha', parentCommentNickname='test', content='hahah', status='0'}}], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='test@gg.com', nickname='test', parentCommentNickname='jess', content='great!', status='0'}}, CommentListVo{commentId=15createdate=Wed Dec 01 23:42:17 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='555@test.com', nickname='555', parentCommentNickname='jess', content='555', status='0'}}], CommentVo=CommentVo{parentCommentId=11, articleId=10004, email='jess@gmail.com', nickname='jess', parentCommentNickname='ivan', content='I am doing well. You?', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='ivanliang0818@gmail.com', nickname='ivan', parentCommentNickname='null', content='How are you doing today?', status='0'}}, CommentListVo{commentId=16createdate=Sun Jan 09 10:03:48 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/90.png, replyComments=[CommentListVo{commentId=19createdate=Mon Jan 10 09:47:47 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/73.png, replyComments=[], CommentVo=CommentVo{parentCommentId=16, articleId=10004, email='sdfsd@Ck.com', nickname='ivan', parentCommentNickname='sfs@ss.c', content='dfjgg', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='null', content='what?', status='0'}}, CommentListVo{commentId=17createdate=Sun Jan 09 10:05:33 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/57.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsd@Ck.com', nickname='sfsf', parentCommentNickname='null', content='hdsfsd', status='0'}}, CommentListVo{commentId=18createdate=Sun Jan 09 10:06:04 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/81.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsdf@qq.com', nickname='sf', parentCommentNickname='null', content='sdfsf', status='0'}}], total=1}
2022-01-19 11:54:59:696 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:54:59:696 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 20ms
2022-01-19 11:54:59:696 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:54:59:696 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:54:59:696 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10004
2022-01-19 11:54:59:696 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 11:54:59:696 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10004
2022-01-19 11:54:59:696 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=11createdate=Wed Dec 01 22:44:50 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=14createdate=Wed Dec 01 22:46:22 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=13, articleId=10004, email='hah@gmail.com', nickname='haha', parentCommentNickname='test', content='hahah', status='0'}}, CommentListVo{commentId=13createdate=Wed Dec 01 22:45:56 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=14createdate=Wed Dec 01 22:46:22 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=13, articleId=10004, email='hah@gmail.com', nickname='haha', parentCommentNickname='test', content='hahah', status='0'}}], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='test@gg.com', nickname='test', parentCommentNickname='jess', content='great!', status='0'}}, CommentListVo{commentId=15createdate=Wed Dec 01 23:42:17 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='555@test.com', nickname='555', parentCommentNickname='jess', content='555', status='0'}}, CommentListVo{commentId=12createdate=Wed Dec 01 22:45:18 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=13createdate=Wed Dec 01 22:45:56 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=14createdate=Wed Dec 01 22:46:22 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=13, articleId=10004, email='hah@gmail.com', nickname='haha', parentCommentNickname='test', content='hahah', status='0'}}], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='test@gg.com', nickname='test', parentCommentNickname='jess', content='great!', status='0'}}, CommentListVo{commentId=15createdate=Wed Dec 01 23:42:17 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='555@test.com', nickname='555', parentCommentNickname='jess', content='555', status='0'}}], CommentVo=CommentVo{parentCommentId=11, articleId=10004, email='jess@gmail.com', nickname='jess', parentCommentNickname='ivan', content='I am doing well. You?', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='ivanliang0818@gmail.com', nickname='ivan', parentCommentNickname='null', content='How are you doing today?', status='0'}}, CommentListVo{commentId=16createdate=Sun Jan 09 10:03:48 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/90.png, replyComments=[CommentListVo{commentId=19createdate=Mon Jan 10 09:47:47 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/73.png, replyComments=[], CommentVo=CommentVo{parentCommentId=16, articleId=10004, email='sdfsd@Ck.com', nickname='ivan', parentCommentNickname='sfs@ss.c', content='dfjgg', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='null', content='what?', status='0'}}, CommentListVo{commentId=17createdate=Sun Jan 09 10:05:33 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/57.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsd@Ck.com', nickname='sfsf', parentCommentNickname='null', content='hdsfsd', status='0'}}, CommentListVo{commentId=18createdate=Sun Jan 09 10:06:04 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/81.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsdf@qq.com', nickname='sf', parentCommentNickname='null', content='sdfsf', status='0'}}], total=1}
2022-01-19 11:54:59:696 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 21ms
2022-01-19 11:54:59:696 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:54:59:710 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:54:59:711 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:54:59:711 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:54:59:711 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10004
2022-01-19 11:54:59:711 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 11:54:59:711 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10004
2022-01-19 11:54:59:711 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=11createdate=Wed Dec 01 22:44:50 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=14createdate=Wed Dec 01 22:46:22 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=13, articleId=10004, email='hah@gmail.com', nickname='haha', parentCommentNickname='test', content='hahah', status='0'}}, CommentListVo{commentId=13createdate=Wed Dec 01 22:45:56 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=14createdate=Wed Dec 01 22:46:22 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=13, articleId=10004, email='hah@gmail.com', nickname='haha', parentCommentNickname='test', content='hahah', status='0'}}], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='test@gg.com', nickname='test', parentCommentNickname='jess', content='great!', status='0'}}, CommentListVo{commentId=15createdate=Wed Dec 01 23:42:17 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='555@test.com', nickname='555', parentCommentNickname='jess', content='555', status='0'}}, CommentListVo{commentId=12createdate=Wed Dec 01 22:45:18 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=13createdate=Wed Dec 01 22:45:56 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=14createdate=Wed Dec 01 22:46:22 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=13, articleId=10004, email='hah@gmail.com', nickname='haha', parentCommentNickname='test', content='hahah', status='0'}}], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='test@gg.com', nickname='test', parentCommentNickname='jess', content='great!', status='0'}}, CommentListVo{commentId=15createdate=Wed Dec 01 23:42:17 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='555@test.com', nickname='555', parentCommentNickname='jess', content='555', status='0'}}], CommentVo=CommentVo{parentCommentId=11, articleId=10004, email='jess@gmail.com', nickname='jess', parentCommentNickname='ivan', content='I am doing well. You?', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='ivanliang0818@gmail.com', nickname='ivan', parentCommentNickname='null', content='How are you doing today?', status='0'}}, CommentListVo{commentId=16createdate=Sun Jan 09 10:03:48 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/90.png, replyComments=[CommentListVo{commentId=19createdate=Mon Jan 10 09:47:47 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/73.png, replyComments=[], CommentVo=CommentVo{parentCommentId=16, articleId=10004, email='sdfsd@Ck.com', nickname='ivan', parentCommentNickname='sfs@ss.c', content='dfjgg', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='null', content='what?', status='0'}}, CommentListVo{commentId=17createdate=Sun Jan 09 10:05:33 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/57.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsd@Ck.com', nickname='sfsf', parentCommentNickname='null', content='hdsfsd', status='0'}}, CommentListVo{commentId=18createdate=Sun Jan 09 10:06:04 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/81.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsdf@qq.com', nickname='sf', parentCommentNickname='null', content='sdfsf', status='0'}}], total=1}
2022-01-19 11:54:59:711 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 5ms
2022-01-19 11:54:59:711 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:55:02:690 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:55:02:690 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:55:02:690 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:55:02:690 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/categories
2022-01-19 11:55:02:690 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CategoryContoller.getCategories
2022-01-19 11:55:02:690 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: {}
2022-01-19 11:55:02:690 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CategoryVo{categoryId=2, name='liddffd', articleCount=1}, CategoryVo{categoryId=1, name='Life ', articleCount=2}], total=null}
2022-01-19 11:55:02:690 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 4ms
2022-01-19 11:55:02:690 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:55:02:696 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:55:02:696 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:55:02:696 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:55:02:697 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/articles/hot
2022-01-19 11:55:02:697 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.ArticleController.getHotArticles
2022-01-19 11:55:02:697 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: {}
2022-01-19 11:55:02:697 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[ArticleVo{userInfo=null, category=null, BaseArticleVo{articleId=10004, status=null, type=null, title='Spring boot', description='null', content='null', firstPicture='null', viewCount=174, createDate='Tue Oct 12 15:58:26 EDT 2021', updateDate='null'}}, ArticleVo{userInfo=null, category=null, BaseArticleVo{articleId=10005, status=null, type=null, title='dd', description='null', content='null', firstPicture='null', viewCount=83, createDate='Sun Nov 07 14:09:29 EST 2021', updateDate='null'}}, ArticleVo{userInfo=null, category=null, BaseArticleVo{articleId=10003, status=null, type=null, title='dd', description='null', content='null', firstPicture='null', viewCount=0, createDate='Tue Oct 12 15:57:33 EDT 2021', updateDate='null'}}], total=null}
2022-01-19 11:55:02:697 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 10ms
2022-01-19 11:55:02:697 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:55:02:704 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:55:02:704 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:55:02:704 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:55:02:704 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/articles
2022-01-19 11:55:02:704 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.ArticleController.getPublicArticles
2022-01-19 11:55:02:704 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: SearchVo{page=1, limit=10, categoryId=null, total=null}
2022-01-19 11:55:02:704 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[ArticleVo{userInfo=UserInfoVo{userId=100001, nickName='ivan', userName='ivan', avatar='https://res-blog-public.s3.ca-central-1.amazonaws.com/default_avatar.jpg'}, category=CategoryVo{categoryId=1, name='Life ', articleCount=null}, BaseArticleVo{articleId=10005, status=1, type=1, title='dd', description='This is the doc of React markdown editor lite.
Enjoy!!', content='null', firstPicture='', viewCount=83, createDate='Sun Nov 07 14:09:29 EST 2021', updateDate='Tue Jan 18 22:54:08 EST 2022'}}, ArticleVo{userInfo=UserInfoVo{userId=100001, nickName='ivan', userName='ivan', avatar='https://res-blog-public.s3.ca-central-1.amazonaws.com/default_avatar.jpg'}, category=CategoryVo{categoryId=2, name='liddffd', articleCount=null}, BaseArticleVo{articleId=10004, status=1, type=2, title='Spring boot', description='rerwerwer', content='null', firstPicture='', viewCount=174, createDate='Tue Oct 12 15:58:26 EDT 2021', updateDate='Tue Jan 18 22:56:37 EST 2022'}}, ArticleVo{userInfo=UserInfoVo{userId=100001, nickName='ivan', userName='ivan', avatar='https://res-blog-public.s3.ca-central-1.amazonaws.com/default_avatar.jpg'}, category=CategoryVo{categoryId=1, name='Life ', articleCount=null}, BaseArticleVo{articleId=10003, status=1, type=1, title='dd', description='test', content='null', firstPicture='', viewCount=0, createDate='Tue Oct 12 15:57:33 EDT 2021', updateDate='Tue Jan 18 22:53:20 EST 2022'}}], total=3}
2022-01-19 11:55:02:705 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 18ms
2022-01-19 11:55:02:705 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:55:06:780 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:55:06:780 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:55:06:780 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:55:06:780 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/article/10004
2022-01-19 11:55:06:780 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.ArticleController.getPublicArticleDetail
2022-01-19 11:55:06:780 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10004
2022-01-19 11:55:06:780 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:55:06:780 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=ArticleVo{userInfo=UserInfoVo{userId=100001, nickName='ivan', userName='ivan', avatar='https://res-blog-public.s3.ca-central-1.amazonaws.com/default_avatar.jpg'}, category=CategoryVo{categoryId=2, name='liddffd', articleCount=null}, BaseArticleVo{articleId=10004, status=1, type=2, title='Spring boot', description='rerwerwer', content='rererer![test.png](https://s3.ca-central-1.amazonaws.com/res-blog-public/res-dev/blog_1636947281578_test.png)', firstPicture='', viewCount=174, createDate='Tue Oct 12 15:58:26 EDT 2021', updateDate='Tue Jan 18 22:56:37 EST 2022'}}, total=null}
2022-01-19 11:55:06:780 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:55:06:780 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 23ms
2022-01-19 11:55:06:780 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:55:06:780 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:55:06:780 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10004
2022-01-19 11:55:06:780 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 11:55:06:780 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10004
2022-01-19 11:55:06:780 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=11createdate=Wed Dec 01 22:44:50 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=14createdate=Wed Dec 01 22:46:22 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=13, articleId=10004, email='hah@gmail.com', nickname='haha', parentCommentNickname='test', content='hahah', status='0'}}, CommentListVo{commentId=13createdate=Wed Dec 01 22:45:56 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=14createdate=Wed Dec 01 22:46:22 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=13, articleId=10004, email='hah@gmail.com', nickname='haha', parentCommentNickname='test', content='hahah', status='0'}}], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='test@gg.com', nickname='test', parentCommentNickname='jess', content='great!', status='0'}}, CommentListVo{commentId=15createdate=Wed Dec 01 23:42:17 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='555@test.com', nickname='555', parentCommentNickname='jess', content='555', status='0'}}, CommentListVo{commentId=12createdate=Wed Dec 01 22:45:18 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=13createdate=Wed Dec 01 22:45:56 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=14createdate=Wed Dec 01 22:46:22 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=13, articleId=10004, email='hah@gmail.com', nickname='haha', parentCommentNickname='test', content='hahah', status='0'}}], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='test@gg.com', nickname='test', parentCommentNickname='jess', content='great!', status='0'}}, CommentListVo{commentId=15createdate=Wed Dec 01 23:42:17 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='555@test.com', nickname='555', parentCommentNickname='jess', content='555', status='0'}}], CommentVo=CommentVo{parentCommentId=11, articleId=10004, email='jess@gmail.com', nickname='jess', parentCommentNickname='ivan', content='I am doing well. You?', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='ivanliang0818@gmail.com', nickname='ivan', parentCommentNickname='null', content='How are you doing today?', status='0'}}, CommentListVo{commentId=16createdate=Sun Jan 09 10:03:48 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/90.png, replyComments=[CommentListVo{commentId=19createdate=Mon Jan 10 09:47:47 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/73.png, replyComments=[], CommentVo=CommentVo{parentCommentId=16, articleId=10004, email='sdfsd@Ck.com', nickname='ivan', parentCommentNickname='sfs@ss.c', content='dfjgg', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='null', content='what?', status='0'}}, CommentListVo{commentId=17createdate=Sun Jan 09 10:05:33 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/57.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsd@Ck.com', nickname='sfsf', parentCommentNickname='null', content='hdsfsd', status='0'}}, CommentListVo{commentId=18createdate=Sun Jan 09 10:06:04 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/81.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsdf@qq.com', nickname='sf', parentCommentNickname='null', content='sdfsf', status='0'}}], total=1}
2022-01-19 11:55:06:781 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 21ms
2022-01-19 11:55:06:781 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:55:06:782 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:55:06:782 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:55:06:782 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:55:06:782 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10004
2022-01-19 11:55:06:782 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 11:55:06:782 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10004
2022-01-19 11:55:06:782 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=11createdate=Wed Dec 01 22:44:50 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=14createdate=Wed Dec 01 22:46:22 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=13, articleId=10004, email='hah@gmail.com', nickname='haha', parentCommentNickname='test', content='hahah', status='0'}}, CommentListVo{commentId=13createdate=Wed Dec 01 22:45:56 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=14createdate=Wed Dec 01 22:46:22 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=13, articleId=10004, email='hah@gmail.com', nickname='haha', parentCommentNickname='test', content='hahah', status='0'}}], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='test@gg.com', nickname='test', parentCommentNickname='jess', content='great!', status='0'}}, CommentListVo{commentId=15createdate=Wed Dec 01 23:42:17 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='555@test.com', nickname='555', parentCommentNickname='jess', content='555', status='0'}}, CommentListVo{commentId=12createdate=Wed Dec 01 22:45:18 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=13createdate=Wed Dec 01 22:45:56 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=14createdate=Wed Dec 01 22:46:22 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=13, articleId=10004, email='hah@gmail.com', nickname='haha', parentCommentNickname='test', content='hahah', status='0'}}], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='test@gg.com', nickname='test', parentCommentNickname='jess', content='great!', status='0'}}, CommentListVo{commentId=15createdate=Wed Dec 01 23:42:17 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='555@test.com', nickname='555', parentCommentNickname='jess', content='555', status='0'}}], CommentVo=CommentVo{parentCommentId=11, articleId=10004, email='jess@gmail.com', nickname='jess', parentCommentNickname='ivan', content='I am doing well. You?', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='ivanliang0818@gmail.com', nickname='ivan', parentCommentNickname='null', content='How are you doing today?', status='0'}}, CommentListVo{commentId=16createdate=Sun Jan 09 10:03:48 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/90.png, replyComments=[CommentListVo{commentId=19createdate=Mon Jan 10 09:47:47 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/73.png, replyComments=[], CommentVo=CommentVo{parentCommentId=16, articleId=10004, email='sdfsd@Ck.com', nickname='ivan', parentCommentNickname='sfs@ss.c', content='dfjgg', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='null', content='what?', status='0'}}, CommentListVo{commentId=17createdate=Sun Jan 09 10:05:33 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/57.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsd@Ck.com', nickname='sfsf', parentCommentNickname='null', content='hdsfsd', status='0'}}, CommentListVo{commentId=18createdate=Sun Jan 09 10:06:04 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/81.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsdf@qq.com', nickname='sf', parentCommentNickname='null', content='sdfsf', status='0'}}], total=1}
2022-01-19 11:55:06:783 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 24ms
2022-01-19 11:55:06:783 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:55:06:809 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:55:06:809 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:55:06:809 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:55:06:809 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10004
2022-01-19 11:55:06:809 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 11:55:06:809 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10004
2022-01-19 11:55:06:809 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=11createdate=Wed Dec 01 22:44:50 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=14createdate=Wed Dec 01 22:46:22 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=13, articleId=10004, email='hah@gmail.com', nickname='haha', parentCommentNickname='test', content='hahah', status='0'}}, CommentListVo{commentId=13createdate=Wed Dec 01 22:45:56 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=14createdate=Wed Dec 01 22:46:22 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=13, articleId=10004, email='hah@gmail.com', nickname='haha', parentCommentNickname='test', content='hahah', status='0'}}], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='test@gg.com', nickname='test', parentCommentNickname='jess', content='great!', status='0'}}, CommentListVo{commentId=15createdate=Wed Dec 01 23:42:17 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='555@test.com', nickname='555', parentCommentNickname='jess', content='555', status='0'}}, CommentListVo{commentId=12createdate=Wed Dec 01 22:45:18 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=13createdate=Wed Dec 01 22:45:56 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=14createdate=Wed Dec 01 22:46:22 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=13, articleId=10004, email='hah@gmail.com', nickname='haha', parentCommentNickname='test', content='hahah', status='0'}}], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='test@gg.com', nickname='test', parentCommentNickname='jess', content='great!', status='0'}}, CommentListVo{commentId=15createdate=Wed Dec 01 23:42:17 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='555@test.com', nickname='555', parentCommentNickname='jess', content='555', status='0'}}], CommentVo=CommentVo{parentCommentId=11, articleId=10004, email='jess@gmail.com', nickname='jess', parentCommentNickname='ivan', content='I am doing well. You?', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='ivanliang0818@gmail.com', nickname='ivan', parentCommentNickname='null', content='How are you doing today?', status='0'}}, CommentListVo{commentId=16createdate=Sun Jan 09 10:03:48 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/90.png, replyComments=[CommentListVo{commentId=19createdate=Mon Jan 10 09:47:47 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/73.png, replyComments=[], CommentVo=CommentVo{parentCommentId=16, articleId=10004, email='sdfsd@Ck.com', nickname='ivan', parentCommentNickname='sfs@ss.c', content='dfjgg', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='null', content='what?', status='0'}}, CommentListVo{commentId=17createdate=Sun Jan 09 10:05:33 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/57.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsd@Ck.com', nickname='sfsf', parentCommentNickname='null', content='hdsfsd', status='0'}}, CommentListVo{commentId=18createdate=Sun Jan 09 10:06:04 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/81.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsdf@qq.com', nickname='sf', parentCommentNickname='null', content='sdfsf', status='0'}}], total=1}
2022-01-19 11:55:06:810 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 10ms
2022-01-19 11:55:06:810 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:55:31:788 [Thread-31] INFO  org.springframework.scheduling.concurrent.ThreadPoolTaskScheduler Shutting down ExecutorService 'taskScheduler'
2022-01-19 11:55:31:790 [Thread-31] INFO  org.springframework.scheduling.concurrent.ThreadPoolTaskExecutor Shutting down ExecutorService 'applicationTaskExecutor'
2022-01-19 11:55:31:791 [Thread-31] INFO  com.zaxxer.hikari.HikariDataSource HikariPool-1 - Shutdown initiated...
2022-01-19 11:55:31:792 [Thread-31] INFO  com.zaxxer.hikari.HikariDataSource HikariPool-1 - Shutdown completed.
2022-01-19 11:56:48:898 [restartedMain] INFO  com.ivan.sunnyblog.SunnyBlogApplication Starting SunnyBlogApplication on Jinghaos-MacBook-Air.local with PID 3348 (/Users/jinghaoliang/Documents/tech/Project/gitproject/blog/blog_backend/target/classes started by jinghaoliang in /Users/jinghaoliang/Documents/tech/Project/gitproject/blog/blog_backend)
2022-01-19 11:56:48:900 [restartedMain] INFO  com.ivan.sunnyblog.SunnyBlogApplication No active profile set, falling back to default profiles: default
2022-01-19 11:56:48:918 [restartedMain] INFO  org.springframework.boot.devtools.env.DevToolsPropertyDefaultsPostProcessor Devtools property defaults active! Set 'spring.devtools.add-properties' to 'false' to disable
2022-01-19 11:56:48:919 [restartedMain] INFO  org.springframework.boot.devtools.env.DevToolsPropertyDefaultsPostProcessor For additional web related logging consider setting the 'logging.level.web' property to 'DEBUG'
2022-01-19 11:56:49:224 [restartedMain] INFO  org.springframework.data.repository.config.RepositoryConfigurationDelegate Multiple Spring Data modules found, entering strict repository configuration mode!
2022-01-19 11:56:49:225 [restartedMain] INFO  org.springframework.data.repository.config.RepositoryConfigurationDelegate Bootstrapping Spring Data repositories in DEFAULT mode.
2022-01-19 11:56:49:247 [restartedMain] INFO  org.springframework.data.repository.config.RepositoryConfigurationDelegate Finished Spring Data repository scanning in 16ms. Found 0 repository interfaces.
2022-01-19 11:56:49:393 [restartedMain] INFO  o.s.context.support.PostProcessorRegistrationDelegate$BeanPostProcessorChecker Bean 'org.springframework.transaction.annotation.ProxyTransactionManagementConfiguration' of type [org.springframework.transaction.annotation.ProxyTransactionManagementConfiguration$$EnhancerBySpringCGLIB$$84623bd5] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2022-01-19 11:56:49:557 [restartedMain] INFO  org.springframework.boot.web.embedded.tomcat.TomcatWebServer Tomcat initialized with port(s): 8081 (http)
2022-01-19 11:56:49:563 [restartedMain] INFO  org.apache.coyote.http11.Http11NioProtocol Initializing ProtocolHandler ["http-nio-8081"]
2022-01-19 11:56:49:568 [restartedMain] INFO  org.apache.catalina.core.StandardService Starting service [Tomcat]
2022-01-19 11:56:49:568 [restartedMain] INFO  org.apache.catalina.core.StandardEngine Starting Servlet engine: [Apache Tomcat/9.0.21]
2022-01-19 11:56:49:629 [restartedMain] INFO  org.apache.catalina.core.ContainerBase.[Tomcat].[localhost].[/] Initializing Spring embedded WebApplicationContext
2022-01-19 11:56:49:629 [restartedMain] INFO  org.springframework.web.context.ContextLoader Root WebApplicationContext: initialization completed in 710 ms
2022-01-19 11:56:49:765 [restartedMain] INFO  com.zaxxer.hikari.HikariDataSource HikariPool-1 - Starting...
2022-01-19 11:56:49:798 [restartedMain] INFO  com.zaxxer.hikari.HikariDataSource HikariPool-1 - Start completed.
2022-01-19 11:57:02:249 [restartedMain] INFO  org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor Autowired annotation is not supported on static fields: static com.amazonaws.services.s3.AmazonS3 com.ivan.sunnyblog.web.res.S3ResourceManager.s3Client
2022-01-19 11:57:02:569 [restartedMain] INFO  org.springframework.scheduling.concurrent.ThreadPoolTaskExecutor Initializing ExecutorService 'applicationTaskExecutor'
2022-01-19 11:57:02:730 [restartedMain] INFO  org.springframework.scheduling.concurrent.ThreadPoolTaskScheduler Initializing ExecutorService 'taskScheduler'
2022-01-19 11:57:02:749 [restartedMain] INFO  org.springframework.boot.devtools.autoconfigure.OptionalLiveReloadServer LiveReload server is running on port 35729
2022-01-19 11:57:02:790 [restartedMain] INFO  org.apache.coyote.http11.Http11NioProtocol Starting ProtocolHandler ["http-nio-8081"]
2022-01-19 11:57:02:803 [restartedMain] INFO  org.springframework.boot.web.embedded.tomcat.TomcatWebServer Tomcat started on port(s): 8081 (http) with context path ''
2022-01-19 11:57:02:805 [restartedMain] INFO  com.ivan.sunnyblog.SunnyBlogApplication Started SunnyBlogApplication in 14.069 seconds (JVM running for 14.52)
2022-01-19 11:57:11:332 [http-nio-8081-exec-2] INFO  org.apache.catalina.core.ContainerBase.[Tomcat].[localhost].[/] Initializing Spring DispatcherServlet 'dispatcherServlet'
2022-01-19 11:57:11:332 [http-nio-8081-exec-2] INFO  org.springframework.web.servlet.DispatcherServlet Initializing Servlet 'dispatcherServlet'
2022-01-19 11:57:11:340 [http-nio-8081-exec-2] INFO  org.springframework.web.servlet.DispatcherServlet Completed initialization in 8 ms
2022-01-19 11:57:11:571 [http-nio-8081-exec-1] INFO  org.jooq.Constants 
                                      
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@  @@        @@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@        @@@@@@@@@@
@@@@@@@@@@@@@@@@  @@  @@    @@@@@@@@@@
@@@@@@@@@@  @@@@  @@  @@    @@@@@@@@@@
@@@@@@@@@@        @@        @@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@        @@        @@@@@@@@@@
@@@@@@@@@@    @@  @@  @@@@  @@@@@@@@@@
@@@@@@@@@@    @@  @@  @@@@  @@@@@@@@@@
@@@@@@@@@@        @@  @  @  @@@@@@@@@@
@@@@@@@@@@        @@        @@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@  @@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@  Thank you for using jOOQ 3.11.11
                                      
2022-01-19 11:57:11:642 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:57:11:642 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:57:11:642 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:57:11:642 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:57:11:642 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:57:11:643 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:57:11:643 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10004
2022-01-19 11:57:11:643 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10004
2022-01-19 11:57:11:643 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 11:57:11:643 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 11:57:11:643 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10004
2022-01-19 11:57:11:643 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10004
2022-01-19 11:57:11:643 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=18createdate=Sun Jan 09 10:06:04 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/81.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsdf@qq.com', nickname='sf', parentCommentNickname='null', content='sdfsf', status='0'}}, CommentListVo{commentId=17createdate=Sun Jan 09 10:05:33 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/57.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsd@Ck.com', nickname='sfsf', parentCommentNickname='null', content='hdsfsd', status='0'}}, CommentListVo{commentId=16createdate=Sun Jan 09 10:03:48 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/90.png, replyComments=[CommentListVo{commentId=19createdate=Mon Jan 10 09:47:47 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/73.png, replyComments=[], CommentVo=CommentVo{parentCommentId=16, articleId=10004, email='sdfsd@Ck.com', nickname='ivan', parentCommentNickname='sfs@ss.c', content='dfjgg', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='null', content='what?', status='0'}}, CommentListVo{commentId=11createdate=Wed Dec 01 22:44:50 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=12createdate=Wed Dec 01 22:45:18 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=15createdate=Wed Dec 01 23:42:17 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='555@test.com', nickname='555', parentCommentNickname='jess', content='555', status='0'}}, CommentListVo{commentId=13createdate=Wed Dec 01 22:45:56 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=14createdate=Wed Dec 01 22:46:22 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=13, articleId=10004, email='hah@gmail.com', nickname='haha', parentCommentNickname='test', content='hahah', status='0'}}], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='test@gg.com', nickname='test', parentCommentNickname='jess', content='great!', status='0'}}], CommentVo=CommentVo{parentCommentId=11, articleId=10004, email='jess@gmail.com', nickname='jess', parentCommentNickname='ivan', content='I am doing well. You?', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='ivanliang0818@gmail.com', nickname='ivan', parentCommentNickname='null', content='How are you doing today?', status='0'}}], total=4}
2022-01-19 11:57:11:643 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 260ms
2022-01-19 11:57:11:643 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=18createdate=Sun Jan 09 10:06:04 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/81.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsdf@qq.com', nickname='sf', parentCommentNickname='null', content='sdfsf', status='0'}}, CommentListVo{commentId=17createdate=Sun Jan 09 10:05:33 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/57.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsd@Ck.com', nickname='sfsf', parentCommentNickname='null', content='hdsfsd', status='0'}}, CommentListVo{commentId=16createdate=Sun Jan 09 10:03:48 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/90.png, replyComments=[CommentListVo{commentId=19createdate=Mon Jan 10 09:47:47 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/73.png, replyComments=[], CommentVo=CommentVo{parentCommentId=16, articleId=10004, email='sdfsd@Ck.com', nickname='ivan', parentCommentNickname='sfs@ss.c', content='dfjgg', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='null', content='what?', status='0'}}, CommentListVo{commentId=11createdate=Wed Dec 01 22:44:50 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=12createdate=Wed Dec 01 22:45:18 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=15createdate=Wed Dec 01 23:42:17 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='555@test.com', nickname='555', parentCommentNickname='jess', content='555', status='0'}}, CommentListVo{commentId=13createdate=Wed Dec 01 22:45:56 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=14createdate=Wed Dec 01 22:46:22 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=13, articleId=10004, email='hah@gmail.com', nickname='haha', parentCommentNickname='test', content='hahah', status='0'}}], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='test@gg.com', nickname='test', parentCommentNickname='jess', content='great!', status='0'}}], CommentVo=CommentVo{parentCommentId=11, articleId=10004, email='jess@gmail.com', nickname='jess', parentCommentNickname='ivan', content='I am doing well. You?', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='ivanliang0818@gmail.com', nickname='ivan', parentCommentNickname='null', content='How are you doing today?', status='0'}}], total=4}
2022-01-19 11:57:11:643 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 261ms
2022-01-19 11:57:11:643 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:57:11:643 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:57:11:693 [http-nio-8081-exec-3] INFO  io.lettuce.core.EpollProvider Starting without optional epoll library
2022-01-19 11:57:11:694 [http-nio-8081-exec-3] INFO  io.lettuce.core.KqueueProvider Starting without optional kqueue library
2022-01-19 11:57:11:761 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:57:11:761 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:57:11:761 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:57:11:761 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/article/10004
2022-01-19 11:57:11:761 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.ArticleController.getPublicArticleDetail
2022-01-19 11:57:11:761 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10004
2022-01-19 11:57:11:761 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=ArticleVo{userInfo=UserInfoVo{userId=100001, nickName='ivan', userName='ivan', avatar='https://res-blog-public.s3.ca-central-1.amazonaws.com/default_avatar.jpg'}, category=CategoryVo{categoryId=2, name='liddffd', articleCount=null}, BaseArticleVo{articleId=10004, status=1, type=2, title='Spring boot', description='rerwerwer', content='rererer![test.png](https://s3.ca-central-1.amazonaws.com/res-blog-public/res-dev/blog_1636947281578_test.png)', firstPicture='', viewCount=174, createDate='Tue Oct 12 15:58:26 EDT 2021', updateDate='Tue Jan 18 22:56:37 EST 2022'}}, total=null}
2022-01-19 11:57:11:761 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 391ms
2022-01-19 11:57:11:761 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:57:11:811 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:57:11:811 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:57:11:811 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:57:11:811 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10004
2022-01-19 11:57:11:811 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 11:57:11:811 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10004
2022-01-19 11:57:11:811 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=18createdate=Sun Jan 09 10:06:04 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/81.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsdf@qq.com', nickname='sf', parentCommentNickname='null', content='sdfsf', status='0'}}, CommentListVo{commentId=17createdate=Sun Jan 09 10:05:33 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/57.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsd@Ck.com', nickname='sfsf', parentCommentNickname='null', content='hdsfsd', status='0'}}, CommentListVo{commentId=16createdate=Sun Jan 09 10:03:48 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/90.png, replyComments=[CommentListVo{commentId=19createdate=Mon Jan 10 09:47:47 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/73.png, replyComments=[], CommentVo=CommentVo{parentCommentId=16, articleId=10004, email='sdfsd@Ck.com', nickname='ivan', parentCommentNickname='sfs@ss.c', content='dfjgg', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='null', content='what?', status='0'}}, CommentListVo{commentId=11createdate=Wed Dec 01 22:44:50 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=12createdate=Wed Dec 01 22:45:18 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=15createdate=Wed Dec 01 23:42:17 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='555@test.com', nickname='555', parentCommentNickname='jess', content='555', status='0'}}, CommentListVo{commentId=13createdate=Wed Dec 01 22:45:56 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=14createdate=Wed Dec 01 22:46:22 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=13, articleId=10004, email='hah@gmail.com', nickname='haha', parentCommentNickname='test', content='hahah', status='0'}}], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='test@gg.com', nickname='test', parentCommentNickname='jess', content='great!', status='0'}}], CommentVo=CommentVo{parentCommentId=11, articleId=10004, email='jess@gmail.com', nickname='jess', parentCommentNickname='ivan', content='I am doing well. You?', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='ivanliang0818@gmail.com', nickname='ivan', parentCommentNickname='null', content='How are you doing today?', status='0'}}], total=4}
2022-01-19 11:57:11:811 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 13ms
2022-01-19 11:57:11:811 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:57:50:596 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:57:50:597 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:57:50:597 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: POST
2022-01-19 11:57:50:597 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment
2022-01-19 11:57:50:597 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.postComment
2022-01-19 11:57:50:597 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: CommentVo{parentCommentId=14, articleId=10004, email='sdfsd@Ck.com', nickname='ivan', parentCommentNickname='haha', content='222', status='null'}
2022-01-19 11:57:50:597 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=null, total=null}
2022-01-19 11:57:50:597 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 25ms
2022-01-19 11:57:50:597 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 11:57:50:623 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 11:57:50:623 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 11:57:50:623 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 11:57:50:623 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10004
2022-01-19 11:57:50:623 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 11:57:50:623 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10004
2022-01-19 11:57:50:623 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=18createdate=Sun Jan 09 10:06:04 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/81.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsdf@qq.com', nickname='sf', parentCommentNickname='null', content='sdfsf', status='0'}}, CommentListVo{commentId=17createdate=Sun Jan 09 10:05:33 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/57.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsd@Ck.com', nickname='sfsf', parentCommentNickname='null', content='hdsfsd', status='0'}}, CommentListVo{commentId=16createdate=Sun Jan 09 10:03:48 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/90.png, replyComments=[CommentListVo{commentId=19createdate=Mon Jan 10 09:47:47 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/73.png, replyComments=[], CommentVo=CommentVo{parentCommentId=16, articleId=10004, email='sdfsd@Ck.com', nickname='ivan', parentCommentNickname='sfs@ss.c', content='dfjgg', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='null', content='what?', status='0'}}, CommentListVo{commentId=11createdate=Wed Dec 01 22:44:50 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=12createdate=Wed Dec 01 22:45:18 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=15createdate=Wed Dec 01 23:42:17 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='555@test.com', nickname='555', parentCommentNickname='jess', content='555', status='0'}}, CommentListVo{commentId=13createdate=Wed Dec 01 22:45:56 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=14createdate=Wed Dec 01 22:46:22 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=26createdate=Wed Jan 19 11:57:50 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/49.png, replyComments=[], CommentVo=CommentVo{parentCommentId=14, articleId=10004, email='sdfsd@Ck.com', nickname='ivan', parentCommentNickname='haha', content='222', status='0'}}], CommentVo=CommentVo{parentCommentId=13, articleId=10004, email='hah@gmail.com', nickname='haha', parentCommentNickname='test', content='hahah', status='0'}}], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='test@gg.com', nickname='test', parentCommentNickname='jess', content='great!', status='0'}}], CommentVo=CommentVo{parentCommentId=11, articleId=10004, email='jess@gmail.com', nickname='jess', parentCommentNickname='ivan', content='I am doing well. You?', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='ivanliang0818@gmail.com', nickname='ivan', parentCommentNickname='null', content='How are you doing today?', status='0'}}], total=4}
2022-01-19 11:57:50:623 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 7ms
2022-01-19 11:57:50:623 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 12:49:17:759 [HikariPool-1 housekeeper] WARN  com.zaxxer.hikari.pool.HikariPool HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=46m27s821ms).
2022-01-19 13:38:54:504 [HikariPool-1 housekeeper] WARN  com.zaxxer.hikari.pool.HikariPool HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=49m36s745ms).
2022-01-19 14:05:19:555 [HikariPool-1 housekeeper] WARN  com.zaxxer.hikari.pool.HikariPool HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=26m25s51ms).
2022-01-19 14:51:01:892 [HikariPool-1 housekeeper] WARN  com.zaxxer.hikari.pool.HikariPool HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=39m42s298ms).
2022-01-19 16:16:36:736 [HikariPool-1 housekeeper] WARN  com.zaxxer.hikari.pool.HikariPool HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=1h25m34s844ms).
2022-01-19 16:17:09:784 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 16:17:09:784 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 16:17:09:784 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 16:17:09:785 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/article/10004
2022-01-19 16:17:09:785 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.ArticleController.getPublicArticleDetail
2022-01-19 16:17:09:785 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10004
2022-01-19 16:17:09:785 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=ArticleVo{userInfo=UserInfoVo{userId=100001, nickName='ivan', userName='ivan', avatar='https://res-blog-public.s3.ca-central-1.amazonaws.com/default_avatar.jpg'}, category=CategoryVo{categoryId=2, name='liddffd', articleCount=null}, BaseArticleVo{articleId=10004, status=1, type=2, title='Spring boot', description='rerwerwer', content='rererer![test.png](https://s3.ca-central-1.amazonaws.com/res-blog-public/res-dev/blog_1636947281578_test.png)', firstPicture='', viewCount=174, createDate='Tue Oct 12 15:58:26 EDT 2021', updateDate='Tue Jan 18 22:56:37 EST 2022'}}, total=null}
2022-01-19 16:17:09:785 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 11ms
2022-01-19 16:17:09:785 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 16:17:09:787 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 16:17:09:787 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 16:17:09:787 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 16:17:09:787 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10004
2022-01-19 16:17:09:787 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 16:17:09:787 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10004
2022-01-19 16:17:09:787 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=18createdate=Sun Jan 09 10:06:04 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/81.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsdf@qq.com', nickname='sf', parentCommentNickname='null', content='sdfsf', status='0'}}, CommentListVo{commentId=17createdate=Sun Jan 09 10:05:33 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/57.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsd@Ck.com', nickname='sfsf', parentCommentNickname='null', content='hdsfsd', status='0'}}, CommentListVo{commentId=16createdate=Sun Jan 09 10:03:48 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/90.png, replyComments=[CommentListVo{commentId=19createdate=Mon Jan 10 09:47:47 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/73.png, replyComments=[], CommentVo=CommentVo{parentCommentId=16, articleId=10004, email='sdfsd@Ck.com', nickname='ivan', parentCommentNickname='sfs@ss.c', content='dfjgg', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='null', content='what?', status='0'}}, CommentListVo{commentId=11createdate=Wed Dec 01 22:44:50 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=12createdate=Wed Dec 01 22:45:18 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=15createdate=Wed Dec 01 23:42:17 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='555@test.com', nickname='555', parentCommentNickname='jess', content='555', status='0'}}, CommentListVo{commentId=13createdate=Wed Dec 01 22:45:56 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=14createdate=Wed Dec 01 22:46:22 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=26createdate=Wed Jan 19 11:57:50 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/49.png, replyComments=[], CommentVo=CommentVo{parentCommentId=14, articleId=10004, email='sdfsd@Ck.com', nickname='ivan', parentCommentNickname='haha', content='222', status='0'}}], CommentVo=CommentVo{parentCommentId=13, articleId=10004, email='hah@gmail.com', nickname='haha', parentCommentNickname='test', content='hahah', status='0'}}], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='test@gg.com', nickname='test', parentCommentNickname='jess', content='great!', status='0'}}], CommentVo=CommentVo{parentCommentId=11, articleId=10004, email='jess@gmail.com', nickname='jess', parentCommentNickname='ivan', content='I am doing well. You?', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='ivanliang0818@gmail.com', nickname='ivan', parentCommentNickname='null', content='How are you doing today?', status='0'}}], total=4}
2022-01-19 16:17:09:787 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 14ms
2022-01-19 16:17:09:787 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 16:17:09:790 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 16:17:09:790 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 16:17:09:790 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 16:17:09:790 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10004
2022-01-19 16:17:09:790 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 16:17:09:790 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10004
2022-01-19 16:17:09:790 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=18createdate=Sun Jan 09 10:06:04 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/81.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsdf@qq.com', nickname='sf', parentCommentNickname='null', content='sdfsf', status='0'}}, CommentListVo{commentId=17createdate=Sun Jan 09 10:05:33 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/57.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsd@Ck.com', nickname='sfsf', parentCommentNickname='null', content='hdsfsd', status='0'}}, CommentListVo{commentId=16createdate=Sun Jan 09 10:03:48 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/90.png, replyComments=[CommentListVo{commentId=19createdate=Mon Jan 10 09:47:47 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/73.png, replyComments=[], CommentVo=CommentVo{parentCommentId=16, articleId=10004, email='sdfsd@Ck.com', nickname='ivan', parentCommentNickname='sfs@ss.c', content='dfjgg', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='null', content='what?', status='0'}}, CommentListVo{commentId=11createdate=Wed Dec 01 22:44:50 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=12createdate=Wed Dec 01 22:45:18 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=15createdate=Wed Dec 01 23:42:17 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='555@test.com', nickname='555', parentCommentNickname='jess', content='555', status='0'}}, CommentListVo{commentId=13createdate=Wed Dec 01 22:45:56 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=14createdate=Wed Dec 01 22:46:22 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=26createdate=Wed Jan 19 11:57:50 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/49.png, replyComments=[], CommentVo=CommentVo{parentCommentId=14, articleId=10004, email='sdfsd@Ck.com', nickname='ivan', parentCommentNickname='haha', content='222', status='0'}}], CommentVo=CommentVo{parentCommentId=13, articleId=10004, email='hah@gmail.com', nickname='haha', parentCommentNickname='test', content='hahah', status='0'}}], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='test@gg.com', nickname='test', parentCommentNickname='jess', content='great!', status='0'}}], CommentVo=CommentVo{parentCommentId=11, articleId=10004, email='jess@gmail.com', nickname='jess', parentCommentNickname='ivan', content='I am doing well. You?', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='ivanliang0818@gmail.com', nickname='ivan', parentCommentNickname='null', content='How are you doing today?', status='0'}}], total=4}
2022-01-19 16:17:09:790 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 14ms
2022-01-19 16:17:09:790 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 16:17:10:279 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 16:17:10:279 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 16:17:10:279 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 16:17:10:279 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10004
2022-01-19 16:17:10:279 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 16:17:10:279 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10004
2022-01-19 16:17:10:279 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=18createdate=Sun Jan 09 10:06:04 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/81.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsdf@qq.com', nickname='sf', parentCommentNickname='null', content='sdfsf', status='0'}}, CommentListVo{commentId=17createdate=Sun Jan 09 10:05:33 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/57.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsd@Ck.com', nickname='sfsf', parentCommentNickname='null', content='hdsfsd', status='0'}}, CommentListVo{commentId=16createdate=Sun Jan 09 10:03:48 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/90.png, replyComments=[CommentListVo{commentId=19createdate=Mon Jan 10 09:47:47 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/73.png, replyComments=[], CommentVo=CommentVo{parentCommentId=16, articleId=10004, email='sdfsd@Ck.com', nickname='ivan', parentCommentNickname='sfs@ss.c', content='dfjgg', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='null', content='what?', status='0'}}, CommentListVo{commentId=11createdate=Wed Dec 01 22:44:50 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=12createdate=Wed Dec 01 22:45:18 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=15createdate=Wed Dec 01 23:42:17 EST 2021, avatar=null, replyComments=[], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='555@test.com', nickname='555', parentCommentNickname='jess', content='555', status='0'}}, CommentListVo{commentId=13createdate=Wed Dec 01 22:45:56 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=14createdate=Wed Dec 01 22:46:22 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=26createdate=Wed Jan 19 11:57:50 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/49.png, replyComments=[], CommentVo=CommentVo{parentCommentId=14, articleId=10004, email='sdfsd@Ck.com', nickname='ivan', parentCommentNickname='haha', content='222', status='0'}}], CommentVo=CommentVo{parentCommentId=13, articleId=10004, email='hah@gmail.com', nickname='haha', parentCommentNickname='test', content='hahah', status='0'}}], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='test@gg.com', nickname='test', parentCommentNickname='jess', content='great!', status='0'}}], CommentVo=CommentVo{parentCommentId=11, articleId=10004, email='jess@gmail.com', nickname='jess', parentCommentNickname='ivan', content='I am doing well. You?', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='ivanliang0818@gmail.com', nickname='ivan', parentCommentNickname='null', content='How are you doing today?', status='0'}}], total=4}
2022-01-19 16:17:10:280 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 13ms
2022-01-19 16:17:10:280 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 16:45:15:872 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 16:45:15:873 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 16:45:15:873 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 16:45:15:873 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/articles/hot
2022-01-19 16:45:15:873 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.ArticleController.getHotArticles
2022-01-19 16:45:15:874 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: {}
2022-01-19 16:45:15:874 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[ArticleVo{userInfo=null, category=null, BaseArticleVo{articleId=10004, status=null, type=null, title='Spring boot', description='null', content='null', firstPicture='null', viewCount=174, createDate='Tue Oct 12 15:58:26 EDT 2021', updateDate='null'}}, ArticleVo{userInfo=null, category=null, BaseArticleVo{articleId=10005, status=null, type=null, title='dd', description='null', content='null', firstPicture='null', viewCount=83, createDate='Sun Nov 07 14:09:29 EST 2021', updateDate='null'}}, ArticleVo{userInfo=null, category=null, BaseArticleVo{articleId=10003, status=null, type=null, title='dd', description='null', content='null', firstPicture='null', viewCount=0, createDate='Tue Oct 12 15:57:33 EDT 2021', updateDate='null'}}], total=null}
2022-01-19 16:45:15:874 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 22ms
2022-01-19 16:45:15:874 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 16:45:15:878 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 16:45:15:878 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 16:45:15:878 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 16:45:15:878 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/categories
2022-01-19 16:45:15:878 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CategoryContoller.getCategories
2022-01-19 16:45:15:878 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: {}
2022-01-19 16:45:15:878 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CategoryVo{categoryId=2, name='liddffd', articleCount=1}, CategoryVo{categoryId=1, name='Life ', articleCount=2}], total=null}
2022-01-19 16:45:15:878 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 28ms
2022-01-19 16:45:15:878 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 16:45:15:880 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 16:45:15:881 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 16:45:15:881 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 16:45:15:881 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/articles
2022-01-19 16:45:15:881 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.ArticleController.getPublicArticles
2022-01-19 16:45:15:881 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: SearchVo{page=1, limit=10, categoryId=null, total=null}
2022-01-19 16:45:15:881 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[ArticleVo{userInfo=UserInfoVo{userId=100001, nickName='ivan', userName='ivan', avatar='https://res-blog-public.s3.ca-central-1.amazonaws.com/default_avatar.jpg'}, category=CategoryVo{categoryId=1, name='Life ', articleCount=null}, BaseArticleVo{articleId=10005, status=1, type=1, title='dd', description='This is the doc of React markdown editor lite.
Enjoy!!', content='null', firstPicture='', viewCount=83, createDate='Sun Nov 07 14:09:29 EST 2021', updateDate='Tue Jan 18 22:54:08 EST 2022'}}, ArticleVo{userInfo=UserInfoVo{userId=100001, nickName='ivan', userName='ivan', avatar='https://res-blog-public.s3.ca-central-1.amazonaws.com/default_avatar.jpg'}, category=CategoryVo{categoryId=2, name='liddffd', articleCount=null}, BaseArticleVo{articleId=10004, status=1, type=2, title='Spring boot', description='rerwerwer', content='null', firstPicture='', viewCount=174, createDate='Tue Oct 12 15:58:26 EDT 2021', updateDate='Tue Jan 18 22:56:37 EST 2022'}}, ArticleVo{userInfo=UserInfoVo{userId=100001, nickName='ivan', userName='ivan', avatar='https://res-blog-public.s3.ca-central-1.amazonaws.com/default_avatar.jpg'}, category=CategoryVo{categoryId=1, name='Life ', articleCount=null}, BaseArticleVo{articleId=10003, status=1, type=1, title='dd', description='test', content='null', firstPicture='', viewCount=0, createDate='Tue Oct 12 15:57:33 EDT 2021', updateDate='Tue Jan 18 22:53:20 EST 2022'}}], total=3}
2022-01-19 16:45:15:881 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 28ms
2022-01-19 16:45:15:881 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 16:45:17:239 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 16:45:17:239 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 16:45:17:239 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 16:45:17:239 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 16:45:17:239 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 16:45:17:239 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 16:45:17:239 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 16:45:17:239 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 16:45:17:239 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 16:45:17:239 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 16:45:17:239 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 16:45:17:239 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 16:45:17:239 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=20createdate=Wed Jan 19 11:47:08 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/26.png, replyComments=[CommentListVo{commentId=21createdate=Wed Jan 19 11:47:21 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/89.png, replyComments=[CommentListVo{commentId=22createdate=Wed Jan 19 11:47:39 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/75.png, replyComments=[], CommentVo=CommentVo{parentCommentId=21, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='sfs@ss.c', content='eeeeee', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='tet', content='ree', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='tet', parentCommentNickname='null', content='etet', status='0'}}], total=4}
2022-01-19 16:45:17:239 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 9ms
2022-01-19 16:45:17:239 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 16:45:17:239 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=20createdate=Wed Jan 19 11:47:08 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/26.png, replyComments=[CommentListVo{commentId=21createdate=Wed Jan 19 11:47:21 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/89.png, replyComments=[CommentListVo{commentId=22createdate=Wed Jan 19 11:47:39 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/75.png, replyComments=[], CommentVo=CommentVo{parentCommentId=21, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='sfs@ss.c', content='eeeeee', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='tet', content='ree', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='tet', parentCommentNickname='null', content='etet', status='0'}}], total=4}
2022-01-19 16:45:17:239 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 8ms
2022-01-19 16:45:17:239 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 16:45:17:241 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 16:45:17:241 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 16:45:17:242 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 16:45:17:242 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/article/10005
2022-01-19 16:45:17:242 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.ArticleController.getPublicArticleDetail
2022-01-19 16:45:17:242 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 16:45:17:242 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=ArticleVo{userInfo=UserInfoVo{userId=100001, nickName='ivan', userName='ivan', avatar='https://res-blog-public.s3.ca-central-1.amazonaws.com/default_avatar.jpg'}, category=CategoryVo{categoryId=1, name='Life ', articleCount=null}, BaseArticleVo{articleId=10005, status=1, type=1, title='dd', description='This is the doc of React markdown editor lite.
Enjoy!!', content='| Head | Head | Head | Head |
| --- | --- | --- | --- |
| Data | Data | Data | Data |
| Data | Data | Data | Data |

## 手把手教你写一个markdown编辑器

> 笔者在18年年末的时候接到一个开发任务——搭建一个AI项目的开放平台，其中的产品文档为转化为HTML格式的markdown文档。考虑到文档的即时更新，将文档信息做成了Ajax接口的形式。因此管理后台只需将textarea表单的内容通过markdown解析器进行HTML格式转化，然后将markdown内容和经转化的HTML文档都保存到数据库即可。
> 基本需求完成后，为了更好的用户体验，考虑将常用的编辑功能添加进来。改进版不仅支持了常用的文本编辑功能，还实现的UI界面的配置化，自定义语法解析器。本着造福伸手党的目的，以及积累些开源经验，笔者将该react 组件 [react-markdown-editor-lite](https://github.com/HarryChen0506/react-markdown-editor-lite) 进行了封装改造，并且发布到了开源社区。

### 预览
在线体验 [https://harrychen0506.github.io/react-markdown-editor-lite/](https://harrychen0506.github.io/react-markdown-editor-lite/)

![image](https://github.com//HarryChen0506/react-markdown-editor-lite/blob/master/image/react-markdown-editor-lite-v1.0.0.PNG?raw=true)

### 特点
* 轻量、基于React
* UI可配置, 如只显示编辑区或预览区
* 支持自定义markdown语法解析器,语法高亮等
* 支持常用的markdown编辑功能，如加粗，斜体等等...
* 支持功能按钮插拔化，用户可以自定义扩展组件
* 支持编辑区和预览区同步滚动

### 开发心得

- 文本编辑

  大多数常见的编辑器，包括富文本编辑器，利用了某些元素如div的contenteditable属性，配合selection、range、execCommand等API，实现了富文本编辑功能。这里面的实现比较复杂，所以有了"[为什么都说富文本编辑器是天坑？](https://www.zhihu.com/question/38699645)"这个说法。

  而markdown编辑器，核心的处理内容为简单语法的纯文本，复杂度相对来说比较低，并且input标签自带onSelect事件，可以很方便的获取选择信息（选择起始位置和选择文本值），因此要想实现编辑功能，只需将要改动的内容进行文本转换，然后进行重新拼接首尾，大功告成。
  
- markdown解析

  考察了几个社区流行的markdown解析器，比较流行的有[markdown](https://www.npmjs.com/package/markdown), [markdown-it](https://www.npmjs.com/package/markdown-it), [marked](https://www.npmjs.com/package/marked) 等等。综合考虑扩展性以及稳定性，笔者推荐使用markdown-it作为markdown的词法解析器，因为该解析器有比较多的插件，并且支持语法高亮。

- 同步滚动

  当选择分栏编辑的时候，滚动左侧的编辑区，右侧的预览区能自动滚动到对应的区域。方案参考了《[手把手教你用 100行代码实现基于 react的 markdown 输入 + 即时预览在线编辑器（一）](https://github.com/accforgit/blog-data/blob/master/%E5%9C%A8%E7%BA%BF%E7%BC%96%E8%BE%91%E5%99%A8/README/README1.md)》。只需先计算出输入框容器元素与预览框容器元素之间最大scroll范围的比例值，然后根据主动滚动元素自身的scrollTop做相应的比例换算，即可知道对方区域的scrollTop值。

- 关于UI
 
  - 项目的字体库选择了Font Awesome风格，并且只选取了项目所需要的一些图标。
  - 编辑器的整体css均可通过全局覆盖的形式进行自定义。目前暂时只支持灰色主题。
  - 编辑器的显示区域包括菜单栏，编辑器，预览区，工具栏，通过配置组件的config属性，可以选择默认的展示区域。
  
### Install

```js
npm install react-markdown-editor-lite --save
```

### Props

| Property | Description | Type | default | Remarks |
| --- | --- | --- | --- | --- |
| value | markdown content | String | '' | required |
| style | component container style | Object | {height: '100%'} | not required |
| config | component config | Object | {view: {...}, logger: {...}} | not required |
| onChange | emitting when editor has changed | Function | ({html, md}) => {} | not required |
| onImageUpload | when image uploaded, callback emitting will get image markdown text | (file: File, callback: (url: string) => void) => void; | ({file, callback}) => {} | not required |
| renderHTML | Render markdown text to HTML. You can return either string, function or Promise | (text: string) => string|function|Promise | none | **required** |

### Example

``` js
'use strict';
import React from 'react'
import ReactDOM from 'react-dom'
import MdEditor from 'react-markdown-editor-lite'
import MarkdownIt from 'markdown-it'
import emoji from 'markdown-it-emoji'
import subscript from 'markdown-it-sub'
import superscript from 'markdown-it-sup'
import footnote from 'markdown-it-footnote'
import deflist from 'markdown-it-deflist'
import abbreviation from 'markdown-it-abbr'
import insert from 'markdown-it-ins'
import mark from 'markdown-it-mark'
import tasklists from 'markdown-it-task-lists'
import hljs from 'highlight.js'
import 'highlight.js/styles/atom-one-light.css'
// import 'highlight.js/styles/github.css'
import './index.less';

const MOCK_DATA = "I Love React."
export default class Demo extends React.Component {
  mdEditor = null
  mdParser = null
  constructor(props) {
    super(props)
    // initial a parsera
    this.mdParser = new MarkdownIt({
      html: true,
      linkify: true,
      typographer: true,
      highlight: function (str, lang) {
        if (lang && hljs.getLanguage(lang)) {
          try {
            return hljs.highlight(lang, str).value
          } catch (__) {}
        }    
        return '' // use external default escaping
      }
    })
    .use(emoji)
    .use(subscript)
    .use(superscript)
    .use(footnote)
    .use(deflist)
    .use(abbreviation)
    .use(insert)
    .use(mark)
    .use(tasklists, { enabled: this.taskLists })
    this.renderHTML = this.renderHTML.bind(this)
  }
  handleEditorChange({html, md}) {
    console.log('handleEditorChange', html, md)
  }
  handleImageUpload(file, callback) {
    const reader = new FileReader()
    reader.onload = () => {      
      const convertBase64UrlToBlob = (urlData) => {  
        let arr = urlData.split(','), mime = arr[0].match(/:(.*?);/)[1]
        let bstr = atob(arr[1])
        let n = bstr.length
        let u8arr = new Uint8Array(n)
        while (n--) {
          u8arr[n] = bstr.charCodeAt(n)
        }
        return new Blob([u8arr], {type:mime})
      }
      const blob = convertBase64UrlToBlob(reader.result)
      setTimeout(() => {
        // setTimeout 模拟异步上传图片
        // 当异步上传获取图片地址后，执行calback回调（参数为imageUrl字符串），即可将图片地址写入markdown
        callback('https://avatars0.githubusercontent.com/u/21263805?s=40&v=4')
      }, 1000)
    }
    reader.readAsDataURL(file)
  }
  renderHTML(text) {
    // 模拟异步渲染Markdown
    return new Promise((resolve) => {
      setTimeout(() => {
        resolve(this.mdParser.render(text))
      }, 1000)
    })
  }
  handleGetMdValue = () => {   
    this.mdEditor && alert(this.mdEditor.getMdValue())      
  }
  handleGetHtmlValue = () => {    
    this.mdEditor && alert(this.mdEditor.getHtmlValue())
  }
  render() {
    return (      
      <div>
        <nav>
          <button onClick={this.handleGetMdValue} >getMdValue</button>  
          <button onClick={this.handleGetHtmlValue} >getHtmlValue</button>  
        </nav>
        <section style="height: 500px">
          <MdEditor 
            ref={node => this.mdEditor = node}
            value={MOCK_DATA}
            style={{height: '400px'}}
            renderHTML={this.renderHTML}
            config={{
              view: {
                menu: true,
                md: true,
                html: true
              },
              imageUrl: 'https://octodex.github.com/images/minion.png'
            }}
            onChange={this.handleEditorChange} 
            onImageUpload={this.handleImageUpload}
          />
        </section>                        
      </div>      
    )
  }
}
```

### 最后

   欢迎大家使用和反馈，[项目地址](https://github.com/HarryChen0506/react-markdown-editor-lite) (https://github.com/HarryChen0506/react-markdown-editor-lite)， 你的点赞将是我莫大的动力😊

![1.png](https://s3.ca-central-1.amazonaws.com/res-blog-public/res-dev/blog_1636946743939_1.png)', firstPicture='', viewCount=83, createDate='Sun Nov 07 14:09:29 EST 2021', updateDate='Tue Jan 18 22:54:08 EST 2022'}}, total=null}
2022-01-19 16:45:17:242 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 7ms
2022-01-19 16:45:17:242 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 16:45:17:304 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 16:45:17:304 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 16:45:17:304 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 16:45:17:304 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 16:45:17:304 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 16:45:17:304 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 16:45:17:304 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=20createdate=Wed Jan 19 11:47:08 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/26.png, replyComments=[CommentListVo{commentId=21createdate=Wed Jan 19 11:47:21 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/89.png, replyComments=[CommentListVo{commentId=22createdate=Wed Jan 19 11:47:39 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/75.png, replyComments=[], CommentVo=CommentVo{parentCommentId=21, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='sfs@ss.c', content='eeeeee', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='tet', content='ree', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='tet', parentCommentNickname='null', content='etet', status='0'}}], total=4}
2022-01-19 16:45:17:304 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 4ms
2022-01-19 16:45:17:304 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 17:01:06:044 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 17:01:06:044 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 17:01:06:044 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: POST
2022-01-19 17:01:06:045 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment
2022-01-19 17:01:06:045 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.postComment
2022-01-19 17:01:06:045 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: CommentVo{parentCommentId=20, articleId=10005, email='ljh19911025@gmail.com', nickname='sds', parentCommentNickname='tet', content='wwww', status='null'}
2022-01-19 17:01:06:045 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=null, total=null}
2022-01-19 17:01:06:045 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 14ms
2022-01-19 17:01:06:045 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 17:01:06:074 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 17:01:06:074 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 17:01:06:074 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 17:01:06:074 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 17:01:06:074 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 17:01:06:074 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 17:01:06:074 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=20createdate=Wed Jan 19 11:47:08 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/26.png, replyComments=[CommentListVo{commentId=27createdate=Wed Jan 19 17:01:06 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/2.png, replyComments=[], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='ljh19911025@gmail.com', nickname='sds', parentCommentNickname='tet', content='wwww', status='0'}}, CommentListVo{commentId=21createdate=Wed Jan 19 11:47:21 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/89.png, replyComments=[CommentListVo{commentId=22createdate=Wed Jan 19 11:47:39 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/75.png, replyComments=[], CommentVo=CommentVo{parentCommentId=21, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='sfs@ss.c', content='eeeeee', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='tet', content='ree', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='tet', parentCommentNickname='null', content='etet', status='0'}}], total=4}
2022-01-19 17:01:06:074 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 8ms
2022-01-19 17:01:06:075 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 17:32:22:062 [Thread-37] INFO  org.springframework.scheduling.concurrent.ThreadPoolTaskScheduler Shutting down ExecutorService 'taskScheduler'
2022-01-19 17:32:22:063 [Thread-37] INFO  org.springframework.scheduling.concurrent.ThreadPoolTaskExecutor Shutting down ExecutorService 'applicationTaskExecutor'
2022-01-19 17:32:22:065 [Thread-37] INFO  com.zaxxer.hikari.HikariDataSource HikariPool-1 - Shutdown initiated...
2022-01-19 17:32:22:066 [Thread-37] INFO  com.zaxxer.hikari.HikariDataSource HikariPool-1 - Shutdown completed.
2022-01-19 17:32:27:145 [restartedMain] INFO  com.ivan.sunnyblog.SunnyBlogApplication Starting SunnyBlogApplication on Jinghaos-MacBook-Air.local with PID 4294 (/Users/jinghaoliang/Documents/tech/Project/gitproject/blog/blog_backend/target/classes started by jinghaoliang in /Users/jinghaoliang/Documents/tech/Project/gitproject/blog/blog_backend)
2022-01-19 17:32:27:147 [restartedMain] INFO  com.ivan.sunnyblog.SunnyBlogApplication No active profile set, falling back to default profiles: default
2022-01-19 17:32:27:169 [restartedMain] INFO  org.springframework.boot.devtools.env.DevToolsPropertyDefaultsPostProcessor Devtools property defaults active! Set 'spring.devtools.add-properties' to 'false' to disable
2022-01-19 17:32:27:169 [restartedMain] INFO  org.springframework.boot.devtools.env.DevToolsPropertyDefaultsPostProcessor For additional web related logging consider setting the 'logging.level.web' property to 'DEBUG'
2022-01-19 17:32:27:511 [restartedMain] INFO  org.springframework.data.repository.config.RepositoryConfigurationDelegate Multiple Spring Data modules found, entering strict repository configuration mode!
2022-01-19 17:32:27:512 [restartedMain] INFO  org.springframework.data.repository.config.RepositoryConfigurationDelegate Bootstrapping Spring Data repositories in DEFAULT mode.
2022-01-19 17:32:27:535 [restartedMain] INFO  org.springframework.data.repository.config.RepositoryConfigurationDelegate Finished Spring Data repository scanning in 17ms. Found 0 repository interfaces.
2022-01-19 17:32:27:687 [restartedMain] INFO  o.s.context.support.PostProcessorRegistrationDelegate$BeanPostProcessorChecker Bean 'org.springframework.transaction.annotation.ProxyTransactionManagementConfiguration' of type [org.springframework.transaction.annotation.ProxyTransactionManagementConfiguration$$EnhancerBySpringCGLIB$$d02151e0] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2022-01-19 17:32:27:852 [restartedMain] INFO  org.springframework.boot.web.embedded.tomcat.TomcatWebServer Tomcat initialized with port(s): 8081 (http)
2022-01-19 17:32:27:858 [restartedMain] INFO  org.apache.coyote.http11.Http11NioProtocol Initializing ProtocolHandler ["http-nio-8081"]
2022-01-19 17:32:27:881 [restartedMain] INFO  org.apache.catalina.core.StandardService Starting service [Tomcat]
2022-01-19 17:32:27:881 [restartedMain] INFO  org.apache.catalina.core.StandardEngine Starting Servlet engine: [Apache Tomcat/9.0.21]
2022-01-19 17:32:27:944 [restartedMain] INFO  org.apache.catalina.core.ContainerBase.[Tomcat].[localhost].[/] Initializing Spring embedded WebApplicationContext
2022-01-19 17:32:27:944 [restartedMain] INFO  org.springframework.web.context.ContextLoader Root WebApplicationContext: initialization completed in 775 ms
2022-01-19 17:32:28:089 [restartedMain] INFO  com.zaxxer.hikari.HikariDataSource HikariPool-1 - Starting...
2022-01-19 17:32:28:120 [restartedMain] INFO  com.zaxxer.hikari.HikariDataSource HikariPool-1 - Start completed.
2022-01-19 17:33:05:323 [restartedMain] INFO  org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor Autowired annotation is not supported on static fields: static com.amazonaws.services.s3.AmazonS3 com.ivan.sunnyblog.web.res.S3ResourceManager.s3Client
2022-01-19 17:33:05:625 [restartedMain] INFO  org.springframework.scheduling.concurrent.ThreadPoolTaskExecutor Initializing ExecutorService 'applicationTaskExecutor'
2022-01-19 17:33:05:784 [restartedMain] INFO  org.springframework.scheduling.concurrent.ThreadPoolTaskScheduler Initializing ExecutorService 'taskScheduler'
2022-01-19 17:33:05:805 [restartedMain] INFO  org.springframework.boot.devtools.autoconfigure.OptionalLiveReloadServer LiveReload server is running on port 35729
2022-01-19 17:33:05:847 [restartedMain] INFO  org.apache.coyote.http11.Http11NioProtocol Starting ProtocolHandler ["http-nio-8081"]
2022-01-19 17:33:05:861 [restartedMain] INFO  org.springframework.boot.web.embedded.tomcat.TomcatWebServer Tomcat started on port(s): 8081 (http) with context path ''
2022-01-19 17:33:05:863 [restartedMain] INFO  com.ivan.sunnyblog.SunnyBlogApplication Started SunnyBlogApplication in 38.89 seconds (JVM running for 39.297)
2022-01-19 17:33:16:101 [http-nio-8081-exec-3] INFO  org.apache.catalina.core.ContainerBase.[Tomcat].[localhost].[/] Initializing Spring DispatcherServlet 'dispatcherServlet'
2022-01-19 17:33:16:101 [http-nio-8081-exec-3] INFO  org.springframework.web.servlet.DispatcherServlet Initializing Servlet 'dispatcherServlet'
2022-01-19 17:33:16:106 [http-nio-8081-exec-3] INFO  org.springframework.web.servlet.DispatcherServlet Completed initialization in 5 ms
2022-01-19 17:33:16:361 [http-nio-8081-exec-4] INFO  org.jooq.Constants 
                                      
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@  @@        @@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@        @@@@@@@@@@
@@@@@@@@@@@@@@@@  @@  @@    @@@@@@@@@@
@@@@@@@@@@  @@@@  @@  @@    @@@@@@@@@@
@@@@@@@@@@        @@        @@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@        @@        @@@@@@@@@@
@@@@@@@@@@    @@  @@  @@@@  @@@@@@@@@@
@@@@@@@@@@    @@  @@  @@@@  @@@@@@@@@@
@@@@@@@@@@        @@  @  @  @@@@@@@@@@
@@@@@@@@@@        @@        @@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@  @@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@  Thank you for using jOOQ 3.11.11
                                      
2022-01-19 17:33:16:498 [http-nio-8081-exec-3] INFO  io.lettuce.core.EpollProvider Starting without optional epoll library
2022-01-19 17:33:16:498 [http-nio-8081-exec-3] INFO  io.lettuce.core.KqueueProvider Starting without optional kqueue library
2022-01-19 17:33:16:577 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 17:33:16:579 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 17:33:16:582 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 17:33:16:582 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/article/10005
2022-01-19 17:33:16:582 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.ArticleController.getPublicArticleDetail
2022-01-19 17:33:16:582 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 17:33:16:582 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=ArticleVo{userInfo=UserInfoVo{userId=100001, nickName='ivan', userName='ivan', avatar='https://res-blog-public.s3.ca-central-1.amazonaws.com/default_avatar.jpg'}, category=CategoryVo{categoryId=1, name='Life ', articleCount=null}, BaseArticleVo{articleId=10005, status=1, type=1, title='dd', description='This is the doc of React markdown editor lite.
Enjoy!!', content='| Head | Head | Head | Head |
| --- | --- | --- | --- |
| Data | Data | Data | Data |
| Data | Data | Data | Data |

## 手把手教你写一个markdown编辑器

> 笔者在18年年末的时候接到一个开发任务——搭建一个AI项目的开放平台，其中的产品文档为转化为HTML格式的markdown文档。考虑到文档的即时更新，将文档信息做成了Ajax接口的形式。因此管理后台只需将textarea表单的内容通过markdown解析器进行HTML格式转化，然后将markdown内容和经转化的HTML文档都保存到数据库即可。
> 基本需求完成后，为了更好的用户体验，考虑将常用的编辑功能添加进来。改进版不仅支持了常用的文本编辑功能，还实现的UI界面的配置化，自定义语法解析器。本着造福伸手党的目的，以及积累些开源经验，笔者将该react 组件 [react-markdown-editor-lite](https://github.com/HarryChen0506/react-markdown-editor-lite) 进行了封装改造，并且发布到了开源社区。

### 预览
在线体验 [https://harrychen0506.github.io/react-markdown-editor-lite/](https://harrychen0506.github.io/react-markdown-editor-lite/)

![image](https://github.com//HarryChen0506/react-markdown-editor-lite/blob/master/image/react-markdown-editor-lite-v1.0.0.PNG?raw=true)

### 特点
* 轻量、基于React
* UI可配置, 如只显示编辑区或预览区
* 支持自定义markdown语法解析器,语法高亮等
* 支持常用的markdown编辑功能，如加粗，斜体等等...
* 支持功能按钮插拔化，用户可以自定义扩展组件
* 支持编辑区和预览区同步滚动

### 开发心得

- 文本编辑

  大多数常见的编辑器，包括富文本编辑器，利用了某些元素如div的contenteditable属性，配合selection、range、execCommand等API，实现了富文本编辑功能。这里面的实现比较复杂，所以有了"[为什么都说富文本编辑器是天坑？](https://www.zhihu.com/question/38699645)"这个说法。

  而markdown编辑器，核心的处理内容为简单语法的纯文本，复杂度相对来说比较低，并且input标签自带onSelect事件，可以很方便的获取选择信息（选择起始位置和选择文本值），因此要想实现编辑功能，只需将要改动的内容进行文本转换，然后进行重新拼接首尾，大功告成。
  
- markdown解析

  考察了几个社区流行的markdown解析器，比较流行的有[markdown](https://www.npmjs.com/package/markdown), [markdown-it](https://www.npmjs.com/package/markdown-it), [marked](https://www.npmjs.com/package/marked) 等等。综合考虑扩展性以及稳定性，笔者推荐使用markdown-it作为markdown的词法解析器，因为该解析器有比较多的插件，并且支持语法高亮。

- 同步滚动

  当选择分栏编辑的时候，滚动左侧的编辑区，右侧的预览区能自动滚动到对应的区域。方案参考了《[手把手教你用 100行代码实现基于 react的 markdown 输入 + 即时预览在线编辑器（一）](https://github.com/accforgit/blog-data/blob/master/%E5%9C%A8%E7%BA%BF%E7%BC%96%E8%BE%91%E5%99%A8/README/README1.md)》。只需先计算出输入框容器元素与预览框容器元素之间最大scroll范围的比例值，然后根据主动滚动元素自身的scrollTop做相应的比例换算，即可知道对方区域的scrollTop值。

- 关于UI
 
  - 项目的字体库选择了Font Awesome风格，并且只选取了项目所需要的一些图标。
  - 编辑器的整体css均可通过全局覆盖的形式进行自定义。目前暂时只支持灰色主题。
  - 编辑器的显示区域包括菜单栏，编辑器，预览区，工具栏，通过配置组件的config属性，可以选择默认的展示区域。
  
### Install

```js
npm install react-markdown-editor-lite --save
```

### Props

| Property | Description | Type | default | Remarks |
| --- | --- | --- | --- | --- |
| value | markdown content | String | '' | required |
| style | component container style | Object | {height: '100%'} | not required |
| config | component config | Object | {view: {...}, logger: {...}} | not required |
| onChange | emitting when editor has changed | Function | ({html, md}) => {} | not required |
| onImageUpload | when image uploaded, callback emitting will get image markdown text | (file: File, callback: (url: string) => void) => void; | ({file, callback}) => {} | not required |
| renderHTML | Render markdown text to HTML. You can return either string, function or Promise | (text: string) => string|function|Promise | none | **required** |

### Example

``` js
'use strict';
import React from 'react'
import ReactDOM from 'react-dom'
import MdEditor from 'react-markdown-editor-lite'
import MarkdownIt from 'markdown-it'
import emoji from 'markdown-it-emoji'
import subscript from 'markdown-it-sub'
import superscript from 'markdown-it-sup'
import footnote from 'markdown-it-footnote'
import deflist from 'markdown-it-deflist'
import abbreviation from 'markdown-it-abbr'
import insert from 'markdown-it-ins'
import mark from 'markdown-it-mark'
import tasklists from 'markdown-it-task-lists'
import hljs from 'highlight.js'
import 'highlight.js/styles/atom-one-light.css'
// import 'highlight.js/styles/github.css'
import './index.less';

const MOCK_DATA = "I Love React."
export default class Demo extends React.Component {
  mdEditor = null
  mdParser = null
  constructor(props) {
    super(props)
    // initial a parsera
    this.mdParser = new MarkdownIt({
      html: true,
      linkify: true,
      typographer: true,
      highlight: function (str, lang) {
        if (lang && hljs.getLanguage(lang)) {
          try {
            return hljs.highlight(lang, str).value
          } catch (__) {}
        }    
        return '' // use external default escaping
      }
    })
    .use(emoji)
    .use(subscript)
    .use(superscript)
    .use(footnote)
    .use(deflist)
    .use(abbreviation)
    .use(insert)
    .use(mark)
    .use(tasklists, { enabled: this.taskLists })
    this.renderHTML = this.renderHTML.bind(this)
  }
  handleEditorChange({html, md}) {
    console.log('handleEditorChange', html, md)
  }
  handleImageUpload(file, callback) {
    const reader = new FileReader()
    reader.onload = () => {      
      const convertBase64UrlToBlob = (urlData) => {  
        let arr = urlData.split(','), mime = arr[0].match(/:(.*?);/)[1]
        let bstr = atob(arr[1])
        let n = bstr.length
        let u8arr = new Uint8Array(n)
        while (n--) {
          u8arr[n] = bstr.charCodeAt(n)
        }
        return new Blob([u8arr], {type:mime})
      }
      const blob = convertBase64UrlToBlob(reader.result)
      setTimeout(() => {
        // setTimeout 模拟异步上传图片
        // 当异步上传获取图片地址后，执行calback回调（参数为imageUrl字符串），即可将图片地址写入markdown
        callback('https://avatars0.githubusercontent.com/u/21263805?s=40&v=4')
      }, 1000)
    }
    reader.readAsDataURL(file)
  }
  renderHTML(text) {
    // 模拟异步渲染Markdown
    return new Promise((resolve) => {
      setTimeout(() => {
        resolve(this.mdParser.render(text))
      }, 1000)
    })
  }
  handleGetMdValue = () => {   
    this.mdEditor && alert(this.mdEditor.getMdValue())      
  }
  handleGetHtmlValue = () => {    
    this.mdEditor && alert(this.mdEditor.getHtmlValue())
  }
  render() {
    return (      
      <div>
        <nav>
          <button onClick={this.handleGetMdValue} >getMdValue</button>  
          <button onClick={this.handleGetHtmlValue} >getHtmlValue</button>  
        </nav>
        <section style="height: 500px">
          <MdEditor 
            ref={node => this.mdEditor = node}
            value={MOCK_DATA}
            style={{height: '400px'}}
            renderHTML={this.renderHTML}
            config={{
              view: {
                menu: true,
                md: true,
                html: true
              },
              imageUrl: 'https://octodex.github.com/images/minion.png'
            }}
            onChange={this.handleEditorChange} 
            onImageUpload={this.handleImageUpload}
          />
        </section>                        
      </div>      
    )
  }
}
```

### 最后

   欢迎大家使用和反馈，[项目地址](https://github.com/HarryChen0506/react-markdown-editor-lite) (https://github.com/HarryChen0506/react-markdown-editor-lite)， 你的点赞将是我莫大的动力😊

![1.png](https://s3.ca-central-1.amazonaws.com/res-blog-public/res-dev/blog_1636946743939_1.png)', firstPicture='', viewCount=83, createDate='Sun Nov 07 14:09:29 EST 2021', updateDate='Tue Jan 18 22:54:08 EST 2022'}}, total=null}
2022-01-19 17:33:16:582 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 410ms
2022-01-19 17:33:16:582 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 17:33:17:472 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 17:33:17:472 [http-nio-8081-exec-4] ERROR com.ivan.sunnyblog.web.aop.ControllerAspect Request failed
2022-01-19 17:33:17:472 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 17:33:17:472 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 17:33:17:472 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 17:33:17:472 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 17:33:17:472 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: null
2022-01-19 17:33:17:472 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 1301ms
2022-01-19 17:33:17:472 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 17:33:17:472 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 17:33:17:472 [http-nio-8081-exec-1] ERROR com.ivan.sunnyblog.web.aop.ControllerAspect Request failed
2022-01-19 17:33:17:472 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 17:33:17:472 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 17:33:17:472 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 17:33:17:472 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 17:33:17:472 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: null
2022-01-19 17:33:17:472 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 1301ms
2022-01-19 17:33:17:472 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 17:33:17:474 [http-nio-8081-exec-4] WARN  org.springframework.web.servlet.mvc.method.annotation.ExceptionHandlerExceptionResolver Resolved [org.springframework.web.util.NestedServletException: Handler dispatch failed; nested exception is java.lang.StackOverflowError]
2022-01-19 17:33:17:474 [http-nio-8081-exec-1] WARN  org.springframework.web.servlet.mvc.method.annotation.ExceptionHandlerExceptionResolver Resolved [org.springframework.web.util.NestedServletException: Handler dispatch failed; nested exception is java.lang.StackOverflowError]
2022-01-19 17:33:18:256 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 17:33:18:256 [http-nio-8081-exec-5] ERROR com.ivan.sunnyblog.web.aop.ControllerAspect Request failed
2022-01-19 17:33:18:256 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 17:33:18:256 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 17:33:18:256 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 17:33:18:256 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 17:33:18:256 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: null
2022-01-19 17:33:18:256 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 779ms
2022-01-19 17:33:18:256 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 17:33:18:257 [http-nio-8081-exec-5] WARN  org.springframework.web.servlet.mvc.method.annotation.ExceptionHandlerExceptionResolver Resolved [org.springframework.web.util.NestedServletException: Handler dispatch failed; nested exception is java.lang.StackOverflowError]
2022-01-19 17:33:41:948 [Thread-85] INFO  org.springframework.scheduling.concurrent.ThreadPoolTaskScheduler Shutting down ExecutorService 'taskScheduler'
2022-01-19 17:33:41:949 [Thread-85] INFO  org.springframework.scheduling.concurrent.ThreadPoolTaskExecutor Shutting down ExecutorService 'applicationTaskExecutor'
2022-01-19 17:33:41:950 [Thread-85] INFO  com.zaxxer.hikari.HikariDataSource HikariPool-1 - Shutdown initiated...
2022-01-19 17:33:41:950 [Thread-85] INFO  com.zaxxer.hikari.HikariDataSource HikariPool-1 - Shutdown completed.
2022-01-19 17:35:26:070 [restartedMain] INFO  com.ivan.sunnyblog.SunnyBlogApplication Starting SunnyBlogApplication on Jinghaos-MacBook-Air.local with PID 4334 (/Users/jinghaoliang/Documents/tech/Project/gitproject/blog/blog_backend/target/classes started by jinghaoliang in /Users/jinghaoliang/Documents/tech/Project/gitproject/blog/blog_backend)
2022-01-19 17:35:26:071 [restartedMain] INFO  com.ivan.sunnyblog.SunnyBlogApplication No active profile set, falling back to default profiles: default
2022-01-19 17:35:26:091 [restartedMain] INFO  org.springframework.boot.devtools.env.DevToolsPropertyDefaultsPostProcessor Devtools property defaults active! Set 'spring.devtools.add-properties' to 'false' to disable
2022-01-19 17:35:26:092 [restartedMain] INFO  org.springframework.boot.devtools.env.DevToolsPropertyDefaultsPostProcessor For additional web related logging consider setting the 'logging.level.web' property to 'DEBUG'
2022-01-19 17:35:26:385 [restartedMain] INFO  org.springframework.data.repository.config.RepositoryConfigurationDelegate Multiple Spring Data modules found, entering strict repository configuration mode!
2022-01-19 17:35:26:386 [restartedMain] INFO  org.springframework.data.repository.config.RepositoryConfigurationDelegate Bootstrapping Spring Data repositories in DEFAULT mode.
2022-01-19 17:35:26:407 [restartedMain] INFO  org.springframework.data.repository.config.RepositoryConfigurationDelegate Finished Spring Data repository scanning in 16ms. Found 0 repository interfaces.
2022-01-19 17:35:26:555 [restartedMain] INFO  o.s.context.support.PostProcessorRegistrationDelegate$BeanPostProcessorChecker Bean 'org.springframework.transaction.annotation.ProxyTransactionManagementConfiguration' of type [org.springframework.transaction.annotation.ProxyTransactionManagementConfiguration$$EnhancerBySpringCGLIB$$fbc72379] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2022-01-19 17:35:26:720 [restartedMain] INFO  org.springframework.boot.web.embedded.tomcat.TomcatWebServer Tomcat initialized with port(s): 8081 (http)
2022-01-19 17:35:26:726 [restartedMain] INFO  org.apache.coyote.http11.Http11NioProtocol Initializing ProtocolHandler ["http-nio-8081"]
2022-01-19 17:35:26:731 [restartedMain] INFO  org.apache.catalina.core.StandardService Starting service [Tomcat]
2022-01-19 17:35:26:731 [restartedMain] INFO  org.apache.catalina.core.StandardEngine Starting Servlet engine: [Apache Tomcat/9.0.21]
2022-01-19 17:35:26:796 [restartedMain] INFO  org.apache.catalina.core.ContainerBase.[Tomcat].[localhost].[/] Initializing Spring embedded WebApplicationContext
2022-01-19 17:35:26:796 [restartedMain] INFO  org.springframework.web.context.ContextLoader Root WebApplicationContext: initialization completed in 704 ms
2022-01-19 17:35:26:935 [restartedMain] INFO  com.zaxxer.hikari.HikariDataSource HikariPool-1 - Starting...
2022-01-19 17:35:26:970 [restartedMain] INFO  com.zaxxer.hikari.HikariDataSource HikariPool-1 - Start completed.
2022-01-19 17:36:00:533 [restartedMain] INFO  org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor Autowired annotation is not supported on static fields: static com.amazonaws.services.s3.AmazonS3 com.ivan.sunnyblog.web.res.S3ResourceManager.s3Client
2022-01-19 17:36:00:838 [restartedMain] INFO  org.springframework.scheduling.concurrent.ThreadPoolTaskExecutor Initializing ExecutorService 'applicationTaskExecutor'
2022-01-19 17:36:01:008 [restartedMain] INFO  org.springframework.scheduling.concurrent.ThreadPoolTaskScheduler Initializing ExecutorService 'taskScheduler'
2022-01-19 17:36:01:028 [restartedMain] INFO  org.springframework.boot.devtools.autoconfigure.OptionalLiveReloadServer LiveReload server is running on port 35729
2022-01-19 17:36:01:070 [restartedMain] INFO  org.apache.coyote.http11.Http11NioProtocol Starting ProtocolHandler ["http-nio-8081"]
2022-01-19 17:36:01:084 [restartedMain] INFO  org.springframework.boot.web.embedded.tomcat.TomcatWebServer Tomcat started on port(s): 8081 (http) with context path ''
2022-01-19 17:36:01:086 [restartedMain] INFO  com.ivan.sunnyblog.SunnyBlogApplication Started SunnyBlogApplication in 35.178 seconds (JVM running for 35.655)
2022-01-19 17:36:02:127 [http-nio-8081-exec-2] INFO  org.apache.catalina.core.ContainerBase.[Tomcat].[localhost].[/] Initializing Spring DispatcherServlet 'dispatcherServlet'
2022-01-19 17:36:02:128 [http-nio-8081-exec-2] INFO  org.springframework.web.servlet.DispatcherServlet Initializing Servlet 'dispatcherServlet'
2022-01-19 17:36:02:132 [http-nio-8081-exec-2] INFO  org.springframework.web.servlet.DispatcherServlet Completed initialization in 4 ms
2022-01-19 17:36:02:355 [http-nio-8081-exec-1] INFO  org.jooq.Constants 
                                      
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@  @@        @@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@        @@@@@@@@@@
@@@@@@@@@@@@@@@@  @@  @@    @@@@@@@@@@
@@@@@@@@@@  @@@@  @@  @@    @@@@@@@@@@
@@@@@@@@@@        @@        @@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@        @@        @@@@@@@@@@
@@@@@@@@@@    @@  @@  @@@@  @@@@@@@@@@
@@@@@@@@@@    @@  @@  @@@@  @@@@@@@@@@
@@@@@@@@@@        @@  @  @  @@@@@@@@@@
@@@@@@@@@@        @@        @@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@  @@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@  Thank you for using jOOQ 3.11.11
                                      
2022-01-19 17:36:02:418 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 17:36:02:418 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 17:36:02:418 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 17:36:02:418 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 17:36:02:418 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 17:36:02:418 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 17:36:02:418 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=20createdate=Wed Jan 19 11:47:08 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/26.png, replyComments=[CommentListVo{commentId=27createdate=Wed Jan 19 17:01:06 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/2.png, replyComments=null, CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='ljh19911025@gmail.com', nickname='sds', parentCommentNickname='tet', content='wwww', status='0'}}, CommentListVo{commentId=21createdate=Wed Jan 19 11:47:21 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/89.png, replyComments=[CommentListVo{commentId=22createdate=Wed Jan 19 11:47:39 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/75.png, replyComments=null, CommentVo=CommentVo{parentCommentId=21, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='sfs@ss.c', content='eeeeee', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='tet', content='ree', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='tet', parentCommentNickname='null', content='etet', status='0'}}], total=1}
2022-01-19 17:36:02:418 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 255ms
2022-01-19 17:36:02:418 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 17:36:02:421 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 17:36:02:421 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 17:36:02:421 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 17:36:02:421 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 17:36:02:421 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 17:36:02:421 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 17:36:02:421 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=20createdate=Wed Jan 19 11:47:08 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/26.png, replyComments=[CommentListVo{commentId=27createdate=Wed Jan 19 17:01:06 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/2.png, replyComments=null, CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='ljh19911025@gmail.com', nickname='sds', parentCommentNickname='tet', content='wwww', status='0'}}, CommentListVo{commentId=21createdate=Wed Jan 19 11:47:21 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/89.png, replyComments=[CommentListVo{commentId=22createdate=Wed Jan 19 11:47:39 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/75.png, replyComments=null, CommentVo=CommentVo{parentCommentId=21, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='sfs@ss.c', content='eeeeee', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='tet', content='ree', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='tet', parentCommentNickname='null', content='etet', status='0'}}], total=1}
2022-01-19 17:36:02:421 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 259ms
2022-01-19 17:36:02:421 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 17:36:02:474 [http-nio-8081-exec-1] INFO  io.lettuce.core.EpollProvider Starting without optional epoll library
2022-01-19 17:36:02:475 [http-nio-8081-exec-1] INFO  io.lettuce.core.KqueueProvider Starting without optional kqueue library
2022-01-19 17:36:02:537 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 17:36:02:538 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 17:36:02:538 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 17:36:02:538 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/article/10005
2022-01-19 17:36:02:538 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.ArticleController.getPublicArticleDetail
2022-01-19 17:36:02:538 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 17:36:02:538 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=ArticleVo{userInfo=UserInfoVo{userId=100001, nickName='ivan', userName='ivan', avatar='https://res-blog-public.s3.ca-central-1.amazonaws.com/default_avatar.jpg'}, category=CategoryVo{categoryId=1, name='Life ', articleCount=null}, BaseArticleVo{articleId=10005, status=1, type=1, title='dd', description='This is the doc of React markdown editor lite.
Enjoy!!', content='| Head | Head | Head | Head |
| --- | --- | --- | --- |
| Data | Data | Data | Data |
| Data | Data | Data | Data |

## 手把手教你写一个markdown编辑器

> 笔者在18年年末的时候接到一个开发任务——搭建一个AI项目的开放平台，其中的产品文档为转化为HTML格式的markdown文档。考虑到文档的即时更新，将文档信息做成了Ajax接口的形式。因此管理后台只需将textarea表单的内容通过markdown解析器进行HTML格式转化，然后将markdown内容和经转化的HTML文档都保存到数据库即可。
> 基本需求完成后，为了更好的用户体验，考虑将常用的编辑功能添加进来。改进版不仅支持了常用的文本编辑功能，还实现的UI界面的配置化，自定义语法解析器。本着造福伸手党的目的，以及积累些开源经验，笔者将该react 组件 [react-markdown-editor-lite](https://github.com/HarryChen0506/react-markdown-editor-lite) 进行了封装改造，并且发布到了开源社区。

### 预览
在线体验 [https://harrychen0506.github.io/react-markdown-editor-lite/](https://harrychen0506.github.io/react-markdown-editor-lite/)

![image](https://github.com//HarryChen0506/react-markdown-editor-lite/blob/master/image/react-markdown-editor-lite-v1.0.0.PNG?raw=true)

### 特点
* 轻量、基于React
* UI可配置, 如只显示编辑区或预览区
* 支持自定义markdown语法解析器,语法高亮等
* 支持常用的markdown编辑功能，如加粗，斜体等等...
* 支持功能按钮插拔化，用户可以自定义扩展组件
* 支持编辑区和预览区同步滚动

### 开发心得

- 文本编辑

  大多数常见的编辑器，包括富文本编辑器，利用了某些元素如div的contenteditable属性，配合selection、range、execCommand等API，实现了富文本编辑功能。这里面的实现比较复杂，所以有了"[为什么都说富文本编辑器是天坑？](https://www.zhihu.com/question/38699645)"这个说法。

  而markdown编辑器，核心的处理内容为简单语法的纯文本，复杂度相对来说比较低，并且input标签自带onSelect事件，可以很方便的获取选择信息（选择起始位置和选择文本值），因此要想实现编辑功能，只需将要改动的内容进行文本转换，然后进行重新拼接首尾，大功告成。
  
- markdown解析

  考察了几个社区流行的markdown解析器，比较流行的有[markdown](https://www.npmjs.com/package/markdown), [markdown-it](https://www.npmjs.com/package/markdown-it), [marked](https://www.npmjs.com/package/marked) 等等。综合考虑扩展性以及稳定性，笔者推荐使用markdown-it作为markdown的词法解析器，因为该解析器有比较多的插件，并且支持语法高亮。

- 同步滚动

  当选择分栏编辑的时候，滚动左侧的编辑区，右侧的预览区能自动滚动到对应的区域。方案参考了《[手把手教你用 100行代码实现基于 react的 markdown 输入 + 即时预览在线编辑器（一）](https://github.com/accforgit/blog-data/blob/master/%E5%9C%A8%E7%BA%BF%E7%BC%96%E8%BE%91%E5%99%A8/README/README1.md)》。只需先计算出输入框容器元素与预览框容器元素之间最大scroll范围的比例值，然后根据主动滚动元素自身的scrollTop做相应的比例换算，即可知道对方区域的scrollTop值。

- 关于UI
 
  - 项目的字体库选择了Font Awesome风格，并且只选取了项目所需要的一些图标。
  - 编辑器的整体css均可通过全局覆盖的形式进行自定义。目前暂时只支持灰色主题。
  - 编辑器的显示区域包括菜单栏，编辑器，预览区，工具栏，通过配置组件的config属性，可以选择默认的展示区域。
  
### Install

```js
npm install react-markdown-editor-lite --save
```

### Props

| Property | Description | Type | default | Remarks |
| --- | --- | --- | --- | --- |
| value | markdown content | String | '' | required |
| style | component container style | Object | {height: '100%'} | not required |
| config | component config | Object | {view: {...}, logger: {...}} | not required |
| onChange | emitting when editor has changed | Function | ({html, md}) => {} | not required |
| onImageUpload | when image uploaded, callback emitting will get image markdown text | (file: File, callback: (url: string) => void) => void; | ({file, callback}) => {} | not required |
| renderHTML | Render markdown text to HTML. You can return either string, function or Promise | (text: string) => string|function|Promise | none | **required** |

### Example

``` js
'use strict';
import React from 'react'
import ReactDOM from 'react-dom'
import MdEditor from 'react-markdown-editor-lite'
import MarkdownIt from 'markdown-it'
import emoji from 'markdown-it-emoji'
import subscript from 'markdown-it-sub'
import superscript from 'markdown-it-sup'
import footnote from 'markdown-it-footnote'
import deflist from 'markdown-it-deflist'
import abbreviation from 'markdown-it-abbr'
import insert from 'markdown-it-ins'
import mark from 'markdown-it-mark'
import tasklists from 'markdown-it-task-lists'
import hljs from 'highlight.js'
import 'highlight.js/styles/atom-one-light.css'
// import 'highlight.js/styles/github.css'
import './index.less';

const MOCK_DATA = "I Love React."
export default class Demo extends React.Component {
  mdEditor = null
  mdParser = null
  constructor(props) {
    super(props)
    // initial a parsera
    this.mdParser = new MarkdownIt({
      html: true,
      linkify: true,
      typographer: true,
      highlight: function (str, lang) {
        if (lang && hljs.getLanguage(lang)) {
          try {
            return hljs.highlight(lang, str).value
          } catch (__) {}
        }    
        return '' // use external default escaping
      }
    })
    .use(emoji)
    .use(subscript)
    .use(superscript)
    .use(footnote)
    .use(deflist)
    .use(abbreviation)
    .use(insert)
    .use(mark)
    .use(tasklists, { enabled: this.taskLists })
    this.renderHTML = this.renderHTML.bind(this)
  }
  handleEditorChange({html, md}) {
    console.log('handleEditorChange', html, md)
  }
  handleImageUpload(file, callback) {
    const reader = new FileReader()
    reader.onload = () => {      
      const convertBase64UrlToBlob = (urlData) => {  
        let arr = urlData.split(','), mime = arr[0].match(/:(.*?);/)[1]
        let bstr = atob(arr[1])
        let n = bstr.length
        let u8arr = new Uint8Array(n)
        while (n--) {
          u8arr[n] = bstr.charCodeAt(n)
        }
        return new Blob([u8arr], {type:mime})
      }
      const blob = convertBase64UrlToBlob(reader.result)
      setTimeout(() => {
        // setTimeout 模拟异步上传图片
        // 当异步上传获取图片地址后，执行calback回调（参数为imageUrl字符串），即可将图片地址写入markdown
        callback('https://avatars0.githubusercontent.com/u/21263805?s=40&v=4')
      }, 1000)
    }
    reader.readAsDataURL(file)
  }
  renderHTML(text) {
    // 模拟异步渲染Markdown
    return new Promise((resolve) => {
      setTimeout(() => {
        resolve(this.mdParser.render(text))
      }, 1000)
    })
  }
  handleGetMdValue = () => {   
    this.mdEditor && alert(this.mdEditor.getMdValue())      
  }
  handleGetHtmlValue = () => {    
    this.mdEditor && alert(this.mdEditor.getHtmlValue())
  }
  render() {
    return (      
      <div>
        <nav>
          <button onClick={this.handleGetMdValue} >getMdValue</button>  
          <button onClick={this.handleGetHtmlValue} >getHtmlValue</button>  
        </nav>
        <section style="height: 500px">
          <MdEditor 
            ref={node => this.mdEditor = node}
            value={MOCK_DATA}
            style={{height: '400px'}}
            renderHTML={this.renderHTML}
            config={{
              view: {
                menu: true,
                md: true,
                html: true
              },
              imageUrl: 'https://octodex.github.com/images/minion.png'
            }}
            onChange={this.handleEditorChange} 
            onImageUpload={this.handleImageUpload}
          />
        </section>                        
      </div>      
    )
  }
}
```

### 最后

   欢迎大家使用和反馈，[项目地址](https://github.com/HarryChen0506/react-markdown-editor-lite) (https://github.com/HarryChen0506/react-markdown-editor-lite)， 你的点赞将是我莫大的动力😊

![1.png](https://s3.ca-central-1.amazonaws.com/res-blog-public/res-dev/blog_1636946743939_1.png)', firstPicture='', viewCount=83, createDate='Sun Nov 07 14:09:29 EST 2021', updateDate='Tue Jan 18 22:54:08 EST 2022'}}, total=null}
2022-01-19 17:36:02:538 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 381ms
2022-01-19 17:36:02:538 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 17:36:02:635 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 17:36:02:635 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 17:36:02:635 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 17:36:02:635 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 17:36:02:635 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 17:36:02:636 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 17:36:02:636 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=20createdate=Wed Jan 19 11:47:08 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/26.png, replyComments=[CommentListVo{commentId=27createdate=Wed Jan 19 17:01:06 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/2.png, replyComments=null, CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='ljh19911025@gmail.com', nickname='sds', parentCommentNickname='tet', content='wwww', status='0'}}, CommentListVo{commentId=21createdate=Wed Jan 19 11:47:21 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/89.png, replyComments=[CommentListVo{commentId=22createdate=Wed Jan 19 11:47:39 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/75.png, replyComments=null, CommentVo=CommentVo{parentCommentId=21, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='sfs@ss.c', content='eeeeee', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='tet', content='ree', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='tet', parentCommentNickname='null', content='etet', status='0'}}], total=1}
2022-01-19 17:36:02:646 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 11ms
2022-01-19 17:36:02:646 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 17:38:51:185 [Thread-78] INFO  org.springframework.scheduling.concurrent.ThreadPoolTaskScheduler Shutting down ExecutorService 'taskScheduler'
2022-01-19 17:38:51:186 [Thread-78] INFO  org.springframework.scheduling.concurrent.ThreadPoolTaskExecutor Shutting down ExecutorService 'applicationTaskExecutor'
2022-01-19 17:38:51:187 [Thread-78] INFO  com.zaxxer.hikari.HikariDataSource HikariPool-1 - Shutdown initiated...
2022-01-19 17:38:51:188 [Thread-78] INFO  com.zaxxer.hikari.HikariDataSource HikariPool-1 - Shutdown completed.
2022-01-19 17:38:54:650 [restartedMain] INFO  com.ivan.sunnyblog.SunnyBlogApplication Starting SunnyBlogApplication on Jinghaos-MacBook-Air.local with PID 4377 (/Users/jinghaoliang/Documents/tech/Project/gitproject/blog/blog_backend/target/classes started by jinghaoliang in /Users/jinghaoliang/Documents/tech/Project/gitproject/blog/blog_backend)
2022-01-19 17:38:54:651 [restartedMain] INFO  com.ivan.sunnyblog.SunnyBlogApplication No active profile set, falling back to default profiles: default
2022-01-19 17:38:54:670 [restartedMain] INFO  org.springframework.boot.devtools.env.DevToolsPropertyDefaultsPostProcessor Devtools property defaults active! Set 'spring.devtools.add-properties' to 'false' to disable
2022-01-19 17:38:54:670 [restartedMain] INFO  org.springframework.boot.devtools.env.DevToolsPropertyDefaultsPostProcessor For additional web related logging consider setting the 'logging.level.web' property to 'DEBUG'
2022-01-19 17:38:54:974 [restartedMain] INFO  org.springframework.data.repository.config.RepositoryConfigurationDelegate Multiple Spring Data modules found, entering strict repository configuration mode!
2022-01-19 17:38:54:975 [restartedMain] INFO  org.springframework.data.repository.config.RepositoryConfigurationDelegate Bootstrapping Spring Data repositories in DEFAULT mode.
2022-01-19 17:38:54:997 [restartedMain] INFO  org.springframework.data.repository.config.RepositoryConfigurationDelegate Finished Spring Data repository scanning in 16ms. Found 0 repository interfaces.
2022-01-19 17:38:55:145 [restartedMain] INFO  o.s.context.support.PostProcessorRegistrationDelegate$BeanPostProcessorChecker Bean 'org.springframework.transaction.annotation.ProxyTransactionManagementConfiguration' of type [org.springframework.transaction.annotation.ProxyTransactionManagementConfiguration$$EnhancerBySpringCGLIB$$20afea13] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2022-01-19 17:38:55:311 [restartedMain] INFO  org.springframework.boot.web.embedded.tomcat.TomcatWebServer Tomcat initialized with port(s): 8081 (http)
2022-01-19 17:38:55:317 [restartedMain] INFO  org.apache.coyote.http11.Http11NioProtocol Initializing ProtocolHandler ["http-nio-8081"]
2022-01-19 17:38:55:322 [restartedMain] INFO  org.apache.catalina.core.StandardService Starting service [Tomcat]
2022-01-19 17:38:55:322 [restartedMain] INFO  org.apache.catalina.core.StandardEngine Starting Servlet engine: [Apache Tomcat/9.0.21]
2022-01-19 17:38:55:384 [restartedMain] INFO  org.apache.catalina.core.ContainerBase.[Tomcat].[localhost].[/] Initializing Spring embedded WebApplicationContext
2022-01-19 17:38:55:384 [restartedMain] INFO  org.springframework.web.context.ContextLoader Root WebApplicationContext: initialization completed in 714 ms
2022-01-19 17:38:55:526 [restartedMain] INFO  com.zaxxer.hikari.HikariDataSource HikariPool-1 - Starting...
2022-01-19 17:38:55:562 [restartedMain] INFO  com.zaxxer.hikari.HikariDataSource HikariPool-1 - Start completed.
2022-01-19 17:39:06:837 [restartedMain] INFO  org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor Autowired annotation is not supported on static fields: static com.amazonaws.services.s3.AmazonS3 com.ivan.sunnyblog.web.res.S3ResourceManager.s3Client
2022-01-19 17:39:07:189 [restartedMain] INFO  org.springframework.scheduling.concurrent.ThreadPoolTaskExecutor Initializing ExecutorService 'applicationTaskExecutor'
2022-01-19 17:39:07:346 [restartedMain] INFO  org.springframework.scheduling.concurrent.ThreadPoolTaskScheduler Initializing ExecutorService 'taskScheduler'
2022-01-19 17:39:07:367 [restartedMain] INFO  org.springframework.boot.devtools.autoconfigure.OptionalLiveReloadServer LiveReload server is running on port 35729
2022-01-19 17:39:07:408 [restartedMain] INFO  org.apache.coyote.http11.Http11NioProtocol Starting ProtocolHandler ["http-nio-8081"]
2022-01-19 17:39:07:422 [restartedMain] INFO  org.springframework.boot.web.embedded.tomcat.TomcatWebServer Tomcat started on port(s): 8081 (http) with context path ''
2022-01-19 17:39:07:424 [restartedMain] INFO  com.ivan.sunnyblog.SunnyBlogApplication Started SunnyBlogApplication in 12.939 seconds (JVM running for 13.486)
2022-01-19 17:39:23:626 [http-nio-8081-exec-3] INFO  org.apache.catalina.core.ContainerBase.[Tomcat].[localhost].[/] Initializing Spring DispatcherServlet 'dispatcherServlet'
2022-01-19 17:39:23:626 [http-nio-8081-exec-3] INFO  org.springframework.web.servlet.DispatcherServlet Initializing Servlet 'dispatcherServlet'
2022-01-19 17:39:23:637 [http-nio-8081-exec-3] INFO  org.springframework.web.servlet.DispatcherServlet Completed initialization in 11 ms
2022-01-19 17:39:23:881 [http-nio-8081-exec-1] INFO  org.jooq.Constants 
                                      
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@  @@        @@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@        @@@@@@@@@@
@@@@@@@@@@@@@@@@  @@  @@    @@@@@@@@@@
@@@@@@@@@@  @@@@  @@  @@    @@@@@@@@@@
@@@@@@@@@@        @@        @@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@        @@        @@@@@@@@@@
@@@@@@@@@@    @@  @@  @@@@  @@@@@@@@@@
@@@@@@@@@@    @@  @@  @@@@  @@@@@@@@@@
@@@@@@@@@@        @@  @  @  @@@@@@@@@@
@@@@@@@@@@        @@        @@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@  @@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@  Thank you for using jOOQ 3.11.11
                                      
2022-01-19 17:39:23:940 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 17:39:23:940 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 17:39:23:940 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 17:39:23:940 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 17:39:23:940 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 17:39:23:940 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 17:39:23:940 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 17:39:23:940 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 17:39:23:940 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 17:39:23:940 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 17:39:23:940 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 17:39:23:940 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 17:39:23:941 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=20createdate=Wed Jan 19 11:47:08 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/26.png, replyComments=[CommentListVo{commentId=21createdate=Wed Jan 19 11:47:21 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/89.png, replyComments=[CommentListVo{commentId=22createdate=Wed Jan 19 11:47:39 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/75.png, replyComments=null, CommentVo=CommentVo{parentCommentId=21, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='sfs@ss.c', content='eeeeee', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='tet', content='ree', status='0'}}, CommentListVo{commentId=27createdate=Wed Jan 19 17:01:06 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/2.png, replyComments=null, CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='ljh19911025@gmail.com', nickname='sds', parentCommentNickname='tet', content='wwww', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='tet', parentCommentNickname='null', content='etet', status='0'}}], total=1}
2022-01-19 17:39:23:941 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=20createdate=Wed Jan 19 11:47:08 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/26.png, replyComments=[CommentListVo{commentId=21createdate=Wed Jan 19 11:47:21 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/89.png, replyComments=[CommentListVo{commentId=22createdate=Wed Jan 19 11:47:39 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/75.png, replyComments=null, CommentVo=CommentVo{parentCommentId=21, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='sfs@ss.c', content='eeeeee', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='tet', content='ree', status='0'}}, CommentListVo{commentId=27createdate=Wed Jan 19 17:01:06 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/2.png, replyComments=null, CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='ljh19911025@gmail.com', nickname='sds', parentCommentNickname='tet', content='wwww', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='tet', parentCommentNickname='null', content='etet', status='0'}}], total=1}
2022-01-19 17:39:23:941 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 262ms
2022-01-19 17:39:23:941 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 257ms
2022-01-19 17:39:23:941 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 17:39:23:941 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 17:39:23:993 [http-nio-8081-exec-1] INFO  io.lettuce.core.EpollProvider Starting without optional epoll library
2022-01-19 17:39:23:993 [http-nio-8081-exec-1] INFO  io.lettuce.core.KqueueProvider Starting without optional kqueue library
2022-01-19 17:39:24:057 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 17:39:24:057 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 17:39:24:057 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 17:39:24:057 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/article/10005
2022-01-19 17:39:24:057 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.ArticleController.getPublicArticleDetail
2022-01-19 17:39:24:057 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 17:39:24:057 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=ArticleVo{userInfo=UserInfoVo{userId=100001, nickName='ivan', userName='ivan', avatar='https://res-blog-public.s3.ca-central-1.amazonaws.com/default_avatar.jpg'}, category=CategoryVo{categoryId=1, name='Life ', articleCount=null}, BaseArticleVo{articleId=10005, status=1, type=1, title='dd', description='This is the doc of React markdown editor lite.
Enjoy!!', content='| Head | Head | Head | Head |
| --- | --- | --- | --- |
| Data | Data | Data | Data |
| Data | Data | Data | Data |

## 手把手教你写一个markdown编辑器

> 笔者在18年年末的时候接到一个开发任务——搭建一个AI项目的开放平台，其中的产品文档为转化为HTML格式的markdown文档。考虑到文档的即时更新，将文档信息做成了Ajax接口的形式。因此管理后台只需将textarea表单的内容通过markdown解析器进行HTML格式转化，然后将markdown内容和经转化的HTML文档都保存到数据库即可。
> 基本需求完成后，为了更好的用户体验，考虑将常用的编辑功能添加进来。改进版不仅支持了常用的文本编辑功能，还实现的UI界面的配置化，自定义语法解析器。本着造福伸手党的目的，以及积累些开源经验，笔者将该react 组件 [react-markdown-editor-lite](https://github.com/HarryChen0506/react-markdown-editor-lite) 进行了封装改造，并且发布到了开源社区。

### 预览
在线体验 [https://harrychen0506.github.io/react-markdown-editor-lite/](https://harrychen0506.github.io/react-markdown-editor-lite/)

![image](https://github.com//HarryChen0506/react-markdown-editor-lite/blob/master/image/react-markdown-editor-lite-v1.0.0.PNG?raw=true)

### 特点
* 轻量、基于React
* UI可配置, 如只显示编辑区或预览区
* 支持自定义markdown语法解析器,语法高亮等
* 支持常用的markdown编辑功能，如加粗，斜体等等...
* 支持功能按钮插拔化，用户可以自定义扩展组件
* 支持编辑区和预览区同步滚动

### 开发心得

- 文本编辑

  大多数常见的编辑器，包括富文本编辑器，利用了某些元素如div的contenteditable属性，配合selection、range、execCommand等API，实现了富文本编辑功能。这里面的实现比较复杂，所以有了"[为什么都说富文本编辑器是天坑？](https://www.zhihu.com/question/38699645)"这个说法。

  而markdown编辑器，核心的处理内容为简单语法的纯文本，复杂度相对来说比较低，并且input标签自带onSelect事件，可以很方便的获取选择信息（选择起始位置和选择文本值），因此要想实现编辑功能，只需将要改动的内容进行文本转换，然后进行重新拼接首尾，大功告成。
  
- markdown解析

  考察了几个社区流行的markdown解析器，比较流行的有[markdown](https://www.npmjs.com/package/markdown), [markdown-it](https://www.npmjs.com/package/markdown-it), [marked](https://www.npmjs.com/package/marked) 等等。综合考虑扩展性以及稳定性，笔者推荐使用markdown-it作为markdown的词法解析器，因为该解析器有比较多的插件，并且支持语法高亮。

- 同步滚动

  当选择分栏编辑的时候，滚动左侧的编辑区，右侧的预览区能自动滚动到对应的区域。方案参考了《[手把手教你用 100行代码实现基于 react的 markdown 输入 + 即时预览在线编辑器（一）](https://github.com/accforgit/blog-data/blob/master/%E5%9C%A8%E7%BA%BF%E7%BC%96%E8%BE%91%E5%99%A8/README/README1.md)》。只需先计算出输入框容器元素与预览框容器元素之间最大scroll范围的比例值，然后根据主动滚动元素自身的scrollTop做相应的比例换算，即可知道对方区域的scrollTop值。

- 关于UI
 
  - 项目的字体库选择了Font Awesome风格，并且只选取了项目所需要的一些图标。
  - 编辑器的整体css均可通过全局覆盖的形式进行自定义。目前暂时只支持灰色主题。
  - 编辑器的显示区域包括菜单栏，编辑器，预览区，工具栏，通过配置组件的config属性，可以选择默认的展示区域。
  
### Install

```js
npm install react-markdown-editor-lite --save
```

### Props

| Property | Description | Type | default | Remarks |
| --- | --- | --- | --- | --- |
| value | markdown content | String | '' | required |
| style | component container style | Object | {height: '100%'} | not required |
| config | component config | Object | {view: {...}, logger: {...}} | not required |
| onChange | emitting when editor has changed | Function | ({html, md}) => {} | not required |
| onImageUpload | when image uploaded, callback emitting will get image markdown text | (file: File, callback: (url: string) => void) => void; | ({file, callback}) => {} | not required |
| renderHTML | Render markdown text to HTML. You can return either string, function or Promise | (text: string) => string|function|Promise | none | **required** |

### Example

``` js
'use strict';
import React from 'react'
import ReactDOM from 'react-dom'
import MdEditor from 'react-markdown-editor-lite'
import MarkdownIt from 'markdown-it'
import emoji from 'markdown-it-emoji'
import subscript from 'markdown-it-sub'
import superscript from 'markdown-it-sup'
import footnote from 'markdown-it-footnote'
import deflist from 'markdown-it-deflist'
import abbreviation from 'markdown-it-abbr'
import insert from 'markdown-it-ins'
import mark from 'markdown-it-mark'
import tasklists from 'markdown-it-task-lists'
import hljs from 'highlight.js'
import 'highlight.js/styles/atom-one-light.css'
// import 'highlight.js/styles/github.css'
import './index.less';

const MOCK_DATA = "I Love React."
export default class Demo extends React.Component {
  mdEditor = null
  mdParser = null
  constructor(props) {
    super(props)
    // initial a parsera
    this.mdParser = new MarkdownIt({
      html: true,
      linkify: true,
      typographer: true,
      highlight: function (str, lang) {
        if (lang && hljs.getLanguage(lang)) {
          try {
            return hljs.highlight(lang, str).value
          } catch (__) {}
        }    
        return '' // use external default escaping
      }
    })
    .use(emoji)
    .use(subscript)
    .use(superscript)
    .use(footnote)
    .use(deflist)
    .use(abbreviation)
    .use(insert)
    .use(mark)
    .use(tasklists, { enabled: this.taskLists })
    this.renderHTML = this.renderHTML.bind(this)
  }
  handleEditorChange({html, md}) {
    console.log('handleEditorChange', html, md)
  }
  handleImageUpload(file, callback) {
    const reader = new FileReader()
    reader.onload = () => {      
      const convertBase64UrlToBlob = (urlData) => {  
        let arr = urlData.split(','), mime = arr[0].match(/:(.*?);/)[1]
        let bstr = atob(arr[1])
        let n = bstr.length
        let u8arr = new Uint8Array(n)
        while (n--) {
          u8arr[n] = bstr.charCodeAt(n)
        }
        return new Blob([u8arr], {type:mime})
      }
      const blob = convertBase64UrlToBlob(reader.result)
      setTimeout(() => {
        // setTimeout 模拟异步上传图片
        // 当异步上传获取图片地址后，执行calback回调（参数为imageUrl字符串），即可将图片地址写入markdown
        callback('https://avatars0.githubusercontent.com/u/21263805?s=40&v=4')
      }, 1000)
    }
    reader.readAsDataURL(file)
  }
  renderHTML(text) {
    // 模拟异步渲染Markdown
    return new Promise((resolve) => {
      setTimeout(() => {
        resolve(this.mdParser.render(text))
      }, 1000)
    })
  }
  handleGetMdValue = () => {   
    this.mdEditor && alert(this.mdEditor.getMdValue())      
  }
  handleGetHtmlValue = () => {    
    this.mdEditor && alert(this.mdEditor.getHtmlValue())
  }
  render() {
    return (      
      <div>
        <nav>
          <button onClick={this.handleGetMdValue} >getMdValue</button>  
          <button onClick={this.handleGetHtmlValue} >getHtmlValue</button>  
        </nav>
        <section style="height: 500px">
          <MdEditor 
            ref={node => this.mdEditor = node}
            value={MOCK_DATA}
            style={{height: '400px'}}
            renderHTML={this.renderHTML}
            config={{
              view: {
                menu: true,
                md: true,
                html: true
              },
              imageUrl: 'https://octodex.github.com/images/minion.png'
            }}
            onChange={this.handleEditorChange} 
            onImageUpload={this.handleImageUpload}
          />
        </section>                        
      </div>      
    )
  }
}
```

### 最后

   欢迎大家使用和反馈，[项目地址](https://github.com/HarryChen0506/react-markdown-editor-lite) (https://github.com/HarryChen0506/react-markdown-editor-lite)， 你的点赞将是我莫大的动力😊

![1.png](https://s3.ca-central-1.amazonaws.com/res-blog-public/res-dev/blog_1636946743939_1.png)', firstPicture='', viewCount=83, createDate='Sun Nov 07 14:09:29 EST 2021', updateDate='Tue Jan 18 22:54:08 EST 2022'}}, total=null}
2022-01-19 17:39:24:057 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 388ms
2022-01-19 17:39:24:057 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 17:39:24:154 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 17:39:24:154 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 17:39:24:154 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 17:39:24:154 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 17:39:24:154 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 17:39:24:154 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 17:39:24:154 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=20createdate=Wed Jan 19 11:47:08 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/26.png, replyComments=[CommentListVo{commentId=21createdate=Wed Jan 19 11:47:21 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/89.png, replyComments=[CommentListVo{commentId=22createdate=Wed Jan 19 11:47:39 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/75.png, replyComments=null, CommentVo=CommentVo{parentCommentId=21, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='sfs@ss.c', content='eeeeee', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='tet', content='ree', status='0'}}, CommentListVo{commentId=27createdate=Wed Jan 19 17:01:06 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/2.png, replyComments=null, CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='ljh19911025@gmail.com', nickname='sds', parentCommentNickname='tet', content='wwww', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='tet', parentCommentNickname='null', content='etet', status='0'}}], total=1}
2022-01-19 17:39:24:154 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 26ms
2022-01-19 17:39:24:154 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 17:41:06:492 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 17:41:06:492 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 17:41:06:492 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 17:41:06:492 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/articles/hot
2022-01-19 17:41:06:493 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.ArticleController.getHotArticles
2022-01-19 17:41:06:493 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: {}
2022-01-19 17:41:06:493 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[ArticleVo{userInfo=null, category=null, BaseArticleVo{articleId=10004, status=null, type=null, title='Spring boot', description='null', content='null', firstPicture='null', viewCount=174, createDate='Tue Oct 12 15:58:26 EDT 2021', updateDate='null'}}, ArticleVo{userInfo=null, category=null, BaseArticleVo{articleId=10005, status=null, type=null, title='dd', description='null', content='null', firstPicture='null', viewCount=83, createDate='Sun Nov 07 14:09:29 EST 2021', updateDate='null'}}, ArticleVo{userInfo=null, category=null, BaseArticleVo{articleId=10003, status=null, type=null, title='dd', description='null', content='null', firstPicture='null', viewCount=0, createDate='Tue Oct 12 15:57:33 EDT 2021', updateDate='null'}}], total=null}
2022-01-19 17:41:06:493 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 16ms
2022-01-19 17:41:06:493 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 17:41:06:494 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 17:41:06:494 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 17:41:06:494 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 17:41:06:494 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/categories
2022-01-19 17:41:06:494 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CategoryContoller.getCategories
2022-01-19 17:41:06:494 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: {}
2022-01-19 17:41:06:494 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CategoryVo{categoryId=2, name='liddffd', articleCount=1}, CategoryVo{categoryId=1, name='Life ', articleCount=2}], total=null}
2022-01-19 17:41:06:495 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 18ms
2022-01-19 17:41:06:495 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 17:41:06:507 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 17:41:06:508 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 17:41:06:508 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 17:41:06:508 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/articles
2022-01-19 17:41:06:508 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.ArticleController.getPublicArticles
2022-01-19 17:41:06:508 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: SearchVo{page=1, limit=10, categoryId=null, total=null}
2022-01-19 17:41:06:508 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[ArticleVo{userInfo=UserInfoVo{userId=100001, nickName='ivan', userName='ivan', avatar='https://res-blog-public.s3.ca-central-1.amazonaws.com/default_avatar.jpg'}, category=CategoryVo{categoryId=1, name='Life ', articleCount=null}, BaseArticleVo{articleId=10005, status=1, type=1, title='dd', description='This is the doc of React markdown editor lite.
Enjoy!!', content='null', firstPicture='', viewCount=83, createDate='Sun Nov 07 14:09:29 EST 2021', updateDate='Tue Jan 18 22:54:08 EST 2022'}}, ArticleVo{userInfo=UserInfoVo{userId=100001, nickName='ivan', userName='ivan', avatar='https://res-blog-public.s3.ca-central-1.amazonaws.com/default_avatar.jpg'}, category=CategoryVo{categoryId=2, name='liddffd', articleCount=null}, BaseArticleVo{articleId=10004, status=1, type=2, title='Spring boot', description='rerwerwer', content='null', firstPicture='', viewCount=174, createDate='Tue Oct 12 15:58:26 EDT 2021', updateDate='Tue Jan 18 22:56:37 EST 2022'}}, ArticleVo{userInfo=UserInfoVo{userId=100001, nickName='ivan', userName='ivan', avatar='https://res-blog-public.s3.ca-central-1.amazonaws.com/default_avatar.jpg'}, category=CategoryVo{categoryId=1, name='Life ', articleCount=null}, BaseArticleVo{articleId=10003, status=1, type=1, title='dd', description='test', content='null', firstPicture='', viewCount=0, createDate='Tue Oct 12 15:57:33 EDT 2021', updateDate='Tue Jan 18 22:53:20 EST 2022'}}], total=3}
2022-01-19 17:41:06:508 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 31ms
2022-01-19 17:41:06:508 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 17:41:07:865 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 17:41:07:866 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 17:41:07:866 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 17:41:07:866 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/article/10004
2022-01-19 17:41:07:866 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.ArticleController.getPublicArticleDetail
2022-01-19 17:41:07:866 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10004
2022-01-19 17:41:07:866 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=ArticleVo{userInfo=UserInfoVo{userId=100001, nickName='ivan', userName='ivan', avatar='https://res-blog-public.s3.ca-central-1.amazonaws.com/default_avatar.jpg'}, category=CategoryVo{categoryId=2, name='liddffd', articleCount=null}, BaseArticleVo{articleId=10004, status=1, type=2, title='Spring boot', description='rerwerwer', content='rererer![test.png](https://s3.ca-central-1.amazonaws.com/res-blog-public/res-dev/blog_1636947281578_test.png)', firstPicture='', viewCount=174, createDate='Tue Oct 12 15:58:26 EDT 2021', updateDate='Tue Jan 18 22:56:37 EST 2022'}}, total=null}
2022-01-19 17:41:07:866 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 8ms
2022-01-19 17:41:07:866 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 17:41:07:877 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 17:41:07:877 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 17:41:07:877 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 17:41:07:877 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10004
2022-01-19 17:41:07:877 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 17:41:07:877 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10004
2022-01-19 17:41:07:877 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=18createdate=Sun Jan 09 10:06:04 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/81.png, replyComments=null, CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsdf@qq.com', nickname='sf', parentCommentNickname='null', content='sdfsf', status='0'}}, CommentListVo{commentId=17createdate=Sun Jan 09 10:05:33 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/57.png, replyComments=null, CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsd@Ck.com', nickname='sfsf', parentCommentNickname='null', content='hdsfsd', status='0'}}, CommentListVo{commentId=16createdate=Sun Jan 09 10:03:48 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/90.png, replyComments=[CommentListVo{commentId=19createdate=Mon Jan 10 09:47:47 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/73.png, replyComments=null, CommentVo=CommentVo{parentCommentId=16, articleId=10004, email='sdfsd@Ck.com', nickname='ivan', parentCommentNickname='sfs@ss.c', content='dfjgg', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='null', content='what?', status='0'}}, CommentListVo{commentId=11createdate=Wed Dec 01 22:44:50 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=12createdate=Wed Dec 01 22:45:18 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=13createdate=Wed Dec 01 22:45:56 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=14createdate=Wed Dec 01 22:46:22 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=26createdate=Wed Jan 19 11:57:50 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/49.png, replyComments=null, CommentVo=CommentVo{parentCommentId=14, articleId=10004, email='sdfsd@Ck.com', nickname='ivan', parentCommentNickname='haha', content='222', status='0'}}], CommentVo=CommentVo{parentCommentId=13, articleId=10004, email='hah@gmail.com', nickname='haha', parentCommentNickname='test', content='hahah', status='0'}}], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='test@gg.com', nickname='test', parentCommentNickname='jess', content='great!', status='0'}}, CommentListVo{commentId=15createdate=Wed Dec 01 23:42:17 EST 2021, avatar=null, replyComments=null, CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='555@test.com', nickname='555', parentCommentNickname='jess', content='555', status='0'}}], CommentVo=CommentVo{parentCommentId=11, articleId=10004, email='jess@gmail.com', nickname='jess', parentCommentNickname='ivan', content='I am doing well. You?', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='ivanliang0818@gmail.com', nickname='ivan', parentCommentNickname='null', content='How are you doing today?', status='0'}}], total=1}
2022-01-19 17:41:07:877 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 19ms
2022-01-19 17:41:07:877 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 17:41:07:877 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 17:41:07:877 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 17:41:07:877 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 17:41:07:877 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10004
2022-01-19 17:41:07:877 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 17:41:07:877 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10004
2022-01-19 17:41:07:877 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=18createdate=Sun Jan 09 10:06:04 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/81.png, replyComments=null, CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsdf@qq.com', nickname='sf', parentCommentNickname='null', content='sdfsf', status='0'}}, CommentListVo{commentId=17createdate=Sun Jan 09 10:05:33 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/57.png, replyComments=null, CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsd@Ck.com', nickname='sfsf', parentCommentNickname='null', content='hdsfsd', status='0'}}, CommentListVo{commentId=16createdate=Sun Jan 09 10:03:48 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/90.png, replyComments=[CommentListVo{commentId=19createdate=Mon Jan 10 09:47:47 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/73.png, replyComments=null, CommentVo=CommentVo{parentCommentId=16, articleId=10004, email='sdfsd@Ck.com', nickname='ivan', parentCommentNickname='sfs@ss.c', content='dfjgg', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='null', content='what?', status='0'}}, CommentListVo{commentId=11createdate=Wed Dec 01 22:44:50 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=12createdate=Wed Dec 01 22:45:18 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=13createdate=Wed Dec 01 22:45:56 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=14createdate=Wed Dec 01 22:46:22 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=26createdate=Wed Jan 19 11:57:50 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/49.png, replyComments=null, CommentVo=CommentVo{parentCommentId=14, articleId=10004, email='sdfsd@Ck.com', nickname='ivan', parentCommentNickname='haha', content='222', status='0'}}], CommentVo=CommentVo{parentCommentId=13, articleId=10004, email='hah@gmail.com', nickname='haha', parentCommentNickname='test', content='hahah', status='0'}}], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='test@gg.com', nickname='test', parentCommentNickname='jess', content='great!', status='0'}}, CommentListVo{commentId=15createdate=Wed Dec 01 23:42:17 EST 2021, avatar=null, replyComments=null, CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='555@test.com', nickname='555', parentCommentNickname='jess', content='555', status='0'}}], CommentVo=CommentVo{parentCommentId=11, articleId=10004, email='jess@gmail.com', nickname='jess', parentCommentNickname='ivan', content='I am doing well. You?', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='ivanliang0818@gmail.com', nickname='ivan', parentCommentNickname='null', content='How are you doing today?', status='0'}}], total=1}
2022-01-19 17:41:07:877 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 20ms
2022-01-19 17:41:07:878 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 17:41:07:899 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 17:41:07:899 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 17:41:07:899 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 17:41:07:899 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10004
2022-01-19 17:41:07:899 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 17:41:07:899 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10004
2022-01-19 17:41:07:899 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=18createdate=Sun Jan 09 10:06:04 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/81.png, replyComments=null, CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsdf@qq.com', nickname='sf', parentCommentNickname='null', content='sdfsf', status='0'}}, CommentListVo{commentId=17createdate=Sun Jan 09 10:05:33 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/57.png, replyComments=null, CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsd@Ck.com', nickname='sfsf', parentCommentNickname='null', content='hdsfsd', status='0'}}, CommentListVo{commentId=16createdate=Sun Jan 09 10:03:48 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/90.png, replyComments=[CommentListVo{commentId=19createdate=Mon Jan 10 09:47:47 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/73.png, replyComments=null, CommentVo=CommentVo{parentCommentId=16, articleId=10004, email='sdfsd@Ck.com', nickname='ivan', parentCommentNickname='sfs@ss.c', content='dfjgg', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='null', content='what?', status='0'}}, CommentListVo{commentId=11createdate=Wed Dec 01 22:44:50 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=12createdate=Wed Dec 01 22:45:18 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=13createdate=Wed Dec 01 22:45:56 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=14createdate=Wed Dec 01 22:46:22 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=26createdate=Wed Jan 19 11:57:50 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/49.png, replyComments=null, CommentVo=CommentVo{parentCommentId=14, articleId=10004, email='sdfsd@Ck.com', nickname='ivan', parentCommentNickname='haha', content='222', status='0'}}], CommentVo=CommentVo{parentCommentId=13, articleId=10004, email='hah@gmail.com', nickname='haha', parentCommentNickname='test', content='hahah', status='0'}}], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='test@gg.com', nickname='test', parentCommentNickname='jess', content='great!', status='0'}}, CommentListVo{commentId=15createdate=Wed Dec 01 23:42:17 EST 2021, avatar=null, replyComments=null, CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='555@test.com', nickname='555', parentCommentNickname='jess', content='555', status='0'}}], CommentVo=CommentVo{parentCommentId=11, articleId=10004, email='jess@gmail.com', nickname='jess', parentCommentNickname='ivan', content='I am doing well. You?', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='ivanliang0818@gmail.com', nickname='ivan', parentCommentNickname='null', content='How are you doing today?', status='0'}}], total=1}
2022-01-19 17:41:07:899 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 5ms
2022-01-19 17:41:07:899 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 17:43:02:475 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 17:43:02:476 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 17:43:02:476 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 17:43:02:476 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/article/10004
2022-01-19 17:43:02:476 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.ArticleController.getPublicArticleDetail
2022-01-19 17:43:02:476 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10004
2022-01-19 17:43:02:476 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=ArticleVo{userInfo=UserInfoVo{userId=100001, nickName='ivan', userName='ivan', avatar='https://res-blog-public.s3.ca-central-1.amazonaws.com/default_avatar.jpg'}, category=CategoryVo{categoryId=2, name='liddffd', articleCount=null}, BaseArticleVo{articleId=10004, status=1, type=2, title='Spring boot', description='rerwerwer', content='rererer![test.png](https://s3.ca-central-1.amazonaws.com/res-blog-public/res-dev/blog_1636947281578_test.png)', firstPicture='', viewCount=174, createDate='Tue Oct 12 15:58:26 EDT 2021', updateDate='Tue Jan 18 22:56:37 EST 2022'}}, total=null}
2022-01-19 17:43:02:476 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 18ms
2022-01-19 17:43:02:476 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 17:43:02:483 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 17:43:02:483 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 17:43:02:483 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 17:43:02:483 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10004
2022-01-19 17:43:02:483 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 17:43:02:483 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10004
2022-01-19 17:43:02:483 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=18createdate=Sun Jan 09 10:06:04 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/81.png, replyComments=null, CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsdf@qq.com', nickname='sf', parentCommentNickname='null', content='sdfsf', status='0'}}, CommentListVo{commentId=17createdate=Sun Jan 09 10:05:33 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/57.png, replyComments=null, CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsd@Ck.com', nickname='sfsf', parentCommentNickname='null', content='hdsfsd', status='0'}}, CommentListVo{commentId=16createdate=Sun Jan 09 10:03:48 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/90.png, replyComments=[CommentListVo{commentId=19createdate=Mon Jan 10 09:47:47 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/73.png, replyComments=null, CommentVo=CommentVo{parentCommentId=16, articleId=10004, email='sdfsd@Ck.com', nickname='ivan', parentCommentNickname='sfs@ss.c', content='dfjgg', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='null', content='what?', status='0'}}, CommentListVo{commentId=11createdate=Wed Dec 01 22:44:50 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=12createdate=Wed Dec 01 22:45:18 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=13createdate=Wed Dec 01 22:45:56 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=14createdate=Wed Dec 01 22:46:22 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=26createdate=Wed Jan 19 11:57:50 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/49.png, replyComments=null, CommentVo=CommentVo{parentCommentId=14, articleId=10004, email='sdfsd@Ck.com', nickname='ivan', parentCommentNickname='haha', content='222', status='0'}}], CommentVo=CommentVo{parentCommentId=13, articleId=10004, email='hah@gmail.com', nickname='haha', parentCommentNickname='test', content='hahah', status='0'}}], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='test@gg.com', nickname='test', parentCommentNickname='jess', content='great!', status='0'}}, CommentListVo{commentId=15createdate=Wed Dec 01 23:42:17 EST 2021, avatar=null, replyComments=null, CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='555@test.com', nickname='555', parentCommentNickname='jess', content='555', status='0'}}], CommentVo=CommentVo{parentCommentId=11, articleId=10004, email='jess@gmail.com', nickname='jess', parentCommentNickname='ivan', content='I am doing well. You?', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='ivanliang0818@gmail.com', nickname='ivan', parentCommentNickname='null', content='How are you doing today?', status='0'}}], total=4}
2022-01-19 17:43:02:484 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 20ms
2022-01-19 17:43:02:484 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 17:43:02:520 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 17:43:02:520 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 17:43:02:520 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 17:43:02:520 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10004
2022-01-19 17:43:02:520 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 17:43:02:520 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10004
2022-01-19 17:43:02:520 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=18createdate=Sun Jan 09 10:06:04 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/81.png, replyComments=null, CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsdf@qq.com', nickname='sf', parentCommentNickname='null', content='sdfsf', status='0'}}, CommentListVo{commentId=17createdate=Sun Jan 09 10:05:33 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/57.png, replyComments=null, CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsd@Ck.com', nickname='sfsf', parentCommentNickname='null', content='hdsfsd', status='0'}}, CommentListVo{commentId=16createdate=Sun Jan 09 10:03:48 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/90.png, replyComments=[CommentListVo{commentId=19createdate=Mon Jan 10 09:47:47 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/73.png, replyComments=null, CommentVo=CommentVo{parentCommentId=16, articleId=10004, email='sdfsd@Ck.com', nickname='ivan', parentCommentNickname='sfs@ss.c', content='dfjgg', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='null', content='what?', status='0'}}, CommentListVo{commentId=11createdate=Wed Dec 01 22:44:50 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=12createdate=Wed Dec 01 22:45:18 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=13createdate=Wed Dec 01 22:45:56 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=14createdate=Wed Dec 01 22:46:22 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=26createdate=Wed Jan 19 11:57:50 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/49.png, replyComments=null, CommentVo=CommentVo{parentCommentId=14, articleId=10004, email='sdfsd@Ck.com', nickname='ivan', parentCommentNickname='haha', content='222', status='0'}}], CommentVo=CommentVo{parentCommentId=13, articleId=10004, email='hah@gmail.com', nickname='haha', parentCommentNickname='test', content='hahah', status='0'}}], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='test@gg.com', nickname='test', parentCommentNickname='jess', content='great!', status='0'}}, CommentListVo{commentId=15createdate=Wed Dec 01 23:42:17 EST 2021, avatar=null, replyComments=null, CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='555@test.com', nickname='555', parentCommentNickname='jess', content='555', status='0'}}], CommentVo=CommentVo{parentCommentId=11, articleId=10004, email='jess@gmail.com', nickname='jess', parentCommentNickname='ivan', content='I am doing well. You?', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='ivanliang0818@gmail.com', nickname='ivan', parentCommentNickname='null', content='How are you doing today?', status='0'}}], total=4}
2022-01-19 17:43:02:521 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 23ms
2022-01-19 17:43:02:521 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 17:43:03:000 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 17:43:03:000 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 17:43:03:000 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 17:43:03:000 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10004
2022-01-19 17:43:03:000 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 17:43:03:001 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10004
2022-01-19 17:43:03:001 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=18createdate=Sun Jan 09 10:06:04 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/81.png, replyComments=null, CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsdf@qq.com', nickname='sf', parentCommentNickname='null', content='sdfsf', status='0'}}, CommentListVo{commentId=17createdate=Sun Jan 09 10:05:33 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/57.png, replyComments=null, CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsd@Ck.com', nickname='sfsf', parentCommentNickname='null', content='hdsfsd', status='0'}}, CommentListVo{commentId=16createdate=Sun Jan 09 10:03:48 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/90.png, replyComments=[CommentListVo{commentId=19createdate=Mon Jan 10 09:47:47 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/73.png, replyComments=null, CommentVo=CommentVo{parentCommentId=16, articleId=10004, email='sdfsd@Ck.com', nickname='ivan', parentCommentNickname='sfs@ss.c', content='dfjgg', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='null', content='what?', status='0'}}, CommentListVo{commentId=11createdate=Wed Dec 01 22:44:50 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=12createdate=Wed Dec 01 22:45:18 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=13createdate=Wed Dec 01 22:45:56 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=14createdate=Wed Dec 01 22:46:22 EST 2021, avatar=null, replyComments=[CommentListVo{commentId=26createdate=Wed Jan 19 11:57:50 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/49.png, replyComments=null, CommentVo=CommentVo{parentCommentId=14, articleId=10004, email='sdfsd@Ck.com', nickname='ivan', parentCommentNickname='haha', content='222', status='0'}}], CommentVo=CommentVo{parentCommentId=13, articleId=10004, email='hah@gmail.com', nickname='haha', parentCommentNickname='test', content='hahah', status='0'}}], CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='test@gg.com', nickname='test', parentCommentNickname='jess', content='great!', status='0'}}, CommentListVo{commentId=15createdate=Wed Dec 01 23:42:17 EST 2021, avatar=null, replyComments=null, CommentVo=CommentVo{parentCommentId=12, articleId=10004, email='555@test.com', nickname='555', parentCommentNickname='jess', content='555', status='0'}}], CommentVo=CommentVo{parentCommentId=11, articleId=10004, email='jess@gmail.com', nickname='jess', parentCommentNickname='ivan', content='I am doing well. You?', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10004, email='ivanliang0818@gmail.com', nickname='ivan', parentCommentNickname='null', content='How are you doing today?', status='0'}}], total=4}
2022-01-19 17:43:03:001 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 7ms
2022-01-19 17:43:03:001 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 17:43:07:830 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 17:43:07:831 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 17:43:07:831 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 17:43:07:831 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 17:43:07:831 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 17:43:07:831 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/categories
2022-01-19 17:43:07:831 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 17:43:07:831 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CategoryContoller.getCategories
2022-01-19 17:43:07:831 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/articles/hot
2022-01-19 17:43:07:831 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.ArticleController.getHotArticles
2022-01-19 17:43:07:831 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: {}
2022-01-19 17:43:07:831 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[ArticleVo{userInfo=null, category=null, BaseArticleVo{articleId=10004, status=null, type=null, title='Spring boot', description='null', content='null', firstPicture='null', viewCount=174, createDate='Tue Oct 12 15:58:26 EDT 2021', updateDate='null'}}, ArticleVo{userInfo=null, category=null, BaseArticleVo{articleId=10005, status=null, type=null, title='dd', description='null', content='null', firstPicture='null', viewCount=83, createDate='Sun Nov 07 14:09:29 EST 2021', updateDate='null'}}, ArticleVo{userInfo=null, category=null, BaseArticleVo{articleId=10003, status=null, type=null, title='dd', description='null', content='null', firstPicture='null', viewCount=0, createDate='Tue Oct 12 15:57:33 EDT 2021', updateDate='null'}}], total=null}
2022-01-19 17:43:07:831 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 4ms
2022-01-19 17:43:07:831 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 17:43:07:831 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: {}
2022-01-19 17:43:07:831 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CategoryVo{categoryId=2, name='liddffd', articleCount=1}, CategoryVo{categoryId=1, name='Life ', articleCount=2}], total=null}
2022-01-19 17:43:07:832 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 3ms
2022-01-19 17:43:07:832 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 17:43:07:846 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 17:43:07:846 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 17:43:07:846 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 17:43:07:846 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/articles
2022-01-19 17:43:07:846 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.ArticleController.getPublicArticles
2022-01-19 17:43:07:846 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: SearchVo{page=1, limit=10, categoryId=null, total=null}
2022-01-19 17:43:07:847 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[ArticleVo{userInfo=UserInfoVo{userId=100001, nickName='ivan', userName='ivan', avatar='https://res-blog-public.s3.ca-central-1.amazonaws.com/default_avatar.jpg'}, category=CategoryVo{categoryId=1, name='Life ', articleCount=null}, BaseArticleVo{articleId=10005, status=1, type=1, title='dd', description='This is the doc of React markdown editor lite.
Enjoy!!', content='null', firstPicture='', viewCount=83, createDate='Sun Nov 07 14:09:29 EST 2021', updateDate='Tue Jan 18 22:54:08 EST 2022'}}, ArticleVo{userInfo=UserInfoVo{userId=100001, nickName='ivan', userName='ivan', avatar='https://res-blog-public.s3.ca-central-1.amazonaws.com/default_avatar.jpg'}, category=CategoryVo{categoryId=2, name='liddffd', articleCount=null}, BaseArticleVo{articleId=10004, status=1, type=2, title='Spring boot', description='rerwerwer', content='null', firstPicture='', viewCount=174, createDate='Tue Oct 12 15:58:26 EDT 2021', updateDate='Tue Jan 18 22:56:37 EST 2022'}}, ArticleVo{userInfo=UserInfoVo{userId=100001, nickName='ivan', userName='ivan', avatar='https://res-blog-public.s3.ca-central-1.amazonaws.com/default_avatar.jpg'}, category=CategoryVo{categoryId=1, name='Life ', articleCount=null}, BaseArticleVo{articleId=10003, status=1, type=1, title='dd', description='test', content='null', firstPicture='', viewCount=0, createDate='Tue Oct 12 15:57:33 EDT 2021', updateDate='Tue Jan 18 22:53:20 EST 2022'}}], total=3}
2022-01-19 17:43:07:847 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 18ms
2022-01-19 17:43:07:847 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 17:43:09:379 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 17:43:09:380 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 17:43:09:380 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 17:43:09:380 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 17:43:09:380 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 17:43:09:380 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 17:43:09:380 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=20createdate=Wed Jan 19 11:47:08 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/26.png, replyComments=[CommentListVo{commentId=21createdate=Wed Jan 19 11:47:21 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/89.png, replyComments=[CommentListVo{commentId=22createdate=Wed Jan 19 11:47:39 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/75.png, replyComments=null, CommentVo=CommentVo{parentCommentId=21, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='sfs@ss.c', content='eeeeee', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='tet', content='ree', status='0'}}, CommentListVo{commentId=27createdate=Wed Jan 19 17:01:06 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/2.png, replyComments=null, CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='ljh19911025@gmail.com', nickname='sds', parentCommentNickname='tet', content='wwww', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='tet', parentCommentNickname='null', content='etet', status='0'}}], total=4}
2022-01-19 17:43:09:380 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 10ms
2022-01-19 17:43:09:380 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 17:43:09:383 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 17:43:09:383 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 17:43:09:383 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 17:43:09:383 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 17:43:09:384 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 17:43:09:384 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 17:43:09:384 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=20createdate=Wed Jan 19 11:47:08 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/26.png, replyComments=[CommentListVo{commentId=21createdate=Wed Jan 19 11:47:21 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/89.png, replyComments=[CommentListVo{commentId=22createdate=Wed Jan 19 11:47:39 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/75.png, replyComments=null, CommentVo=CommentVo{parentCommentId=21, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='sfs@ss.c', content='eeeeee', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='tet', content='ree', status='0'}}, CommentListVo{commentId=27createdate=Wed Jan 19 17:01:06 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/2.png, replyComments=null, CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='ljh19911025@gmail.com', nickname='sds', parentCommentNickname='tet', content='wwww', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='tet', parentCommentNickname='null', content='etet', status='0'}}], total=4}
2022-01-19 17:43:09:384 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 14ms
2022-01-19 17:43:09:384 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 17:43:09:384 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 17:43:09:384 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 17:43:09:384 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 17:43:09:384 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/article/10005
2022-01-19 17:43:09:384 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.ArticleController.getPublicArticleDetail
2022-01-19 17:43:09:384 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 17:43:09:384 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=ArticleVo{userInfo=UserInfoVo{userId=100001, nickName='ivan', userName='ivan', avatar='https://res-blog-public.s3.ca-central-1.amazonaws.com/default_avatar.jpg'}, category=CategoryVo{categoryId=1, name='Life ', articleCount=null}, BaseArticleVo{articleId=10005, status=1, type=1, title='dd', description='This is the doc of React markdown editor lite.
Enjoy!!', content='| Head | Head | Head | Head |
| --- | --- | --- | --- |
| Data | Data | Data | Data |
| Data | Data | Data | Data |

## 手把手教你写一个markdown编辑器

> 笔者在18年年末的时候接到一个开发任务——搭建一个AI项目的开放平台，其中的产品文档为转化为HTML格式的markdown文档。考虑到文档的即时更新，将文档信息做成了Ajax接口的形式。因此管理后台只需将textarea表单的内容通过markdown解析器进行HTML格式转化，然后将markdown内容和经转化的HTML文档都保存到数据库即可。
> 基本需求完成后，为了更好的用户体验，考虑将常用的编辑功能添加进来。改进版不仅支持了常用的文本编辑功能，还实现的UI界面的配置化，自定义语法解析器。本着造福伸手党的目的，以及积累些开源经验，笔者将该react 组件 [react-markdown-editor-lite](https://github.com/HarryChen0506/react-markdown-editor-lite) 进行了封装改造，并且发布到了开源社区。

### 预览
在线体验 [https://harrychen0506.github.io/react-markdown-editor-lite/](https://harrychen0506.github.io/react-markdown-editor-lite/)

![image](https://github.com//HarryChen0506/react-markdown-editor-lite/blob/master/image/react-markdown-editor-lite-v1.0.0.PNG?raw=true)

### 特点
* 轻量、基于React
* UI可配置, 如只显示编辑区或预览区
* 支持自定义markdown语法解析器,语法高亮等
* 支持常用的markdown编辑功能，如加粗，斜体等等...
* 支持功能按钮插拔化，用户可以自定义扩展组件
* 支持编辑区和预览区同步滚动

### 开发心得

- 文本编辑

  大多数常见的编辑器，包括富文本编辑器，利用了某些元素如div的contenteditable属性，配合selection、range、execCommand等API，实现了富文本编辑功能。这里面的实现比较复杂，所以有了"[为什么都说富文本编辑器是天坑？](https://www.zhihu.com/question/38699645)"这个说法。

  而markdown编辑器，核心的处理内容为简单语法的纯文本，复杂度相对来说比较低，并且input标签自带onSelect事件，可以很方便的获取选择信息（选择起始位置和选择文本值），因此要想实现编辑功能，只需将要改动的内容进行文本转换，然后进行重新拼接首尾，大功告成。
  
- markdown解析

  考察了几个社区流行的markdown解析器，比较流行的有[markdown](https://www.npmjs.com/package/markdown), [markdown-it](https://www.npmjs.com/package/markdown-it), [marked](https://www.npmjs.com/package/marked) 等等。综合考虑扩展性以及稳定性，笔者推荐使用markdown-it作为markdown的词法解析器，因为该解析器有比较多的插件，并且支持语法高亮。

- 同步滚动

  当选择分栏编辑的时候，滚动左侧的编辑区，右侧的预览区能自动滚动到对应的区域。方案参考了《[手把手教你用 100行代码实现基于 react的 markdown 输入 + 即时预览在线编辑器（一）](https://github.com/accforgit/blog-data/blob/master/%E5%9C%A8%E7%BA%BF%E7%BC%96%E8%BE%91%E5%99%A8/README/README1.md)》。只需先计算出输入框容器元素与预览框容器元素之间最大scroll范围的比例值，然后根据主动滚动元素自身的scrollTop做相应的比例换算，即可知道对方区域的scrollTop值。

- 关于UI
 
  - 项目的字体库选择了Font Awesome风格，并且只选取了项目所需要的一些图标。
  - 编辑器的整体css均可通过全局覆盖的形式进行自定义。目前暂时只支持灰色主题。
  - 编辑器的显示区域包括菜单栏，编辑器，预览区，工具栏，通过配置组件的config属性，可以选择默认的展示区域。
  
### Install

```js
npm install react-markdown-editor-lite --save
```

### Props

| Property | Description | Type | default | Remarks |
| --- | --- | --- | --- | --- |
| value | markdown content | String | '' | required |
| style | component container style | Object | {height: '100%'} | not required |
| config | component config | Object | {view: {...}, logger: {...}} | not required |
| onChange | emitting when editor has changed | Function | ({html, md}) => {} | not required |
| onImageUpload | when image uploaded, callback emitting will get image markdown text | (file: File, callback: (url: string) => void) => void; | ({file, callback}) => {} | not required |
| renderHTML | Render markdown text to HTML. You can return either string, function or Promise | (text: string) => string|function|Promise | none | **required** |

### Example

``` js
'use strict';
import React from 'react'
import ReactDOM from 'react-dom'
import MdEditor from 'react-markdown-editor-lite'
import MarkdownIt from 'markdown-it'
import emoji from 'markdown-it-emoji'
import subscript from 'markdown-it-sub'
import superscript from 'markdown-it-sup'
import footnote from 'markdown-it-footnote'
import deflist from 'markdown-it-deflist'
import abbreviation from 'markdown-it-abbr'
import insert from 'markdown-it-ins'
import mark from 'markdown-it-mark'
import tasklists from 'markdown-it-task-lists'
import hljs from 'highlight.js'
import 'highlight.js/styles/atom-one-light.css'
// import 'highlight.js/styles/github.css'
import './index.less';

const MOCK_DATA = "I Love React."
export default class Demo extends React.Component {
  mdEditor = null
  mdParser = null
  constructor(props) {
    super(props)
    // initial a parsera
    this.mdParser = new MarkdownIt({
      html: true,
      linkify: true,
      typographer: true,
      highlight: function (str, lang) {
        if (lang && hljs.getLanguage(lang)) {
          try {
            return hljs.highlight(lang, str).value
          } catch (__) {}
        }    
        return '' // use external default escaping
      }
    })
    .use(emoji)
    .use(subscript)
    .use(superscript)
    .use(footnote)
    .use(deflist)
    .use(abbreviation)
    .use(insert)
    .use(mark)
    .use(tasklists, { enabled: this.taskLists })
    this.renderHTML = this.renderHTML.bind(this)
  }
  handleEditorChange({html, md}) {
    console.log('handleEditorChange', html, md)
  }
  handleImageUpload(file, callback) {
    const reader = new FileReader()
    reader.onload = () => {      
      const convertBase64UrlToBlob = (urlData) => {  
        let arr = urlData.split(','), mime = arr[0].match(/:(.*?);/)[1]
        let bstr = atob(arr[1])
        let n = bstr.length
        let u8arr = new Uint8Array(n)
        while (n--) {
          u8arr[n] = bstr.charCodeAt(n)
        }
        return new Blob([u8arr], {type:mime})
      }
      const blob = convertBase64UrlToBlob(reader.result)
      setTimeout(() => {
        // setTimeout 模拟异步上传图片
        // 当异步上传获取图片地址后，执行calback回调（参数为imageUrl字符串），即可将图片地址写入markdown
        callback('https://avatars0.githubusercontent.com/u/21263805?s=40&v=4')
      }, 1000)
    }
    reader.readAsDataURL(file)
  }
  renderHTML(text) {
    // 模拟异步渲染Markdown
    return new Promise((resolve) => {
      setTimeout(() => {
        resolve(this.mdParser.render(text))
      }, 1000)
    })
  }
  handleGetMdValue = () => {   
    this.mdEditor && alert(this.mdEditor.getMdValue())      
  }
  handleGetHtmlValue = () => {    
    this.mdEditor && alert(this.mdEditor.getHtmlValue())
  }
  render() {
    return (      
      <div>
        <nav>
          <button onClick={this.handleGetMdValue} >getMdValue</button>  
          <button onClick={this.handleGetHtmlValue} >getHtmlValue</button>  
        </nav>
        <section style="height: 500px">
          <MdEditor 
            ref={node => this.mdEditor = node}
            value={MOCK_DATA}
            style={{height: '400px'}}
            renderHTML={this.renderHTML}
            config={{
              view: {
                menu: true,
                md: true,
                html: true
              },
              imageUrl: 'https://octodex.github.com/images/minion.png'
            }}
            onChange={this.handleEditorChange} 
            onImageUpload={this.handleImageUpload}
          />
        </section>                        
      </div>      
    )
  }
}
```

### 最后

   欢迎大家使用和反馈，[项目地址](https://github.com/HarryChen0506/react-markdown-editor-lite) (https://github.com/HarryChen0506/react-markdown-editor-lite)， 你的点赞将是我莫大的动力😊

![1.png](https://s3.ca-central-1.amazonaws.com/res-blog-public/res-dev/blog_1636946743939_1.png)', firstPicture='', viewCount=83, createDate='Sun Nov 07 14:09:29 EST 2021', updateDate='Tue Jan 18 22:54:08 EST 2022'}}, total=null}
2022-01-19 17:43:09:384 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 15ms
2022-01-19 17:43:09:384 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 17:43:09:438 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 17:43:09:438 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 17:43:09:438 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 17:43:09:438 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 17:43:09:438 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 17:43:09:438 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 17:43:09:438 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=20createdate=Wed Jan 19 11:47:08 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/26.png, replyComments=[CommentListVo{commentId=21createdate=Wed Jan 19 11:47:21 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/89.png, replyComments=[CommentListVo{commentId=22createdate=Wed Jan 19 11:47:39 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/75.png, replyComments=null, CommentVo=CommentVo{parentCommentId=21, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='sfs@ss.c', content='eeeeee', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='tet', content='ree', status='0'}}, CommentListVo{commentId=27createdate=Wed Jan 19 17:01:06 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/2.png, replyComments=null, CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='ljh19911025@gmail.com', nickname='sds', parentCommentNickname='tet', content='wwww', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='tet', parentCommentNickname='null', content='etet', status='0'}}], total=4}
2022-01-19 17:43:09:439 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 3ms
2022-01-19 17:43:09:439 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 19:05:38:941 [HikariPool-1 housekeeper] WARN  com.zaxxer.hikari.pool.HikariPool HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=1h6m13s129ms).
2022-01-19 19:28:33:820 [HikariPool-1 housekeeper] WARN  com.zaxxer.hikari.pool.HikariPool HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=22m54s881ms).
2022-01-19 19:42:50:840 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 19:42:50:841 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 19:42:50:840 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 19:42:50:841 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 19:42:50:841 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 19:42:50:840 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 19:42:50:841 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 19:42:50:841 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 19:42:50:841 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 19:42:50:841 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 19:42:50:841 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 19:42:50:841 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 19:42:50:841 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 19:42:50:841 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 19:42:50:841 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 19:42:50:841 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/article/10005
2022-01-19 19:42:50:841 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.ArticleController.getPublicArticleDetail
2022-01-19 19:42:50:841 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=20createdate=Wed Jan 19 11:47:08 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/26.png, replyComments=[CommentListVo{commentId=21createdate=Wed Jan 19 11:47:21 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/89.png, replyComments=[CommentListVo{commentId=22createdate=Wed Jan 19 11:47:39 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/75.png, replyComments=null, CommentVo=CommentVo{parentCommentId=21, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='sfs@ss.c', content='eeeeee', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='tet', content='ree', status='0'}}, CommentListVo{commentId=27createdate=Wed Jan 19 17:01:06 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/2.png, replyComments=null, CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='ljh19911025@gmail.com', nickname='sds', parentCommentNickname='tet', content='wwww', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='tet', parentCommentNickname='null', content='etet', status='0'}}], total=1}
2022-01-19 19:42:50:841 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 19:42:50:841 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 37ms
2022-01-19 19:42:50:841 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=20createdate=Wed Jan 19 11:47:08 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/26.png, replyComments=[CommentListVo{commentId=21createdate=Wed Jan 19 11:47:21 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/89.png, replyComments=[CommentListVo{commentId=22createdate=Wed Jan 19 11:47:39 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/75.png, replyComments=null, CommentVo=CommentVo{parentCommentId=21, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='sfs@ss.c', content='eeeeee', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='tet', content='ree', status='0'}}, CommentListVo{commentId=27createdate=Wed Jan 19 17:01:06 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/2.png, replyComments=null, CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='ljh19911025@gmail.com', nickname='sds', parentCommentNickname='tet', content='wwww', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='tet', parentCommentNickname='null', content='etet', status='0'}}], total=1}
2022-01-19 19:42:50:841 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 19:42:50:841 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 35ms
2022-01-19 19:42:50:841 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 19:42:50:841 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=ArticleVo{userInfo=UserInfoVo{userId=100001, nickName='ivan', userName='ivan', avatar='https://res-blog-public.s3.ca-central-1.amazonaws.com/default_avatar.jpg'}, category=CategoryVo{categoryId=1, name='Life ', articleCount=null}, BaseArticleVo{articleId=10005, status=1, type=1, title='dd', description='This is the doc of React markdown editor lite.
Enjoy!!', content='| Head | Head | Head | Head |
| --- | --- | --- | --- |
| Data | Data | Data | Data |
| Data | Data | Data | Data |

## 手把手教你写一个markdown编辑器

> 笔者在18年年末的时候接到一个开发任务——搭建一个AI项目的开放平台，其中的产品文档为转化为HTML格式的markdown文档。考虑到文档的即时更新，将文档信息做成了Ajax接口的形式。因此管理后台只需将textarea表单的内容通过markdown解析器进行HTML格式转化，然后将markdown内容和经转化的HTML文档都保存到数据库即可。
> 基本需求完成后，为了更好的用户体验，考虑将常用的编辑功能添加进来。改进版不仅支持了常用的文本编辑功能，还实现的UI界面的配置化，自定义语法解析器。本着造福伸手党的目的，以及积累些开源经验，笔者将该react 组件 [react-markdown-editor-lite](https://github.com/HarryChen0506/react-markdown-editor-lite) 进行了封装改造，并且发布到了开源社区。

### 预览
在线体验 [https://harrychen0506.github.io/react-markdown-editor-lite/](https://harrychen0506.github.io/react-markdown-editor-lite/)

![image](https://github.com//HarryChen0506/react-markdown-editor-lite/blob/master/image/react-markdown-editor-lite-v1.0.0.PNG?raw=true)

### 特点
* 轻量、基于React
* UI可配置, 如只显示编辑区或预览区
* 支持自定义markdown语法解析器,语法高亮等
* 支持常用的markdown编辑功能，如加粗，斜体等等...
* 支持功能按钮插拔化，用户可以自定义扩展组件
* 支持编辑区和预览区同步滚动

### 开发心得

- 文本编辑

  大多数常见的编辑器，包括富文本编辑器，利用了某些元素如div的contenteditable属性，配合selection、range、execCommand等API，实现了富文本编辑功能。这里面的实现比较复杂，所以有了"[为什么都说富文本编辑器是天坑？](https://www.zhihu.com/question/38699645)"这个说法。

  而markdown编辑器，核心的处理内容为简单语法的纯文本，复杂度相对来说比较低，并且input标签自带onSelect事件，可以很方便的获取选择信息（选择起始位置和选择文本值），因此要想实现编辑功能，只需将要改动的内容进行文本转换，然后进行重新拼接首尾，大功告成。
  
- markdown解析

  考察了几个社区流行的markdown解析器，比较流行的有[markdown](https://www.npmjs.com/package/markdown), [markdown-it](https://www.npmjs.com/package/markdown-it), [marked](https://www.npmjs.com/package/marked) 等等。综合考虑扩展性以及稳定性，笔者推荐使用markdown-it作为markdown的词法解析器，因为该解析器有比较多的插件，并且支持语法高亮。

- 同步滚动

  当选择分栏编辑的时候，滚动左侧的编辑区，右侧的预览区能自动滚动到对应的区域。方案参考了《[手把手教你用 100行代码实现基于 react的 markdown 输入 + 即时预览在线编辑器（一）](https://github.com/accforgit/blog-data/blob/master/%E5%9C%A8%E7%BA%BF%E7%BC%96%E8%BE%91%E5%99%A8/README/README1.md)》。只需先计算出输入框容器元素与预览框容器元素之间最大scroll范围的比例值，然后根据主动滚动元素自身的scrollTop做相应的比例换算，即可知道对方区域的scrollTop值。

- 关于UI
 
  - 项目的字体库选择了Font Awesome风格，并且只选取了项目所需要的一些图标。
  - 编辑器的整体css均可通过全局覆盖的形式进行自定义。目前暂时只支持灰色主题。
  - 编辑器的显示区域包括菜单栏，编辑器，预览区，工具栏，通过配置组件的config属性，可以选择默认的展示区域。
  
### Install

```js
npm install react-markdown-editor-lite --save
```

### Props

| Property | Description | Type | default | Remarks |
| --- | --- | --- | --- | --- |
| value | markdown content | String | '' | required |
| style | component container style | Object | {height: '100%'} | not required |
| config | component config | Object | {view: {...}, logger: {...}} | not required |
| onChange | emitting when editor has changed | Function | ({html, md}) => {} | not required |
| onImageUpload | when image uploaded, callback emitting will get image markdown text | (file: File, callback: (url: string) => void) => void; | ({file, callback}) => {} | not required |
| renderHTML | Render markdown text to HTML. You can return either string, function or Promise | (text: string) => string|function|Promise | none | **required** |

### Example

``` js
'use strict';
import React from 'react'
import ReactDOM from 'react-dom'
import MdEditor from 'react-markdown-editor-lite'
import MarkdownIt from 'markdown-it'
import emoji from 'markdown-it-emoji'
import subscript from 'markdown-it-sub'
import superscript from 'markdown-it-sup'
import footnote from 'markdown-it-footnote'
import deflist from 'markdown-it-deflist'
import abbreviation from 'markdown-it-abbr'
import insert from 'markdown-it-ins'
import mark from 'markdown-it-mark'
import tasklists from 'markdown-it-task-lists'
import hljs from 'highlight.js'
import 'highlight.js/styles/atom-one-light.css'
// import 'highlight.js/styles/github.css'
import './index.less';

const MOCK_DATA = "I Love React."
export default class Demo extends React.Component {
  mdEditor = null
  mdParser = null
  constructor(props) {
    super(props)
    // initial a parsera
    this.mdParser = new MarkdownIt({
      html: true,
      linkify: true,
      typographer: true,
      highlight: function (str, lang) {
        if (lang && hljs.getLanguage(lang)) {
          try {
            return hljs.highlight(lang, str).value
          } catch (__) {}
        }    
        return '' // use external default escaping
      }
    })
    .use(emoji)
    .use(subscript)
    .use(superscript)
    .use(footnote)
    .use(deflist)
    .use(abbreviation)
    .use(insert)
    .use(mark)
    .use(tasklists, { enabled: this.taskLists })
    this.renderHTML = this.renderHTML.bind(this)
  }
  handleEditorChange({html, md}) {
    console.log('handleEditorChange', html, md)
  }
  handleImageUpload(file, callback) {
    const reader = new FileReader()
    reader.onload = () => {      
      const convertBase64UrlToBlob = (urlData) => {  
        let arr = urlData.split(','), mime = arr[0].match(/:(.*?);/)[1]
        let bstr = atob(arr[1])
        let n = bstr.length
        let u8arr = new Uint8Array(n)
        while (n--) {
          u8arr[n] = bstr.charCodeAt(n)
        }
        return new Blob([u8arr], {type:mime})
      }
      const blob = convertBase64UrlToBlob(reader.result)
      setTimeout(() => {
        // setTimeout 模拟异步上传图片
        // 当异步上传获取图片地址后，执行calback回调（参数为imageUrl字符串），即可将图片地址写入markdown
        callback('https://avatars0.githubusercontent.com/u/21263805?s=40&v=4')
      }, 1000)
    }
    reader.readAsDataURL(file)
  }
  renderHTML(text) {
    // 模拟异步渲染Markdown
    return new Promise((resolve) => {
      setTimeout(() => {
        resolve(this.mdParser.render(text))
      }, 1000)
    })
  }
  handleGetMdValue = () => {   
    this.mdEditor && alert(this.mdEditor.getMdValue())      
  }
  handleGetHtmlValue = () => {    
    this.mdEditor && alert(this.mdEditor.getHtmlValue())
  }
  render() {
    return (      
      <div>
        <nav>
          <button onClick={this.handleGetMdValue} >getMdValue</button>  
          <button onClick={this.handleGetHtmlValue} >getHtmlValue</button>  
        </nav>
        <section style="height: 500px">
          <MdEditor 
            ref={node => this.mdEditor = node}
            value={MOCK_DATA}
            style={{height: '400px'}}
            renderHTML={this.renderHTML}
            config={{
              view: {
                menu: true,
                md: true,
                html: true
              },
              imageUrl: 'https://octodex.github.com/images/minion.png'
            }}
            onChange={this.handleEditorChange} 
            onImageUpload={this.handleImageUpload}
          />
        </section>                        
      </div>      
    )
  }
}
```

### 最后

   欢迎大家使用和反馈，[项目地址](https://github.com/HarryChen0506/react-markdown-editor-lite) (https://github.com/HarryChen0506/react-markdown-editor-lite)， 你的点赞将是我莫大的动力😊

![1.png](https://s3.ca-central-1.amazonaws.com/res-blog-public/res-dev/blog_1636946743939_1.png)', firstPicture='', viewCount=83, createDate='Sun Nov 07 14:09:29 EST 2021', updateDate='Tue Jan 18 22:54:08 EST 2022'}}, total=null}
2022-01-19 19:42:50:841 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 30ms
2022-01-19 19:42:50:841 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 19:43:39:713 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 19:43:39:718 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 19:43:39:719 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 19:43:39:719 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 19:43:39:719 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 19:43:39:719 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/article/10005
2022-01-19 19:43:39:719 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 19:43:39:719 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.ArticleController.getPublicArticleDetail
2022-01-19 19:43:39:719 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 19:43:39:719 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 19:43:39:719 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 19:43:39:719 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 19:43:39:719 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=ArticleVo{userInfo=UserInfoVo{userId=100001, nickName='ivan', userName='ivan', avatar='https://res-blog-public.s3.ca-central-1.amazonaws.com/default_avatar.jpg'}, category=CategoryVo{categoryId=1, name='Life ', articleCount=null}, BaseArticleVo{articleId=10005, status=1, type=1, title='dd', description='This is the doc of React markdown editor lite.
Enjoy!!', content='| Head | Head | Head | Head |
| --- | --- | --- | --- |
| Data | Data | Data | Data |
| Data | Data | Data | Data |

## 手把手教你写一个markdown编辑器

> 笔者在18年年末的时候接到一个开发任务——搭建一个AI项目的开放平台，其中的产品文档为转化为HTML格式的markdown文档。考虑到文档的即时更新，将文档信息做成了Ajax接口的形式。因此管理后台只需将textarea表单的内容通过markdown解析器进行HTML格式转化，然后将markdown内容和经转化的HTML文档都保存到数据库即可。
> 基本需求完成后，为了更好的用户体验，考虑将常用的编辑功能添加进来。改进版不仅支持了常用的文本编辑功能，还实现的UI界面的配置化，自定义语法解析器。本着造福伸手党的目的，以及积累些开源经验，笔者将该react 组件 [react-markdown-editor-lite](https://github.com/HarryChen0506/react-markdown-editor-lite) 进行了封装改造，并且发布到了开源社区。

### 预览
在线体验 [https://harrychen0506.github.io/react-markdown-editor-lite/](https://harrychen0506.github.io/react-markdown-editor-lite/)

![image](https://github.com//HarryChen0506/react-markdown-editor-lite/blob/master/image/react-markdown-editor-lite-v1.0.0.PNG?raw=true)

### 特点
* 轻量、基于React
* UI可配置, 如只显示编辑区或预览区
* 支持自定义markdown语法解析器,语法高亮等
* 支持常用的markdown编辑功能，如加粗，斜体等等...
* 支持功能按钮插拔化，用户可以自定义扩展组件
* 支持编辑区和预览区同步滚动

### 开发心得

- 文本编辑

  大多数常见的编辑器，包括富文本编辑器，利用了某些元素如div的contenteditable属性，配合selection、range、execCommand等API，实现了富文本编辑功能。这里面的实现比较复杂，所以有了"[为什么都说富文本编辑器是天坑？](https://www.zhihu.com/question/38699645)"这个说法。

  而markdown编辑器，核心的处理内容为简单语法的纯文本，复杂度相对来说比较低，并且input标签自带onSelect事件，可以很方便的获取选择信息（选择起始位置和选择文本值），因此要想实现编辑功能，只需将要改动的内容进行文本转换，然后进行重新拼接首尾，大功告成。
  
- markdown解析

  考察了几个社区流行的markdown解析器，比较流行的有[markdown](https://www.npmjs.com/package/markdown), [markdown-it](https://www.npmjs.com/package/markdown-it), [marked](https://www.npmjs.com/package/marked) 等等。综合考虑扩展性以及稳定性，笔者推荐使用markdown-it作为markdown的词法解析器，因为该解析器有比较多的插件，并且支持语法高亮。

- 同步滚动

  当选择分栏编辑的时候，滚动左侧的编辑区，右侧的预览区能自动滚动到对应的区域。方案参考了《[手把手教你用 100行代码实现基于 react的 markdown 输入 + 即时预览在线编辑器（一）](https://github.com/accforgit/blog-data/blob/master/%E5%9C%A8%E7%BA%BF%E7%BC%96%E8%BE%91%E5%99%A8/README/README1.md)》。只需先计算出输入框容器元素与预览框容器元素之间最大scroll范围的比例值，然后根据主动滚动元素自身的scrollTop做相应的比例换算，即可知道对方区域的scrollTop值。

- 关于UI
 
  - 项目的字体库选择了Font Awesome风格，并且只选取了项目所需要的一些图标。
  - 编辑器的整体css均可通过全局覆盖的形式进行自定义。目前暂时只支持灰色主题。
  - 编辑器的显示区域包括菜单栏，编辑器，预览区，工具栏，通过配置组件的config属性，可以选择默认的展示区域。
  
### Install

```js
npm install react-markdown-editor-lite --save
```

### Props

| Property | Description | Type | default | Remarks |
| --- | --- | --- | --- | --- |
| value | markdown content | String | '' | required |
| style | component container style | Object | {height: '100%'} | not required |
| config | component config | Object | {view: {...}, logger: {...}} | not required |
| onChange | emitting when editor has changed | Function | ({html, md}) => {} | not required |
| onImageUpload | when image uploaded, callback emitting will get image markdown text | (file: File, callback: (url: string) => void) => void; | ({file, callback}) => {} | not required |
| renderHTML | Render markdown text to HTML. You can return either string, function or Promise | (text: string) => string|function|Promise | none | **required** |

### Example

``` js
'use strict';
import React from 'react'
import ReactDOM from 'react-dom'
import MdEditor from 'react-markdown-editor-lite'
import MarkdownIt from 'markdown-it'
import emoji from 'markdown-it-emoji'
import subscript from 'markdown-it-sub'
import superscript from 'markdown-it-sup'
import footnote from 'markdown-it-footnote'
import deflist from 'markdown-it-deflist'
import abbreviation from 'markdown-it-abbr'
import insert from 'markdown-it-ins'
import mark from 'markdown-it-mark'
import tasklists from 'markdown-it-task-lists'
import hljs from 'highlight.js'
import 'highlight.js/styles/atom-one-light.css'
// import 'highlight.js/styles/github.css'
import './index.less';

const MOCK_DATA = "I Love React."
export default class Demo extends React.Component {
  mdEditor = null
  mdParser = null
  constructor(props) {
    super(props)
    // initial a parsera
    this.mdParser = new MarkdownIt({
      html: true,
      linkify: true,
      typographer: true,
      highlight: function (str, lang) {
        if (lang && hljs.getLanguage(lang)) {
          try {
            return hljs.highlight(lang, str).value
          } catch (__) {}
        }    
        return '' // use external default escaping
      }
    })
    .use(emoji)
    .use(subscript)
    .use(superscript)
    .use(footnote)
    .use(deflist)
    .use(abbreviation)
    .use(insert)
    .use(mark)
    .use(tasklists, { enabled: this.taskLists })
    this.renderHTML = this.renderHTML.bind(this)
  }
  handleEditorChange({html, md}) {
    console.log('handleEditorChange', html, md)
  }
  handleImageUpload(file, callback) {
    const reader = new FileReader()
    reader.onload = () => {      
      const convertBase64UrlToBlob = (urlData) => {  
        let arr = urlData.split(','), mime = arr[0].match(/:(.*?);/)[1]
        let bstr = atob(arr[1])
        let n = bstr.length
        let u8arr = new Uint8Array(n)
        while (n--) {
          u8arr[n] = bstr.charCodeAt(n)
        }
        return new Blob([u8arr], {type:mime})
      }
      const blob = convertBase64UrlToBlob(reader.result)
      setTimeout(() => {
        // setTimeout 模拟异步上传图片
        // 当异步上传获取图片地址后，执行calback回调（参数为imageUrl字符串），即可将图片地址写入markdown
        callback('https://avatars0.githubusercontent.com/u/21263805?s=40&v=4')
      }, 1000)
    }
    reader.readAsDataURL(file)
  }
  renderHTML(text) {
    // 模拟异步渲染Markdown
    return new Promise((resolve) => {
      setTimeout(() => {
        resolve(this.mdParser.render(text))
      }, 1000)
    })
  }
  handleGetMdValue = () => {   
    this.mdEditor && alert(this.mdEditor.getMdValue())      
  }
  handleGetHtmlValue = () => {    
    this.mdEditor && alert(this.mdEditor.getHtmlValue())
  }
  render() {
    return (      
      <div>
        <nav>
          <button onClick={this.handleGetMdValue} >getMdValue</button>  
          <button onClick={this.handleGetHtmlValue} >getHtmlValue</button>  
        </nav>
        <section style="height: 500px">
          <MdEditor 
            ref={node => this.mdEditor = node}
            value={MOCK_DATA}
            style={{height: '400px'}}
            renderHTML={this.renderHTML}
            config={{
              view: {
                menu: true,
                md: true,
                html: true
              },
              imageUrl: 'https://octodex.github.com/images/minion.png'
            }}
            onChange={this.handleEditorChange} 
            onImageUpload={this.handleImageUpload}
          />
        </section>                        
      </div>      
    )
  }
}
```

### 最后

   欢迎大家使用和反馈，[项目地址](https://github.com/HarryChen0506/react-markdown-editor-lite) (https://github.com/HarryChen0506/react-markdown-editor-lite)， 你的点赞将是我莫大的动力😊

![1.png](https://s3.ca-central-1.amazonaws.com/res-blog-public/res-dev/blog_1636946743939_1.png)', firstPicture='', viewCount=83, createDate='Sun Nov 07 14:09:29 EST 2021', updateDate='Tue Jan 18 22:54:08 EST 2022'}}, total=null}
2022-01-19 19:43:39:719 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 14ms
2022-01-19 19:43:39:719 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 19:43:39:719 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=20createdate=Wed Jan 19 11:47:08 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/26.png, replyComments=[CommentListVo{commentId=21createdate=Wed Jan 19 11:47:21 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/89.png, replyComments=[CommentListVo{commentId=22createdate=Wed Jan 19 11:47:39 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/75.png, replyComments=null, CommentVo=CommentVo{parentCommentId=21, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='sfs@ss.c', content='eeeeee', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='tet', content='ree', status='0'}}, CommentListVo{commentId=27createdate=Wed Jan 19 17:01:06 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/2.png, replyComments=null, CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='ljh19911025@gmail.com', nickname='sds', parentCommentNickname='tet', content='wwww', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='tet', parentCommentNickname='null', content='etet', status='0'}}], total=1}
2022-01-19 19:43:39:720 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 18ms
2022-01-19 19:43:39:720 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 19:43:39:724 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 19:43:39:724 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 19:43:39:724 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 19:43:39:724 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 19:43:39:724 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 19:43:39:724 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 19:43:39:724 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=20createdate=Wed Jan 19 11:47:08 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/26.png, replyComments=[CommentListVo{commentId=21createdate=Wed Jan 19 11:47:21 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/89.png, replyComments=[CommentListVo{commentId=22createdate=Wed Jan 19 11:47:39 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/75.png, replyComments=null, CommentVo=CommentVo{parentCommentId=21, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='sfs@ss.c', content='eeeeee', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='tet', content='ree', status='0'}}, CommentListVo{commentId=27createdate=Wed Jan 19 17:01:06 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/2.png, replyComments=null, CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='ljh19911025@gmail.com', nickname='sds', parentCommentNickname='tet', content='wwww', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='tet', parentCommentNickname='null', content='etet', status='0'}}], total=1}
2022-01-19 19:43:39:724 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 24ms
2022-01-19 19:43:39:724 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 19:44:39:912 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 19:44:39:912 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 19:44:39:912 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 19:44:39:912 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/article/10005
2022-01-19 19:44:39:912 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.ArticleController.getPublicArticleDetail
2022-01-19 19:44:39:912 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 19:44:39:912 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=ArticleVo{userInfo=UserInfoVo{userId=100001, nickName='ivan', userName='ivan', avatar='https://res-blog-public.s3.ca-central-1.amazonaws.com/default_avatar.jpg'}, category=CategoryVo{categoryId=1, name='Life ', articleCount=null}, BaseArticleVo{articleId=10005, status=1, type=1, title='dd', description='This is the doc of React markdown editor lite.
Enjoy!!', content='| Head | Head | Head | Head |
| --- | --- | --- | --- |
| Data | Data | Data | Data |
| Data | Data | Data | Data |

## 手把手教你写一个markdown编辑器

> 笔者在18年年末的时候接到一个开发任务——搭建一个AI项目的开放平台，其中的产品文档为转化为HTML格式的markdown文档。考虑到文档的即时更新，将文档信息做成了Ajax接口的形式。因此管理后台只需将textarea表单的内容通过markdown解析器进行HTML格式转化，然后将markdown内容和经转化的HTML文档都保存到数据库即可。
> 基本需求完成后，为了更好的用户体验，考虑将常用的编辑功能添加进来。改进版不仅支持了常用的文本编辑功能，还实现的UI界面的配置化，自定义语法解析器。本着造福伸手党的目的，以及积累些开源经验，笔者将该react 组件 [react-markdown-editor-lite](https://github.com/HarryChen0506/react-markdown-editor-lite) 进行了封装改造，并且发布到了开源社区。

### 预览
在线体验 [https://harrychen0506.github.io/react-markdown-editor-lite/](https://harrychen0506.github.io/react-markdown-editor-lite/)

![image](https://github.com//HarryChen0506/react-markdown-editor-lite/blob/master/image/react-markdown-editor-lite-v1.0.0.PNG?raw=true)

### 特点
* 轻量、基于React
* UI可配置, 如只显示编辑区或预览区
* 支持自定义markdown语法解析器,语法高亮等
* 支持常用的markdown编辑功能，如加粗，斜体等等...
* 支持功能按钮插拔化，用户可以自定义扩展组件
* 支持编辑区和预览区同步滚动

### 开发心得

- 文本编辑

  大多数常见的编辑器，包括富文本编辑器，利用了某些元素如div的contenteditable属性，配合selection、range、execCommand等API，实现了富文本编辑功能。这里面的实现比较复杂，所以有了"[为什么都说富文本编辑器是天坑？](https://www.zhihu.com/question/38699645)"这个说法。

  而markdown编辑器，核心的处理内容为简单语法的纯文本，复杂度相对来说比较低，并且input标签自带onSelect事件，可以很方便的获取选择信息（选择起始位置和选择文本值），因此要想实现编辑功能，只需将要改动的内容进行文本转换，然后进行重新拼接首尾，大功告成。
  
- markdown解析

  考察了几个社区流行的markdown解析器，比较流行的有[markdown](https://www.npmjs.com/package/markdown), [markdown-it](https://www.npmjs.com/package/markdown-it), [marked](https://www.npmjs.com/package/marked) 等等。综合考虑扩展性以及稳定性，笔者推荐使用markdown-it作为markdown的词法解析器，因为该解析器有比较多的插件，并且支持语法高亮。

- 同步滚动

  当选择分栏编辑的时候，滚动左侧的编辑区，右侧的预览区能自动滚动到对应的区域。方案参考了《[手把手教你用 100行代码实现基于 react的 markdown 输入 + 即时预览在线编辑器（一）](https://github.com/accforgit/blog-data/blob/master/%E5%9C%A8%E7%BA%BF%E7%BC%96%E8%BE%91%E5%99%A8/README/README1.md)》。只需先计算出输入框容器元素与预览框容器元素之间最大scroll范围的比例值，然后根据主动滚动元素自身的scrollTop做相应的比例换算，即可知道对方区域的scrollTop值。

- 关于UI
 
  - 项目的字体库选择了Font Awesome风格，并且只选取了项目所需要的一些图标。
  - 编辑器的整体css均可通过全局覆盖的形式进行自定义。目前暂时只支持灰色主题。
  - 编辑器的显示区域包括菜单栏，编辑器，预览区，工具栏，通过配置组件的config属性，可以选择默认的展示区域。
  
### Install

```js
npm install react-markdown-editor-lite --save
```

### Props

| Property | Description | Type | default | Remarks |
| --- | --- | --- | --- | --- |
| value | markdown content | String | '' | required |
| style | component container style | Object | {height: '100%'} | not required |
| config | component config | Object | {view: {...}, logger: {...}} | not required |
| onChange | emitting when editor has changed | Function | ({html, md}) => {} | not required |
| onImageUpload | when image uploaded, callback emitting will get image markdown text | (file: File, callback: (url: string) => void) => void; | ({file, callback}) => {} | not required |
| renderHTML | Render markdown text to HTML. You can return either string, function or Promise | (text: string) => string|function|Promise | none | **required** |

### Example

``` js
'use strict';
import React from 'react'
import ReactDOM from 'react-dom'
import MdEditor from 'react-markdown-editor-lite'
import MarkdownIt from 'markdown-it'
import emoji from 'markdown-it-emoji'
import subscript from 'markdown-it-sub'
import superscript from 'markdown-it-sup'
import footnote from 'markdown-it-footnote'
import deflist from 'markdown-it-deflist'
import abbreviation from 'markdown-it-abbr'
import insert from 'markdown-it-ins'
import mark from 'markdown-it-mark'
import tasklists from 'markdown-it-task-lists'
import hljs from 'highlight.js'
import 'highlight.js/styles/atom-one-light.css'
// import 'highlight.js/styles/github.css'
import './index.less';

const MOCK_DATA = "I Love React."
export default class Demo extends React.Component {
  mdEditor = null
  mdParser = null
  constructor(props) {
    super(props)
    // initial a parsera
    this.mdParser = new MarkdownIt({
      html: true,
      linkify: true,
      typographer: true,
      highlight: function (str, lang) {
        if (lang && hljs.getLanguage(lang)) {
          try {
            return hljs.highlight(lang, str).value
          } catch (__) {}
        }    
        return '' // use external default escaping
      }
    })
    .use(emoji)
    .use(subscript)
    .use(superscript)
    .use(footnote)
    .use(deflist)
    .use(abbreviation)
    .use(insert)
    .use(mark)
    .use(tasklists, { enabled: this.taskLists })
    this.renderHTML = this.renderHTML.bind(this)
  }
  handleEditorChange({html, md}) {
    console.log('handleEditorChange', html, md)
  }
  handleImageUpload(file, callback) {
    const reader = new FileReader()
    reader.onload = () => {      
      const convertBase64UrlToBlob = (urlData) => {  
        let arr = urlData.split(','), mime = arr[0].match(/:(.*?);/)[1]
        let bstr = atob(arr[1])
        let n = bstr.length
        let u8arr = new Uint8Array(n)
        while (n--) {
          u8arr[n] = bstr.charCodeAt(n)
        }
        return new Blob([u8arr], {type:mime})
      }
      const blob = convertBase64UrlToBlob(reader.result)
      setTimeout(() => {
        // setTimeout 模拟异步上传图片
        // 当异步上传获取图片地址后，执行calback回调（参数为imageUrl字符串），即可将图片地址写入markdown
        callback('https://avatars0.githubusercontent.com/u/21263805?s=40&v=4')
      }, 1000)
    }
    reader.readAsDataURL(file)
  }
  renderHTML(text) {
    // 模拟异步渲染Markdown
    return new Promise((resolve) => {
      setTimeout(() => {
        resolve(this.mdParser.render(text))
      }, 1000)
    })
  }
  handleGetMdValue = () => {   
    this.mdEditor && alert(this.mdEditor.getMdValue())      
  }
  handleGetHtmlValue = () => {    
    this.mdEditor && alert(this.mdEditor.getHtmlValue())
  }
  render() {
    return (      
      <div>
        <nav>
          <button onClick={this.handleGetMdValue} >getMdValue</button>  
          <button onClick={this.handleGetHtmlValue} >getHtmlValue</button>  
        </nav>
        <section style="height: 500px">
          <MdEditor 
            ref={node => this.mdEditor = node}
            value={MOCK_DATA}
            style={{height: '400px'}}
            renderHTML={this.renderHTML}
            config={{
              view: {
                menu: true,
                md: true,
                html: true
              },
              imageUrl: 'https://octodex.github.com/images/minion.png'
            }}
            onChange={this.handleEditorChange} 
            onImageUpload={this.handleImageUpload}
          />
        </section>                        
      </div>      
    )
  }
}
```

### 最后

   欢迎大家使用和反馈，[项目地址](https://github.com/HarryChen0506/react-markdown-editor-lite) (https://github.com/HarryChen0506/react-markdown-editor-lite)， 你的点赞将是我莫大的动力😊

![1.png](https://s3.ca-central-1.amazonaws.com/res-blog-public/res-dev/blog_1636946743939_1.png)', firstPicture='', viewCount=83, createDate='Sun Nov 07 14:09:29 EST 2021', updateDate='Tue Jan 18 22:54:08 EST 2022'}}, total=null}
2022-01-19 19:44:39:913 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 15ms
2022-01-19 19:44:39:913 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 19:44:39:914 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 19:44:39:914 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 19:44:39:914 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 19:44:39:915 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 19:44:39:915 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 19:44:39:915 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 19:44:39:915 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=20createdate=Wed Jan 19 11:47:08 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/26.png, replyComments=[CommentListVo{commentId=21createdate=Wed Jan 19 11:47:21 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/89.png, replyComments=[CommentListVo{commentId=22createdate=Wed Jan 19 11:47:39 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/75.png, replyComments=null, CommentVo=CommentVo{parentCommentId=21, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='sfs@ss.c', content='eeeeee', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='tet', content='ree', status='0'}}, CommentListVo{commentId=27createdate=Wed Jan 19 17:01:06 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/2.png, replyComments=null, CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='ljh19911025@gmail.com', nickname='sds', parentCommentNickname='tet', content='wwww', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='tet', parentCommentNickname='null', content='etet', status='0'}}], total=1}
2022-01-19 19:44:39:915 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 17ms
2022-01-19 19:44:39:915 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 19:44:39:920 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 19:44:39:920 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 19:44:39:920 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 19:44:39:920 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 19:44:39:921 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 19:44:39:921 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 19:44:39:921 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=20createdate=Wed Jan 19 11:47:08 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/26.png, replyComments=[CommentListVo{commentId=21createdate=Wed Jan 19 11:47:21 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/89.png, replyComments=[CommentListVo{commentId=22createdate=Wed Jan 19 11:47:39 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/75.png, replyComments=null, CommentVo=CommentVo{parentCommentId=21, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='sfs@ss.c', content='eeeeee', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='tet', content='ree', status='0'}}, CommentListVo{commentId=27createdate=Wed Jan 19 17:01:06 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/2.png, replyComments=null, CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='ljh19911025@gmail.com', nickname='sds', parentCommentNickname='tet', content='wwww', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='tet', parentCommentNickname='null', content='etet', status='0'}}], total=1}
2022-01-19 19:44:39:921 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 23ms
2022-01-19 19:44:39:921 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 19:44:40:427 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 19:44:40:427 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 19:44:40:427 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 19:44:40:427 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 19:44:40:428 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 19:44:40:428 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 19:44:40:428 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=20createdate=Wed Jan 19 11:47:08 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/26.png, replyComments=[CommentListVo{commentId=21createdate=Wed Jan 19 11:47:21 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/89.png, replyComments=[CommentListVo{commentId=22createdate=Wed Jan 19 11:47:39 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/75.png, replyComments=null, CommentVo=CommentVo{parentCommentId=21, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='sfs@ss.c', content='eeeeee', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='tet', content='ree', status='0'}}, CommentListVo{commentId=27createdate=Wed Jan 19 17:01:06 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/2.png, replyComments=null, CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='ljh19911025@gmail.com', nickname='sds', parentCommentNickname='tet', content='wwww', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='tet', parentCommentNickname='null', content='etet', status='0'}}], total=1}
2022-01-19 19:44:40:428 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 6ms
2022-01-19 19:44:40:428 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 19:50:13:212 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 19:50:13:212 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 19:50:13:212 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 19:50:13:213 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 19:50:13:213 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 19:50:13:213 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 19:50:13:213 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 19:50:13:213 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 19:50:13:213 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 19:50:13:213 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 19:50:13:213 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 19:50:13:213 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/article/10005
2022-01-19 19:50:13:213 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 19:50:13:213 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 19:50:13:213 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.ArticleController.getPublicArticleDetail
2022-01-19 19:50:13:213 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 19:50:13:213 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 19:50:13:213 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 19:50:13:213 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=20createdate=Wed Jan 19 11:47:08 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/26.png, replyComments=[CommentListVo{commentId=21createdate=Wed Jan 19 11:47:21 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/89.png, replyComments=[CommentListVo{commentId=22createdate=Wed Jan 19 11:47:39 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/75.png, replyComments=null, CommentVo=CommentVo{parentCommentId=21, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='sfs@ss.c', content='eeeeee', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='tet', content='ree', status='0'}}, CommentListVo{commentId=27createdate=Wed Jan 19 17:01:06 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/2.png, replyComments=null, CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='ljh19911025@gmail.com', nickname='sds', parentCommentNickname='tet', content='wwww', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='tet', parentCommentNickname='null', content='etet', status='0'}}], total=1}
2022-01-19 19:50:13:213 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 15ms
2022-01-19 19:50:13:213 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 19:50:13:213 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=20createdate=Wed Jan 19 11:47:08 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/26.png, replyComments=[CommentListVo{commentId=21createdate=Wed Jan 19 11:47:21 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/89.png, replyComments=[CommentListVo{commentId=22createdate=Wed Jan 19 11:47:39 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/75.png, replyComments=null, CommentVo=CommentVo{parentCommentId=21, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='sfs@ss.c', content='eeeeee', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='tet', content='ree', status='0'}}, CommentListVo{commentId=27createdate=Wed Jan 19 17:01:06 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/2.png, replyComments=null, CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='ljh19911025@gmail.com', nickname='sds', parentCommentNickname='tet', content='wwww', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='tet', parentCommentNickname='null', content='etet', status='0'}}], total=1}
2022-01-19 19:50:13:213 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=ArticleVo{userInfo=UserInfoVo{userId=100001, nickName='ivan', userName='ivan', avatar='https://res-blog-public.s3.ca-central-1.amazonaws.com/default_avatar.jpg'}, category=CategoryVo{categoryId=1, name='Life ', articleCount=null}, BaseArticleVo{articleId=10005, status=1, type=1, title='dd', description='This is the doc of React markdown editor lite.
Enjoy!!', content='| Head | Head | Head | Head |
| --- | --- | --- | --- |
| Data | Data | Data | Data |
| Data | Data | Data | Data |

## 手把手教你写一个markdown编辑器

> 笔者在18年年末的时候接到一个开发任务——搭建一个AI项目的开放平台，其中的产品文档为转化为HTML格式的markdown文档。考虑到文档的即时更新，将文档信息做成了Ajax接口的形式。因此管理后台只需将textarea表单的内容通过markdown解析器进行HTML格式转化，然后将markdown内容和经转化的HTML文档都保存到数据库即可。
> 基本需求完成后，为了更好的用户体验，考虑将常用的编辑功能添加进来。改进版不仅支持了常用的文本编辑功能，还实现的UI界面的配置化，自定义语法解析器。本着造福伸手党的目的，以及积累些开源经验，笔者将该react 组件 [react-markdown-editor-lite](https://github.com/HarryChen0506/react-markdown-editor-lite) 进行了封装改造，并且发布到了开源社区。

### 预览
在线体验 [https://harrychen0506.github.io/react-markdown-editor-lite/](https://harrychen0506.github.io/react-markdown-editor-lite/)

![image](https://github.com//HarryChen0506/react-markdown-editor-lite/blob/master/image/react-markdown-editor-lite-v1.0.0.PNG?raw=true)

### 特点
* 轻量、基于React
* UI可配置, 如只显示编辑区或预览区
* 支持自定义markdown语法解析器,语法高亮等
* 支持常用的markdown编辑功能，如加粗，斜体等等...
* 支持功能按钮插拔化，用户可以自定义扩展组件
* 支持编辑区和预览区同步滚动

### 开发心得

- 文本编辑

  大多数常见的编辑器，包括富文本编辑器，利用了某些元素如div的contenteditable属性，配合selection、range、execCommand等API，实现了富文本编辑功能。这里面的实现比较复杂，所以有了"[为什么都说富文本编辑器是天坑？](https://www.zhihu.com/question/38699645)"这个说法。

  而markdown编辑器，核心的处理内容为简单语法的纯文本，复杂度相对来说比较低，并且input标签自带onSelect事件，可以很方便的获取选择信息（选择起始位置和选择文本值），因此要想实现编辑功能，只需将要改动的内容进行文本转换，然后进行重新拼接首尾，大功告成。
  
- markdown解析

  考察了几个社区流行的markdown解析器，比较流行的有[markdown](https://www.npmjs.com/package/markdown), [markdown-it](https://www.npmjs.com/package/markdown-it), [marked](https://www.npmjs.com/package/marked) 等等。综合考虑扩展性以及稳定性，笔者推荐使用markdown-it作为markdown的词法解析器，因为该解析器有比较多的插件，并且支持语法高亮。

- 同步滚动

  当选择分栏编辑的时候，滚动左侧的编辑区，右侧的预览区能自动滚动到对应的区域。方案参考了《[手把手教你用 100行代码实现基于 react的 markdown 输入 + 即时预览在线编辑器（一）](https://github.com/accforgit/blog-data/blob/master/%E5%9C%A8%E7%BA%BF%E7%BC%96%E8%BE%91%E5%99%A8/README/README1.md)》。只需先计算出输入框容器元素与预览框容器元素之间最大scroll范围的比例值，然后根据主动滚动元素自身的scrollTop做相应的比例换算，即可知道对方区域的scrollTop值。

- 关于UI
 
  - 项目的字体库选择了Font Awesome风格，并且只选取了项目所需要的一些图标。
  - 编辑器的整体css均可通过全局覆盖的形式进行自定义。目前暂时只支持灰色主题。
  - 编辑器的显示区域包括菜单栏，编辑器，预览区，工具栏，通过配置组件的config属性，可以选择默认的展示区域。
  
### Install

```js
npm install react-markdown-editor-lite --save
```

### Props

| Property | Description | Type | default | Remarks |
| --- | --- | --- | --- | --- |
| value | markdown content | String | '' | required |
| style | component container style | Object | {height: '100%'} | not required |
| config | component config | Object | {view: {...}, logger: {...}} | not required |
| onChange | emitting when editor has changed | Function | ({html, md}) => {} | not required |
| onImageUpload | when image uploaded, callback emitting will get image markdown text | (file: File, callback: (url: string) => void) => void; | ({file, callback}) => {} | not required |
| renderHTML | Render markdown text to HTML. You can return either string, function or Promise | (text: string) => string|function|Promise | none | **required** |

### Example

``` js
'use strict';
import React from 'react'
import ReactDOM from 'react-dom'
import MdEditor from 'react-markdown-editor-lite'
import MarkdownIt from 'markdown-it'
import emoji from 'markdown-it-emoji'
import subscript from 'markdown-it-sub'
import superscript from 'markdown-it-sup'
import footnote from 'markdown-it-footnote'
import deflist from 'markdown-it-deflist'
import abbreviation from 'markdown-it-abbr'
import insert from 'markdown-it-ins'
import mark from 'markdown-it-mark'
import tasklists from 'markdown-it-task-lists'
import hljs from 'highlight.js'
import 'highlight.js/styles/atom-one-light.css'
// import 'highlight.js/styles/github.css'
import './index.less';

const MOCK_DATA = "I Love React."
export default class Demo extends React.Component {
  mdEditor = null
  mdParser = null
  constructor(props) {
    super(props)
    // initial a parsera
    this.mdParser = new MarkdownIt({
      html: true,
      linkify: true,
      typographer: true,
      highlight: function (str, lang) {
        if (lang && hljs.getLanguage(lang)) {
          try {
            return hljs.highlight(lang, str).value
          } catch (__) {}
        }    
        return '' // use external default escaping
      }
    })
    .use(emoji)
    .use(subscript)
    .use(superscript)
    .use(footnote)
    .use(deflist)
    .use(abbreviation)
    .use(insert)
    .use(mark)
    .use(tasklists, { enabled: this.taskLists })
    this.renderHTML = this.renderHTML.bind(this)
  }
  handleEditorChange({html, md}) {
    console.log('handleEditorChange', html, md)
  }
  handleImageUpload(file, callback) {
    const reader = new FileReader()
    reader.onload = () => {      
      const convertBase64UrlToBlob = (urlData) => {  
        let arr = urlData.split(','), mime = arr[0].match(/:(.*?);/)[1]
        let bstr = atob(arr[1])
        let n = bstr.length
        let u8arr = new Uint8Array(n)
        while (n--) {
          u8arr[n] = bstr.charCodeAt(n)
        }
        return new Blob([u8arr], {type:mime})
      }
      const blob = convertBase64UrlToBlob(reader.result)
      setTimeout(() => {
        // setTimeout 模拟异步上传图片
        // 当异步上传获取图片地址后，执行calback回调（参数为imageUrl字符串），即可将图片地址写入markdown
        callback('https://avatars0.githubusercontent.com/u/21263805?s=40&v=4')
      }, 1000)
    }
    reader.readAsDataURL(file)
  }
  renderHTML(text) {
    // 模拟异步渲染Markdown
    return new Promise((resolve) => {
      setTimeout(() => {
        resolve(this.mdParser.render(text))
      }, 1000)
    })
  }
  handleGetMdValue = () => {   
    this.mdEditor && alert(this.mdEditor.getMdValue())      
  }
  handleGetHtmlValue = () => {    
    this.mdEditor && alert(this.mdEditor.getHtmlValue())
  }
  render() {
    return (      
      <div>
        <nav>
          <button onClick={this.handleGetMdValue} >getMdValue</button>  
          <button onClick={this.handleGetHtmlValue} >getHtmlValue</button>  
        </nav>
        <section style="height: 500px">
          <MdEditor 
            ref={node => this.mdEditor = node}
            value={MOCK_DATA}
            style={{height: '400px'}}
            renderHTML={this.renderHTML}
            config={{
              view: {
                menu: true,
                md: true,
                html: true
              },
              imageUrl: 'https://octodex.github.com/images/minion.png'
            }}
            onChange={this.handleEditorChange} 
            onImageUpload={this.handleImageUpload}
          />
        </section>                        
      </div>      
    )
  }
}
```

### 最后

   欢迎大家使用和反馈，[项目地址](https://github.com/HarryChen0506/react-markdown-editor-lite) (https://github.com/HarryChen0506/react-markdown-editor-lite)， 你的点赞将是我莫大的动力😊

![1.png](https://s3.ca-central-1.amazonaws.com/res-blog-public/res-dev/blog_1636946743939_1.png)', firstPicture='', viewCount=83, createDate='Sun Nov 07 14:09:29 EST 2021', updateDate='Tue Jan 18 22:54:08 EST 2022'}}, total=null}
2022-01-19 19:50:13:213 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 15ms
2022-01-19 19:50:13:213 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 15ms
2022-01-19 19:50:13:213 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 19:50:13:213 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 19:50:58:844 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 19:50:58:844 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 19:50:58:844 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 19:50:58:844 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 19:50:58:844 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 19:50:58:846 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 19:50:58:846 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=20createdate=Wed Jan 19 11:47:08 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/26.png, replyComments=[CommentListVo{commentId=21createdate=Wed Jan 19 11:47:21 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/89.png, replyComments=[CommentListVo{commentId=22createdate=Wed Jan 19 11:47:39 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/75.png, replyComments=null, CommentVo=CommentVo{parentCommentId=21, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='sfs@ss.c', content='eeeeee', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='tet', content='ree', status='0'}}, CommentListVo{commentId=27createdate=Wed Jan 19 17:01:06 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/2.png, replyComments=null, CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='ljh19911025@gmail.com', nickname='sds', parentCommentNickname='tet', content='wwww', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='tet', parentCommentNickname='null', content='etet', status='0'}}], total=1}
2022-01-19 19:50:58:847 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 9ms
2022-01-19 19:50:58:847 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 19:50:58:850 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 19:50:58:850 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 19:50:58:850 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 19:50:58:850 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/article/10005
2022-01-19 19:50:58:850 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.ArticleController.getPublicArticleDetail
2022-01-19 19:50:58:850 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 19:50:58:850 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=ArticleVo{userInfo=UserInfoVo{userId=100001, nickName='ivan', userName='ivan', avatar='https://res-blog-public.s3.ca-central-1.amazonaws.com/default_avatar.jpg'}, category=CategoryVo{categoryId=1, name='Life ', articleCount=null}, BaseArticleVo{articleId=10005, status=1, type=1, title='dd', description='This is the doc of React markdown editor lite.
Enjoy!!', content='| Head | Head | Head | Head |
| --- | --- | --- | --- |
| Data | Data | Data | Data |
| Data | Data | Data | Data |

## 手把手教你写一个markdown编辑器

> 笔者在18年年末的时候接到一个开发任务——搭建一个AI项目的开放平台，其中的产品文档为转化为HTML格式的markdown文档。考虑到文档的即时更新，将文档信息做成了Ajax接口的形式。因此管理后台只需将textarea表单的内容通过markdown解析器进行HTML格式转化，然后将markdown内容和经转化的HTML文档都保存到数据库即可。
> 基本需求完成后，为了更好的用户体验，考虑将常用的编辑功能添加进来。改进版不仅支持了常用的文本编辑功能，还实现的UI界面的配置化，自定义语法解析器。本着造福伸手党的目的，以及积累些开源经验，笔者将该react 组件 [react-markdown-editor-lite](https://github.com/HarryChen0506/react-markdown-editor-lite) 进行了封装改造，并且发布到了开源社区。

### 预览
在线体验 [https://harrychen0506.github.io/react-markdown-editor-lite/](https://harrychen0506.github.io/react-markdown-editor-lite/)

![image](https://github.com//HarryChen0506/react-markdown-editor-lite/blob/master/image/react-markdown-editor-lite-v1.0.0.PNG?raw=true)

### 特点
* 轻量、基于React
* UI可配置, 如只显示编辑区或预览区
* 支持自定义markdown语法解析器,语法高亮等
* 支持常用的markdown编辑功能，如加粗，斜体等等...
* 支持功能按钮插拔化，用户可以自定义扩展组件
* 支持编辑区和预览区同步滚动

### 开发心得

- 文本编辑

  大多数常见的编辑器，包括富文本编辑器，利用了某些元素如div的contenteditable属性，配合selection、range、execCommand等API，实现了富文本编辑功能。这里面的实现比较复杂，所以有了"[为什么都说富文本编辑器是天坑？](https://www.zhihu.com/question/38699645)"这个说法。

  而markdown编辑器，核心的处理内容为简单语法的纯文本，复杂度相对来说比较低，并且input标签自带onSelect事件，可以很方便的获取选择信息（选择起始位置和选择文本值），因此要想实现编辑功能，只需将要改动的内容进行文本转换，然后进行重新拼接首尾，大功告成。
  
- markdown解析

  考察了几个社区流行的markdown解析器，比较流行的有[markdown](https://www.npmjs.com/package/markdown), [markdown-it](https://www.npmjs.com/package/markdown-it), [marked](https://www.npmjs.com/package/marked) 等等。综合考虑扩展性以及稳定性，笔者推荐使用markdown-it作为markdown的词法解析器，因为该解析器有比较多的插件，并且支持语法高亮。

- 同步滚动

  当选择分栏编辑的时候，滚动左侧的编辑区，右侧的预览区能自动滚动到对应的区域。方案参考了《[手把手教你用 100行代码实现基于 react的 markdown 输入 + 即时预览在线编辑器（一）](https://github.com/accforgit/blog-data/blob/master/%E5%9C%A8%E7%BA%BF%E7%BC%96%E8%BE%91%E5%99%A8/README/README1.md)》。只需先计算出输入框容器元素与预览框容器元素之间最大scroll范围的比例值，然后根据主动滚动元素自身的scrollTop做相应的比例换算，即可知道对方区域的scrollTop值。

- 关于UI
 
  - 项目的字体库选择了Font Awesome风格，并且只选取了项目所需要的一些图标。
  - 编辑器的整体css均可通过全局覆盖的形式进行自定义。目前暂时只支持灰色主题。
  - 编辑器的显示区域包括菜单栏，编辑器，预览区，工具栏，通过配置组件的config属性，可以选择默认的展示区域。
  
### Install

```js
npm install react-markdown-editor-lite --save
```

### Props

| Property | Description | Type | default | Remarks |
| --- | --- | --- | --- | --- |
| value | markdown content | String | '' | required |
| style | component container style | Object | {height: '100%'} | not required |
| config | component config | Object | {view: {...}, logger: {...}} | not required |
| onChange | emitting when editor has changed | Function | ({html, md}) => {} | not required |
| onImageUpload | when image uploaded, callback emitting will get image markdown text | (file: File, callback: (url: string) => void) => void; | ({file, callback}) => {} | not required |
| renderHTML | Render markdown text to HTML. You can return either string, function or Promise | (text: string) => string|function|Promise | none | **required** |

### Example

``` js
'use strict';
import React from 'react'
import ReactDOM from 'react-dom'
import MdEditor from 'react-markdown-editor-lite'
import MarkdownIt from 'markdown-it'
import emoji from 'markdown-it-emoji'
import subscript from 'markdown-it-sub'
import superscript from 'markdown-it-sup'
import footnote from 'markdown-it-footnote'
import deflist from 'markdown-it-deflist'
import abbreviation from 'markdown-it-abbr'
import insert from 'markdown-it-ins'
import mark from 'markdown-it-mark'
import tasklists from 'markdown-it-task-lists'
import hljs from 'highlight.js'
import 'highlight.js/styles/atom-one-light.css'
// import 'highlight.js/styles/github.css'
import './index.less';

const MOCK_DATA = "I Love React."
export default class Demo extends React.Component {
  mdEditor = null
  mdParser = null
  constructor(props) {
    super(props)
    // initial a parsera
    this.mdParser = new MarkdownIt({
      html: true,
      linkify: true,
      typographer: true,
      highlight: function (str, lang) {
        if (lang && hljs.getLanguage(lang)) {
          try {
            return hljs.highlight(lang, str).value
          } catch (__) {}
        }    
        return '' // use external default escaping
      }
    })
    .use(emoji)
    .use(subscript)
    .use(superscript)
    .use(footnote)
    .use(deflist)
    .use(abbreviation)
    .use(insert)
    .use(mark)
    .use(tasklists, { enabled: this.taskLists })
    this.renderHTML = this.renderHTML.bind(this)
  }
  handleEditorChange({html, md}) {
    console.log('handleEditorChange', html, md)
  }
  handleImageUpload(file, callback) {
    const reader = new FileReader()
    reader.onload = () => {      
      const convertBase64UrlToBlob = (urlData) => {  
        let arr = urlData.split(','), mime = arr[0].match(/:(.*?);/)[1]
        let bstr = atob(arr[1])
        let n = bstr.length
        let u8arr = new Uint8Array(n)
        while (n--) {
          u8arr[n] = bstr.charCodeAt(n)
        }
        return new Blob([u8arr], {type:mime})
      }
      const blob = convertBase64UrlToBlob(reader.result)
      setTimeout(() => {
        // setTimeout 模拟异步上传图片
        // 当异步上传获取图片地址后，执行calback回调（参数为imageUrl字符串），即可将图片地址写入markdown
        callback('https://avatars0.githubusercontent.com/u/21263805?s=40&v=4')
      }, 1000)
    }
    reader.readAsDataURL(file)
  }
  renderHTML(text) {
    // 模拟异步渲染Markdown
    return new Promise((resolve) => {
      setTimeout(() => {
        resolve(this.mdParser.render(text))
      }, 1000)
    })
  }
  handleGetMdValue = () => {   
    this.mdEditor && alert(this.mdEditor.getMdValue())      
  }
  handleGetHtmlValue = () => {    
    this.mdEditor && alert(this.mdEditor.getHtmlValue())
  }
  render() {
    return (      
      <div>
        <nav>
          <button onClick={this.handleGetMdValue} >getMdValue</button>  
          <button onClick={this.handleGetHtmlValue} >getHtmlValue</button>  
        </nav>
        <section style="height: 500px">
          <MdEditor 
            ref={node => this.mdEditor = node}
            value={MOCK_DATA}
            style={{height: '400px'}}
            renderHTML={this.renderHTML}
            config={{
              view: {
                menu: true,
                md: true,
                html: true
              },
              imageUrl: 'https://octodex.github.com/images/minion.png'
            }}
            onChange={this.handleEditorChange} 
            onImageUpload={this.handleImageUpload}
          />
        </section>                        
      </div>      
    )
  }
}
```

### 最后

   欢迎大家使用和反馈，[项目地址](https://github.com/HarryChen0506/react-markdown-editor-lite) (https://github.com/HarryChen0506/react-markdown-editor-lite)， 你的点赞将是我莫大的动力😊

![1.png](https://s3.ca-central-1.amazonaws.com/res-blog-public/res-dev/blog_1636946743939_1.png)', firstPicture='', viewCount=83, createDate='Sun Nov 07 14:09:29 EST 2021', updateDate='Tue Jan 18 22:54:08 EST 2022'}}, total=null}
2022-01-19 19:50:58:850 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 15ms
2022-01-19 19:50:58:850 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 19:50:58:859 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 19:50:58:859 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 19:50:58:859 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 19:50:58:859 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 19:50:58:859 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 19:50:58:859 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 19:50:58:859 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=20createdate=Wed Jan 19 11:47:08 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/26.png, replyComments=[CommentListVo{commentId=21createdate=Wed Jan 19 11:47:21 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/89.png, replyComments=[CommentListVo{commentId=22createdate=Wed Jan 19 11:47:39 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/75.png, replyComments=null, CommentVo=CommentVo{parentCommentId=21, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='sfs@ss.c', content='eeeeee', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='tet', content='ree', status='0'}}, CommentListVo{commentId=27createdate=Wed Jan 19 17:01:06 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/2.png, replyComments=null, CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='ljh19911025@gmail.com', nickname='sds', parentCommentNickname='tet', content='wwww', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='tet', parentCommentNickname='null', content='etet', status='0'}}], total=1}
2022-01-19 19:50:58:859 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 23ms
2022-01-19 19:50:58:859 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 19:53:53:213 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 19:53:53:213 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 19:53:53:214 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 19:53:53:214 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 19:53:53:214 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 19:53:53:214 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 19:53:53:214 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 19:53:53:214 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 19:53:53:214 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 19:53:53:214 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 19:53:53:214 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 19:53:53:214 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/article/10005
2022-01-19 19:53:53:214 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 19:53:53:214 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.ArticleController.getPublicArticleDetail
2022-01-19 19:53:53:214 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 19:53:53:214 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 19:53:53:214 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 19:53:53:214 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 19:53:53:214 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=20createdate=Wed Jan 19 11:47:08 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/26.png, replyComments=[CommentListVo{commentId=21createdate=Wed Jan 19 11:47:21 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/89.png, replyComments=[CommentListVo{commentId=22createdate=Wed Jan 19 11:47:39 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/75.png, replyComments=null, CommentVo=CommentVo{parentCommentId=21, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='sfs@ss.c', content='eeeeee', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='tet', content='ree', status='0'}}, CommentListVo{commentId=27createdate=Wed Jan 19 17:01:06 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/2.png, replyComments=null, CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='ljh19911025@gmail.com', nickname='sds', parentCommentNickname='tet', content='wwww', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='tet', parentCommentNickname='null', content='etet', status='0'}}], total=1}
2022-01-19 19:53:53:214 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=20createdate=Wed Jan 19 11:47:08 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/26.png, replyComments=[CommentListVo{commentId=21createdate=Wed Jan 19 11:47:21 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/89.png, replyComments=[CommentListVo{commentId=22createdate=Wed Jan 19 11:47:39 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/75.png, replyComments=null, CommentVo=CommentVo{parentCommentId=21, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='sfs@ss.c', content='eeeeee', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='tet', content='ree', status='0'}}, CommentListVo{commentId=27createdate=Wed Jan 19 17:01:06 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/2.png, replyComments=null, CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='ljh19911025@gmail.com', nickname='sds', parentCommentNickname='tet', content='wwww', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='tet', parentCommentNickname='null', content='etet', status='0'}}], total=1}
2022-01-19 19:53:53:215 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 26ms
2022-01-19 19:53:53:214 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=ArticleVo{userInfo=UserInfoVo{userId=100001, nickName='ivan', userName='ivan', avatar='https://res-blog-public.s3.ca-central-1.amazonaws.com/default_avatar.jpg'}, category=CategoryVo{categoryId=1, name='Life ', articleCount=null}, BaseArticleVo{articleId=10005, status=1, type=1, title='dd', description='This is the doc of React markdown editor lite.
Enjoy!!', content='| Head | Head | Head | Head |
| --- | --- | --- | --- |
| Data | Data | Data | Data |
| Data | Data | Data | Data |

## 手把手教你写一个markdown编辑器

> 笔者在18年年末的时候接到一个开发任务——搭建一个AI项目的开放平台，其中的产品文档为转化为HTML格式的markdown文档。考虑到文档的即时更新，将文档信息做成了Ajax接口的形式。因此管理后台只需将textarea表单的内容通过markdown解析器进行HTML格式转化，然后将markdown内容和经转化的HTML文档都保存到数据库即可。
> 基本需求完成后，为了更好的用户体验，考虑将常用的编辑功能添加进来。改进版不仅支持了常用的文本编辑功能，还实现的UI界面的配置化，自定义语法解析器。本着造福伸手党的目的，以及积累些开源经验，笔者将该react 组件 [react-markdown-editor-lite](https://github.com/HarryChen0506/react-markdown-editor-lite) 进行了封装改造，并且发布到了开源社区。

### 预览
在线体验 [https://harrychen0506.github.io/react-markdown-editor-lite/](https://harrychen0506.github.io/react-markdown-editor-lite/)

![image](https://github.com//HarryChen0506/react-markdown-editor-lite/blob/master/image/react-markdown-editor-lite-v1.0.0.PNG?raw=true)

### 特点
* 轻量、基于React
* UI可配置, 如只显示编辑区或预览区
* 支持自定义markdown语法解析器,语法高亮等
* 支持常用的markdown编辑功能，如加粗，斜体等等...
* 支持功能按钮插拔化，用户可以自定义扩展组件
* 支持编辑区和预览区同步滚动

### 开发心得

- 文本编辑

  大多数常见的编辑器，包括富文本编辑器，利用了某些元素如div的contenteditable属性，配合selection、range、execCommand等API，实现了富文本编辑功能。这里面的实现比较复杂，所以有了"[为什么都说富文本编辑器是天坑？](https://www.zhihu.com/question/38699645)"这个说法。

  而markdown编辑器，核心的处理内容为简单语法的纯文本，复杂度相对来说比较低，并且input标签自带onSelect事件，可以很方便的获取选择信息（选择起始位置和选择文本值），因此要想实现编辑功能，只需将要改动的内容进行文本转换，然后进行重新拼接首尾，大功告成。
  
- markdown解析

  考察了几个社区流行的markdown解析器，比较流行的有[markdown](https://www.npmjs.com/package/markdown), [markdown-it](https://www.npmjs.com/package/markdown-it), [marked](https://www.npmjs.com/package/marked) 等等。综合考虑扩展性以及稳定性，笔者推荐使用markdown-it作为markdown的词法解析器，因为该解析器有比较多的插件，并且支持语法高亮。

- 同步滚动

  当选择分栏编辑的时候，滚动左侧的编辑区，右侧的预览区能自动滚动到对应的区域。方案参考了《[手把手教你用 100行代码实现基于 react的 markdown 输入 + 即时预览在线编辑器（一）](https://github.com/accforgit/blog-data/blob/master/%E5%9C%A8%E7%BA%BF%E7%BC%96%E8%BE%91%E5%99%A8/README/README1.md)》。只需先计算出输入框容器元素与预览框容器元素之间最大scroll范围的比例值，然后根据主动滚动元素自身的scrollTop做相应的比例换算，即可知道对方区域的scrollTop值。

- 关于UI
 
  - 项目的字体库选择了Font Awesome风格，并且只选取了项目所需要的一些图标。
  - 编辑器的整体css均可通过全局覆盖的形式进行自定义。目前暂时只支持灰色主题。
  - 编辑器的显示区域包括菜单栏，编辑器，预览区，工具栏，通过配置组件的config属性，可以选择默认的展示区域。
  
### Install

```js
npm install react-markdown-editor-lite --save
```

### Props

| Property | Description | Type | default | Remarks |
| --- | --- | --- | --- | --- |
| value | markdown content | String | '' | required |
| style | component container style | Object | {height: '100%'} | not required |
| config | component config | Object | {view: {...}, logger: {...}} | not required |
| onChange | emitting when editor has changed | Function | ({html, md}) => {} | not required |
| onImageUpload | when image uploaded, callback emitting will get image markdown text | (file: File, callback: (url: string) => void) => void; | ({file, callback}) => {} | not required |
| renderHTML | Render markdown text to HTML. You can return either string, function or Promise | (text: string) => string|function|Promise | none | **required** |

### Example

``` js
'use strict';
import React from 'react'
import ReactDOM from 'react-dom'
import MdEditor from 'react-markdown-editor-lite'
import MarkdownIt from 'markdown-it'
import emoji from 'markdown-it-emoji'
import subscript from 'markdown-it-sub'
import superscript from 'markdown-it-sup'
import footnote from 'markdown-it-footnote'
import deflist from 'markdown-it-deflist'
import abbreviation from 'markdown-it-abbr'
import insert from 'markdown-it-ins'
import mark from 'markdown-it-mark'
import tasklists from 'markdown-it-task-lists'
import hljs from 'highlight.js'
import 'highlight.js/styles/atom-one-light.css'
// import 'highlight.js/styles/github.css'
import './index.less';

const MOCK_DATA = "I Love React."
export default class Demo extends React.Component {
  mdEditor = null
  mdParser = null
  constructor(props) {
    super(props)
    // initial a parsera
    this.mdParser = new MarkdownIt({
      html: true,
      linkify: true,
      typographer: true,
      highlight: function (str, lang) {
        if (lang && hljs.getLanguage(lang)) {
          try {
            return hljs.highlight(lang, str).value
          } catch (__) {}
        }    
        return '' // use external default escaping
      }
    })
    .use(emoji)
    .use(subscript)
    .use(superscript)
    .use(footnote)
    .use(deflist)
    .use(abbreviation)
    .use(insert)
    .use(mark)
    .use(tasklists, { enabled: this.taskLists })
    this.renderHTML = this.renderHTML.bind(this)
  }
  handleEditorChange({html, md}) {
    console.log('handleEditorChange', html, md)
  }
  handleImageUpload(file, callback) {
    const reader = new FileReader()
    reader.onload = () => {      
      const convertBase64UrlToBlob = (urlData) => {  
        let arr = urlData.split(','), mime = arr[0].match(/:(.*?);/)[1]
        let bstr = atob(arr[1])
        let n = bstr.length
        let u8arr = new Uint8Array(n)
        while (n--) {
          u8arr[n] = bstr.charCodeAt(n)
        }
        return new Blob([u8arr], {type:mime})
      }
      const blob = convertBase64UrlToBlob(reader.result)
      setTimeout(() => {
        // setTimeout 模拟异步上传图片
        // 当异步上传获取图片地址后，执行calback回调（参数为imageUrl字符串），即可将图片地址写入markdown
        callback('https://avatars0.githubusercontent.com/u/21263805?s=40&v=4')
      }, 1000)
    }
    reader.readAsDataURL(file)
  }
  renderHTML(text) {
    // 模拟异步渲染Markdown
    return new Promise((resolve) => {
      setTimeout(() => {
        resolve(this.mdParser.render(text))
      }, 1000)
    })
  }
  handleGetMdValue = () => {   
    this.mdEditor && alert(this.mdEditor.getMdValue())      
  }
  handleGetHtmlValue = () => {    
    this.mdEditor && alert(this.mdEditor.getHtmlValue())
  }
  render() {
    return (      
      <div>
        <nav>
          <button onClick={this.handleGetMdValue} >getMdValue</button>  
          <button onClick={this.handleGetHtmlValue} >getHtmlValue</button>  
        </nav>
        <section style="height: 500px">
          <MdEditor 
            ref={node => this.mdEditor = node}
            value={MOCK_DATA}
            style={{height: '400px'}}
            renderHTML={this.renderHTML}
            config={{
              view: {
                menu: true,
                md: true,
                html: true
              },
              imageUrl: 'https://octodex.github.com/images/minion.png'
            }}
            onChange={this.handleEditorChange} 
            onImageUpload={this.handleImageUpload}
          />
        </section>                        
      </div>      
    )
  }
}
```

### 最后

   欢迎大家使用和反馈，[项目地址](https://github.com/HarryChen0506/react-markdown-editor-lite) (https://github.com/HarryChen0506/react-markdown-editor-lite)， 你的点赞将是我莫大的动力😊

![1.png](https://s3.ca-central-1.amazonaws.com/res-blog-public/res-dev/blog_1636946743939_1.png)', firstPicture='', viewCount=83, createDate='Sun Nov 07 14:09:29 EST 2021', updateDate='Tue Jan 18 22:54:08 EST 2022'}}, total=null}
2022-01-19 19:53:53:215 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 24ms
2022-01-19 19:53:53:215 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 19:53:53:215 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 23ms
2022-01-19 19:53:53:215 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 19:53:53:215 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 19:54:35:361 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 19:54:35:362 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 19:54:35:362 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 19:54:35:362 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 19:54:35:362 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 19:54:35:362 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 19:54:35:362 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 19:54:35:362 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 19:54:35:362 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 19:54:35:362 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 19:54:35:362 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 19:54:35:362 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 19:54:35:362 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=20createdate=Wed Jan 19 11:47:08 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/26.png, replyComments=[CommentListVo{commentId=21createdate=Wed Jan 19 11:47:21 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/89.png, replyComments=[CommentListVo{commentId=22createdate=Wed Jan 19 11:47:39 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/75.png, replyComments=null, CommentVo=CommentVo{parentCommentId=21, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='sfs@ss.c', content='eeeeee', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='tet', content='ree', status='0'}}, CommentListVo{commentId=27createdate=Wed Jan 19 17:01:06 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/2.png, replyComments=null, CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='ljh19911025@gmail.com', nickname='sds', parentCommentNickname='tet', content='wwww', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='tet', parentCommentNickname='null', content='etet', status='0'}}], total=1}
2022-01-19 19:54:35:362 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 14ms
2022-01-19 19:54:35:362 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 19:54:35:362 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=20createdate=Wed Jan 19 11:47:08 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/26.png, replyComments=[CommentListVo{commentId=21createdate=Wed Jan 19 11:47:21 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/89.png, replyComments=[CommentListVo{commentId=22createdate=Wed Jan 19 11:47:39 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/75.png, replyComments=null, CommentVo=CommentVo{parentCommentId=21, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='sfs@ss.c', content='eeeeee', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='tet', content='ree', status='0'}}, CommentListVo{commentId=27createdate=Wed Jan 19 17:01:06 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/2.png, replyComments=null, CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='ljh19911025@gmail.com', nickname='sds', parentCommentNickname='tet', content='wwww', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='tet', parentCommentNickname='null', content='etet', status='0'}}], total=1}
2022-01-19 19:54:35:362 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 15ms
2022-01-19 19:54:35:362 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 19:54:35:372 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 19:54:35:372 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 19:54:35:372 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 19:54:35:372 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/article/10005
2022-01-19 19:54:35:372 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.ArticleController.getPublicArticleDetail
2022-01-19 19:54:35:372 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 19:54:35:372 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=ArticleVo{userInfo=UserInfoVo{userId=100001, nickName='ivan', userName='ivan', avatar='https://res-blog-public.s3.ca-central-1.amazonaws.com/default_avatar.jpg'}, category=CategoryVo{categoryId=1, name='Life ', articleCount=null}, BaseArticleVo{articleId=10005, status=1, type=1, title='dd', description='This is the doc of React markdown editor lite.
Enjoy!!', content='| Head | Head | Head | Head |
| --- | --- | --- | --- |
| Data | Data | Data | Data |
| Data | Data | Data | Data |

## 手把手教你写一个markdown编辑器

> 笔者在18年年末的时候接到一个开发任务——搭建一个AI项目的开放平台，其中的产品文档为转化为HTML格式的markdown文档。考虑到文档的即时更新，将文档信息做成了Ajax接口的形式。因此管理后台只需将textarea表单的内容通过markdown解析器进行HTML格式转化，然后将markdown内容和经转化的HTML文档都保存到数据库即可。
> 基本需求完成后，为了更好的用户体验，考虑将常用的编辑功能添加进来。改进版不仅支持了常用的文本编辑功能，还实现的UI界面的配置化，自定义语法解析器。本着造福伸手党的目的，以及积累些开源经验，笔者将该react 组件 [react-markdown-editor-lite](https://github.com/HarryChen0506/react-markdown-editor-lite) 进行了封装改造，并且发布到了开源社区。

### 预览
在线体验 [https://harrychen0506.github.io/react-markdown-editor-lite/](https://harrychen0506.github.io/react-markdown-editor-lite/)

![image](https://github.com//HarryChen0506/react-markdown-editor-lite/blob/master/image/react-markdown-editor-lite-v1.0.0.PNG?raw=true)

### 特点
* 轻量、基于React
* UI可配置, 如只显示编辑区或预览区
* 支持自定义markdown语法解析器,语法高亮等
* 支持常用的markdown编辑功能，如加粗，斜体等等...
* 支持功能按钮插拔化，用户可以自定义扩展组件
* 支持编辑区和预览区同步滚动

### 开发心得

- 文本编辑

  大多数常见的编辑器，包括富文本编辑器，利用了某些元素如div的contenteditable属性，配合selection、range、execCommand等API，实现了富文本编辑功能。这里面的实现比较复杂，所以有了"[为什么都说富文本编辑器是天坑？](https://www.zhihu.com/question/38699645)"这个说法。

  而markdown编辑器，核心的处理内容为简单语法的纯文本，复杂度相对来说比较低，并且input标签自带onSelect事件，可以很方便的获取选择信息（选择起始位置和选择文本值），因此要想实现编辑功能，只需将要改动的内容进行文本转换，然后进行重新拼接首尾，大功告成。
  
- markdown解析

  考察了几个社区流行的markdown解析器，比较流行的有[markdown](https://www.npmjs.com/package/markdown), [markdown-it](https://www.npmjs.com/package/markdown-it), [marked](https://www.npmjs.com/package/marked) 等等。综合考虑扩展性以及稳定性，笔者推荐使用markdown-it作为markdown的词法解析器，因为该解析器有比较多的插件，并且支持语法高亮。

- 同步滚动

  当选择分栏编辑的时候，滚动左侧的编辑区，右侧的预览区能自动滚动到对应的区域。方案参考了《[手把手教你用 100行代码实现基于 react的 markdown 输入 + 即时预览在线编辑器（一）](https://github.com/accforgit/blog-data/blob/master/%E5%9C%A8%E7%BA%BF%E7%BC%96%E8%BE%91%E5%99%A8/README/README1.md)》。只需先计算出输入框容器元素与预览框容器元素之间最大scroll范围的比例值，然后根据主动滚动元素自身的scrollTop做相应的比例换算，即可知道对方区域的scrollTop值。

- 关于UI
 
  - 项目的字体库选择了Font Awesome风格，并且只选取了项目所需要的一些图标。
  - 编辑器的整体css均可通过全局覆盖的形式进行自定义。目前暂时只支持灰色主题。
  - 编辑器的显示区域包括菜单栏，编辑器，预览区，工具栏，通过配置组件的config属性，可以选择默认的展示区域。
  
### Install

```js
npm install react-markdown-editor-lite --save
```

### Props

| Property | Description | Type | default | Remarks |
| --- | --- | --- | --- | --- |
| value | markdown content | String | '' | required |
| style | component container style | Object | {height: '100%'} | not required |
| config | component config | Object | {view: {...}, logger: {...}} | not required |
| onChange | emitting when editor has changed | Function | ({html, md}) => {} | not required |
| onImageUpload | when image uploaded, callback emitting will get image markdown text | (file: File, callback: (url: string) => void) => void; | ({file, callback}) => {} | not required |
| renderHTML | Render markdown text to HTML. You can return either string, function or Promise | (text: string) => string|function|Promise | none | **required** |

### Example

``` js
'use strict';
import React from 'react'
import ReactDOM from 'react-dom'
import MdEditor from 'react-markdown-editor-lite'
import MarkdownIt from 'markdown-it'
import emoji from 'markdown-it-emoji'
import subscript from 'markdown-it-sub'
import superscript from 'markdown-it-sup'
import footnote from 'markdown-it-footnote'
import deflist from 'markdown-it-deflist'
import abbreviation from 'markdown-it-abbr'
import insert from 'markdown-it-ins'
import mark from 'markdown-it-mark'
import tasklists from 'markdown-it-task-lists'
import hljs from 'highlight.js'
import 'highlight.js/styles/atom-one-light.css'
// import 'highlight.js/styles/github.css'
import './index.less';

const MOCK_DATA = "I Love React."
export default class Demo extends React.Component {
  mdEditor = null
  mdParser = null
  constructor(props) {
    super(props)
    // initial a parsera
    this.mdParser = new MarkdownIt({
      html: true,
      linkify: true,
      typographer: true,
      highlight: function (str, lang) {
        if (lang && hljs.getLanguage(lang)) {
          try {
            return hljs.highlight(lang, str).value
          } catch (__) {}
        }    
        return '' // use external default escaping
      }
    })
    .use(emoji)
    .use(subscript)
    .use(superscript)
    .use(footnote)
    .use(deflist)
    .use(abbreviation)
    .use(insert)
    .use(mark)
    .use(tasklists, { enabled: this.taskLists })
    this.renderHTML = this.renderHTML.bind(this)
  }
  handleEditorChange({html, md}) {
    console.log('handleEditorChange', html, md)
  }
  handleImageUpload(file, callback) {
    const reader = new FileReader()
    reader.onload = () => {      
      const convertBase64UrlToBlob = (urlData) => {  
        let arr = urlData.split(','), mime = arr[0].match(/:(.*?);/)[1]
        let bstr = atob(arr[1])
        let n = bstr.length
        let u8arr = new Uint8Array(n)
        while (n--) {
          u8arr[n] = bstr.charCodeAt(n)
        }
        return new Blob([u8arr], {type:mime})
      }
      const blob = convertBase64UrlToBlob(reader.result)
      setTimeout(() => {
        // setTimeout 模拟异步上传图片
        // 当异步上传获取图片地址后，执行calback回调（参数为imageUrl字符串），即可将图片地址写入markdown
        callback('https://avatars0.githubusercontent.com/u/21263805?s=40&v=4')
      }, 1000)
    }
    reader.readAsDataURL(file)
  }
  renderHTML(text) {
    // 模拟异步渲染Markdown
    return new Promise((resolve) => {
      setTimeout(() => {
        resolve(this.mdParser.render(text))
      }, 1000)
    })
  }
  handleGetMdValue = () => {   
    this.mdEditor && alert(this.mdEditor.getMdValue())      
  }
  handleGetHtmlValue = () => {    
    this.mdEditor && alert(this.mdEditor.getHtmlValue())
  }
  render() {
    return (      
      <div>
        <nav>
          <button onClick={this.handleGetMdValue} >getMdValue</button>  
          <button onClick={this.handleGetHtmlValue} >getHtmlValue</button>  
        </nav>
        <section style="height: 500px">
          <MdEditor 
            ref={node => this.mdEditor = node}
            value={MOCK_DATA}
            style={{height: '400px'}}
            renderHTML={this.renderHTML}
            config={{
              view: {
                menu: true,
                md: true,
                html: true
              },
              imageUrl: 'https://octodex.github.com/images/minion.png'
            }}
            onChange={this.handleEditorChange} 
            onImageUpload={this.handleImageUpload}
          />
        </section>                        
      </div>      
    )
  }
}
```

### 最后

   欢迎大家使用和反馈，[项目地址](https://github.com/HarryChen0506/react-markdown-editor-lite) (https://github.com/HarryChen0506/react-markdown-editor-lite)， 你的点赞将是我莫大的动力😊

![1.png](https://s3.ca-central-1.amazonaws.com/res-blog-public/res-dev/blog_1636946743939_1.png)', firstPicture='', viewCount=83, createDate='Sun Nov 07 14:09:29 EST 2021', updateDate='Tue Jan 18 22:54:08 EST 2022'}}, total=null}
2022-01-19 19:54:35:372 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 25ms
2022-01-19 19:54:35:372 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 19:55:17:875 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 19:55:17:875 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 19:55:17:875 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 19:55:17:875 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 19:55:17:875 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 19:55:17:875 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 19:55:17:875 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 19:55:17:875 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 19:55:17:875 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 19:55:17:875 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 19:55:17:875 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 19:55:17:875 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 19:55:17:875 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 19:55:17:875 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 19:55:17:875 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/article/10005
2022-01-19 19:55:17:875 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 19:55:17:875 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.ArticleController.getPublicArticleDetail
2022-01-19 19:55:17:875 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 19:55:17:875 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=20createdate=Wed Jan 19 11:47:08 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/26.png, replyComments=[CommentListVo{commentId=21createdate=Wed Jan 19 11:47:21 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/89.png, replyComments=[CommentListVo{commentId=22createdate=Wed Jan 19 11:47:39 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/75.png, replyComments=null, CommentVo=CommentVo{parentCommentId=21, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='sfs@ss.c', content='eeeeee', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='tet', content='ree', status='0'}}, CommentListVo{commentId=27createdate=Wed Jan 19 17:01:06 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/2.png, replyComments=null, CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='ljh19911025@gmail.com', nickname='sds', parentCommentNickname='tet', content='wwww', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='tet', parentCommentNickname='null', content='etet', status='0'}}], total=1}
2022-01-19 19:55:17:875 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=20createdate=Wed Jan 19 11:47:08 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/26.png, replyComments=[CommentListVo{commentId=21createdate=Wed Jan 19 11:47:21 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/89.png, replyComments=[CommentListVo{commentId=22createdate=Wed Jan 19 11:47:39 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/75.png, replyComments=null, CommentVo=CommentVo{parentCommentId=21, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='sfs@ss.c', content='eeeeee', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='tet', content='ree', status='0'}}, CommentListVo{commentId=27createdate=Wed Jan 19 17:01:06 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/2.png, replyComments=null, CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='ljh19911025@gmail.com', nickname='sds', parentCommentNickname='tet', content='wwww', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='tet', parentCommentNickname='null', content='etet', status='0'}}], total=1}
2022-01-19 19:55:17:876 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 5ms
2022-01-19 19:55:17:876 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 6ms
2022-01-19 19:55:17:876 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 19:55:17:876 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 19:55:17:875 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=ArticleVo{userInfo=UserInfoVo{userId=100001, nickName='ivan', userName='ivan', avatar='https://res-blog-public.s3.ca-central-1.amazonaws.com/default_avatar.jpg'}, category=CategoryVo{categoryId=1, name='Life ', articleCount=null}, BaseArticleVo{articleId=10005, status=1, type=1, title='dd', description='This is the doc of React markdown editor lite.
Enjoy!!', content='| Head | Head | Head | Head |
| --- | --- | --- | --- |
| Data | Data | Data | Data |
| Data | Data | Data | Data |

## 手把手教你写一个markdown编辑器

> 笔者在18年年末的时候接到一个开发任务——搭建一个AI项目的开放平台，其中的产品文档为转化为HTML格式的markdown文档。考虑到文档的即时更新，将文档信息做成了Ajax接口的形式。因此管理后台只需将textarea表单的内容通过markdown解析器进行HTML格式转化，然后将markdown内容和经转化的HTML文档都保存到数据库即可。
> 基本需求完成后，为了更好的用户体验，考虑将常用的编辑功能添加进来。改进版不仅支持了常用的文本编辑功能，还实现的UI界面的配置化，自定义语法解析器。本着造福伸手党的目的，以及积累些开源经验，笔者将该react 组件 [react-markdown-editor-lite](https://github.com/HarryChen0506/react-markdown-editor-lite) 进行了封装改造，并且发布到了开源社区。

### 预览
在线体验 [https://harrychen0506.github.io/react-markdown-editor-lite/](https://harrychen0506.github.io/react-markdown-editor-lite/)

![image](https://github.com//HarryChen0506/react-markdown-editor-lite/blob/master/image/react-markdown-editor-lite-v1.0.0.PNG?raw=true)

### 特点
* 轻量、基于React
* UI可配置, 如只显示编辑区或预览区
* 支持自定义markdown语法解析器,语法高亮等
* 支持常用的markdown编辑功能，如加粗，斜体等等...
* 支持功能按钮插拔化，用户可以自定义扩展组件
* 支持编辑区和预览区同步滚动

### 开发心得

- 文本编辑

  大多数常见的编辑器，包括富文本编辑器，利用了某些元素如div的contenteditable属性，配合selection、range、execCommand等API，实现了富文本编辑功能。这里面的实现比较复杂，所以有了"[为什么都说富文本编辑器是天坑？](https://www.zhihu.com/question/38699645)"这个说法。

  而markdown编辑器，核心的处理内容为简单语法的纯文本，复杂度相对来说比较低，并且input标签自带onSelect事件，可以很方便的获取选择信息（选择起始位置和选择文本值），因此要想实现编辑功能，只需将要改动的内容进行文本转换，然后进行重新拼接首尾，大功告成。
  
- markdown解析

  考察了几个社区流行的markdown解析器，比较流行的有[markdown](https://www.npmjs.com/package/markdown), [markdown-it](https://www.npmjs.com/package/markdown-it), [marked](https://www.npmjs.com/package/marked) 等等。综合考虑扩展性以及稳定性，笔者推荐使用markdown-it作为markdown的词法解析器，因为该解析器有比较多的插件，并且支持语法高亮。

- 同步滚动

  当选择分栏编辑的时候，滚动左侧的编辑区，右侧的预览区能自动滚动到对应的区域。方案参考了《[手把手教你用 100行代码实现基于 react的 markdown 输入 + 即时预览在线编辑器（一）](https://github.com/accforgit/blog-data/blob/master/%E5%9C%A8%E7%BA%BF%E7%BC%96%E8%BE%91%E5%99%A8/README/README1.md)》。只需先计算出输入框容器元素与预览框容器元素之间最大scroll范围的比例值，然后根据主动滚动元素自身的scrollTop做相应的比例换算，即可知道对方区域的scrollTop值。

- 关于UI
 
  - 项目的字体库选择了Font Awesome风格，并且只选取了项目所需要的一些图标。
  - 编辑器的整体css均可通过全局覆盖的形式进行自定义。目前暂时只支持灰色主题。
  - 编辑器的显示区域包括菜单栏，编辑器，预览区，工具栏，通过配置组件的config属性，可以选择默认的展示区域。
  
### Install

```js
npm install react-markdown-editor-lite --save
```

### Props

| Property | Description | Type | default | Remarks |
| --- | --- | --- | --- | --- |
| value | markdown content | String | '' | required |
| style | component container style | Object | {height: '100%'} | not required |
| config | component config | Object | {view: {...}, logger: {...}} | not required |
| onChange | emitting when editor has changed | Function | ({html, md}) => {} | not required |
| onImageUpload | when image uploaded, callback emitting will get image markdown text | (file: File, callback: (url: string) => void) => void; | ({file, callback}) => {} | not required |
| renderHTML | Render markdown text to HTML. You can return either string, function or Promise | (text: string) => string|function|Promise | none | **required** |

### Example

``` js
'use strict';
import React from 'react'
import ReactDOM from 'react-dom'
import MdEditor from 'react-markdown-editor-lite'
import MarkdownIt from 'markdown-it'
import emoji from 'markdown-it-emoji'
import subscript from 'markdown-it-sub'
import superscript from 'markdown-it-sup'
import footnote from 'markdown-it-footnote'
import deflist from 'markdown-it-deflist'
import abbreviation from 'markdown-it-abbr'
import insert from 'markdown-it-ins'
import mark from 'markdown-it-mark'
import tasklists from 'markdown-it-task-lists'
import hljs from 'highlight.js'
import 'highlight.js/styles/atom-one-light.css'
// import 'highlight.js/styles/github.css'
import './index.less';

const MOCK_DATA = "I Love React."
export default class Demo extends React.Component {
  mdEditor = null
  mdParser = null
  constructor(props) {
    super(props)
    // initial a parsera
    this.mdParser = new MarkdownIt({
      html: true,
      linkify: true,
      typographer: true,
      highlight: function (str, lang) {
        if (lang && hljs.getLanguage(lang)) {
          try {
            return hljs.highlight(lang, str).value
          } catch (__) {}
        }    
        return '' // use external default escaping
      }
    })
    .use(emoji)
    .use(subscript)
    .use(superscript)
    .use(footnote)
    .use(deflist)
    .use(abbreviation)
    .use(insert)
    .use(mark)
    .use(tasklists, { enabled: this.taskLists })
    this.renderHTML = this.renderHTML.bind(this)
  }
  handleEditorChange({html, md}) {
    console.log('handleEditorChange', html, md)
  }
  handleImageUpload(file, callback) {
    const reader = new FileReader()
    reader.onload = () => {      
      const convertBase64UrlToBlob = (urlData) => {  
        let arr = urlData.split(','), mime = arr[0].match(/:(.*?);/)[1]
        let bstr = atob(arr[1])
        let n = bstr.length
        let u8arr = new Uint8Array(n)
        while (n--) {
          u8arr[n] = bstr.charCodeAt(n)
        }
        return new Blob([u8arr], {type:mime})
      }
      const blob = convertBase64UrlToBlob(reader.result)
      setTimeout(() => {
        // setTimeout 模拟异步上传图片
        // 当异步上传获取图片地址后，执行calback回调（参数为imageUrl字符串），即可将图片地址写入markdown
        callback('https://avatars0.githubusercontent.com/u/21263805?s=40&v=4')
      }, 1000)
    }
    reader.readAsDataURL(file)
  }
  renderHTML(text) {
    // 模拟异步渲染Markdown
    return new Promise((resolve) => {
      setTimeout(() => {
        resolve(this.mdParser.render(text))
      }, 1000)
    })
  }
  handleGetMdValue = () => {   
    this.mdEditor && alert(this.mdEditor.getMdValue())      
  }
  handleGetHtmlValue = () => {    
    this.mdEditor && alert(this.mdEditor.getHtmlValue())
  }
  render() {
    return (      
      <div>
        <nav>
          <button onClick={this.handleGetMdValue} >getMdValue</button>  
          <button onClick={this.handleGetHtmlValue} >getHtmlValue</button>  
        </nav>
        <section style="height: 500px">
          <MdEditor 
            ref={node => this.mdEditor = node}
            value={MOCK_DATA}
            style={{height: '400px'}}
            renderHTML={this.renderHTML}
            config={{
              view: {
                menu: true,
                md: true,
                html: true
              },
              imageUrl: 'https://octodex.github.com/images/minion.png'
            }}
            onChange={this.handleEditorChange} 
            onImageUpload={this.handleImageUpload}
          />
        </section>                        
      </div>      
    )
  }
}
```

### 最后

   欢迎大家使用和反馈，[项目地址](https://github.com/HarryChen0506/react-markdown-editor-lite) (https://github.com/HarryChen0506/react-markdown-editor-lite)， 你的点赞将是我莫大的动力😊

![1.png](https://s3.ca-central-1.amazonaws.com/res-blog-public/res-dev/blog_1636946743939_1.png)', firstPicture='', viewCount=83, createDate='Sun Nov 07 14:09:29 EST 2021', updateDate='Tue Jan 18 22:54:08 EST 2022'}}, total=null}
2022-01-19 19:55:17:876 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 7ms
2022-01-19 19:55:17:876 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 19:55:17:968 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 19:55:17:968 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 19:55:17:968 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 19:55:17:968 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 19:55:17:968 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 19:55:17:968 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 19:55:17:968 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=20createdate=Wed Jan 19 11:47:08 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/26.png, replyComments=[CommentListVo{commentId=21createdate=Wed Jan 19 11:47:21 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/89.png, replyComments=[CommentListVo{commentId=22createdate=Wed Jan 19 11:47:39 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/75.png, replyComments=null, CommentVo=CommentVo{parentCommentId=21, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='sfs@ss.c', content='eeeeee', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='tet', content='ree', status='0'}}, CommentListVo{commentId=27createdate=Wed Jan 19 17:01:06 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/2.png, replyComments=null, CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='ljh19911025@gmail.com', nickname='sds', parentCommentNickname='tet', content='wwww', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='tet', parentCommentNickname='null', content='etet', status='0'}}], total=1}
2022-01-19 19:55:17:969 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 22ms
2022-01-19 19:55:17:969 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 19:57:47:938 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 19:57:47:940 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 19:57:47:940 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 19:57:47:942 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 19:57:47:942 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 19:57:47:945 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 19:57:47:945 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=20createdate=Wed Jan 19 11:47:08 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/26.png, replyComments=[CommentListVo{commentId=21createdate=Wed Jan 19 11:47:21 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/89.png, replyComments=[CommentListVo{commentId=22createdate=Wed Jan 19 11:47:39 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/75.png, replyComments=null, CommentVo=CommentVo{parentCommentId=21, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='sfs@ss.c', content='eeeeee', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='tet', content='ree', status='0'}}, CommentListVo{commentId=27createdate=Wed Jan 19 17:01:06 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/2.png, replyComments=null, CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='ljh19911025@gmail.com', nickname='sds', parentCommentNickname='tet', content='wwww', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='tet', parentCommentNickname='null', content='etet', status='0'}}], total=1}
2022-01-19 19:57:47:945 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 33ms
2022-01-19 19:57:47:945 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 19:57:47:952 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 19:57:47:953 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 19:57:47:953 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 19:57:47:953 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 19:57:47:953 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 19:57:47:953 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 19:57:47:953 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=20createdate=Wed Jan 19 11:47:08 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/26.png, replyComments=[CommentListVo{commentId=21createdate=Wed Jan 19 11:47:21 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/89.png, replyComments=[CommentListVo{commentId=22createdate=Wed Jan 19 11:47:39 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/75.png, replyComments=null, CommentVo=CommentVo{parentCommentId=21, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='sfs@ss.c', content='eeeeee', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='tet', content='ree', status='0'}}, CommentListVo{commentId=27createdate=Wed Jan 19 17:01:06 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/2.png, replyComments=null, CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='ljh19911025@gmail.com', nickname='sds', parentCommentNickname='tet', content='wwww', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='tet', parentCommentNickname='null', content='etet', status='0'}}], total=1}
2022-01-19 19:57:47:953 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 47ms
2022-01-19 19:57:47:953 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 19:57:47:955 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 19:57:47:955 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 19:57:47:955 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 19:57:47:955 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/article/10005
2022-01-19 19:57:47:955 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.ArticleController.getPublicArticleDetail
2022-01-19 19:57:47:955 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 19:57:47:955 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=ArticleVo{userInfo=UserInfoVo{userId=100001, nickName='ivan', userName='ivan', avatar='https://res-blog-public.s3.ca-central-1.amazonaws.com/default_avatar.jpg'}, category=CategoryVo{categoryId=1, name='Life ', articleCount=null}, BaseArticleVo{articleId=10005, status=1, type=1, title='dd', description='This is the doc of React markdown editor lite.
Enjoy!!', content='| Head | Head | Head | Head |
| --- | --- | --- | --- |
| Data | Data | Data | Data |
| Data | Data | Data | Data |

## 手把手教你写一个markdown编辑器

> 笔者在18年年末的时候接到一个开发任务——搭建一个AI项目的开放平台，其中的产品文档为转化为HTML格式的markdown文档。考虑到文档的即时更新，将文档信息做成了Ajax接口的形式。因此管理后台只需将textarea表单的内容通过markdown解析器进行HTML格式转化，然后将markdown内容和经转化的HTML文档都保存到数据库即可。
> 基本需求完成后，为了更好的用户体验，考虑将常用的编辑功能添加进来。改进版不仅支持了常用的文本编辑功能，还实现的UI界面的配置化，自定义语法解析器。本着造福伸手党的目的，以及积累些开源经验，笔者将该react 组件 [react-markdown-editor-lite](https://github.com/HarryChen0506/react-markdown-editor-lite) 进行了封装改造，并且发布到了开源社区。

### 预览
在线体验 [https://harrychen0506.github.io/react-markdown-editor-lite/](https://harrychen0506.github.io/react-markdown-editor-lite/)

![image](https://github.com//HarryChen0506/react-markdown-editor-lite/blob/master/image/react-markdown-editor-lite-v1.0.0.PNG?raw=true)

### 特点
* 轻量、基于React
* UI可配置, 如只显示编辑区或预览区
* 支持自定义markdown语法解析器,语法高亮等
* 支持常用的markdown编辑功能，如加粗，斜体等等...
* 支持功能按钮插拔化，用户可以自定义扩展组件
* 支持编辑区和预览区同步滚动

### 开发心得

- 文本编辑

  大多数常见的编辑器，包括富文本编辑器，利用了某些元素如div的contenteditable属性，配合selection、range、execCommand等API，实现了富文本编辑功能。这里面的实现比较复杂，所以有了"[为什么都说富文本编辑器是天坑？](https://www.zhihu.com/question/38699645)"这个说法。

  而markdown编辑器，核心的处理内容为简单语法的纯文本，复杂度相对来说比较低，并且input标签自带onSelect事件，可以很方便的获取选择信息（选择起始位置和选择文本值），因此要想实现编辑功能，只需将要改动的内容进行文本转换，然后进行重新拼接首尾，大功告成。
  
- markdown解析

  考察了几个社区流行的markdown解析器，比较流行的有[markdown](https://www.npmjs.com/package/markdown), [markdown-it](https://www.npmjs.com/package/markdown-it), [marked](https://www.npmjs.com/package/marked) 等等。综合考虑扩展性以及稳定性，笔者推荐使用markdown-it作为markdown的词法解析器，因为该解析器有比较多的插件，并且支持语法高亮。

- 同步滚动

  当选择分栏编辑的时候，滚动左侧的编辑区，右侧的预览区能自动滚动到对应的区域。方案参考了《[手把手教你用 100行代码实现基于 react的 markdown 输入 + 即时预览在线编辑器（一）](https://github.com/accforgit/blog-data/blob/master/%E5%9C%A8%E7%BA%BF%E7%BC%96%E8%BE%91%E5%99%A8/README/README1.md)》。只需先计算出输入框容器元素与预览框容器元素之间最大scroll范围的比例值，然后根据主动滚动元素自身的scrollTop做相应的比例换算，即可知道对方区域的scrollTop值。

- 关于UI
 
  - 项目的字体库选择了Font Awesome风格，并且只选取了项目所需要的一些图标。
  - 编辑器的整体css均可通过全局覆盖的形式进行自定义。目前暂时只支持灰色主题。
  - 编辑器的显示区域包括菜单栏，编辑器，预览区，工具栏，通过配置组件的config属性，可以选择默认的展示区域。
  
### Install

```js
npm install react-markdown-editor-lite --save
```

### Props

| Property | Description | Type | default | Remarks |
| --- | --- | --- | --- | --- |
| value | markdown content | String | '' | required |
| style | component container style | Object | {height: '100%'} | not required |
| config | component config | Object | {view: {...}, logger: {...}} | not required |
| onChange | emitting when editor has changed | Function | ({html, md}) => {} | not required |
| onImageUpload | when image uploaded, callback emitting will get image markdown text | (file: File, callback: (url: string) => void) => void; | ({file, callback}) => {} | not required |
| renderHTML | Render markdown text to HTML. You can return either string, function or Promise | (text: string) => string|function|Promise | none | **required** |

### Example

``` js
'use strict';
import React from 'react'
import ReactDOM from 'react-dom'
import MdEditor from 'react-markdown-editor-lite'
import MarkdownIt from 'markdown-it'
import emoji from 'markdown-it-emoji'
import subscript from 'markdown-it-sub'
import superscript from 'markdown-it-sup'
import footnote from 'markdown-it-footnote'
import deflist from 'markdown-it-deflist'
import abbreviation from 'markdown-it-abbr'
import insert from 'markdown-it-ins'
import mark from 'markdown-it-mark'
import tasklists from 'markdown-it-task-lists'
import hljs from 'highlight.js'
import 'highlight.js/styles/atom-one-light.css'
// import 'highlight.js/styles/github.css'
import './index.less';

const MOCK_DATA = "I Love React."
export default class Demo extends React.Component {
  mdEditor = null
  mdParser = null
  constructor(props) {
    super(props)
    // initial a parsera
    this.mdParser = new MarkdownIt({
      html: true,
      linkify: true,
      typographer: true,
      highlight: function (str, lang) {
        if (lang && hljs.getLanguage(lang)) {
          try {
            return hljs.highlight(lang, str).value
          } catch (__) {}
        }    
        return '' // use external default escaping
      }
    })
    .use(emoji)
    .use(subscript)
    .use(superscript)
    .use(footnote)
    .use(deflist)
    .use(abbreviation)
    .use(insert)
    .use(mark)
    .use(tasklists, { enabled: this.taskLists })
    this.renderHTML = this.renderHTML.bind(this)
  }
  handleEditorChange({html, md}) {
    console.log('handleEditorChange', html, md)
  }
  handleImageUpload(file, callback) {
    const reader = new FileReader()
    reader.onload = () => {      
      const convertBase64UrlToBlob = (urlData) => {  
        let arr = urlData.split(','), mime = arr[0].match(/:(.*?);/)[1]
        let bstr = atob(arr[1])
        let n = bstr.length
        let u8arr = new Uint8Array(n)
        while (n--) {
          u8arr[n] = bstr.charCodeAt(n)
        }
        return new Blob([u8arr], {type:mime})
      }
      const blob = convertBase64UrlToBlob(reader.result)
      setTimeout(() => {
        // setTimeout 模拟异步上传图片
        // 当异步上传获取图片地址后，执行calback回调（参数为imageUrl字符串），即可将图片地址写入markdown
        callback('https://avatars0.githubusercontent.com/u/21263805?s=40&v=4')
      }, 1000)
    }
    reader.readAsDataURL(file)
  }
  renderHTML(text) {
    // 模拟异步渲染Markdown
    return new Promise((resolve) => {
      setTimeout(() => {
        resolve(this.mdParser.render(text))
      }, 1000)
    })
  }
  handleGetMdValue = () => {   
    this.mdEditor && alert(this.mdEditor.getMdValue())      
  }
  handleGetHtmlValue = () => {    
    this.mdEditor && alert(this.mdEditor.getHtmlValue())
  }
  render() {
    return (      
      <div>
        <nav>
          <button onClick={this.handleGetMdValue} >getMdValue</button>  
          <button onClick={this.handleGetHtmlValue} >getHtmlValue</button>  
        </nav>
        <section style="height: 500px">
          <MdEditor 
            ref={node => this.mdEditor = node}
            value={MOCK_DATA}
            style={{height: '400px'}}
            renderHTML={this.renderHTML}
            config={{
              view: {
                menu: true,
                md: true,
                html: true
              },
              imageUrl: 'https://octodex.github.com/images/minion.png'
            }}
            onChange={this.handleEditorChange} 
            onImageUpload={this.handleImageUpload}
          />
        </section>                        
      </div>      
    )
  }
}
```

### 最后

   欢迎大家使用和反馈，[项目地址](https://github.com/HarryChen0506/react-markdown-editor-lite) (https://github.com/HarryChen0506/react-markdown-editor-lite)， 你的点赞将是我莫大的动力😊

![1.png](https://s3.ca-central-1.amazonaws.com/res-blog-public/res-dev/blog_1636946743939_1.png)', firstPicture='', viewCount=83, createDate='Sun Nov 07 14:09:29 EST 2021', updateDate='Tue Jan 18 22:54:08 EST 2022'}}, total=null}
2022-01-19 19:57:47:956 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 51ms
2022-01-19 19:57:47:956 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 19:57:48:473 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 19:57:48:474 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 19:57:48:474 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 19:57:48:474 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 19:57:48:474 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 19:57:48:474 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 19:57:48:474 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=20createdate=Wed Jan 19 11:47:08 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/26.png, replyComments=[CommentListVo{commentId=21createdate=Wed Jan 19 11:47:21 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/89.png, replyComments=[CommentListVo{commentId=22createdate=Wed Jan 19 11:47:39 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/75.png, replyComments=null, CommentVo=CommentVo{parentCommentId=21, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='sfs@ss.c', content='eeeeee', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='tet', content='ree', status='0'}}, CommentListVo{commentId=27createdate=Wed Jan 19 17:01:06 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/2.png, replyComments=null, CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='ljh19911025@gmail.com', nickname='sds', parentCommentNickname='tet', content='wwww', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='tet', parentCommentNickname='null', content='etet', status='0'}}], total=1}
2022-01-19 19:57:48:474 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 28ms
2022-01-19 19:57:48:474 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 20:06:02:313 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 20:06:02:314 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 20:06:02:314 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 20:06:02:314 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/article/10005
2022-01-19 20:06:02:314 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.ArticleController.getPublicArticleDetail
2022-01-19 20:06:02:314 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 20:06:02:314 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=ArticleVo{userInfo=UserInfoVo{userId=100001, nickName='ivan', userName='ivan', avatar='https://res-blog-public.s3.ca-central-1.amazonaws.com/default_avatar.jpg'}, category=CategoryVo{categoryId=1, name='Life ', articleCount=null}, BaseArticleVo{articleId=10005, status=1, type=1, title='dd', description='This is the doc of React markdown editor lite.
Enjoy!!', content='| Head | Head | Head | Head |
| --- | --- | --- | --- |
| Data | Data | Data | Data |
| Data | Data | Data | Data |

## 手把手教你写一个markdown编辑器

> 笔者在18年年末的时候接到一个开发任务——搭建一个AI项目的开放平台，其中的产品文档为转化为HTML格式的markdown文档。考虑到文档的即时更新，将文档信息做成了Ajax接口的形式。因此管理后台只需将textarea表单的内容通过markdown解析器进行HTML格式转化，然后将markdown内容和经转化的HTML文档都保存到数据库即可。
> 基本需求完成后，为了更好的用户体验，考虑将常用的编辑功能添加进来。改进版不仅支持了常用的文本编辑功能，还实现的UI界面的配置化，自定义语法解析器。本着造福伸手党的目的，以及积累些开源经验，笔者将该react 组件 [react-markdown-editor-lite](https://github.com/HarryChen0506/react-markdown-editor-lite) 进行了封装改造，并且发布到了开源社区。

### 预览
在线体验 [https://harrychen0506.github.io/react-markdown-editor-lite/](https://harrychen0506.github.io/react-markdown-editor-lite/)

![image](https://github.com//HarryChen0506/react-markdown-editor-lite/blob/master/image/react-markdown-editor-lite-v1.0.0.PNG?raw=true)

### 特点
* 轻量、基于React
* UI可配置, 如只显示编辑区或预览区
* 支持自定义markdown语法解析器,语法高亮等
* 支持常用的markdown编辑功能，如加粗，斜体等等...
* 支持功能按钮插拔化，用户可以自定义扩展组件
* 支持编辑区和预览区同步滚动

### 开发心得

- 文本编辑

  大多数常见的编辑器，包括富文本编辑器，利用了某些元素如div的contenteditable属性，配合selection、range、execCommand等API，实现了富文本编辑功能。这里面的实现比较复杂，所以有了"[为什么都说富文本编辑器是天坑？](https://www.zhihu.com/question/38699645)"这个说法。

  而markdown编辑器，核心的处理内容为简单语法的纯文本，复杂度相对来说比较低，并且input标签自带onSelect事件，可以很方便的获取选择信息（选择起始位置和选择文本值），因此要想实现编辑功能，只需将要改动的内容进行文本转换，然后进行重新拼接首尾，大功告成。
  
- markdown解析

  考察了几个社区流行的markdown解析器，比较流行的有[markdown](https://www.npmjs.com/package/markdown), [markdown-it](https://www.npmjs.com/package/markdown-it), [marked](https://www.npmjs.com/package/marked) 等等。综合考虑扩展性以及稳定性，笔者推荐使用markdown-it作为markdown的词法解析器，因为该解析器有比较多的插件，并且支持语法高亮。

- 同步滚动

  当选择分栏编辑的时候，滚动左侧的编辑区，右侧的预览区能自动滚动到对应的区域。方案参考了《[手把手教你用 100行代码实现基于 react的 markdown 输入 + 即时预览在线编辑器（一）](https://github.com/accforgit/blog-data/blob/master/%E5%9C%A8%E7%BA%BF%E7%BC%96%E8%BE%91%E5%99%A8/README/README1.md)》。只需先计算出输入框容器元素与预览框容器元素之间最大scroll范围的比例值，然后根据主动滚动元素自身的scrollTop做相应的比例换算，即可知道对方区域的scrollTop值。

- 关于UI
 
  - 项目的字体库选择了Font Awesome风格，并且只选取了项目所需要的一些图标。
  - 编辑器的整体css均可通过全局覆盖的形式进行自定义。目前暂时只支持灰色主题。
  - 编辑器的显示区域包括菜单栏，编辑器，预览区，工具栏，通过配置组件的config属性，可以选择默认的展示区域。
  
### Install

```js
npm install react-markdown-editor-lite --save
```

### Props

| Property | Description | Type | default | Remarks |
| --- | --- | --- | --- | --- |
| value | markdown content | String | '' | required |
| style | component container style | Object | {height: '100%'} | not required |
| config | component config | Object | {view: {...}, logger: {...}} | not required |
| onChange | emitting when editor has changed | Function | ({html, md}) => {} | not required |
| onImageUpload | when image uploaded, callback emitting will get image markdown text | (file: File, callback: (url: string) => void) => void; | ({file, callback}) => {} | not required |
| renderHTML | Render markdown text to HTML. You can return either string, function or Promise | (text: string) => string|function|Promise | none | **required** |

### Example

``` js
'use strict';
import React from 'react'
import ReactDOM from 'react-dom'
import MdEditor from 'react-markdown-editor-lite'
import MarkdownIt from 'markdown-it'
import emoji from 'markdown-it-emoji'
import subscript from 'markdown-it-sub'
import superscript from 'markdown-it-sup'
import footnote from 'markdown-it-footnote'
import deflist from 'markdown-it-deflist'
import abbreviation from 'markdown-it-abbr'
import insert from 'markdown-it-ins'
import mark from 'markdown-it-mark'
import tasklists from 'markdown-it-task-lists'
import hljs from 'highlight.js'
import 'highlight.js/styles/atom-one-light.css'
// import 'highlight.js/styles/github.css'
import './index.less';

const MOCK_DATA = "I Love React."
export default class Demo extends React.Component {
  mdEditor = null
  mdParser = null
  constructor(props) {
    super(props)
    // initial a parsera
    this.mdParser = new MarkdownIt({
      html: true,
      linkify: true,
      typographer: true,
      highlight: function (str, lang) {
        if (lang && hljs.getLanguage(lang)) {
          try {
            return hljs.highlight(lang, str).value
          } catch (__) {}
        }    
        return '' // use external default escaping
      }
    })
    .use(emoji)
    .use(subscript)
    .use(superscript)
    .use(footnote)
    .use(deflist)
    .use(abbreviation)
    .use(insert)
    .use(mark)
    .use(tasklists, { enabled: this.taskLists })
    this.renderHTML = this.renderHTML.bind(this)
  }
  handleEditorChange({html, md}) {
    console.log('handleEditorChange', html, md)
  }
  handleImageUpload(file, callback) {
    const reader = new FileReader()
    reader.onload = () => {      
      const convertBase64UrlToBlob = (urlData) => {  
        let arr = urlData.split(','), mime = arr[0].match(/:(.*?);/)[1]
        let bstr = atob(arr[1])
        let n = bstr.length
        let u8arr = new Uint8Array(n)
        while (n--) {
          u8arr[n] = bstr.charCodeAt(n)
        }
        return new Blob([u8arr], {type:mime})
      }
      const blob = convertBase64UrlToBlob(reader.result)
      setTimeout(() => {
        // setTimeout 模拟异步上传图片
        // 当异步上传获取图片地址后，执行calback回调（参数为imageUrl字符串），即可将图片地址写入markdown
        callback('https://avatars0.githubusercontent.com/u/21263805?s=40&v=4')
      }, 1000)
    }
    reader.readAsDataURL(file)
  }
  renderHTML(text) {
    // 模拟异步渲染Markdown
    return new Promise((resolve) => {
      setTimeout(() => {
        resolve(this.mdParser.render(text))
      }, 1000)
    })
  }
  handleGetMdValue = () => {   
    this.mdEditor && alert(this.mdEditor.getMdValue())      
  }
  handleGetHtmlValue = () => {    
    this.mdEditor && alert(this.mdEditor.getHtmlValue())
  }
  render() {
    return (      
      <div>
        <nav>
          <button onClick={this.handleGetMdValue} >getMdValue</button>  
          <button onClick={this.handleGetHtmlValue} >getHtmlValue</button>  
        </nav>
        <section style="height: 500px">
          <MdEditor 
            ref={node => this.mdEditor = node}
            value={MOCK_DATA}
            style={{height: '400px'}}
            renderHTML={this.renderHTML}
            config={{
              view: {
                menu: true,
                md: true,
                html: true
              },
              imageUrl: 'https://octodex.github.com/images/minion.png'
            }}
            onChange={this.handleEditorChange} 
            onImageUpload={this.handleImageUpload}
          />
        </section>                        
      </div>      
    )
  }
}
```

### 最后

   欢迎大家使用和反馈，[项目地址](https://github.com/HarryChen0506/react-markdown-editor-lite) (https://github.com/HarryChen0506/react-markdown-editor-lite)， 你的点赞将是我莫大的动力😊

![1.png](https://s3.ca-central-1.amazonaws.com/res-blog-public/res-dev/blog_1636946743939_1.png)', firstPicture='', viewCount=83, createDate='Sun Nov 07 14:09:29 EST 2021', updateDate='Tue Jan 18 22:54:08 EST 2022'}}, total=null}
2022-01-19 20:06:02:315 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 28ms
2022-01-19 20:06:02:315 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 20:06:02:328 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 20:06:02:328 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 20:06:02:328 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 20:06:02:328 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 20:06:02:328 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 20:06:02:328 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 20:06:02:328 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 20:06:02:328 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 20:06:02:328 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 20:06:02:328 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 20:06:02:328 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 20:06:02:328 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 20:06:02:328 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=20createdate=Wed Jan 19 11:47:08 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/26.png, replyComments=[CommentListVo{commentId=21createdate=Wed Jan 19 11:47:21 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/89.png, replyComments=[CommentListVo{commentId=22createdate=Wed Jan 19 11:47:39 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/75.png, replyComments=null, CommentVo=CommentVo{parentCommentId=21, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='sfs@ss.c', content='eeeeee', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='tet', content='ree', status='0'}}, CommentListVo{commentId=27createdate=Wed Jan 19 17:01:06 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/2.png, replyComments=null, CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='ljh19911025@gmail.com', nickname='sds', parentCommentNickname='tet', content='wwww', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='tet', parentCommentNickname='null', content='etet', status='0'}}], total=1}
2022-01-19 20:06:02:328 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=20createdate=Wed Jan 19 11:47:08 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/26.png, replyComments=[CommentListVo{commentId=21createdate=Wed Jan 19 11:47:21 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/89.png, replyComments=[CommentListVo{commentId=22createdate=Wed Jan 19 11:47:39 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/75.png, replyComments=null, CommentVo=CommentVo{parentCommentId=21, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='sfs@ss.c', content='eeeeee', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='tet', content='ree', status='0'}}, CommentListVo{commentId=27createdate=Wed Jan 19 17:01:06 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/2.png, replyComments=null, CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='ljh19911025@gmail.com', nickname='sds', parentCommentNickname='tet', content='wwww', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='tet', parentCommentNickname='null', content='etet', status='0'}}], total=1}
2022-01-19 20:06:02:328 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 39ms
2022-01-19 20:06:02:328 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 39ms
2022-01-19 20:06:02:328 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 20:06:02:328 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 20:06:02:825 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 20:06:02:825 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 20:06:02:825 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 20:06:02:825 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 20:06:02:825 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 20:06:02:826 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 20:06:02:826 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=20createdate=Wed Jan 19 11:47:08 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/26.png, replyComments=[CommentListVo{commentId=21createdate=Wed Jan 19 11:47:21 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/89.png, replyComments=[CommentListVo{commentId=22createdate=Wed Jan 19 11:47:39 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/75.png, replyComments=null, CommentVo=CommentVo{parentCommentId=21, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='sfs@ss.c', content='eeeeee', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='tet', content='ree', status='0'}}, CommentListVo{commentId=27createdate=Wed Jan 19 17:01:06 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/2.png, replyComments=null, CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='ljh19911025@gmail.com', nickname='sds', parentCommentNickname='tet', content='wwww', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='tet', parentCommentNickname='null', content='etet', status='0'}}], total=1}
2022-01-19 20:06:02:826 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 3ms
2022-01-19 20:06:02:826 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 20:07:42:396 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 20:07:42:397 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 20:07:42:397 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 20:07:42:397 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/article/10005
2022-01-19 20:07:42:397 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.ArticleController.getPublicArticleDetail
2022-01-19 20:07:42:397 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 20:07:42:397 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=ArticleVo{userInfo=UserInfoVo{userId=100001, nickName='ivan', userName='ivan', avatar='https://res-blog-public.s3.ca-central-1.amazonaws.com/default_avatar.jpg'}, category=CategoryVo{categoryId=1, name='Life ', articleCount=null}, BaseArticleVo{articleId=10005, status=1, type=1, title='dd', description='This is the doc of React markdown editor lite.
Enjoy!!', content='| Head | Head | Head | Head |
| --- | --- | --- | --- |
| Data | Data | Data | Data |
| Data | Data | Data | Data |

## 手把手教你写一个markdown编辑器

> 笔者在18年年末的时候接到一个开发任务——搭建一个AI项目的开放平台，其中的产品文档为转化为HTML格式的markdown文档。考虑到文档的即时更新，将文档信息做成了Ajax接口的形式。因此管理后台只需将textarea表单的内容通过markdown解析器进行HTML格式转化，然后将markdown内容和经转化的HTML文档都保存到数据库即可。
> 基本需求完成后，为了更好的用户体验，考虑将常用的编辑功能添加进来。改进版不仅支持了常用的文本编辑功能，还实现的UI界面的配置化，自定义语法解析器。本着造福伸手党的目的，以及积累些开源经验，笔者将该react 组件 [react-markdown-editor-lite](https://github.com/HarryChen0506/react-markdown-editor-lite) 进行了封装改造，并且发布到了开源社区。

### 预览
在线体验 [https://harrychen0506.github.io/react-markdown-editor-lite/](https://harrychen0506.github.io/react-markdown-editor-lite/)

![image](https://github.com//HarryChen0506/react-markdown-editor-lite/blob/master/image/react-markdown-editor-lite-v1.0.0.PNG?raw=true)

### 特点
* 轻量、基于React
* UI可配置, 如只显示编辑区或预览区
* 支持自定义markdown语法解析器,语法高亮等
* 支持常用的markdown编辑功能，如加粗，斜体等等...
* 支持功能按钮插拔化，用户可以自定义扩展组件
* 支持编辑区和预览区同步滚动

### 开发心得

- 文本编辑

  大多数常见的编辑器，包括富文本编辑器，利用了某些元素如div的contenteditable属性，配合selection、range、execCommand等API，实现了富文本编辑功能。这里面的实现比较复杂，所以有了"[为什么都说富文本编辑器是天坑？](https://www.zhihu.com/question/38699645)"这个说法。

  而markdown编辑器，核心的处理内容为简单语法的纯文本，复杂度相对来说比较低，并且input标签自带onSelect事件，可以很方便的获取选择信息（选择起始位置和选择文本值），因此要想实现编辑功能，只需将要改动的内容进行文本转换，然后进行重新拼接首尾，大功告成。
  
- markdown解析

  考察了几个社区流行的markdown解析器，比较流行的有[markdown](https://www.npmjs.com/package/markdown), [markdown-it](https://www.npmjs.com/package/markdown-it), [marked](https://www.npmjs.com/package/marked) 等等。综合考虑扩展性以及稳定性，笔者推荐使用markdown-it作为markdown的词法解析器，因为该解析器有比较多的插件，并且支持语法高亮。

- 同步滚动

  当选择分栏编辑的时候，滚动左侧的编辑区，右侧的预览区能自动滚动到对应的区域。方案参考了《[手把手教你用 100行代码实现基于 react的 markdown 输入 + 即时预览在线编辑器（一）](https://github.com/accforgit/blog-data/blob/master/%E5%9C%A8%E7%BA%BF%E7%BC%96%E8%BE%91%E5%99%A8/README/README1.md)》。只需先计算出输入框容器元素与预览框容器元素之间最大scroll范围的比例值，然后根据主动滚动元素自身的scrollTop做相应的比例换算，即可知道对方区域的scrollTop值。

- 关于UI
 
  - 项目的字体库选择了Font Awesome风格，并且只选取了项目所需要的一些图标。
  - 编辑器的整体css均可通过全局覆盖的形式进行自定义。目前暂时只支持灰色主题。
  - 编辑器的显示区域包括菜单栏，编辑器，预览区，工具栏，通过配置组件的config属性，可以选择默认的展示区域。
  
### Install

```js
npm install react-markdown-editor-lite --save
```

### Props

| Property | Description | Type | default | Remarks |
| --- | --- | --- | --- | --- |
| value | markdown content | String | '' | required |
| style | component container style | Object | {height: '100%'} | not required |
| config | component config | Object | {view: {...}, logger: {...}} | not required |
| onChange | emitting when editor has changed | Function | ({html, md}) => {} | not required |
| onImageUpload | when image uploaded, callback emitting will get image markdown text | (file: File, callback: (url: string) => void) => void; | ({file, callback}) => {} | not required |
| renderHTML | Render markdown text to HTML. You can return either string, function or Promise | (text: string) => string|function|Promise | none | **required** |

### Example

``` js
'use strict';
import React from 'react'
import ReactDOM from 'react-dom'
import MdEditor from 'react-markdown-editor-lite'
import MarkdownIt from 'markdown-it'
import emoji from 'markdown-it-emoji'
import subscript from 'markdown-it-sub'
import superscript from 'markdown-it-sup'
import footnote from 'markdown-it-footnote'
import deflist from 'markdown-it-deflist'
import abbreviation from 'markdown-it-abbr'
import insert from 'markdown-it-ins'
import mark from 'markdown-it-mark'
import tasklists from 'markdown-it-task-lists'
import hljs from 'highlight.js'
import 'highlight.js/styles/atom-one-light.css'
// import 'highlight.js/styles/github.css'
import './index.less';

const MOCK_DATA = "I Love React."
export default class Demo extends React.Component {
  mdEditor = null
  mdParser = null
  constructor(props) {
    super(props)
    // initial a parsera
    this.mdParser = new MarkdownIt({
      html: true,
      linkify: true,
      typographer: true,
      highlight: function (str, lang) {
        if (lang && hljs.getLanguage(lang)) {
          try {
            return hljs.highlight(lang, str).value
          } catch (__) {}
        }    
        return '' // use external default escaping
      }
    })
    .use(emoji)
    .use(subscript)
    .use(superscript)
    .use(footnote)
    .use(deflist)
    .use(abbreviation)
    .use(insert)
    .use(mark)
    .use(tasklists, { enabled: this.taskLists })
    this.renderHTML = this.renderHTML.bind(this)
  }
  handleEditorChange({html, md}) {
    console.log('handleEditorChange', html, md)
  }
  handleImageUpload(file, callback) {
    const reader = new FileReader()
    reader.onload = () => {      
      const convertBase64UrlToBlob = (urlData) => {  
        let arr = urlData.split(','), mime = arr[0].match(/:(.*?);/)[1]
        let bstr = atob(arr[1])
        let n = bstr.length
        let u8arr = new Uint8Array(n)
        while (n--) {
          u8arr[n] = bstr.charCodeAt(n)
        }
        return new Blob([u8arr], {type:mime})
      }
      const blob = convertBase64UrlToBlob(reader.result)
      setTimeout(() => {
        // setTimeout 模拟异步上传图片
        // 当异步上传获取图片地址后，执行calback回调（参数为imageUrl字符串），即可将图片地址写入markdown
        callback('https://avatars0.githubusercontent.com/u/21263805?s=40&v=4')
      }, 1000)
    }
    reader.readAsDataURL(file)
  }
  renderHTML(text) {
    // 模拟异步渲染Markdown
    return new Promise((resolve) => {
      setTimeout(() => {
        resolve(this.mdParser.render(text))
      }, 1000)
    })
  }
  handleGetMdValue = () => {   
    this.mdEditor && alert(this.mdEditor.getMdValue())      
  }
  handleGetHtmlValue = () => {    
    this.mdEditor && alert(this.mdEditor.getHtmlValue())
  }
  render() {
    return (      
      <div>
        <nav>
          <button onClick={this.handleGetMdValue} >getMdValue</button>  
          <button onClick={this.handleGetHtmlValue} >getHtmlValue</button>  
        </nav>
        <section style="height: 500px">
          <MdEditor 
            ref={node => this.mdEditor = node}
            value={MOCK_DATA}
            style={{height: '400px'}}
            renderHTML={this.renderHTML}
            config={{
              view: {
                menu: true,
                md: true,
                html: true
              },
              imageUrl: 'https://octodex.github.com/images/minion.png'
            }}
            onChange={this.handleEditorChange} 
            onImageUpload={this.handleImageUpload}
          />
        </section>                        
      </div>      
    )
  }
}
```

### 最后

   欢迎大家使用和反馈，[项目地址](https://github.com/HarryChen0506/react-markdown-editor-lite) (https://github.com/HarryChen0506/react-markdown-editor-lite)， 你的点赞将是我莫大的动力😊

![1.png](https://s3.ca-central-1.amazonaws.com/res-blog-public/res-dev/blog_1636946743939_1.png)', firstPicture='', viewCount=83, createDate='Sun Nov 07 14:09:29 EST 2021', updateDate='Tue Jan 18 22:54:08 EST 2022'}}, total=null}
2022-01-19 20:07:42:397 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 25ms
2022-01-19 20:07:42:397 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 20:07:42:408 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 20:07:42:408 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 20:07:42:408 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 20:07:42:408 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 20:07:42:408 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 20:07:42:408 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 20:07:42:408 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=20createdate=Wed Jan 19 11:47:08 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/26.png, replyComments=[CommentListVo{commentId=21createdate=Wed Jan 19 11:47:21 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/89.png, replyComments=[CommentListVo{commentId=22createdate=Wed Jan 19 11:47:39 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/75.png, replyComments=null, CommentVo=CommentVo{parentCommentId=21, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='sfs@ss.c', content='eeeeee', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='tet', content='ree', status='0'}}, CommentListVo{commentId=27createdate=Wed Jan 19 17:01:06 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/2.png, replyComments=null, CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='ljh19911025@gmail.com', nickname='sds', parentCommentNickname='tet', content='wwww', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='tet', parentCommentNickname='null', content='etet', status='0'}}], total=1}
2022-01-19 20:07:42:408 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 37ms
2022-01-19 20:07:42:408 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 20:07:42:409 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 20:07:42:409 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 20:07:42:409 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 20:07:42:409 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 20:07:42:409 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 20:07:42:409 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 20:07:42:409 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=20createdate=Wed Jan 19 11:47:08 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/26.png, replyComments=[CommentListVo{commentId=21createdate=Wed Jan 19 11:47:21 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/89.png, replyComments=[CommentListVo{commentId=22createdate=Wed Jan 19 11:47:39 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/75.png, replyComments=null, CommentVo=CommentVo{parentCommentId=21, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='sfs@ss.c', content='eeeeee', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='tet', content='ree', status='0'}}, CommentListVo{commentId=27createdate=Wed Jan 19 17:01:06 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/2.png, replyComments=null, CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='ljh19911025@gmail.com', nickname='sds', parentCommentNickname='tet', content='wwww', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='tet', parentCommentNickname='null', content='etet', status='0'}}], total=1}
2022-01-19 20:07:42:409 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 38ms
2022-01-19 20:07:42:409 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 20:07:42:889 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 20:07:42:889 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 20:07:42:889 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 20:07:42:889 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 20:07:42:889 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 20:07:42:889 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 20:07:42:889 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=20createdate=Wed Jan 19 11:47:08 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/26.png, replyComments=[CommentListVo{commentId=21createdate=Wed Jan 19 11:47:21 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/89.png, replyComments=[CommentListVo{commentId=22createdate=Wed Jan 19 11:47:39 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/75.png, replyComments=null, CommentVo=CommentVo{parentCommentId=21, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='sfs@ss.c', content='eeeeee', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='tet', content='ree', status='0'}}, CommentListVo{commentId=27createdate=Wed Jan 19 17:01:06 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/2.png, replyComments=null, CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='ljh19911025@gmail.com', nickname='sds', parentCommentNickname='tet', content='wwww', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='tet', parentCommentNickname='null', content='etet', status='0'}}], total=1}
2022-01-19 20:07:42:890 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 7ms
2022-01-19 20:07:42:890 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 20:11:15:425 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 20:11:15:434 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 20:11:15:434 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 20:11:15:434 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/article/10005
2022-01-19 20:11:15:434 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.ArticleController.getPublicArticleDetail
2022-01-19 20:11:15:434 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 20:11:15:427 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 20:11:15:434 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 20:11:15:434 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 20:11:15:434 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 20:11:15:434 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 20:11:15:434 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 20:11:15:434 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=ArticleVo{userInfo=UserInfoVo{userId=100001, nickName='ivan', userName='ivan', avatar='https://res-blog-public.s3.ca-central-1.amazonaws.com/default_avatar.jpg'}, category=CategoryVo{categoryId=1, name='Life ', articleCount=null}, BaseArticleVo{articleId=10005, status=1, type=1, title='dd', description='This is the doc of React markdown editor lite.
Enjoy!!', content='| Head | Head | Head | Head |
| --- | --- | --- | --- |
| Data | Data | Data | Data |
| Data | Data | Data | Data |

## 手把手教你写一个markdown编辑器

> 笔者在18年年末的时候接到一个开发任务——搭建一个AI项目的开放平台，其中的产品文档为转化为HTML格式的markdown文档。考虑到文档的即时更新，将文档信息做成了Ajax接口的形式。因此管理后台只需将textarea表单的内容通过markdown解析器进行HTML格式转化，然后将markdown内容和经转化的HTML文档都保存到数据库即可。
> 基本需求完成后，为了更好的用户体验，考虑将常用的编辑功能添加进来。改进版不仅支持了常用的文本编辑功能，还实现的UI界面的配置化，自定义语法解析器。本着造福伸手党的目的，以及积累些开源经验，笔者将该react 组件 [react-markdown-editor-lite](https://github.com/HarryChen0506/react-markdown-editor-lite) 进行了封装改造，并且发布到了开源社区。

### 预览
在线体验 [https://harrychen0506.github.io/react-markdown-editor-lite/](https://harrychen0506.github.io/react-markdown-editor-lite/)

![image](https://github.com//HarryChen0506/react-markdown-editor-lite/blob/master/image/react-markdown-editor-lite-v1.0.0.PNG?raw=true)

### 特点
* 轻量、基于React
* UI可配置, 如只显示编辑区或预览区
* 支持自定义markdown语法解析器,语法高亮等
* 支持常用的markdown编辑功能，如加粗，斜体等等...
* 支持功能按钮插拔化，用户可以自定义扩展组件
* 支持编辑区和预览区同步滚动

### 开发心得

- 文本编辑

  大多数常见的编辑器，包括富文本编辑器，利用了某些元素如div的contenteditable属性，配合selection、range、execCommand等API，实现了富文本编辑功能。这里面的实现比较复杂，所以有了"[为什么都说富文本编辑器是天坑？](https://www.zhihu.com/question/38699645)"这个说法。

  而markdown编辑器，核心的处理内容为简单语法的纯文本，复杂度相对来说比较低，并且input标签自带onSelect事件，可以很方便的获取选择信息（选择起始位置和选择文本值），因此要想实现编辑功能，只需将要改动的内容进行文本转换，然后进行重新拼接首尾，大功告成。
  
- markdown解析

  考察了几个社区流行的markdown解析器，比较流行的有[markdown](https://www.npmjs.com/package/markdown), [markdown-it](https://www.npmjs.com/package/markdown-it), [marked](https://www.npmjs.com/package/marked) 等等。综合考虑扩展性以及稳定性，笔者推荐使用markdown-it作为markdown的词法解析器，因为该解析器有比较多的插件，并且支持语法高亮。

- 同步滚动

  当选择分栏编辑的时候，滚动左侧的编辑区，右侧的预览区能自动滚动到对应的区域。方案参考了《[手把手教你用 100行代码实现基于 react的 markdown 输入 + 即时预览在线编辑器（一）](https://github.com/accforgit/blog-data/blob/master/%E5%9C%A8%E7%BA%BF%E7%BC%96%E8%BE%91%E5%99%A8/README/README1.md)》。只需先计算出输入框容器元素与预览框容器元素之间最大scroll范围的比例值，然后根据主动滚动元素自身的scrollTop做相应的比例换算，即可知道对方区域的scrollTop值。

- 关于UI
 
  - 项目的字体库选择了Font Awesome风格，并且只选取了项目所需要的一些图标。
  - 编辑器的整体css均可通过全局覆盖的形式进行自定义。目前暂时只支持灰色主题。
  - 编辑器的显示区域包括菜单栏，编辑器，预览区，工具栏，通过配置组件的config属性，可以选择默认的展示区域。
  
### Install

```js
npm install react-markdown-editor-lite --save
```

### Props

| Property | Description | Type | default | Remarks |
| --- | --- | --- | --- | --- |
| value | markdown content | String | '' | required |
| style | component container style | Object | {height: '100%'} | not required |
| config | component config | Object | {view: {...}, logger: {...}} | not required |
| onChange | emitting when editor has changed | Function | ({html, md}) => {} | not required |
| onImageUpload | when image uploaded, callback emitting will get image markdown text | (file: File, callback: (url: string) => void) => void; | ({file, callback}) => {} | not required |
| renderHTML | Render markdown text to HTML. You can return either string, function or Promise | (text: string) => string|function|Promise | none | **required** |

### Example

``` js
'use strict';
import React from 'react'
import ReactDOM from 'react-dom'
import MdEditor from 'react-markdown-editor-lite'
import MarkdownIt from 'markdown-it'
import emoji from 'markdown-it-emoji'
import subscript from 'markdown-it-sub'
import superscript from 'markdown-it-sup'
import footnote from 'markdown-it-footnote'
import deflist from 'markdown-it-deflist'
import abbreviation from 'markdown-it-abbr'
import insert from 'markdown-it-ins'
import mark from 'markdown-it-mark'
import tasklists from 'markdown-it-task-lists'
import hljs from 'highlight.js'
import 'highlight.js/styles/atom-one-light.css'
// import 'highlight.js/styles/github.css'
import './index.less';

const MOCK_DATA = "I Love React."
export default class Demo extends React.Component {
  mdEditor = null
  mdParser = null
  constructor(props) {
    super(props)
    // initial a parsera
    this.mdParser = new MarkdownIt({
      html: true,
      linkify: true,
      typographer: true,
      highlight: function (str, lang) {
        if (lang && hljs.getLanguage(lang)) {
          try {
            return hljs.highlight(lang, str).value
          } catch (__) {}
        }    
        return '' // use external default escaping
      }
    })
    .use(emoji)
    .use(subscript)
    .use(superscript)
    .use(footnote)
    .use(deflist)
    .use(abbreviation)
    .use(insert)
    .use(mark)
    .use(tasklists, { enabled: this.taskLists })
    this.renderHTML = this.renderHTML.bind(this)
  }
  handleEditorChange({html, md}) {
    console.log('handleEditorChange', html, md)
  }
  handleImageUpload(file, callback) {
    const reader = new FileReader()
    reader.onload = () => {      
      const convertBase64UrlToBlob = (urlData) => {  
        let arr = urlData.split(','), mime = arr[0].match(/:(.*?);/)[1]
        let bstr = atob(arr[1])
        let n = bstr.length
        let u8arr = new Uint8Array(n)
        while (n--) {
          u8arr[n] = bstr.charCodeAt(n)
        }
        return new Blob([u8arr], {type:mime})
      }
      const blob = convertBase64UrlToBlob(reader.result)
      setTimeout(() => {
        // setTimeout 模拟异步上传图片
        // 当异步上传获取图片地址后，执行calback回调（参数为imageUrl字符串），即可将图片地址写入markdown
        callback('https://avatars0.githubusercontent.com/u/21263805?s=40&v=4')
      }, 1000)
    }
    reader.readAsDataURL(file)
  }
  renderHTML(text) {
    // 模拟异步渲染Markdown
    return new Promise((resolve) => {
      setTimeout(() => {
        resolve(this.mdParser.render(text))
      }, 1000)
    })
  }
  handleGetMdValue = () => {   
    this.mdEditor && alert(this.mdEditor.getMdValue())      
  }
  handleGetHtmlValue = () => {    
    this.mdEditor && alert(this.mdEditor.getHtmlValue())
  }
  render() {
    return (      
      <div>
        <nav>
          <button onClick={this.handleGetMdValue} >getMdValue</button>  
          <button onClick={this.handleGetHtmlValue} >getHtmlValue</button>  
        </nav>
        <section style="height: 500px">
          <MdEditor 
            ref={node => this.mdEditor = node}
            value={MOCK_DATA}
            style={{height: '400px'}}
            renderHTML={this.renderHTML}
            config={{
              view: {
                menu: true,
                md: true,
                html: true
              },
              imageUrl: 'https://octodex.github.com/images/minion.png'
            }}
            onChange={this.handleEditorChange} 
            onImageUpload={this.handleImageUpload}
          />
        </section>                        
      </div>      
    )
  }
}
```

### 最后

   欢迎大家使用和反馈，[项目地址](https://github.com/HarryChen0506/react-markdown-editor-lite) (https://github.com/HarryChen0506/react-markdown-editor-lite)， 你的点赞将是我莫大的动力😊

![1.png](https://s3.ca-central-1.amazonaws.com/res-blog-public/res-dev/blog_1636946743939_1.png)', firstPicture='', viewCount=83, createDate='Sun Nov 07 14:09:29 EST 2021', updateDate='Tue Jan 18 22:54:08 EST 2022'}}, total=null}
2022-01-19 20:11:15:435 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 66ms
2022-01-19 20:11:15:435 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 20:11:15:434 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=20createdate=Wed Jan 19 11:47:08 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/26.png, replyComments=[CommentListVo{commentId=21createdate=Wed Jan 19 11:47:21 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/89.png, replyComments=[CommentListVo{commentId=22createdate=Wed Jan 19 11:47:39 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/75.png, replyComments=null, CommentVo=CommentVo{parentCommentId=21, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='sfs@ss.c', content='eeeeee', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='tet', content='ree', status='0'}}, CommentListVo{commentId=27createdate=Wed Jan 19 17:01:06 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/2.png, replyComments=null, CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='ljh19911025@gmail.com', nickname='sds', parentCommentNickname='tet', content='wwww', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='tet', parentCommentNickname='null', content='etet', status='0'}}], total=1}
2022-01-19 20:11:15:435 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 64ms
2022-01-19 20:11:15:435 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 20:11:15:427 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 20:11:15:435 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 20:11:15:435 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 20:11:15:435 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 20:11:15:435 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 20:11:15:435 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 20:11:15:435 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=20createdate=Wed Jan 19 11:47:08 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/26.png, replyComments=[CommentListVo{commentId=21createdate=Wed Jan 19 11:47:21 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/89.png, replyComments=[CommentListVo{commentId=22createdate=Wed Jan 19 11:47:39 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/75.png, replyComments=null, CommentVo=CommentVo{parentCommentId=21, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='sfs@ss.c', content='eeeeee', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='tet', content='ree', status='0'}}, CommentListVo{commentId=27createdate=Wed Jan 19 17:01:06 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/2.png, replyComments=null, CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='ljh19911025@gmail.com', nickname='sds', parentCommentNickname='tet', content='wwww', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='tet', parentCommentNickname='null', content='etet', status='0'}}], total=1}
2022-01-19 20:11:15:435 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 68ms
2022-01-19 20:11:15:435 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 20:11:15:957 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 20:11:15:957 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 20:11:15:957 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 20:11:15:957 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 20:11:15:957 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 20:11:15:957 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 20:11:15:957 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=20createdate=Wed Jan 19 11:47:08 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/26.png, replyComments=[CommentListVo{commentId=21createdate=Wed Jan 19 11:47:21 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/89.png, replyComments=[CommentListVo{commentId=22createdate=Wed Jan 19 11:47:39 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/75.png, replyComments=null, CommentVo=CommentVo{parentCommentId=21, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='sfs@ss.c', content='eeeeee', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='tet', content='ree', status='0'}}, CommentListVo{commentId=27createdate=Wed Jan 19 17:01:06 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/2.png, replyComments=null, CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='ljh19911025@gmail.com', nickname='sds', parentCommentNickname='tet', content='wwww', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='tet', parentCommentNickname='null', content='etet', status='0'}}], total=1}
2022-01-19 20:11:15:957 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 8ms
2022-01-19 20:11:15:957 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 20:13:16:241 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 20:13:16:241 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 20:13:16:242 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 20:13:16:242 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 20:13:16:242 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 20:13:16:242 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 20:13:16:243 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 20:13:16:243 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 20:13:16:243 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 20:13:16:243 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 20:13:16:243 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 20:13:16:243 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 20:13:16:243 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=20createdate=Wed Jan 19 11:47:08 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/26.png, replyComments=[CommentListVo{commentId=21createdate=Wed Jan 19 11:47:21 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/89.png, replyComments=[CommentListVo{commentId=22createdate=Wed Jan 19 11:47:39 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/75.png, replyComments=null, CommentVo=CommentVo{parentCommentId=21, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='sfs@ss.c', content='eeeeee', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='tet', content='ree', status='0'}}, CommentListVo{commentId=27createdate=Wed Jan 19 17:01:06 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/2.png, replyComments=null, CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='ljh19911025@gmail.com', nickname='sds', parentCommentNickname='tet', content='wwww', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='tet', parentCommentNickname='null', content='etet', status='0'}}], total=1}
2022-01-19 20:13:16:243 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 75ms
2022-01-19 20:13:16:243 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 20:13:16:243 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=20createdate=Wed Jan 19 11:47:08 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/26.png, replyComments=[CommentListVo{commentId=21createdate=Wed Jan 19 11:47:21 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/89.png, replyComments=[CommentListVo{commentId=22createdate=Wed Jan 19 11:47:39 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/75.png, replyComments=null, CommentVo=CommentVo{parentCommentId=21, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='sfs@ss.c', content='eeeeee', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='tet', content='ree', status='0'}}, CommentListVo{commentId=27createdate=Wed Jan 19 17:01:06 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/2.png, replyComments=null, CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='ljh19911025@gmail.com', nickname='sds', parentCommentNickname='tet', content='wwww', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='tet', parentCommentNickname='null', content='etet', status='0'}}], total=1}
2022-01-19 20:13:16:243 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 75ms
2022-01-19 20:13:16:243 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 20:13:16:243 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 20:13:16:244 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 20:13:16:244 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 20:13:16:244 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/article/10005
2022-01-19 20:13:16:244 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.ArticleController.getPublicArticleDetail
2022-01-19 20:13:16:244 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 20:13:16:244 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=ArticleVo{userInfo=UserInfoVo{userId=100001, nickName='ivan', userName='ivan', avatar='https://res-blog-public.s3.ca-central-1.amazonaws.com/default_avatar.jpg'}, category=CategoryVo{categoryId=1, name='Life ', articleCount=null}, BaseArticleVo{articleId=10005, status=1, type=1, title='dd', description='This is the doc of React markdown editor lite.
Enjoy!!', content='| Head | Head | Head | Head |
| --- | --- | --- | --- |
| Data | Data | Data | Data |
| Data | Data | Data | Data |

## 手把手教你写一个markdown编辑器

> 笔者在18年年末的时候接到一个开发任务——搭建一个AI项目的开放平台，其中的产品文档为转化为HTML格式的markdown文档。考虑到文档的即时更新，将文档信息做成了Ajax接口的形式。因此管理后台只需将textarea表单的内容通过markdown解析器进行HTML格式转化，然后将markdown内容和经转化的HTML文档都保存到数据库即可。
> 基本需求完成后，为了更好的用户体验，考虑将常用的编辑功能添加进来。改进版不仅支持了常用的文本编辑功能，还实现的UI界面的配置化，自定义语法解析器。本着造福伸手党的目的，以及积累些开源经验，笔者将该react 组件 [react-markdown-editor-lite](https://github.com/HarryChen0506/react-markdown-editor-lite) 进行了封装改造，并且发布到了开源社区。

### 预览
在线体验 [https://harrychen0506.github.io/react-markdown-editor-lite/](https://harrychen0506.github.io/react-markdown-editor-lite/)

![image](https://github.com//HarryChen0506/react-markdown-editor-lite/blob/master/image/react-markdown-editor-lite-v1.0.0.PNG?raw=true)

### 特点
* 轻量、基于React
* UI可配置, 如只显示编辑区或预览区
* 支持自定义markdown语法解析器,语法高亮等
* 支持常用的markdown编辑功能，如加粗，斜体等等...
* 支持功能按钮插拔化，用户可以自定义扩展组件
* 支持编辑区和预览区同步滚动

### 开发心得

- 文本编辑

  大多数常见的编辑器，包括富文本编辑器，利用了某些元素如div的contenteditable属性，配合selection、range、execCommand等API，实现了富文本编辑功能。这里面的实现比较复杂，所以有了"[为什么都说富文本编辑器是天坑？](https://www.zhihu.com/question/38699645)"这个说法。

  而markdown编辑器，核心的处理内容为简单语法的纯文本，复杂度相对来说比较低，并且input标签自带onSelect事件，可以很方便的获取选择信息（选择起始位置和选择文本值），因此要想实现编辑功能，只需将要改动的内容进行文本转换，然后进行重新拼接首尾，大功告成。
  
- markdown解析

  考察了几个社区流行的markdown解析器，比较流行的有[markdown](https://www.npmjs.com/package/markdown), [markdown-it](https://www.npmjs.com/package/markdown-it), [marked](https://www.npmjs.com/package/marked) 等等。综合考虑扩展性以及稳定性，笔者推荐使用markdown-it作为markdown的词法解析器，因为该解析器有比较多的插件，并且支持语法高亮。

- 同步滚动

  当选择分栏编辑的时候，滚动左侧的编辑区，右侧的预览区能自动滚动到对应的区域。方案参考了《[手把手教你用 100行代码实现基于 react的 markdown 输入 + 即时预览在线编辑器（一）](https://github.com/accforgit/blog-data/blob/master/%E5%9C%A8%E7%BA%BF%E7%BC%96%E8%BE%91%E5%99%A8/README/README1.md)》。只需先计算出输入框容器元素与预览框容器元素之间最大scroll范围的比例值，然后根据主动滚动元素自身的scrollTop做相应的比例换算，即可知道对方区域的scrollTop值。

- 关于UI
 
  - 项目的字体库选择了Font Awesome风格，并且只选取了项目所需要的一些图标。
  - 编辑器的整体css均可通过全局覆盖的形式进行自定义。目前暂时只支持灰色主题。
  - 编辑器的显示区域包括菜单栏，编辑器，预览区，工具栏，通过配置组件的config属性，可以选择默认的展示区域。
  
### Install

```js
npm install react-markdown-editor-lite --save
```

### Props

| Property | Description | Type | default | Remarks |
| --- | --- | --- | --- | --- |
| value | markdown content | String | '' | required |
| style | component container style | Object | {height: '100%'} | not required |
| config | component config | Object | {view: {...}, logger: {...}} | not required |
| onChange | emitting when editor has changed | Function | ({html, md}) => {} | not required |
| onImageUpload | when image uploaded, callback emitting will get image markdown text | (file: File, callback: (url: string) => void) => void; | ({file, callback}) => {} | not required |
| renderHTML | Render markdown text to HTML. You can return either string, function or Promise | (text: string) => string|function|Promise | none | **required** |

### Example

``` js
'use strict';
import React from 'react'
import ReactDOM from 'react-dom'
import MdEditor from 'react-markdown-editor-lite'
import MarkdownIt from 'markdown-it'
import emoji from 'markdown-it-emoji'
import subscript from 'markdown-it-sub'
import superscript from 'markdown-it-sup'
import footnote from 'markdown-it-footnote'
import deflist from 'markdown-it-deflist'
import abbreviation from 'markdown-it-abbr'
import insert from 'markdown-it-ins'
import mark from 'markdown-it-mark'
import tasklists from 'markdown-it-task-lists'
import hljs from 'highlight.js'
import 'highlight.js/styles/atom-one-light.css'
// import 'highlight.js/styles/github.css'
import './index.less';

const MOCK_DATA = "I Love React."
export default class Demo extends React.Component {
  mdEditor = null
  mdParser = null
  constructor(props) {
    super(props)
    // initial a parsera
    this.mdParser = new MarkdownIt({
      html: true,
      linkify: true,
      typographer: true,
      highlight: function (str, lang) {
        if (lang && hljs.getLanguage(lang)) {
          try {
            return hljs.highlight(lang, str).value
          } catch (__) {}
        }    
        return '' // use external default escaping
      }
    })
    .use(emoji)
    .use(subscript)
    .use(superscript)
    .use(footnote)
    .use(deflist)
    .use(abbreviation)
    .use(insert)
    .use(mark)
    .use(tasklists, { enabled: this.taskLists })
    this.renderHTML = this.renderHTML.bind(this)
  }
  handleEditorChange({html, md}) {
    console.log('handleEditorChange', html, md)
  }
  handleImageUpload(file, callback) {
    const reader = new FileReader()
    reader.onload = () => {      
      const convertBase64UrlToBlob = (urlData) => {  
        let arr = urlData.split(','), mime = arr[0].match(/:(.*?);/)[1]
        let bstr = atob(arr[1])
        let n = bstr.length
        let u8arr = new Uint8Array(n)
        while (n--) {
          u8arr[n] = bstr.charCodeAt(n)
        }
        return new Blob([u8arr], {type:mime})
      }
      const blob = convertBase64UrlToBlob(reader.result)
      setTimeout(() => {
        // setTimeout 模拟异步上传图片
        // 当异步上传获取图片地址后，执行calback回调（参数为imageUrl字符串），即可将图片地址写入markdown
        callback('https://avatars0.githubusercontent.com/u/21263805?s=40&v=4')
      }, 1000)
    }
    reader.readAsDataURL(file)
  }
  renderHTML(text) {
    // 模拟异步渲染Markdown
    return new Promise((resolve) => {
      setTimeout(() => {
        resolve(this.mdParser.render(text))
      }, 1000)
    })
  }
  handleGetMdValue = () => {   
    this.mdEditor && alert(this.mdEditor.getMdValue())      
  }
  handleGetHtmlValue = () => {    
    this.mdEditor && alert(this.mdEditor.getHtmlValue())
  }
  render() {
    return (      
      <div>
        <nav>
          <button onClick={this.handleGetMdValue} >getMdValue</button>  
          <button onClick={this.handleGetHtmlValue} >getHtmlValue</button>  
        </nav>
        <section style="height: 500px">
          <MdEditor 
            ref={node => this.mdEditor = node}
            value={MOCK_DATA}
            style={{height: '400px'}}
            renderHTML={this.renderHTML}
            config={{
              view: {
                menu: true,
                md: true,
                html: true
              },
              imageUrl: 'https://octodex.github.com/images/minion.png'
            }}
            onChange={this.handleEditorChange} 
            onImageUpload={this.handleImageUpload}
          />
        </section>                        
      </div>      
    )
  }
}
```

### 最后

   欢迎大家使用和反馈，[项目地址](https://github.com/HarryChen0506/react-markdown-editor-lite) (https://github.com/HarryChen0506/react-markdown-editor-lite)， 你的点赞将是我莫大的动力😊

![1.png](https://s3.ca-central-1.amazonaws.com/res-blog-public/res-dev/blog_1636946743939_1.png)', firstPicture='', viewCount=83, createDate='Sun Nov 07 14:09:29 EST 2021', updateDate='Tue Jan 18 22:54:08 EST 2022'}}, total=null}
2022-01-19 20:13:16:244 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 78ms
2022-01-19 20:13:16:244 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 20:13:16:747 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 20:13:16:747 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 20:13:16:747 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 20:13:16:747 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 20:13:16:747 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 20:13:16:747 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 20:13:16:747 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=20createdate=Wed Jan 19 11:47:08 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/26.png, replyComments=[CommentListVo{commentId=21createdate=Wed Jan 19 11:47:21 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/89.png, replyComments=[CommentListVo{commentId=22createdate=Wed Jan 19 11:47:39 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/75.png, replyComments=null, CommentVo=CommentVo{parentCommentId=21, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='sfs@ss.c', content='eeeeee', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='tet', content='ree', status='0'}}, CommentListVo{commentId=27createdate=Wed Jan 19 17:01:06 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/2.png, replyComments=null, CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='ljh19911025@gmail.com', nickname='sds', parentCommentNickname='tet', content='wwww', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='tet', parentCommentNickname='null', content='etet', status='0'}}], total=1}
2022-01-19 20:13:16:747 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 4ms
2022-01-19 20:13:16:747 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 20:14:15:195 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 20:14:15:195 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 20:14:15:195 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 20:14:15:195 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 20:14:15:195 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 20:14:15:195 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 20:14:15:195 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=20createdate=Wed Jan 19 11:47:08 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/26.png, replyComments=[CommentListVo{commentId=21createdate=Wed Jan 19 11:47:21 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/89.png, replyComments=[CommentListVo{commentId=22createdate=Wed Jan 19 11:47:39 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/75.png, replyComments=null, CommentVo=CommentVo{parentCommentId=21, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='sfs@ss.c', content='eeeeee', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='tet', content='ree', status='0'}}, CommentListVo{commentId=27createdate=Wed Jan 19 17:01:06 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/2.png, replyComments=null, CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='ljh19911025@gmail.com', nickname='sds', parentCommentNickname='tet', content='wwww', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='tet', parentCommentNickname='null', content='etet', status='0'}}], total=1}
2022-01-19 20:14:15:196 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 18ms
2022-01-19 20:14:15:196 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 20:14:15:196 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 20:14:15:196 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 20:14:15:196 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 20:14:15:196 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 20:14:15:196 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 20:14:15:196 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 20:14:15:197 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 20:14:15:197 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 20:14:15:196 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=20createdate=Wed Jan 19 11:47:08 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/26.png, replyComments=[CommentListVo{commentId=21createdate=Wed Jan 19 11:47:21 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/89.png, replyComments=[CommentListVo{commentId=22createdate=Wed Jan 19 11:47:39 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/75.png, replyComments=null, CommentVo=CommentVo{parentCommentId=21, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='sfs@ss.c', content='eeeeee', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='tet', content='ree', status='0'}}, CommentListVo{commentId=27createdate=Wed Jan 19 17:01:06 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/2.png, replyComments=null, CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='ljh19911025@gmail.com', nickname='sds', parentCommentNickname='tet', content='wwww', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='tet', parentCommentNickname='null', content='etet', status='0'}}], total=1}
2022-01-19 20:14:15:197 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 20:14:15:197 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/article/10005
2022-01-19 20:14:15:197 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.ArticleController.getPublicArticleDetail
2022-01-19 20:14:15:197 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 20:14:15:197 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 19ms
2022-01-19 20:14:15:197 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 20:14:15:197 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=ArticleVo{userInfo=UserInfoVo{userId=100001, nickName='ivan', userName='ivan', avatar='https://res-blog-public.s3.ca-central-1.amazonaws.com/default_avatar.jpg'}, category=CategoryVo{categoryId=1, name='Life ', articleCount=null}, BaseArticleVo{articleId=10005, status=1, type=1, title='dd', description='This is the doc of React markdown editor lite.
Enjoy!!', content='| Head | Head | Head | Head |
| --- | --- | --- | --- |
| Data | Data | Data | Data |
| Data | Data | Data | Data |

## 手把手教你写一个markdown编辑器

> 笔者在18年年末的时候接到一个开发任务——搭建一个AI项目的开放平台，其中的产品文档为转化为HTML格式的markdown文档。考虑到文档的即时更新，将文档信息做成了Ajax接口的形式。因此管理后台只需将textarea表单的内容通过markdown解析器进行HTML格式转化，然后将markdown内容和经转化的HTML文档都保存到数据库即可。
> 基本需求完成后，为了更好的用户体验，考虑将常用的编辑功能添加进来。改进版不仅支持了常用的文本编辑功能，还实现的UI界面的配置化，自定义语法解析器。本着造福伸手党的目的，以及积累些开源经验，笔者将该react 组件 [react-markdown-editor-lite](https://github.com/HarryChen0506/react-markdown-editor-lite) 进行了封装改造，并且发布到了开源社区。

### 预览
在线体验 [https://harrychen0506.github.io/react-markdown-editor-lite/](https://harrychen0506.github.io/react-markdown-editor-lite/)

![image](https://github.com//HarryChen0506/react-markdown-editor-lite/blob/master/image/react-markdown-editor-lite-v1.0.0.PNG?raw=true)

### 特点
* 轻量、基于React
* UI可配置, 如只显示编辑区或预览区
* 支持自定义markdown语法解析器,语法高亮等
* 支持常用的markdown编辑功能，如加粗，斜体等等...
* 支持功能按钮插拔化，用户可以自定义扩展组件
* 支持编辑区和预览区同步滚动

### 开发心得

- 文本编辑

  大多数常见的编辑器，包括富文本编辑器，利用了某些元素如div的contenteditable属性，配合selection、range、execCommand等API，实现了富文本编辑功能。这里面的实现比较复杂，所以有了"[为什么都说富文本编辑器是天坑？](https://www.zhihu.com/question/38699645)"这个说法。

  而markdown编辑器，核心的处理内容为简单语法的纯文本，复杂度相对来说比较低，并且input标签自带onSelect事件，可以很方便的获取选择信息（选择起始位置和选择文本值），因此要想实现编辑功能，只需将要改动的内容进行文本转换，然后进行重新拼接首尾，大功告成。
  
- markdown解析

  考察了几个社区流行的markdown解析器，比较流行的有[markdown](https://www.npmjs.com/package/markdown), [markdown-it](https://www.npmjs.com/package/markdown-it), [marked](https://www.npmjs.com/package/marked) 等等。综合考虑扩展性以及稳定性，笔者推荐使用markdown-it作为markdown的词法解析器，因为该解析器有比较多的插件，并且支持语法高亮。

- 同步滚动

  当选择分栏编辑的时候，滚动左侧的编辑区，右侧的预览区能自动滚动到对应的区域。方案参考了《[手把手教你用 100行代码实现基于 react的 markdown 输入 + 即时预览在线编辑器（一）](https://github.com/accforgit/blog-data/blob/master/%E5%9C%A8%E7%BA%BF%E7%BC%96%E8%BE%91%E5%99%A8/README/README1.md)》。只需先计算出输入框容器元素与预览框容器元素之间最大scroll范围的比例值，然后根据主动滚动元素自身的scrollTop做相应的比例换算，即可知道对方区域的scrollTop值。

- 关于UI
 
  - 项目的字体库选择了Font Awesome风格，并且只选取了项目所需要的一些图标。
  - 编辑器的整体css均可通过全局覆盖的形式进行自定义。目前暂时只支持灰色主题。
  - 编辑器的显示区域包括菜单栏，编辑器，预览区，工具栏，通过配置组件的config属性，可以选择默认的展示区域。
  
### Install

```js
npm install react-markdown-editor-lite --save
```

### Props

| Property | Description | Type | default | Remarks |
| --- | --- | --- | --- | --- |
| value | markdown content | String | '' | required |
| style | component container style | Object | {height: '100%'} | not required |
| config | component config | Object | {view: {...}, logger: {...}} | not required |
| onChange | emitting when editor has changed | Function | ({html, md}) => {} | not required |
| onImageUpload | when image uploaded, callback emitting will get image markdown text | (file: File, callback: (url: string) => void) => void; | ({file, callback}) => {} | not required |
| renderHTML | Render markdown text to HTML. You can return either string, function or Promise | (text: string) => string|function|Promise | none | **required** |

### Example

``` js
'use strict';
import React from 'react'
import ReactDOM from 'react-dom'
import MdEditor from 'react-markdown-editor-lite'
import MarkdownIt from 'markdown-it'
import emoji from 'markdown-it-emoji'
import subscript from 'markdown-it-sub'
import superscript from 'markdown-it-sup'
import footnote from 'markdown-it-footnote'
import deflist from 'markdown-it-deflist'
import abbreviation from 'markdown-it-abbr'
import insert from 'markdown-it-ins'
import mark from 'markdown-it-mark'
import tasklists from 'markdown-it-task-lists'
import hljs from 'highlight.js'
import 'highlight.js/styles/atom-one-light.css'
// import 'highlight.js/styles/github.css'
import './index.less';

const MOCK_DATA = "I Love React."
export default class Demo extends React.Component {
  mdEditor = null
  mdParser = null
  constructor(props) {
    super(props)
    // initial a parsera
    this.mdParser = new MarkdownIt({
      html: true,
      linkify: true,
      typographer: true,
      highlight: function (str, lang) {
        if (lang && hljs.getLanguage(lang)) {
          try {
            return hljs.highlight(lang, str).value
          } catch (__) {}
        }    
        return '' // use external default escaping
      }
    })
    .use(emoji)
    .use(subscript)
    .use(superscript)
    .use(footnote)
    .use(deflist)
    .use(abbreviation)
    .use(insert)
    .use(mark)
    .use(tasklists, { enabled: this.taskLists })
    this.renderHTML = this.renderHTML.bind(this)
  }
  handleEditorChange({html, md}) {
    console.log('handleEditorChange', html, md)
  }
  handleImageUpload(file, callback) {
    const reader = new FileReader()
    reader.onload = () => {      
      const convertBase64UrlToBlob = (urlData) => {  
        let arr = urlData.split(','), mime = arr[0].match(/:(.*?);/)[1]
        let bstr = atob(arr[1])
        let n = bstr.length
        let u8arr = new Uint8Array(n)
        while (n--) {
          u8arr[n] = bstr.charCodeAt(n)
        }
        return new Blob([u8arr], {type:mime})
      }
      const blob = convertBase64UrlToBlob(reader.result)
      setTimeout(() => {
        // setTimeout 模拟异步上传图片
        // 当异步上传获取图片地址后，执行calback回调（参数为imageUrl字符串），即可将图片地址写入markdown
        callback('https://avatars0.githubusercontent.com/u/21263805?s=40&v=4')
      }, 1000)
    }
    reader.readAsDataURL(file)
  }
  renderHTML(text) {
    // 模拟异步渲染Markdown
    return new Promise((resolve) => {
      setTimeout(() => {
        resolve(this.mdParser.render(text))
      }, 1000)
    })
  }
  handleGetMdValue = () => {   
    this.mdEditor && alert(this.mdEditor.getMdValue())      
  }
  handleGetHtmlValue = () => {    
    this.mdEditor && alert(this.mdEditor.getHtmlValue())
  }
  render() {
    return (      
      <div>
        <nav>
          <button onClick={this.handleGetMdValue} >getMdValue</button>  
          <button onClick={this.handleGetHtmlValue} >getHtmlValue</button>  
        </nav>
        <section style="height: 500px">
          <MdEditor 
            ref={node => this.mdEditor = node}
            value={MOCK_DATA}
            style={{height: '400px'}}
            renderHTML={this.renderHTML}
            config={{
              view: {
                menu: true,
                md: true,
                html: true
              },
              imageUrl: 'https://octodex.github.com/images/minion.png'
            }}
            onChange={this.handleEditorChange} 
            onImageUpload={this.handleImageUpload}
          />
        </section>                        
      </div>      
    )
  }
}
```

### 最后

   欢迎大家使用和反馈，[项目地址](https://github.com/HarryChen0506/react-markdown-editor-lite) (https://github.com/HarryChen0506/react-markdown-editor-lite)， 你的点赞将是我莫大的动力😊

![1.png](https://s3.ca-central-1.amazonaws.com/res-blog-public/res-dev/blog_1636946743939_1.png)', firstPicture='', viewCount=83, createDate='Sun Nov 07 14:09:29 EST 2021', updateDate='Tue Jan 18 22:54:08 EST 2022'}}, total=null}
2022-01-19 20:14:15:197 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 20ms
2022-01-19 20:14:15:197 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 20:14:15:726 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 20:14:15:726 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 20:14:15:726 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 20:14:15:726 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 20:14:15:726 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 20:14:15:726 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 20:14:15:726 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=20createdate=Wed Jan 19 11:47:08 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/26.png, replyComments=[CommentListVo{commentId=21createdate=Wed Jan 19 11:47:21 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/89.png, replyComments=[CommentListVo{commentId=22createdate=Wed Jan 19 11:47:39 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/75.png, replyComments=null, CommentVo=CommentVo{parentCommentId=21, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='sfs@ss.c', content='eeeeee', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='tet', content='ree', status='0'}}, CommentListVo{commentId=27createdate=Wed Jan 19 17:01:06 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/2.png, replyComments=null, CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='ljh19911025@gmail.com', nickname='sds', parentCommentNickname='tet', content='wwww', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='tet', parentCommentNickname='null', content='etet', status='0'}}], total=1}
2022-01-19 20:14:15:726 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 4ms
2022-01-19 20:14:15:726 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 20:14:24:644 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 20:14:24:645 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 20:14:24:645 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 20:14:24:645 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 20:14:24:645 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 20:14:24:645 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 20:14:24:645 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 20:14:24:645 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 20:14:24:645 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 20:14:24:645 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 20:14:24:645 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 20:14:24:645 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 20:14:24:645 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=20createdate=Wed Jan 19 11:47:08 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/26.png, replyComments=[CommentListVo{commentId=21createdate=Wed Jan 19 11:47:21 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/89.png, replyComments=[CommentListVo{commentId=22createdate=Wed Jan 19 11:47:39 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/75.png, replyComments=null, CommentVo=CommentVo{parentCommentId=21, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='sfs@ss.c', content='eeeeee', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='tet', content='ree', status='0'}}, CommentListVo{commentId=27createdate=Wed Jan 19 17:01:06 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/2.png, replyComments=null, CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='ljh19911025@gmail.com', nickname='sds', parentCommentNickname='tet', content='wwww', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='tet', parentCommentNickname='null', content='etet', status='0'}}], total=1}
2022-01-19 20:14:24:645 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=20createdate=Wed Jan 19 11:47:08 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/26.png, replyComments=[CommentListVo{commentId=21createdate=Wed Jan 19 11:47:21 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/89.png, replyComments=[CommentListVo{commentId=22createdate=Wed Jan 19 11:47:39 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/75.png, replyComments=null, CommentVo=CommentVo{parentCommentId=21, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='sfs@ss.c', content='eeeeee', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='tet', content='ree', status='0'}}, CommentListVo{commentId=27createdate=Wed Jan 19 17:01:06 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/2.png, replyComments=null, CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='ljh19911025@gmail.com', nickname='sds', parentCommentNickname='tet', content='wwww', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='tet', parentCommentNickname='null', content='etet', status='0'}}], total=1}
2022-01-19 20:14:24:645 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 14ms
2022-01-19 20:14:24:645 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 15ms
2022-01-19 20:14:24:645 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 20:14:24:645 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 20:14:24:647 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 20:14:24:647 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 20:14:24:647 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 20:14:24:647 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/article/10005
2022-01-19 20:14:24:647 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.ArticleController.getPublicArticleDetail
2022-01-19 20:14:24:647 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 20:14:24:647 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=ArticleVo{userInfo=UserInfoVo{userId=100001, nickName='ivan', userName='ivan', avatar='https://res-blog-public.s3.ca-central-1.amazonaws.com/default_avatar.jpg'}, category=CategoryVo{categoryId=1, name='Life ', articleCount=null}, BaseArticleVo{articleId=10005, status=1, type=1, title='dd', description='This is the doc of React markdown editor lite.
Enjoy!!', content='| Head | Head | Head | Head |
| --- | --- | --- | --- |
| Data | Data | Data | Data |
| Data | Data | Data | Data |

## 手把手教你写一个markdown编辑器

> 笔者在18年年末的时候接到一个开发任务——搭建一个AI项目的开放平台，其中的产品文档为转化为HTML格式的markdown文档。考虑到文档的即时更新，将文档信息做成了Ajax接口的形式。因此管理后台只需将textarea表单的内容通过markdown解析器进行HTML格式转化，然后将markdown内容和经转化的HTML文档都保存到数据库即可。
> 基本需求完成后，为了更好的用户体验，考虑将常用的编辑功能添加进来。改进版不仅支持了常用的文本编辑功能，还实现的UI界面的配置化，自定义语法解析器。本着造福伸手党的目的，以及积累些开源经验，笔者将该react 组件 [react-markdown-editor-lite](https://github.com/HarryChen0506/react-markdown-editor-lite) 进行了封装改造，并且发布到了开源社区。

### 预览
在线体验 [https://harrychen0506.github.io/react-markdown-editor-lite/](https://harrychen0506.github.io/react-markdown-editor-lite/)

![image](https://github.com//HarryChen0506/react-markdown-editor-lite/blob/master/image/react-markdown-editor-lite-v1.0.0.PNG?raw=true)

### 特点
* 轻量、基于React
* UI可配置, 如只显示编辑区或预览区
* 支持自定义markdown语法解析器,语法高亮等
* 支持常用的markdown编辑功能，如加粗，斜体等等...
* 支持功能按钮插拔化，用户可以自定义扩展组件
* 支持编辑区和预览区同步滚动

### 开发心得

- 文本编辑

  大多数常见的编辑器，包括富文本编辑器，利用了某些元素如div的contenteditable属性，配合selection、range、execCommand等API，实现了富文本编辑功能。这里面的实现比较复杂，所以有了"[为什么都说富文本编辑器是天坑？](https://www.zhihu.com/question/38699645)"这个说法。

  而markdown编辑器，核心的处理内容为简单语法的纯文本，复杂度相对来说比较低，并且input标签自带onSelect事件，可以很方便的获取选择信息（选择起始位置和选择文本值），因此要想实现编辑功能，只需将要改动的内容进行文本转换，然后进行重新拼接首尾，大功告成。
  
- markdown解析

  考察了几个社区流行的markdown解析器，比较流行的有[markdown](https://www.npmjs.com/package/markdown), [markdown-it](https://www.npmjs.com/package/markdown-it), [marked](https://www.npmjs.com/package/marked) 等等。综合考虑扩展性以及稳定性，笔者推荐使用markdown-it作为markdown的词法解析器，因为该解析器有比较多的插件，并且支持语法高亮。

- 同步滚动

  当选择分栏编辑的时候，滚动左侧的编辑区，右侧的预览区能自动滚动到对应的区域。方案参考了《[手把手教你用 100行代码实现基于 react的 markdown 输入 + 即时预览在线编辑器（一）](https://github.com/accforgit/blog-data/blob/master/%E5%9C%A8%E7%BA%BF%E7%BC%96%E8%BE%91%E5%99%A8/README/README1.md)》。只需先计算出输入框容器元素与预览框容器元素之间最大scroll范围的比例值，然后根据主动滚动元素自身的scrollTop做相应的比例换算，即可知道对方区域的scrollTop值。

- 关于UI
 
  - 项目的字体库选择了Font Awesome风格，并且只选取了项目所需要的一些图标。
  - 编辑器的整体css均可通过全局覆盖的形式进行自定义。目前暂时只支持灰色主题。
  - 编辑器的显示区域包括菜单栏，编辑器，预览区，工具栏，通过配置组件的config属性，可以选择默认的展示区域。
  
### Install

```js
npm install react-markdown-editor-lite --save
```

### Props

| Property | Description | Type | default | Remarks |
| --- | --- | --- | --- | --- |
| value | markdown content | String | '' | required |
| style | component container style | Object | {height: '100%'} | not required |
| config | component config | Object | {view: {...}, logger: {...}} | not required |
| onChange | emitting when editor has changed | Function | ({html, md}) => {} | not required |
| onImageUpload | when image uploaded, callback emitting will get image markdown text | (file: File, callback: (url: string) => void) => void; | ({file, callback}) => {} | not required |
| renderHTML | Render markdown text to HTML. You can return either string, function or Promise | (text: string) => string|function|Promise | none | **required** |

### Example

``` js
'use strict';
import React from 'react'
import ReactDOM from 'react-dom'
import MdEditor from 'react-markdown-editor-lite'
import MarkdownIt from 'markdown-it'
import emoji from 'markdown-it-emoji'
import subscript from 'markdown-it-sub'
import superscript from 'markdown-it-sup'
import footnote from 'markdown-it-footnote'
import deflist from 'markdown-it-deflist'
import abbreviation from 'markdown-it-abbr'
import insert from 'markdown-it-ins'
import mark from 'markdown-it-mark'
import tasklists from 'markdown-it-task-lists'
import hljs from 'highlight.js'
import 'highlight.js/styles/atom-one-light.css'
// import 'highlight.js/styles/github.css'
import './index.less';

const MOCK_DATA = "I Love React."
export default class Demo extends React.Component {
  mdEditor = null
  mdParser = null
  constructor(props) {
    super(props)
    // initial a parsera
    this.mdParser = new MarkdownIt({
      html: true,
      linkify: true,
      typographer: true,
      highlight: function (str, lang) {
        if (lang && hljs.getLanguage(lang)) {
          try {
            return hljs.highlight(lang, str).value
          } catch (__) {}
        }    
        return '' // use external default escaping
      }
    })
    .use(emoji)
    .use(subscript)
    .use(superscript)
    .use(footnote)
    .use(deflist)
    .use(abbreviation)
    .use(insert)
    .use(mark)
    .use(tasklists, { enabled: this.taskLists })
    this.renderHTML = this.renderHTML.bind(this)
  }
  handleEditorChange({html, md}) {
    console.log('handleEditorChange', html, md)
  }
  handleImageUpload(file, callback) {
    const reader = new FileReader()
    reader.onload = () => {      
      const convertBase64UrlToBlob = (urlData) => {  
        let arr = urlData.split(','), mime = arr[0].match(/:(.*?);/)[1]
        let bstr = atob(arr[1])
        let n = bstr.length
        let u8arr = new Uint8Array(n)
        while (n--) {
          u8arr[n] = bstr.charCodeAt(n)
        }
        return new Blob([u8arr], {type:mime})
      }
      const blob = convertBase64UrlToBlob(reader.result)
      setTimeout(() => {
        // setTimeout 模拟异步上传图片
        // 当异步上传获取图片地址后，执行calback回调（参数为imageUrl字符串），即可将图片地址写入markdown
        callback('https://avatars0.githubusercontent.com/u/21263805?s=40&v=4')
      }, 1000)
    }
    reader.readAsDataURL(file)
  }
  renderHTML(text) {
    // 模拟异步渲染Markdown
    return new Promise((resolve) => {
      setTimeout(() => {
        resolve(this.mdParser.render(text))
      }, 1000)
    })
  }
  handleGetMdValue = () => {   
    this.mdEditor && alert(this.mdEditor.getMdValue())      
  }
  handleGetHtmlValue = () => {    
    this.mdEditor && alert(this.mdEditor.getHtmlValue())
  }
  render() {
    return (      
      <div>
        <nav>
          <button onClick={this.handleGetMdValue} >getMdValue</button>  
          <button onClick={this.handleGetHtmlValue} >getHtmlValue</button>  
        </nav>
        <section style="height: 500px">
          <MdEditor 
            ref={node => this.mdEditor = node}
            value={MOCK_DATA}
            style={{height: '400px'}}
            renderHTML={this.renderHTML}
            config={{
              view: {
                menu: true,
                md: true,
                html: true
              },
              imageUrl: 'https://octodex.github.com/images/minion.png'
            }}
            onChange={this.handleEditorChange} 
            onImageUpload={this.handleImageUpload}
          />
        </section>                        
      </div>      
    )
  }
}
```

### 最后

   欢迎大家使用和反馈，[项目地址](https://github.com/HarryChen0506/react-markdown-editor-lite) (https://github.com/HarryChen0506/react-markdown-editor-lite)， 你的点赞将是我莫大的动力😊

![1.png](https://s3.ca-central-1.amazonaws.com/res-blog-public/res-dev/blog_1636946743939_1.png)', firstPicture='', viewCount=83, createDate='Sun Nov 07 14:09:29 EST 2021', updateDate='Tue Jan 18 22:54:08 EST 2022'}}, total=null}
2022-01-19 20:14:24:648 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 17ms
2022-01-19 20:14:24:648 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 20:14:25:148 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 20:14:25:149 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 20:14:25:149 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 20:14:25:149 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 20:14:25:149 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 20:14:25:149 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 20:14:25:149 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=20createdate=Wed Jan 19 11:47:08 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/26.png, replyComments=[CommentListVo{commentId=21createdate=Wed Jan 19 11:47:21 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/89.png, replyComments=[CommentListVo{commentId=22createdate=Wed Jan 19 11:47:39 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/75.png, replyComments=null, CommentVo=CommentVo{parentCommentId=21, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='sfs@ss.c', content='eeeeee', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='tet', content='ree', status='0'}}, CommentListVo{commentId=27createdate=Wed Jan 19 17:01:06 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/2.png, replyComments=null, CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='ljh19911025@gmail.com', nickname='sds', parentCommentNickname='tet', content='wwww', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='tet', parentCommentNickname='null', content='etet', status='0'}}], total=1}
2022-01-19 20:14:25:149 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 6ms
2022-01-19 20:14:25:149 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 20:16:38:749 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 20:16:38:750 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 20:16:38:750 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: POST
2022-01-19 20:16:38:750 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment
2022-01-19 20:16:38:750 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.postComment
2022-01-19 20:16:38:750 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: CommentVo{parentCommentId=27, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='sds', content='dddd', status='null'}
2022-01-19 20:16:38:750 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=null, total=null}
2022-01-19 20:16:38:750 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 21ms
2022-01-19 20:16:38:750 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 20:16:38:765 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 20:16:38:765 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 20:16:38:765 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 20:16:38:765 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 20:16:38:765 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 20:16:38:765 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 20:16:38:765 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=20createdate=Wed Jan 19 11:47:08 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/26.png, replyComments=[CommentListVo{commentId=21createdate=Wed Jan 19 11:47:21 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/89.png, replyComments=[CommentListVo{commentId=22createdate=Wed Jan 19 11:47:39 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/75.png, replyComments=null, CommentVo=CommentVo{parentCommentId=21, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='sfs@ss.c', content='eeeeee', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='tet', content='ree', status='0'}}, CommentListVo{commentId=27createdate=Wed Jan 19 17:01:06 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/2.png, replyComments=[CommentListVo{commentId=28createdate=Wed Jan 19 20:16:38 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/51.png, replyComments=null, CommentVo=CommentVo{parentCommentId=27, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='sds', content='dddd', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='ljh19911025@gmail.com', nickname='sds', parentCommentNickname='tet', content='wwww', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='tet', parentCommentNickname='null', content='etet', status='0'}}], total=1}
2022-01-19 20:16:38:766 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 2ms
2022-01-19 20:16:38:766 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 20:17:06:394 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 20:17:06:394 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 20:17:06:394 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: POST
2022-01-19 20:17:06:394 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment
2022-01-19 20:17:06:394 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.postComment
2022-01-19 20:17:06:394 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: CommentVo{parentCommentId=20, articleId=10005, email='test@gg.com', nickname='sfsf', parentCommentNickname='tet', content='reply tet', status='null'}
2022-01-19 20:17:06:395 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=null, total=null}
2022-01-19 20:17:06:395 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 3ms
2022-01-19 20:17:06:395 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 20:17:06:416 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 20:17:06:416 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 20:17:06:416 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 20:17:06:416 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 20:17:06:416 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 20:17:06:416 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 20:17:06:416 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=20createdate=Wed Jan 19 11:47:08 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/26.png, replyComments=[CommentListVo{commentId=21createdate=Wed Jan 19 11:47:21 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/89.png, replyComments=[CommentListVo{commentId=22createdate=Wed Jan 19 11:47:39 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/75.png, replyComments=null, CommentVo=CommentVo{parentCommentId=21, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='sfs@ss.c', content='eeeeee', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='tet', content='ree', status='0'}}, CommentListVo{commentId=27createdate=Wed Jan 19 17:01:06 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/2.png, replyComments=[CommentListVo{commentId=28createdate=Wed Jan 19 20:16:38 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/51.png, replyComments=null, CommentVo=CommentVo{parentCommentId=27, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='sds', content='dddd', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='ljh19911025@gmail.com', nickname='sds', parentCommentNickname='tet', content='wwww', status='0'}}, CommentListVo{commentId=29createdate=Wed Jan 19 20:17:06 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/99.png, replyComments=null, CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='test@gg.com', nickname='sfsf', parentCommentNickname='tet', content='reply tet', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='tet', parentCommentNickname='null', content='etet', status='0'}}], total=1}
2022-01-19 20:17:06:416 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 3ms
2022-01-19 20:17:06:416 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 20:17:20:791 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 20:17:20:791 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 20:17:20:791 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: POST
2022-01-19 20:17:20:791 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment
2022-01-19 20:17:20:791 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.postComment
2022-01-19 20:17:20:791 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: CommentVo{parentCommentId=null, articleId=10005, email='sfs@ss.c', nickname='sfsf', parentCommentNickname='null', content='djjsf', status='null'}
2022-01-19 20:17:20:791 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=null, total=null}
2022-01-19 20:17:20:791 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 3ms
2022-01-19 20:17:20:791 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 20:17:20:816 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 20:17:20:816 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 20:17:20:816 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 20:17:20:816 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 20:17:20:816 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 20:17:20:816 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 20:17:20:816 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=30createdate=Wed Jan 19 20:17:20 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/78.png, replyComments=null, CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='sfsf', parentCommentNickname='null', content='djjsf', status='0'}}, CommentListVo{commentId=20createdate=Wed Jan 19 11:47:08 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/26.png, replyComments=[CommentListVo{commentId=21createdate=Wed Jan 19 11:47:21 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/89.png, replyComments=[CommentListVo{commentId=22createdate=Wed Jan 19 11:47:39 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/75.png, replyComments=null, CommentVo=CommentVo{parentCommentId=21, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='sfs@ss.c', content='eeeeee', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='tet', content='ree', status='0'}}, CommentListVo{commentId=27createdate=Wed Jan 19 17:01:06 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/2.png, replyComments=[CommentListVo{commentId=28createdate=Wed Jan 19 20:16:38 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/51.png, replyComments=null, CommentVo=CommentVo{parentCommentId=27, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='sds', content='dddd', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='ljh19911025@gmail.com', nickname='sds', parentCommentNickname='tet', content='wwww', status='0'}}, CommentListVo{commentId=29createdate=Wed Jan 19 20:17:06 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/99.png, replyComments=null, CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='test@gg.com', nickname='sfsf', parentCommentNickname='tet', content='reply tet', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='tet', parentCommentNickname='null', content='etet', status='0'}}], total=1}
2022-01-19 20:17:20:816 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 4ms
2022-01-19 20:17:20:816 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 20:17:39:151 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 20:17:39:151 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 20:17:39:151 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: POST
2022-01-19 20:17:39:151 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment
2022-01-19 20:17:39:151 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.postComment
2022-01-19 20:17:39:151 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: CommentVo{parentCommentId=null, articleId=10005, email='ljh19911025@gmail.com', nickname='ivan', parentCommentNickname='null', content='sssssssss', status='null'}
2022-01-19 20:17:39:151 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=null, total=null}
2022-01-19 20:17:39:151 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 3ms
2022-01-19 20:17:39:151 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 20:17:39:177 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 20:17:39:177 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 20:17:39:177 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 20:17:39:177 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 20:17:39:177 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 20:17:39:177 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 20:17:39:177 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=31createdate=Wed Jan 19 20:17:39 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/58.png, replyComments=null, CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='ljh19911025@gmail.com', nickname='ivan', parentCommentNickname='null', content='sssssssss', status='0'}}, CommentListVo{commentId=30createdate=Wed Jan 19 20:17:20 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/78.png, replyComments=null, CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='sfsf', parentCommentNickname='null', content='djjsf', status='0'}}, CommentListVo{commentId=20createdate=Wed Jan 19 11:47:08 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/26.png, replyComments=[CommentListVo{commentId=21createdate=Wed Jan 19 11:47:21 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/89.png, replyComments=[CommentListVo{commentId=22createdate=Wed Jan 19 11:47:39 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/75.png, replyComments=null, CommentVo=CommentVo{parentCommentId=21, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='sfs@ss.c', content='eeeeee', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='tet', content='ree', status='0'}}, CommentListVo{commentId=27createdate=Wed Jan 19 17:01:06 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/2.png, replyComments=[CommentListVo{commentId=28createdate=Wed Jan 19 20:16:38 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/51.png, replyComments=null, CommentVo=CommentVo{parentCommentId=27, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='sds', content='dddd', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='ljh19911025@gmail.com', nickname='sds', parentCommentNickname='tet', content='wwww', status='0'}}, CommentListVo{commentId=29createdate=Wed Jan 19 20:17:06 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/99.png, replyComments=null, CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='test@gg.com', nickname='sfsf', parentCommentNickname='tet', content='reply tet', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='tet', parentCommentNickname='null', content='etet', status='0'}}], total=1}
2022-01-19 20:17:39:177 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 4ms
2022-01-19 20:17:39:177 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 20:26:47:647 [HikariPool-1 housekeeper] WARN  com.zaxxer.hikari.pool.HikariPool HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=8m13s544ms).
2022-01-19 20:27:02:101 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 20:27:02:102 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 20:27:02:102 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 20:27:02:102 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 20:27:02:102 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 20:27:02:102 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 20:27:02:102 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=31createdate=Wed Jan 19 20:17:39 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/58.png, replyComments=null, CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='ljh19911025@gmail.com', nickname='ivan', parentCommentNickname='null', content='sssssssss', status='0'}}, CommentListVo{commentId=30createdate=Wed Jan 19 20:17:20 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/78.png, replyComments=null, CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='sfsf', parentCommentNickname='null', content='djjsf', status='0'}}, CommentListVo{commentId=20createdate=Wed Jan 19 11:47:08 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/26.png, replyComments=[CommentListVo{commentId=21createdate=Wed Jan 19 11:47:21 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/89.png, replyComments=[CommentListVo{commentId=22createdate=Wed Jan 19 11:47:39 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/75.png, replyComments=null, CommentVo=CommentVo{parentCommentId=21, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='sfs@ss.c', content='eeeeee', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='tet', content='ree', status='0'}}, CommentListVo{commentId=27createdate=Wed Jan 19 17:01:06 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/2.png, replyComments=[CommentListVo{commentId=28createdate=Wed Jan 19 20:16:38 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/51.png, replyComments=null, CommentVo=CommentVo{parentCommentId=27, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='sds', content='dddd', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='ljh19911025@gmail.com', nickname='sds', parentCommentNickname='tet', content='wwww', status='0'}}, CommentListVo{commentId=29createdate=Wed Jan 19 20:17:06 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/99.png, replyComments=null, CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='test@gg.com', nickname='sfsf', parentCommentNickname='tet', content='reply tet', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='tet', parentCommentNickname='null', content='etet', status='0'}}], total=3}
2022-01-19 20:27:02:102 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 6ms
2022-01-19 20:27:02:102 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 20:27:02:103 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 20:27:02:103 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 20:27:02:103 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 20:27:02:103 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 20:27:02:103 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 20:27:02:103 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 20:27:02:103 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=31createdate=Wed Jan 19 20:17:39 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/58.png, replyComments=null, CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='ljh19911025@gmail.com', nickname='ivan', parentCommentNickname='null', content='sssssssss', status='0'}}, CommentListVo{commentId=30createdate=Wed Jan 19 20:17:20 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/78.png, replyComments=null, CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='sfsf', parentCommentNickname='null', content='djjsf', status='0'}}, CommentListVo{commentId=20createdate=Wed Jan 19 11:47:08 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/26.png, replyComments=[CommentListVo{commentId=21createdate=Wed Jan 19 11:47:21 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/89.png, replyComments=[CommentListVo{commentId=22createdate=Wed Jan 19 11:47:39 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/75.png, replyComments=null, CommentVo=CommentVo{parentCommentId=21, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='sfs@ss.c', content='eeeeee', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='tet', content='ree', status='0'}}, CommentListVo{commentId=27createdate=Wed Jan 19 17:01:06 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/2.png, replyComments=[CommentListVo{commentId=28createdate=Wed Jan 19 20:16:38 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/51.png, replyComments=null, CommentVo=CommentVo{parentCommentId=27, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='sds', content='dddd', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='ljh19911025@gmail.com', nickname='sds', parentCommentNickname='tet', content='wwww', status='0'}}, CommentListVo{commentId=29createdate=Wed Jan 19 20:17:06 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/99.png, replyComments=null, CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='test@gg.com', nickname='sfsf', parentCommentNickname='tet', content='reply tet', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='tet', parentCommentNickname='null', content='etet', status='0'}}], total=3}
2022-01-19 20:27:02:104 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 9ms
2022-01-19 20:27:02:104 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 20:27:02:105 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 20:27:02:105 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 20:27:02:105 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 20:27:02:105 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/article/10005
2022-01-19 20:27:02:105 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.ArticleController.getPublicArticleDetail
2022-01-19 20:27:02:105 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 20:27:02:105 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=ArticleVo{userInfo=UserInfoVo{userId=100001, nickName='ivan', userName='ivan', avatar='https://res-blog-public.s3.ca-central-1.amazonaws.com/default_avatar.jpg'}, category=CategoryVo{categoryId=1, name='Life ', articleCount=null}, BaseArticleVo{articleId=10005, status=1, type=1, title='dd', description='This is the doc of React markdown editor lite.
Enjoy!!', content='| Head | Head | Head | Head |
| --- | --- | --- | --- |
| Data | Data | Data | Data |
| Data | Data | Data | Data |

## 手把手教你写一个markdown编辑器

> 笔者在18年年末的时候接到一个开发任务——搭建一个AI项目的开放平台，其中的产品文档为转化为HTML格式的markdown文档。考虑到文档的即时更新，将文档信息做成了Ajax接口的形式。因此管理后台只需将textarea表单的内容通过markdown解析器进行HTML格式转化，然后将markdown内容和经转化的HTML文档都保存到数据库即可。
> 基本需求完成后，为了更好的用户体验，考虑将常用的编辑功能添加进来。改进版不仅支持了常用的文本编辑功能，还实现的UI界面的配置化，自定义语法解析器。本着造福伸手党的目的，以及积累些开源经验，笔者将该react 组件 [react-markdown-editor-lite](https://github.com/HarryChen0506/react-markdown-editor-lite) 进行了封装改造，并且发布到了开源社区。

### 预览
在线体验 [https://harrychen0506.github.io/react-markdown-editor-lite/](https://harrychen0506.github.io/react-markdown-editor-lite/)

![image](https://github.com//HarryChen0506/react-markdown-editor-lite/blob/master/image/react-markdown-editor-lite-v1.0.0.PNG?raw=true)

### 特点
* 轻量、基于React
* UI可配置, 如只显示编辑区或预览区
* 支持自定义markdown语法解析器,语法高亮等
* 支持常用的markdown编辑功能，如加粗，斜体等等...
* 支持功能按钮插拔化，用户可以自定义扩展组件
* 支持编辑区和预览区同步滚动

### 开发心得

- 文本编辑

  大多数常见的编辑器，包括富文本编辑器，利用了某些元素如div的contenteditable属性，配合selection、range、execCommand等API，实现了富文本编辑功能。这里面的实现比较复杂，所以有了"[为什么都说富文本编辑器是天坑？](https://www.zhihu.com/question/38699645)"这个说法。

  而markdown编辑器，核心的处理内容为简单语法的纯文本，复杂度相对来说比较低，并且input标签自带onSelect事件，可以很方便的获取选择信息（选择起始位置和选择文本值），因此要想实现编辑功能，只需将要改动的内容进行文本转换，然后进行重新拼接首尾，大功告成。
  
- markdown解析

  考察了几个社区流行的markdown解析器，比较流行的有[markdown](https://www.npmjs.com/package/markdown), [markdown-it](https://www.npmjs.com/package/markdown-it), [marked](https://www.npmjs.com/package/marked) 等等。综合考虑扩展性以及稳定性，笔者推荐使用markdown-it作为markdown的词法解析器，因为该解析器有比较多的插件，并且支持语法高亮。

- 同步滚动

  当选择分栏编辑的时候，滚动左侧的编辑区，右侧的预览区能自动滚动到对应的区域。方案参考了《[手把手教你用 100行代码实现基于 react的 markdown 输入 + 即时预览在线编辑器（一）](https://github.com/accforgit/blog-data/blob/master/%E5%9C%A8%E7%BA%BF%E7%BC%96%E8%BE%91%E5%99%A8/README/README1.md)》。只需先计算出输入框容器元素与预览框容器元素之间最大scroll范围的比例值，然后根据主动滚动元素自身的scrollTop做相应的比例换算，即可知道对方区域的scrollTop值。

- 关于UI
 
  - 项目的字体库选择了Font Awesome风格，并且只选取了项目所需要的一些图标。
  - 编辑器的整体css均可通过全局覆盖的形式进行自定义。目前暂时只支持灰色主题。
  - 编辑器的显示区域包括菜单栏，编辑器，预览区，工具栏，通过配置组件的config属性，可以选择默认的展示区域。
  
### Install

```js
npm install react-markdown-editor-lite --save
```

### Props

| Property | Description | Type | default | Remarks |
| --- | --- | --- | --- | --- |
| value | markdown content | String | '' | required |
| style | component container style | Object | {height: '100%'} | not required |
| config | component config | Object | {view: {...}, logger: {...}} | not required |
| onChange | emitting when editor has changed | Function | ({html, md}) => {} | not required |
| onImageUpload | when image uploaded, callback emitting will get image markdown text | (file: File, callback: (url: string) => void) => void; | ({file, callback}) => {} | not required |
| renderHTML | Render markdown text to HTML. You can return either string, function or Promise | (text: string) => string|function|Promise | none | **required** |

### Example

``` js
'use strict';
import React from 'react'
import ReactDOM from 'react-dom'
import MdEditor from 'react-markdown-editor-lite'
import MarkdownIt from 'markdown-it'
import emoji from 'markdown-it-emoji'
import subscript from 'markdown-it-sub'
import superscript from 'markdown-it-sup'
import footnote from 'markdown-it-footnote'
import deflist from 'markdown-it-deflist'
import abbreviation from 'markdown-it-abbr'
import insert from 'markdown-it-ins'
import mark from 'markdown-it-mark'
import tasklists from 'markdown-it-task-lists'
import hljs from 'highlight.js'
import 'highlight.js/styles/atom-one-light.css'
// import 'highlight.js/styles/github.css'
import './index.less';

const MOCK_DATA = "I Love React."
export default class Demo extends React.Component {
  mdEditor = null
  mdParser = null
  constructor(props) {
    super(props)
    // initial a parsera
    this.mdParser = new MarkdownIt({
      html: true,
      linkify: true,
      typographer: true,
      highlight: function (str, lang) {
        if (lang && hljs.getLanguage(lang)) {
          try {
            return hljs.highlight(lang, str).value
          } catch (__) {}
        }    
        return '' // use external default escaping
      }
    })
    .use(emoji)
    .use(subscript)
    .use(superscript)
    .use(footnote)
    .use(deflist)
    .use(abbreviation)
    .use(insert)
    .use(mark)
    .use(tasklists, { enabled: this.taskLists })
    this.renderHTML = this.renderHTML.bind(this)
  }
  handleEditorChange({html, md}) {
    console.log('handleEditorChange', html, md)
  }
  handleImageUpload(file, callback) {
    const reader = new FileReader()
    reader.onload = () => {      
      const convertBase64UrlToBlob = (urlData) => {  
        let arr = urlData.split(','), mime = arr[0].match(/:(.*?);/)[1]
        let bstr = atob(arr[1])
        let n = bstr.length
        let u8arr = new Uint8Array(n)
        while (n--) {
          u8arr[n] = bstr.charCodeAt(n)
        }
        return new Blob([u8arr], {type:mime})
      }
      const blob = convertBase64UrlToBlob(reader.result)
      setTimeout(() => {
        // setTimeout 模拟异步上传图片
        // 当异步上传获取图片地址后，执行calback回调（参数为imageUrl字符串），即可将图片地址写入markdown
        callback('https://avatars0.githubusercontent.com/u/21263805?s=40&v=4')
      }, 1000)
    }
    reader.readAsDataURL(file)
  }
  renderHTML(text) {
    // 模拟异步渲染Markdown
    return new Promise((resolve) => {
      setTimeout(() => {
        resolve(this.mdParser.render(text))
      }, 1000)
    })
  }
  handleGetMdValue = () => {   
    this.mdEditor && alert(this.mdEditor.getMdValue())      
  }
  handleGetHtmlValue = () => {    
    this.mdEditor && alert(this.mdEditor.getHtmlValue())
  }
  render() {
    return (      
      <div>
        <nav>
          <button onClick={this.handleGetMdValue} >getMdValue</button>  
          <button onClick={this.handleGetHtmlValue} >getHtmlValue</button>  
        </nav>
        <section style="height: 500px">
          <MdEditor 
            ref={node => this.mdEditor = node}
            value={MOCK_DATA}
            style={{height: '400px'}}
            renderHTML={this.renderHTML}
            config={{
              view: {
                menu: true,
                md: true,
                html: true
              },
              imageUrl: 'https://octodex.github.com/images/minion.png'
            }}
            onChange={this.handleEditorChange} 
            onImageUpload={this.handleImageUpload}
          />
        </section>                        
      </div>      
    )
  }
}
```

### 最后

   欢迎大家使用和反馈，[项目地址](https://github.com/HarryChen0506/react-markdown-editor-lite) (https://github.com/HarryChen0506/react-markdown-editor-lite)， 你的点赞将是我莫大的动力😊

![1.png](https://s3.ca-central-1.amazonaws.com/res-blog-public/res-dev/blog_1636946743939_1.png)', firstPicture='', viewCount=83, createDate='Sun Nov 07 14:09:29 EST 2021', updateDate='Tue Jan 18 22:54:08 EST 2022'}}, total=null}
2022-01-19 20:27:02:105 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 12ms
2022-01-19 20:27:02:105 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 20:27:02:603 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 20:27:02:603 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 20:27:02:603 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 20:27:02:603 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 20:27:02:603 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 20:27:02:603 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 20:27:02:603 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=31createdate=Wed Jan 19 20:17:39 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/58.png, replyComments=null, CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='ljh19911025@gmail.com', nickname='ivan', parentCommentNickname='null', content='sssssssss', status='0'}}, CommentListVo{commentId=30createdate=Wed Jan 19 20:17:20 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/78.png, replyComments=null, CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='sfsf', parentCommentNickname='null', content='djjsf', status='0'}}, CommentListVo{commentId=20createdate=Wed Jan 19 11:47:08 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/26.png, replyComments=[CommentListVo{commentId=21createdate=Wed Jan 19 11:47:21 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/89.png, replyComments=[CommentListVo{commentId=22createdate=Wed Jan 19 11:47:39 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/75.png, replyComments=null, CommentVo=CommentVo{parentCommentId=21, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='sfs@ss.c', content='eeeeee', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='tet', content='ree', status='0'}}, CommentListVo{commentId=27createdate=Wed Jan 19 17:01:06 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/2.png, replyComments=[CommentListVo{commentId=28createdate=Wed Jan 19 20:16:38 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/51.png, replyComments=null, CommentVo=CommentVo{parentCommentId=27, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='sds', content='dddd', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='ljh19911025@gmail.com', nickname='sds', parentCommentNickname='tet', content='wwww', status='0'}}, CommentListVo{commentId=29createdate=Wed Jan 19 20:17:06 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/99.png, replyComments=null, CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='test@gg.com', nickname='sfsf', parentCommentNickname='tet', content='reply tet', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='tet', parentCommentNickname='null', content='etet', status='0'}}], total=3}
2022-01-19 20:27:02:603 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 4ms
2022-01-19 20:27:02:604 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 20:27:15:506 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 20:27:15:506 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 20:27:15:506 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: POST
2022-01-19 20:27:15:506 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment
2022-01-19 20:27:15:506 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.postComment
2022-01-19 20:27:15:506 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: CommentVo{parentCommentId=null, articleId=10005, email='ljh19911025@gmail.com', nickname='sfs@ss.c', parentCommentNickname='null', content='sds', status='null'}
2022-01-19 20:27:15:506 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=null, total=null}
2022-01-19 20:27:15:506 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 4ms
2022-01-19 20:27:15:506 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 20:27:15:526 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 20:27:15:526 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 20:27:15:526 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 20:27:15:526 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 20:27:15:526 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 20:27:15:526 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 20:27:15:526 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=32createdate=Wed Jan 19 20:27:15 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/4.png, replyComments=null, CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='ljh19911025@gmail.com', nickname='sfs@ss.c', parentCommentNickname='null', content='sds', status='0'}}, CommentListVo{commentId=31createdate=Wed Jan 19 20:17:39 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/58.png, replyComments=null, CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='ljh19911025@gmail.com', nickname='ivan', parentCommentNickname='null', content='sssssssss', status='0'}}, CommentListVo{commentId=30createdate=Wed Jan 19 20:17:20 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/78.png, replyComments=null, CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='sfsf', parentCommentNickname='null', content='djjsf', status='0'}}, CommentListVo{commentId=20createdate=Wed Jan 19 11:47:08 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/26.png, replyComments=[CommentListVo{commentId=21createdate=Wed Jan 19 11:47:21 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/89.png, replyComments=[CommentListVo{commentId=22createdate=Wed Jan 19 11:47:39 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/75.png, replyComments=null, CommentVo=CommentVo{parentCommentId=21, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='sfs@ss.c', content='eeeeee', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='tet', content='ree', status='0'}}, CommentListVo{commentId=27createdate=Wed Jan 19 17:01:06 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/2.png, replyComments=[CommentListVo{commentId=28createdate=Wed Jan 19 20:16:38 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/51.png, replyComments=null, CommentVo=CommentVo{parentCommentId=27, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='sds', content='dddd', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='ljh19911025@gmail.com', nickname='sds', parentCommentNickname='tet', content='wwww', status='0'}}, CommentListVo{commentId=29createdate=Wed Jan 19 20:17:06 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/99.png, replyComments=null, CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='test@gg.com', nickname='sfsf', parentCommentNickname='tet', content='reply tet', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='tet', parentCommentNickname='null', content='etet', status='0'}}], total=3}
2022-01-19 20:27:15:527 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 4ms
2022-01-19 20:27:15:527 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 20:31:18:133 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 20:31:18:135 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 20:31:18:136 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 20:31:18:140 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 20:31:18:140 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 20:31:18:140 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 20:31:18:140 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 20:31:18:140 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 20:31:18:140 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 20:31:18:140 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 20:31:18:140 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 20:31:18:140 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 20:31:18:140 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 20:31:18:140 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/article/10005
2022-01-19 20:31:18:140 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 20:31:18:140 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 20:31:18:140 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.ArticleController.getPublicArticleDetail
2022-01-19 20:31:18:140 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 20:31:18:140 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=32createdate=Wed Jan 19 20:27:15 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/4.png, replyComments=null, CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='ljh19911025@gmail.com', nickname='sfs@ss.c', parentCommentNickname='null', content='sds', status='0'}}, CommentListVo{commentId=31createdate=Wed Jan 19 20:17:39 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/58.png, replyComments=null, CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='ljh19911025@gmail.com', nickname='ivan', parentCommentNickname='null', content='sssssssss', status='0'}}, CommentListVo{commentId=30createdate=Wed Jan 19 20:17:20 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/78.png, replyComments=null, CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='sfsf', parentCommentNickname='null', content='djjsf', status='0'}}, CommentListVo{commentId=20createdate=Wed Jan 19 11:47:08 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/26.png, replyComments=[CommentListVo{commentId=21createdate=Wed Jan 19 11:47:21 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/89.png, replyComments=[CommentListVo{commentId=22createdate=Wed Jan 19 11:47:39 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/75.png, replyComments=null, CommentVo=CommentVo{parentCommentId=21, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='sfs@ss.c', content='eeeeee', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='tet', content='ree', status='0'}}, CommentListVo{commentId=27createdate=Wed Jan 19 17:01:06 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/2.png, replyComments=[CommentListVo{commentId=28createdate=Wed Jan 19 20:16:38 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/51.png, replyComments=null, CommentVo=CommentVo{parentCommentId=27, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='sds', content='dddd', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='ljh19911025@gmail.com', nickname='sds', parentCommentNickname='tet', content='wwww', status='0'}}, CommentListVo{commentId=29createdate=Wed Jan 19 20:17:06 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/99.png, replyComments=null, CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='test@gg.com', nickname='sfsf', parentCommentNickname='tet', content='reply tet', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='tet', parentCommentNickname='null', content='etet', status='0'}}], total=4}
2022-01-19 20:31:18:141 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 43ms
2022-01-19 20:31:18:141 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 20:31:18:140 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=32createdate=Wed Jan 19 20:27:15 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/4.png, replyComments=null, CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='ljh19911025@gmail.com', nickname='sfs@ss.c', parentCommentNickname='null', content='sds', status='0'}}, CommentListVo{commentId=31createdate=Wed Jan 19 20:17:39 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/58.png, replyComments=null, CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='ljh19911025@gmail.com', nickname='ivan', parentCommentNickname='null', content='sssssssss', status='0'}}, CommentListVo{commentId=30createdate=Wed Jan 19 20:17:20 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/78.png, replyComments=null, CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='sfsf', parentCommentNickname='null', content='djjsf', status='0'}}, CommentListVo{commentId=20createdate=Wed Jan 19 11:47:08 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/26.png, replyComments=[CommentListVo{commentId=21createdate=Wed Jan 19 11:47:21 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/89.png, replyComments=[CommentListVo{commentId=22createdate=Wed Jan 19 11:47:39 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/75.png, replyComments=null, CommentVo=CommentVo{parentCommentId=21, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='sfs@ss.c', content='eeeeee', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='tet', content='ree', status='0'}}, CommentListVo{commentId=27createdate=Wed Jan 19 17:01:06 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/2.png, replyComments=[CommentListVo{commentId=28createdate=Wed Jan 19 20:16:38 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/51.png, replyComments=null, CommentVo=CommentVo{parentCommentId=27, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='sds', content='dddd', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='ljh19911025@gmail.com', nickname='sds', parentCommentNickname='tet', content='wwww', status='0'}}, CommentListVo{commentId=29createdate=Wed Jan 19 20:17:06 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/99.png, replyComments=null, CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='test@gg.com', nickname='sfsf', parentCommentNickname='tet', content='reply tet', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='tet', parentCommentNickname='null', content='etet', status='0'}}], total=4}
2022-01-19 20:31:18:141 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 45ms
2022-01-19 20:31:18:141 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 20:31:18:140 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=ArticleVo{userInfo=UserInfoVo{userId=100001, nickName='ivan', userName='ivan', avatar='https://res-blog-public.s3.ca-central-1.amazonaws.com/default_avatar.jpg'}, category=CategoryVo{categoryId=1, name='Life ', articleCount=null}, BaseArticleVo{articleId=10005, status=1, type=1, title='dd', description='This is the doc of React markdown editor lite.
Enjoy!!', content='| Head | Head | Head | Head |
| --- | --- | --- | --- |
| Data | Data | Data | Data |
| Data | Data | Data | Data |

## 手把手教你写一个markdown编辑器

> 笔者在18年年末的时候接到一个开发任务——搭建一个AI项目的开放平台，其中的产品文档为转化为HTML格式的markdown文档。考虑到文档的即时更新，将文档信息做成了Ajax接口的形式。因此管理后台只需将textarea表单的内容通过markdown解析器进行HTML格式转化，然后将markdown内容和经转化的HTML文档都保存到数据库即可。
> 基本需求完成后，为了更好的用户体验，考虑将常用的编辑功能添加进来。改进版不仅支持了常用的文本编辑功能，还实现的UI界面的配置化，自定义语法解析器。本着造福伸手党的目的，以及积累些开源经验，笔者将该react 组件 [react-markdown-editor-lite](https://github.com/HarryChen0506/react-markdown-editor-lite) 进行了封装改造，并且发布到了开源社区。

### 预览
在线体验 [https://harrychen0506.github.io/react-markdown-editor-lite/](https://harrychen0506.github.io/react-markdown-editor-lite/)

![image](https://github.com//HarryChen0506/react-markdown-editor-lite/blob/master/image/react-markdown-editor-lite-v1.0.0.PNG?raw=true)

### 特点
* 轻量、基于React
* UI可配置, 如只显示编辑区或预览区
* 支持自定义markdown语法解析器,语法高亮等
* 支持常用的markdown编辑功能，如加粗，斜体等等...
* 支持功能按钮插拔化，用户可以自定义扩展组件
* 支持编辑区和预览区同步滚动

### 开发心得

- 文本编辑

  大多数常见的编辑器，包括富文本编辑器，利用了某些元素如div的contenteditable属性，配合selection、range、execCommand等API，实现了富文本编辑功能。这里面的实现比较复杂，所以有了"[为什么都说富文本编辑器是天坑？](https://www.zhihu.com/question/38699645)"这个说法。

  而markdown编辑器，核心的处理内容为简单语法的纯文本，复杂度相对来说比较低，并且input标签自带onSelect事件，可以很方便的获取选择信息（选择起始位置和选择文本值），因此要想实现编辑功能，只需将要改动的内容进行文本转换，然后进行重新拼接首尾，大功告成。
  
- markdown解析

  考察了几个社区流行的markdown解析器，比较流行的有[markdown](https://www.npmjs.com/package/markdown), [markdown-it](https://www.npmjs.com/package/markdown-it), [marked](https://www.npmjs.com/package/marked) 等等。综合考虑扩展性以及稳定性，笔者推荐使用markdown-it作为markdown的词法解析器，因为该解析器有比较多的插件，并且支持语法高亮。

- 同步滚动

  当选择分栏编辑的时候，滚动左侧的编辑区，右侧的预览区能自动滚动到对应的区域。方案参考了《[手把手教你用 100行代码实现基于 react的 markdown 输入 + 即时预览在线编辑器（一）](https://github.com/accforgit/blog-data/blob/master/%E5%9C%A8%E7%BA%BF%E7%BC%96%E8%BE%91%E5%99%A8/README/README1.md)》。只需先计算出输入框容器元素与预览框容器元素之间最大scroll范围的比例值，然后根据主动滚动元素自身的scrollTop做相应的比例换算，即可知道对方区域的scrollTop值。

- 关于UI
 
  - 项目的字体库选择了Font Awesome风格，并且只选取了项目所需要的一些图标。
  - 编辑器的整体css均可通过全局覆盖的形式进行自定义。目前暂时只支持灰色主题。
  - 编辑器的显示区域包括菜单栏，编辑器，预览区，工具栏，通过配置组件的config属性，可以选择默认的展示区域。
  
### Install

```js
npm install react-markdown-editor-lite --save
```

### Props

| Property | Description | Type | default | Remarks |
| --- | --- | --- | --- | --- |
| value | markdown content | String | '' | required |
| style | component container style | Object | {height: '100%'} | not required |
| config | component config | Object | {view: {...}, logger: {...}} | not required |
| onChange | emitting when editor has changed | Function | ({html, md}) => {} | not required |
| onImageUpload | when image uploaded, callback emitting will get image markdown text | (file: File, callback: (url: string) => void) => void; | ({file, callback}) => {} | not required |
| renderHTML | Render markdown text to HTML. You can return either string, function or Promise | (text: string) => string|function|Promise | none | **required** |

### Example

``` js
'use strict';
import React from 'react'
import ReactDOM from 'react-dom'
import MdEditor from 'react-markdown-editor-lite'
import MarkdownIt from 'markdown-it'
import emoji from 'markdown-it-emoji'
import subscript from 'markdown-it-sub'
import superscript from 'markdown-it-sup'
import footnote from 'markdown-it-footnote'
import deflist from 'markdown-it-deflist'
import abbreviation from 'markdown-it-abbr'
import insert from 'markdown-it-ins'
import mark from 'markdown-it-mark'
import tasklists from 'markdown-it-task-lists'
import hljs from 'highlight.js'
import 'highlight.js/styles/atom-one-light.css'
// import 'highlight.js/styles/github.css'
import './index.less';

const MOCK_DATA = "I Love React."
export default class Demo extends React.Component {
  mdEditor = null
  mdParser = null
  constructor(props) {
    super(props)
    // initial a parsera
    this.mdParser = new MarkdownIt({
      html: true,
      linkify: true,
      typographer: true,
      highlight: function (str, lang) {
        if (lang && hljs.getLanguage(lang)) {
          try {
            return hljs.highlight(lang, str).value
          } catch (__) {}
        }    
        return '' // use external default escaping
      }
    })
    .use(emoji)
    .use(subscript)
    .use(superscript)
    .use(footnote)
    .use(deflist)
    .use(abbreviation)
    .use(insert)
    .use(mark)
    .use(tasklists, { enabled: this.taskLists })
    this.renderHTML = this.renderHTML.bind(this)
  }
  handleEditorChange({html, md}) {
    console.log('handleEditorChange', html, md)
  }
  handleImageUpload(file, callback) {
    const reader = new FileReader()
    reader.onload = () => {      
      const convertBase64UrlToBlob = (urlData) => {  
        let arr = urlData.split(','), mime = arr[0].match(/:(.*?);/)[1]
        let bstr = atob(arr[1])
        let n = bstr.length
        let u8arr = new Uint8Array(n)
        while (n--) {
          u8arr[n] = bstr.charCodeAt(n)
        }
        return new Blob([u8arr], {type:mime})
      }
      const blob = convertBase64UrlToBlob(reader.result)
      setTimeout(() => {
        // setTimeout 模拟异步上传图片
        // 当异步上传获取图片地址后，执行calback回调（参数为imageUrl字符串），即可将图片地址写入markdown
        callback('https://avatars0.githubusercontent.com/u/21263805?s=40&v=4')
      }, 1000)
    }
    reader.readAsDataURL(file)
  }
  renderHTML(text) {
    // 模拟异步渲染Markdown
    return new Promise((resolve) => {
      setTimeout(() => {
        resolve(this.mdParser.render(text))
      }, 1000)
    })
  }
  handleGetMdValue = () => {   
    this.mdEditor && alert(this.mdEditor.getMdValue())      
  }
  handleGetHtmlValue = () => {    
    this.mdEditor && alert(this.mdEditor.getHtmlValue())
  }
  render() {
    return (      
      <div>
        <nav>
          <button onClick={this.handleGetMdValue} >getMdValue</button>  
          <button onClick={this.handleGetHtmlValue} >getHtmlValue</button>  
        </nav>
        <section style="height: 500px">
          <MdEditor 
            ref={node => this.mdEditor = node}
            value={MOCK_DATA}
            style={{height: '400px'}}
            renderHTML={this.renderHTML}
            config={{
              view: {
                menu: true,
                md: true,
                html: true
              },
              imageUrl: 'https://octodex.github.com/images/minion.png'
            }}
            onChange={this.handleEditorChange} 
            onImageUpload={this.handleImageUpload}
          />
        </section>                        
      </div>      
    )
  }
}
```

### 最后

   欢迎大家使用和反馈，[项目地址](https://github.com/HarryChen0506/react-markdown-editor-lite) (https://github.com/HarryChen0506/react-markdown-editor-lite)， 你的点赞将是我莫大的动力😊

![1.png](https://s3.ca-central-1.amazonaws.com/res-blog-public/res-dev/blog_1636946743939_1.png)', firstPicture='', viewCount=83, createDate='Sun Nov 07 14:09:29 EST 2021', updateDate='Tue Jan 18 22:54:08 EST 2022'}}, total=null}
2022-01-19 20:31:18:142 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 44ms
2022-01-19 20:31:18:142 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 20:31:18:652 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 20:31:18:652 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 20:31:18:652 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 20:31:18:653 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 20:31:18:653 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 20:31:18:653 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 20:31:18:653 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=32createdate=Wed Jan 19 20:27:15 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/4.png, replyComments=null, CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='ljh19911025@gmail.com', nickname='sfs@ss.c', parentCommentNickname='null', content='sds', status='0'}}, CommentListVo{commentId=31createdate=Wed Jan 19 20:17:39 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/58.png, replyComments=null, CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='ljh19911025@gmail.com', nickname='ivan', parentCommentNickname='null', content='sssssssss', status='0'}}, CommentListVo{commentId=30createdate=Wed Jan 19 20:17:20 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/78.png, replyComments=null, CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='sfsf', parentCommentNickname='null', content='djjsf', status='0'}}, CommentListVo{commentId=20createdate=Wed Jan 19 11:47:08 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/26.png, replyComments=[CommentListVo{commentId=21createdate=Wed Jan 19 11:47:21 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/89.png, replyComments=[CommentListVo{commentId=22createdate=Wed Jan 19 11:47:39 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/75.png, replyComments=null, CommentVo=CommentVo{parentCommentId=21, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='sfs@ss.c', content='eeeeee', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='tet', content='ree', status='0'}}, CommentListVo{commentId=27createdate=Wed Jan 19 17:01:06 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/2.png, replyComments=[CommentListVo{commentId=28createdate=Wed Jan 19 20:16:38 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/51.png, replyComments=null, CommentVo=CommentVo{parentCommentId=27, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='sds', content='dddd', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='ljh19911025@gmail.com', nickname='sds', parentCommentNickname='tet', content='wwww', status='0'}}, CommentListVo{commentId=29createdate=Wed Jan 19 20:17:06 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/99.png, replyComments=null, CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='test@gg.com', nickname='sfsf', parentCommentNickname='tet', content='reply tet', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='tet', parentCommentNickname='null', content='etet', status='0'}}], total=4}
2022-01-19 20:31:18:653 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 12ms
2022-01-19 20:31:18:653 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 20:31:22:052 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 20:31:22:052 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 20:31:22:052 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 20:31:22:052 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/article/10005
2022-01-19 20:31:22:052 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.ArticleController.getPublicArticleDetail
2022-01-19 20:31:22:052 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 20:31:22:052 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=ArticleVo{userInfo=UserInfoVo{userId=100001, nickName='ivan', userName='ivan', avatar='https://res-blog-public.s3.ca-central-1.amazonaws.com/default_avatar.jpg'}, category=CategoryVo{categoryId=1, name='Life ', articleCount=null}, BaseArticleVo{articleId=10005, status=1, type=1, title='dd', description='This is the doc of React markdown editor lite.
Enjoy!!', content='| Head | Head | Head | Head |
| --- | --- | --- | --- |
| Data | Data | Data | Data |
| Data | Data | Data | Data |

## 手把手教你写一个markdown编辑器

> 笔者在18年年末的时候接到一个开发任务——搭建一个AI项目的开放平台，其中的产品文档为转化为HTML格式的markdown文档。考虑到文档的即时更新，将文档信息做成了Ajax接口的形式。因此管理后台只需将textarea表单的内容通过markdown解析器进行HTML格式转化，然后将markdown内容和经转化的HTML文档都保存到数据库即可。
> 基本需求完成后，为了更好的用户体验，考虑将常用的编辑功能添加进来。改进版不仅支持了常用的文本编辑功能，还实现的UI界面的配置化，自定义语法解析器。本着造福伸手党的目的，以及积累些开源经验，笔者将该react 组件 [react-markdown-editor-lite](https://github.com/HarryChen0506/react-markdown-editor-lite) 进行了封装改造，并且发布到了开源社区。

### 预览
在线体验 [https://harrychen0506.github.io/react-markdown-editor-lite/](https://harrychen0506.github.io/react-markdown-editor-lite/)

![image](https://github.com//HarryChen0506/react-markdown-editor-lite/blob/master/image/react-markdown-editor-lite-v1.0.0.PNG?raw=true)

### 特点
* 轻量、基于React
* UI可配置, 如只显示编辑区或预览区
* 支持自定义markdown语法解析器,语法高亮等
* 支持常用的markdown编辑功能，如加粗，斜体等等...
* 支持功能按钮插拔化，用户可以自定义扩展组件
* 支持编辑区和预览区同步滚动

### 开发心得

- 文本编辑

  大多数常见的编辑器，包括富文本编辑器，利用了某些元素如div的contenteditable属性，配合selection、range、execCommand等API，实现了富文本编辑功能。这里面的实现比较复杂，所以有了"[为什么都说富文本编辑器是天坑？](https://www.zhihu.com/question/38699645)"这个说法。

  而markdown编辑器，核心的处理内容为简单语法的纯文本，复杂度相对来说比较低，并且input标签自带onSelect事件，可以很方便的获取选择信息（选择起始位置和选择文本值），因此要想实现编辑功能，只需将要改动的内容进行文本转换，然后进行重新拼接首尾，大功告成。
  
- markdown解析

  考察了几个社区流行的markdown解析器，比较流行的有[markdown](https://www.npmjs.com/package/markdown), [markdown-it](https://www.npmjs.com/package/markdown-it), [marked](https://www.npmjs.com/package/marked) 等等。综合考虑扩展性以及稳定性，笔者推荐使用markdown-it作为markdown的词法解析器，因为该解析器有比较多的插件，并且支持语法高亮。

- 同步滚动

  当选择分栏编辑的时候，滚动左侧的编辑区，右侧的预览区能自动滚动到对应的区域。方案参考了《[手把手教你用 100行代码实现基于 react的 markdown 输入 + 即时预览在线编辑器（一）](https://github.com/accforgit/blog-data/blob/master/%E5%9C%A8%E7%BA%BF%E7%BC%96%E8%BE%91%E5%99%A8/README/README1.md)》。只需先计算出输入框容器元素与预览框容器元素之间最大scroll范围的比例值，然后根据主动滚动元素自身的scrollTop做相应的比例换算，即可知道对方区域的scrollTop值。

- 关于UI
 
  - 项目的字体库选择了Font Awesome风格，并且只选取了项目所需要的一些图标。
  - 编辑器的整体css均可通过全局覆盖的形式进行自定义。目前暂时只支持灰色主题。
  - 编辑器的显示区域包括菜单栏，编辑器，预览区，工具栏，通过配置组件的config属性，可以选择默认的展示区域。
  
### Install

```js
npm install react-markdown-editor-lite --save
```

### Props

| Property | Description | Type | default | Remarks |
| --- | --- | --- | --- | --- |
| value | markdown content | String | '' | required |
| style | component container style | Object | {height: '100%'} | not required |
| config | component config | Object | {view: {...}, logger: {...}} | not required |
| onChange | emitting when editor has changed | Function | ({html, md}) => {} | not required |
| onImageUpload | when image uploaded, callback emitting will get image markdown text | (file: File, callback: (url: string) => void) => void; | ({file, callback}) => {} | not required |
| renderHTML | Render markdown text to HTML. You can return either string, function or Promise | (text: string) => string|function|Promise | none | **required** |

### Example

``` js
'use strict';
import React from 'react'
import ReactDOM from 'react-dom'
import MdEditor from 'react-markdown-editor-lite'
import MarkdownIt from 'markdown-it'
import emoji from 'markdown-it-emoji'
import subscript from 'markdown-it-sub'
import superscript from 'markdown-it-sup'
import footnote from 'markdown-it-footnote'
import deflist from 'markdown-it-deflist'
import abbreviation from 'markdown-it-abbr'
import insert from 'markdown-it-ins'
import mark from 'markdown-it-mark'
import tasklists from 'markdown-it-task-lists'
import hljs from 'highlight.js'
import 'highlight.js/styles/atom-one-light.css'
// import 'highlight.js/styles/github.css'
import './index.less';

const MOCK_DATA = "I Love React."
export default class Demo extends React.Component {
  mdEditor = null
  mdParser = null
  constructor(props) {
    super(props)
    // initial a parsera
    this.mdParser = new MarkdownIt({
      html: true,
      linkify: true,
      typographer: true,
      highlight: function (str, lang) {
        if (lang && hljs.getLanguage(lang)) {
          try {
            return hljs.highlight(lang, str).value
          } catch (__) {}
        }    
        return '' // use external default escaping
      }
    })
    .use(emoji)
    .use(subscript)
    .use(superscript)
    .use(footnote)
    .use(deflist)
    .use(abbreviation)
    .use(insert)
    .use(mark)
    .use(tasklists, { enabled: this.taskLists })
    this.renderHTML = this.renderHTML.bind(this)
  }
  handleEditorChange({html, md}) {
    console.log('handleEditorChange', html, md)
  }
  handleImageUpload(file, callback) {
    const reader = new FileReader()
    reader.onload = () => {      
      const convertBase64UrlToBlob = (urlData) => {  
        let arr = urlData.split(','), mime = arr[0].match(/:(.*?);/)[1]
        let bstr = atob(arr[1])
        let n = bstr.length
        let u8arr = new Uint8Array(n)
        while (n--) {
          u8arr[n] = bstr.charCodeAt(n)
        }
        return new Blob([u8arr], {type:mime})
      }
      const blob = convertBase64UrlToBlob(reader.result)
      setTimeout(() => {
        // setTimeout 模拟异步上传图片
        // 当异步上传获取图片地址后，执行calback回调（参数为imageUrl字符串），即可将图片地址写入markdown
        callback('https://avatars0.githubusercontent.com/u/21263805?s=40&v=4')
      }, 1000)
    }
    reader.readAsDataURL(file)
  }
  renderHTML(text) {
    // 模拟异步渲染Markdown
    return new Promise((resolve) => {
      setTimeout(() => {
        resolve(this.mdParser.render(text))
      }, 1000)
    })
  }
  handleGetMdValue = () => {   
    this.mdEditor && alert(this.mdEditor.getMdValue())      
  }
  handleGetHtmlValue = () => {    
    this.mdEditor && alert(this.mdEditor.getHtmlValue())
  }
  render() {
    return (      
      <div>
        <nav>
          <button onClick={this.handleGetMdValue} >getMdValue</button>  
          <button onClick={this.handleGetHtmlValue} >getHtmlValue</button>  
        </nav>
        <section style="height: 500px">
          <MdEditor 
            ref={node => this.mdEditor = node}
            value={MOCK_DATA}
            style={{height: '400px'}}
            renderHTML={this.renderHTML}
            config={{
              view: {
                menu: true,
                md: true,
                html: true
              },
              imageUrl: 'https://octodex.github.com/images/minion.png'
            }}
            onChange={this.handleEditorChange} 
            onImageUpload={this.handleImageUpload}
          />
        </section>                        
      </div>      
    )
  }
}
```

### 最后

   欢迎大家使用和反馈，[项目地址](https://github.com/HarryChen0506/react-markdown-editor-lite) (https://github.com/HarryChen0506/react-markdown-editor-lite)， 你的点赞将是我莫大的动力😊

![1.png](https://s3.ca-central-1.amazonaws.com/res-blog-public/res-dev/blog_1636946743939_1.png)', firstPicture='', viewCount=83, createDate='Sun Nov 07 14:09:29 EST 2021', updateDate='Tue Jan 18 22:54:08 EST 2022'}}, total=null}
2022-01-19 20:31:22:052 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 12ms
2022-01-19 20:31:22:052 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 20:31:22:055 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 20:31:22:055 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 20:31:22:055 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 20:31:22:055 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 20:31:22:055 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 20:31:22:055 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 20:31:22:055 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=32createdate=Wed Jan 19 20:27:15 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/4.png, replyComments=null, CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='ljh19911025@gmail.com', nickname='sfs@ss.c', parentCommentNickname='null', content='sds', status='0'}}, CommentListVo{commentId=31createdate=Wed Jan 19 20:17:39 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/58.png, replyComments=null, CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='ljh19911025@gmail.com', nickname='ivan', parentCommentNickname='null', content='sssssssss', status='0'}}, CommentListVo{commentId=30createdate=Wed Jan 19 20:17:20 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/78.png, replyComments=null, CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='sfsf', parentCommentNickname='null', content='djjsf', status='0'}}, CommentListVo{commentId=20createdate=Wed Jan 19 11:47:08 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/26.png, replyComments=[CommentListVo{commentId=21createdate=Wed Jan 19 11:47:21 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/89.png, replyComments=[CommentListVo{commentId=22createdate=Wed Jan 19 11:47:39 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/75.png, replyComments=null, CommentVo=CommentVo{parentCommentId=21, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='sfs@ss.c', content='eeeeee', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='tet', content='ree', status='0'}}, CommentListVo{commentId=27createdate=Wed Jan 19 17:01:06 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/2.png, replyComments=[CommentListVo{commentId=28createdate=Wed Jan 19 20:16:38 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/51.png, replyComments=null, CommentVo=CommentVo{parentCommentId=27, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='sds', content='dddd', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='ljh19911025@gmail.com', nickname='sds', parentCommentNickname='tet', content='wwww', status='0'}}, CommentListVo{commentId=29createdate=Wed Jan 19 20:17:06 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/99.png, replyComments=null, CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='test@gg.com', nickname='sfsf', parentCommentNickname='tet', content='reply tet', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='tet', parentCommentNickname='null', content='etet', status='0'}}], total=4}
2022-01-19 20:31:22:056 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 15ms
2022-01-19 20:31:22:056 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 20:31:22:060 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 20:31:22:060 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 20:31:22:060 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 20:31:22:060 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 20:31:22:060 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 20:31:22:060 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 20:31:22:060 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=32createdate=Wed Jan 19 20:27:15 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/4.png, replyComments=null, CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='ljh19911025@gmail.com', nickname='sfs@ss.c', parentCommentNickname='null', content='sds', status='0'}}, CommentListVo{commentId=31createdate=Wed Jan 19 20:17:39 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/58.png, replyComments=null, CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='ljh19911025@gmail.com', nickname='ivan', parentCommentNickname='null', content='sssssssss', status='0'}}, CommentListVo{commentId=30createdate=Wed Jan 19 20:17:20 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/78.png, replyComments=null, CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='sfsf', parentCommentNickname='null', content='djjsf', status='0'}}, CommentListVo{commentId=20createdate=Wed Jan 19 11:47:08 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/26.png, replyComments=[CommentListVo{commentId=21createdate=Wed Jan 19 11:47:21 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/89.png, replyComments=[CommentListVo{commentId=22createdate=Wed Jan 19 11:47:39 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/75.png, replyComments=null, CommentVo=CommentVo{parentCommentId=21, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='sfs@ss.c', content='eeeeee', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='tet', content='ree', status='0'}}, CommentListVo{commentId=27createdate=Wed Jan 19 17:01:06 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/2.png, replyComments=[CommentListVo{commentId=28createdate=Wed Jan 19 20:16:38 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/51.png, replyComments=null, CommentVo=CommentVo{parentCommentId=27, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='sds', content='dddd', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='ljh19911025@gmail.com', nickname='sds', parentCommentNickname='tet', content='wwww', status='0'}}, CommentListVo{commentId=29createdate=Wed Jan 19 20:17:06 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/99.png, replyComments=null, CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='test@gg.com', nickname='sfsf', parentCommentNickname='tet', content='reply tet', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='tet', parentCommentNickname='null', content='etet', status='0'}}], total=4}
2022-01-19 20:31:22:060 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 20ms
2022-01-19 20:31:22:060 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 20:31:22:118 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 20:31:22:118 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 20:31:22:118 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 20:31:22:118 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 20:31:22:118 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 20:31:22:118 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 20:31:22:118 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=32createdate=Wed Jan 19 20:27:15 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/4.png, replyComments=null, CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='ljh19911025@gmail.com', nickname='sfs@ss.c', parentCommentNickname='null', content='sds', status='0'}}, CommentListVo{commentId=31createdate=Wed Jan 19 20:17:39 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/58.png, replyComments=null, CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='ljh19911025@gmail.com', nickname='ivan', parentCommentNickname='null', content='sssssssss', status='0'}}, CommentListVo{commentId=30createdate=Wed Jan 19 20:17:20 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/78.png, replyComments=null, CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='sfsf', parentCommentNickname='null', content='djjsf', status='0'}}, CommentListVo{commentId=20createdate=Wed Jan 19 11:47:08 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/26.png, replyComments=[CommentListVo{commentId=21createdate=Wed Jan 19 11:47:21 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/89.png, replyComments=[CommentListVo{commentId=22createdate=Wed Jan 19 11:47:39 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/75.png, replyComments=null, CommentVo=CommentVo{parentCommentId=21, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='sfs@ss.c', content='eeeeee', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='tet', content='ree', status='0'}}, CommentListVo{commentId=27createdate=Wed Jan 19 17:01:06 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/2.png, replyComments=[CommentListVo{commentId=28createdate=Wed Jan 19 20:16:38 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/51.png, replyComments=null, CommentVo=CommentVo{parentCommentId=27, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='sds', content='dddd', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='ljh19911025@gmail.com', nickname='sds', parentCommentNickname='tet', content='wwww', status='0'}}, CommentListVo{commentId=29createdate=Wed Jan 19 20:17:06 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/99.png, replyComments=null, CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='test@gg.com', nickname='sfsf', parentCommentNickname='tet', content='reply tet', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='tet', parentCommentNickname='null', content='etet', status='0'}}], total=4}
2022-01-19 20:31:22:118 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 7ms
2022-01-19 20:31:22:118 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 20:31:35:069 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 20:31:35:070 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 20:31:35:070 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 20:31:35:070 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/articles/hot
2022-01-19 20:31:35:070 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.ArticleController.getHotArticles
2022-01-19 20:31:35:070 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: {}
2022-01-19 20:31:35:070 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[ArticleVo{userInfo=null, category=null, BaseArticleVo{articleId=10004, status=null, type=null, title='Spring boot', description='null', content='null', firstPicture='null', viewCount=174, createDate='Tue Oct 12 15:58:26 EDT 2021', updateDate='null'}}, ArticleVo{userInfo=null, category=null, BaseArticleVo{articleId=10005, status=null, type=null, title='dd', description='null', content='null', firstPicture='null', viewCount=83, createDate='Sun Nov 07 14:09:29 EST 2021', updateDate='null'}}, ArticleVo{userInfo=null, category=null, BaseArticleVo{articleId=10003, status=null, type=null, title='dd', description='null', content='null', firstPicture='null', viewCount=0, createDate='Tue Oct 12 15:57:33 EDT 2021', updateDate='null'}}], total=null}
2022-01-19 20:31:35:070 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 16ms
2022-01-19 20:31:35:070 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 20:31:35:077 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 20:31:35:077 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 20:31:35:078 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 20:31:35:078 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/categories
2022-01-19 20:31:35:078 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CategoryContoller.getCategories
2022-01-19 20:31:35:078 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: {}
2022-01-19 20:31:35:078 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CategoryVo{categoryId=2, name='liddffd', articleCount=1}, CategoryVo{categoryId=1, name='Life ', articleCount=2}], total=null}
2022-01-19 20:31:35:078 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 24ms
2022-01-19 20:31:35:078 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 20:31:35:083 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 20:31:35:083 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 20:31:35:083 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 20:31:35:083 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/articles
2022-01-19 20:31:35:083 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.ArticleController.getPublicArticles
2022-01-19 20:31:35:083 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: SearchVo{page=1, limit=10, categoryId=null, total=null}
2022-01-19 20:31:35:083 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[ArticleVo{userInfo=UserInfoVo{userId=100001, nickName='ivan', userName='ivan', avatar='https://res-blog-public.s3.ca-central-1.amazonaws.com/default_avatar.jpg'}, category=CategoryVo{categoryId=1, name='Life ', articleCount=null}, BaseArticleVo{articleId=10005, status=1, type=1, title='dd', description='This is the doc of React markdown editor lite.
Enjoy!!', content='null', firstPicture='', viewCount=83, createDate='Sun Nov 07 14:09:29 EST 2021', updateDate='Tue Jan 18 22:54:08 EST 2022'}}, ArticleVo{userInfo=UserInfoVo{userId=100001, nickName='ivan', userName='ivan', avatar='https://res-blog-public.s3.ca-central-1.amazonaws.com/default_avatar.jpg'}, category=CategoryVo{categoryId=2, name='liddffd', articleCount=null}, BaseArticleVo{articleId=10004, status=1, type=2, title='Spring boot', description='rerwerwer', content='null', firstPicture='', viewCount=174, createDate='Tue Oct 12 15:58:26 EDT 2021', updateDate='Tue Jan 18 22:56:37 EST 2022'}}, ArticleVo{userInfo=UserInfoVo{userId=100001, nickName='ivan', userName='ivan', avatar='https://res-blog-public.s3.ca-central-1.amazonaws.com/default_avatar.jpg'}, category=CategoryVo{categoryId=1, name='Life ', articleCount=null}, BaseArticleVo{articleId=10003, status=1, type=1, title='dd', description='test', content='null', firstPicture='', viewCount=0, createDate='Tue Oct 12 15:57:33 EDT 2021', updateDate='Tue Jan 18 22:53:20 EST 2022'}}], total=3}
2022-01-19 20:31:35:083 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 29ms
2022-01-19 20:31:35:083 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 20:31:36:863 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 20:31:36:864 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 20:31:36:863 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 20:31:36:864 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 20:31:36:864 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 20:31:36:864 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 20:31:36:864 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 20:31:36:864 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 20:31:36:864 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 20:31:36:864 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/article/10005
2022-01-19 20:31:36:864 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.ArticleController.getPublicArticleDetail
2022-01-19 20:31:36:864 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 20:31:36:864 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=32createdate=Wed Jan 19 20:27:15 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/4.png, replyComments=null, CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='ljh19911025@gmail.com', nickname='sfs@ss.c', parentCommentNickname='null', content='sds', status='0'}}, CommentListVo{commentId=31createdate=Wed Jan 19 20:17:39 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/58.png, replyComments=null, CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='ljh19911025@gmail.com', nickname='ivan', parentCommentNickname='null', content='sssssssss', status='0'}}, CommentListVo{commentId=30createdate=Wed Jan 19 20:17:20 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/78.png, replyComments=null, CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='sfsf', parentCommentNickname='null', content='djjsf', status='0'}}, CommentListVo{commentId=20createdate=Wed Jan 19 11:47:08 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/26.png, replyComments=[CommentListVo{commentId=21createdate=Wed Jan 19 11:47:21 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/89.png, replyComments=[CommentListVo{commentId=22createdate=Wed Jan 19 11:47:39 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/75.png, replyComments=null, CommentVo=CommentVo{parentCommentId=21, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='sfs@ss.c', content='eeeeee', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='tet', content='ree', status='0'}}, CommentListVo{commentId=27createdate=Wed Jan 19 17:01:06 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/2.png, replyComments=[CommentListVo{commentId=28createdate=Wed Jan 19 20:16:38 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/51.png, replyComments=null, CommentVo=CommentVo{parentCommentId=27, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='sds', content='dddd', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='ljh19911025@gmail.com', nickname='sds', parentCommentNickname='tet', content='wwww', status='0'}}, CommentListVo{commentId=29createdate=Wed Jan 19 20:17:06 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/99.png, replyComments=null, CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='test@gg.com', nickname='sfsf', parentCommentNickname='tet', content='reply tet', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='tet', parentCommentNickname='null', content='etet', status='0'}}], total=4}
2022-01-19 20:31:36:864 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 7ms
2022-01-19 20:31:36:864 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 20:31:36:864 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=ArticleVo{userInfo=UserInfoVo{userId=100001, nickName='ivan', userName='ivan', avatar='https://res-blog-public.s3.ca-central-1.amazonaws.com/default_avatar.jpg'}, category=CategoryVo{categoryId=1, name='Life ', articleCount=null}, BaseArticleVo{articleId=10005, status=1, type=1, title='dd', description='This is the doc of React markdown editor lite.
Enjoy!!', content='| Head | Head | Head | Head |
| --- | --- | --- | --- |
| Data | Data | Data | Data |
| Data | Data | Data | Data |

## 手把手教你写一个markdown编辑器

> 笔者在18年年末的时候接到一个开发任务——搭建一个AI项目的开放平台，其中的产品文档为转化为HTML格式的markdown文档。考虑到文档的即时更新，将文档信息做成了Ajax接口的形式。因此管理后台只需将textarea表单的内容通过markdown解析器进行HTML格式转化，然后将markdown内容和经转化的HTML文档都保存到数据库即可。
> 基本需求完成后，为了更好的用户体验，考虑将常用的编辑功能添加进来。改进版不仅支持了常用的文本编辑功能，还实现的UI界面的配置化，自定义语法解析器。本着造福伸手党的目的，以及积累些开源经验，笔者将该react 组件 [react-markdown-editor-lite](https://github.com/HarryChen0506/react-markdown-editor-lite) 进行了封装改造，并且发布到了开源社区。

### 预览
在线体验 [https://harrychen0506.github.io/react-markdown-editor-lite/](https://harrychen0506.github.io/react-markdown-editor-lite/)

![image](https://github.com//HarryChen0506/react-markdown-editor-lite/blob/master/image/react-markdown-editor-lite-v1.0.0.PNG?raw=true)

### 特点
* 轻量、基于React
* UI可配置, 如只显示编辑区或预览区
* 支持自定义markdown语法解析器,语法高亮等
* 支持常用的markdown编辑功能，如加粗，斜体等等...
* 支持功能按钮插拔化，用户可以自定义扩展组件
* 支持编辑区和预览区同步滚动

### 开发心得

- 文本编辑

  大多数常见的编辑器，包括富文本编辑器，利用了某些元素如div的contenteditable属性，配合selection、range、execCommand等API，实现了富文本编辑功能。这里面的实现比较复杂，所以有了"[为什么都说富文本编辑器是天坑？](https://www.zhihu.com/question/38699645)"这个说法。

  而markdown编辑器，核心的处理内容为简单语法的纯文本，复杂度相对来说比较低，并且input标签自带onSelect事件，可以很方便的获取选择信息（选择起始位置和选择文本值），因此要想实现编辑功能，只需将要改动的内容进行文本转换，然后进行重新拼接首尾，大功告成。
  
- markdown解析

  考察了几个社区流行的markdown解析器，比较流行的有[markdown](https://www.npmjs.com/package/markdown), [markdown-it](https://www.npmjs.com/package/markdown-it), [marked](https://www.npmjs.com/package/marked) 等等。综合考虑扩展性以及稳定性，笔者推荐使用markdown-it作为markdown的词法解析器，因为该解析器有比较多的插件，并且支持语法高亮。

- 同步滚动

  当选择分栏编辑的时候，滚动左侧的编辑区，右侧的预览区能自动滚动到对应的区域。方案参考了《[手把手教你用 100行代码实现基于 react的 markdown 输入 + 即时预览在线编辑器（一）](https://github.com/accforgit/blog-data/blob/master/%E5%9C%A8%E7%BA%BF%E7%BC%96%E8%BE%91%E5%99%A8/README/README1.md)》。只需先计算出输入框容器元素与预览框容器元素之间最大scroll范围的比例值，然后根据主动滚动元素自身的scrollTop做相应的比例换算，即可知道对方区域的scrollTop值。

- 关于UI
 
  - 项目的字体库选择了Font Awesome风格，并且只选取了项目所需要的一些图标。
  - 编辑器的整体css均可通过全局覆盖的形式进行自定义。目前暂时只支持灰色主题。
  - 编辑器的显示区域包括菜单栏，编辑器，预览区，工具栏，通过配置组件的config属性，可以选择默认的展示区域。
  
### Install

```js
npm install react-markdown-editor-lite --save
```

### Props

| Property | Description | Type | default | Remarks |
| --- | --- | --- | --- | --- |
| value | markdown content | String | '' | required |
| style | component container style | Object | {height: '100%'} | not required |
| config | component config | Object | {view: {...}, logger: {...}} | not required |
| onChange | emitting when editor has changed | Function | ({html, md}) => {} | not required |
| onImageUpload | when image uploaded, callback emitting will get image markdown text | (file: File, callback: (url: string) => void) => void; | ({file, callback}) => {} | not required |
| renderHTML | Render markdown text to HTML. You can return either string, function or Promise | (text: string) => string|function|Promise | none | **required** |

### Example

``` js
'use strict';
import React from 'react'
import ReactDOM from 'react-dom'
import MdEditor from 'react-markdown-editor-lite'
import MarkdownIt from 'markdown-it'
import emoji from 'markdown-it-emoji'
import subscript from 'markdown-it-sub'
import superscript from 'markdown-it-sup'
import footnote from 'markdown-it-footnote'
import deflist from 'markdown-it-deflist'
import abbreviation from 'markdown-it-abbr'
import insert from 'markdown-it-ins'
import mark from 'markdown-it-mark'
import tasklists from 'markdown-it-task-lists'
import hljs from 'highlight.js'
import 'highlight.js/styles/atom-one-light.css'
// import 'highlight.js/styles/github.css'
import './index.less';

const MOCK_DATA = "I Love React."
export default class Demo extends React.Component {
  mdEditor = null
  mdParser = null
  constructor(props) {
    super(props)
    // initial a parsera
    this.mdParser = new MarkdownIt({
      html: true,
      linkify: true,
      typographer: true,
      highlight: function (str, lang) {
        if (lang && hljs.getLanguage(lang)) {
          try {
            return hljs.highlight(lang, str).value
          } catch (__) {}
        }    
        return '' // use external default escaping
      }
    })
    .use(emoji)
    .use(subscript)
    .use(superscript)
    .use(footnote)
    .use(deflist)
    .use(abbreviation)
    .use(insert)
    .use(mark)
    .use(tasklists, { enabled: this.taskLists })
    this.renderHTML = this.renderHTML.bind(this)
  }
  handleEditorChange({html, md}) {
    console.log('handleEditorChange', html, md)
  }
  handleImageUpload(file, callback) {
    const reader = new FileReader()
    reader.onload = () => {      
      const convertBase64UrlToBlob = (urlData) => {  
        let arr = urlData.split(','), mime = arr[0].match(/:(.*?);/)[1]
        let bstr = atob(arr[1])
        let n = bstr.length
        let u8arr = new Uint8Array(n)
        while (n--) {
          u8arr[n] = bstr.charCodeAt(n)
        }
        return new Blob([u8arr], {type:mime})
      }
      const blob = convertBase64UrlToBlob(reader.result)
      setTimeout(() => {
        // setTimeout 模拟异步上传图片
        // 当异步上传获取图片地址后，执行calback回调（参数为imageUrl字符串），即可将图片地址写入markdown
        callback('https://avatars0.githubusercontent.com/u/21263805?s=40&v=4')
      }, 1000)
    }
    reader.readAsDataURL(file)
  }
  renderHTML(text) {
    // 模拟异步渲染Markdown
    return new Promise((resolve) => {
      setTimeout(() => {
        resolve(this.mdParser.render(text))
      }, 1000)
    })
  }
  handleGetMdValue = () => {   
    this.mdEditor && alert(this.mdEditor.getMdValue())      
  }
  handleGetHtmlValue = () => {    
    this.mdEditor && alert(this.mdEditor.getHtmlValue())
  }
  render() {
    return (      
      <div>
        <nav>
          <button onClick={this.handleGetMdValue} >getMdValue</button>  
          <button onClick={this.handleGetHtmlValue} >getHtmlValue</button>  
        </nav>
        <section style="height: 500px">
          <MdEditor 
            ref={node => this.mdEditor = node}
            value={MOCK_DATA}
            style={{height: '400px'}}
            renderHTML={this.renderHTML}
            config={{
              view: {
                menu: true,
                md: true,
                html: true
              },
              imageUrl: 'https://octodex.github.com/images/minion.png'
            }}
            onChange={this.handleEditorChange} 
            onImageUpload={this.handleImageUpload}
          />
        </section>                        
      </div>      
    )
  }
}
```

### 最后

   欢迎大家使用和反馈，[项目地址](https://github.com/HarryChen0506/react-markdown-editor-lite) (https://github.com/HarryChen0506/react-markdown-editor-lite)， 你的点赞将是我莫大的动力😊

![1.png](https://s3.ca-central-1.amazonaws.com/res-blog-public/res-dev/blog_1636946743939_1.png)', firstPicture='', viewCount=83, createDate='Sun Nov 07 14:09:29 EST 2021', updateDate='Tue Jan 18 22:54:08 EST 2022'}}, total=null}
2022-01-19 20:31:36:864 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 8ms
2022-01-19 20:31:36:864 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 20:31:36:866 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 20:31:36:866 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 20:31:36:866 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 20:31:36:866 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 20:31:36:866 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 20:31:36:866 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 20:31:36:866 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=32createdate=Wed Jan 19 20:27:15 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/4.png, replyComments=null, CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='ljh19911025@gmail.com', nickname='sfs@ss.c', parentCommentNickname='null', content='sds', status='0'}}, CommentListVo{commentId=31createdate=Wed Jan 19 20:17:39 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/58.png, replyComments=null, CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='ljh19911025@gmail.com', nickname='ivan', parentCommentNickname='null', content='sssssssss', status='0'}}, CommentListVo{commentId=30createdate=Wed Jan 19 20:17:20 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/78.png, replyComments=null, CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='sfsf', parentCommentNickname='null', content='djjsf', status='0'}}, CommentListVo{commentId=20createdate=Wed Jan 19 11:47:08 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/26.png, replyComments=[CommentListVo{commentId=21createdate=Wed Jan 19 11:47:21 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/89.png, replyComments=[CommentListVo{commentId=22createdate=Wed Jan 19 11:47:39 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/75.png, replyComments=null, CommentVo=CommentVo{parentCommentId=21, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='sfs@ss.c', content='eeeeee', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='tet', content='ree', status='0'}}, CommentListVo{commentId=27createdate=Wed Jan 19 17:01:06 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/2.png, replyComments=[CommentListVo{commentId=28createdate=Wed Jan 19 20:16:38 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/51.png, replyComments=null, CommentVo=CommentVo{parentCommentId=27, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='sds', content='dddd', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='ljh19911025@gmail.com', nickname='sds', parentCommentNickname='tet', content='wwww', status='0'}}, CommentListVo{commentId=29createdate=Wed Jan 19 20:17:06 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/99.png, replyComments=null, CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='test@gg.com', nickname='sfsf', parentCommentNickname='tet', content='reply tet', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='tet', parentCommentNickname='null', content='etet', status='0'}}], total=4}
2022-01-19 20:31:36:866 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 6ms
2022-01-19 20:31:36:866 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 20:31:36:899 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 20:31:36:899 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 20:31:36:899 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 20:31:36:899 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 20:31:36:899 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 20:31:36:899 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 20:31:36:899 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=32createdate=Wed Jan 19 20:27:15 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/4.png, replyComments=null, CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='ljh19911025@gmail.com', nickname='sfs@ss.c', parentCommentNickname='null', content='sds', status='0'}}, CommentListVo{commentId=31createdate=Wed Jan 19 20:17:39 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/58.png, replyComments=null, CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='ljh19911025@gmail.com', nickname='ivan', parentCommentNickname='null', content='sssssssss', status='0'}}, CommentListVo{commentId=30createdate=Wed Jan 19 20:17:20 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/78.png, replyComments=null, CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='sfsf', parentCommentNickname='null', content='djjsf', status='0'}}, CommentListVo{commentId=20createdate=Wed Jan 19 11:47:08 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/26.png, replyComments=[CommentListVo{commentId=21createdate=Wed Jan 19 11:47:21 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/89.png, replyComments=[CommentListVo{commentId=22createdate=Wed Jan 19 11:47:39 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/75.png, replyComments=null, CommentVo=CommentVo{parentCommentId=21, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='sfs@ss.c', content='eeeeee', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='tet', content='ree', status='0'}}, CommentListVo{commentId=27createdate=Wed Jan 19 17:01:06 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/2.png, replyComments=[CommentListVo{commentId=28createdate=Wed Jan 19 20:16:38 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/51.png, replyComments=null, CommentVo=CommentVo{parentCommentId=27, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='sds', content='dddd', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='ljh19911025@gmail.com', nickname='sds', parentCommentNickname='tet', content='wwww', status='0'}}, CommentListVo{commentId=29createdate=Wed Jan 19 20:17:06 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/99.png, replyComments=null, CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='test@gg.com', nickname='sfsf', parentCommentNickname='tet', content='reply tet', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='tet', parentCommentNickname='null', content='etet', status='0'}}], total=4}
2022-01-19 20:31:36:899 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 3ms
2022-01-19 20:31:36:899 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 20:32:40:107 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 20:32:40:107 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 20:32:40:108 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: POST
2022-01-19 20:32:40:108 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment
2022-01-19 20:32:40:108 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.postComment
2022-01-19 20:32:40:108 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: CommentVo{parentCommentId=20, articleId=10005, email='ljh19911025@gmail.com', nickname='ivan', parentCommentNickname='tet', content='ddd', status='null'}
2022-01-19 20:32:40:108 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=null, total=null}
2022-01-19 20:32:40:108 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 4ms
2022-01-19 20:32:40:108 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 20:32:40:132 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 20:32:40:132 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 20:32:40:132 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 20:32:40:132 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 20:32:40:132 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 20:32:40:132 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 20:32:40:132 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=32createdate=Wed Jan 19 20:27:15 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/4.png, replyComments=null, CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='ljh19911025@gmail.com', nickname='sfs@ss.c', parentCommentNickname='null', content='sds', status='0'}}, CommentListVo{commentId=31createdate=Wed Jan 19 20:17:39 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/58.png, replyComments=null, CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='ljh19911025@gmail.com', nickname='ivan', parentCommentNickname='null', content='sssssssss', status='0'}}, CommentListVo{commentId=30createdate=Wed Jan 19 20:17:20 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/78.png, replyComments=null, CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='sfsf', parentCommentNickname='null', content='djjsf', status='0'}}, CommentListVo{commentId=20createdate=Wed Jan 19 11:47:08 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/26.png, replyComments=[CommentListVo{commentId=21createdate=Wed Jan 19 11:47:21 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/89.png, replyComments=[CommentListVo{commentId=22createdate=Wed Jan 19 11:47:39 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/75.png, replyComments=null, CommentVo=CommentVo{parentCommentId=21, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='sfs@ss.c', content='eeeeee', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='tet', content='ree', status='0'}}, CommentListVo{commentId=27createdate=Wed Jan 19 17:01:06 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/2.png, replyComments=[CommentListVo{commentId=28createdate=Wed Jan 19 20:16:38 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/51.png, replyComments=null, CommentVo=CommentVo{parentCommentId=27, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='sds', content='dddd', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='ljh19911025@gmail.com', nickname='sds', parentCommentNickname='tet', content='wwww', status='0'}}, CommentListVo{commentId=29createdate=Wed Jan 19 20:17:06 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/99.png, replyComments=null, CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='test@gg.com', nickname='sfsf', parentCommentNickname='tet', content='reply tet', status='0'}}, CommentListVo{commentId=33createdate=Wed Jan 19 20:32:40 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/42.png, replyComments=null, CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='ljh19911025@gmail.com', nickname='ivan', parentCommentNickname='tet', content='ddd', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='tet', parentCommentNickname='null', content='etet', status='0'}}], total=4}
2022-01-19 20:32:40:133 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 4ms
2022-01-19 20:32:40:133 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 20:32:55:325 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 20:32:55:325 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 20:32:55:325 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: POST
2022-01-19 20:32:55:325 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment
2022-01-19 20:32:55:325 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.postComment
2022-01-19 20:32:55:325 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: CommentVo{parentCommentId=29, articleId=10005, email='ljh19911025@gmail.com', nickname='sfsf', parentCommentNickname='sfsf', content='dfd', status='null'}
2022-01-19 20:32:55:325 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=null, total=null}
2022-01-19 20:32:55:325 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 2ms
2022-01-19 20:32:55:326 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 20:32:55:360 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 20:32:55:360 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 20:32:55:360 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 20:32:55:360 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 20:32:55:360 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 20:32:55:360 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 20:32:55:360 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=32createdate=Wed Jan 19 20:27:15 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/4.png, replyComments=null, CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='ljh19911025@gmail.com', nickname='sfs@ss.c', parentCommentNickname='null', content='sds', status='0'}}, CommentListVo{commentId=31createdate=Wed Jan 19 20:17:39 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/58.png, replyComments=null, CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='ljh19911025@gmail.com', nickname='ivan', parentCommentNickname='null', content='sssssssss', status='0'}}, CommentListVo{commentId=30createdate=Wed Jan 19 20:17:20 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/78.png, replyComments=null, CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='sfsf', parentCommentNickname='null', content='djjsf', status='0'}}, CommentListVo{commentId=20createdate=Wed Jan 19 11:47:08 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/26.png, replyComments=[CommentListVo{commentId=21createdate=Wed Jan 19 11:47:21 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/89.png, replyComments=[CommentListVo{commentId=22createdate=Wed Jan 19 11:47:39 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/75.png, replyComments=null, CommentVo=CommentVo{parentCommentId=21, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='sfs@ss.c', content='eeeeee', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='tet', content='ree', status='0'}}, CommentListVo{commentId=27createdate=Wed Jan 19 17:01:06 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/2.png, replyComments=[CommentListVo{commentId=28createdate=Wed Jan 19 20:16:38 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/51.png, replyComments=null, CommentVo=CommentVo{parentCommentId=27, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='sds', content='dddd', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='ljh19911025@gmail.com', nickname='sds', parentCommentNickname='tet', content='wwww', status='0'}}, CommentListVo{commentId=29createdate=Wed Jan 19 20:17:06 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/99.png, replyComments=[CommentListVo{commentId=34createdate=Wed Jan 19 20:32:55 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/21.png, replyComments=null, CommentVo=CommentVo{parentCommentId=29, articleId=10005, email='ljh19911025@gmail.com', nickname='sfsf', parentCommentNickname='sfsf', content='dfd', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='test@gg.com', nickname='sfsf', parentCommentNickname='tet', content='reply tet', status='0'}}, CommentListVo{commentId=33createdate=Wed Jan 19 20:32:40 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/42.png, replyComments=null, CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='ljh19911025@gmail.com', nickname='ivan', parentCommentNickname='tet', content='ddd', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='tet', parentCommentNickname='null', content='etet', status='0'}}], total=4}
2022-01-19 20:32:55:361 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 5ms
2022-01-19 20:32:55:361 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 21:01:22:670 [HikariPool-1 housekeeper] WARN  com.zaxxer.hikari.pool.HikariPool HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=20m4s963ms).
2022-01-19 21:04:15:778 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 21:04:15:778 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 21:04:15:778 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 21:04:15:778 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/article/10005
2022-01-19 21:04:15:778 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.ArticleController.getPublicArticleDetail
2022-01-19 21:04:15:778 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 21:04:15:778 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=ArticleVo{userInfo=UserInfoVo{userId=100001, nickName='ivan', userName='ivan', avatar='https://res-blog-public.s3.ca-central-1.amazonaws.com/default_avatar.jpg'}, category=CategoryVo{categoryId=1, name='Life ', articleCount=null}, BaseArticleVo{articleId=10005, status=1, type=1, title='dd', description='This is the doc of React markdown editor lite.
Enjoy!!', content='| Head | Head | Head | Head |
| --- | --- | --- | --- |
| Data | Data | Data | Data |
| Data | Data | Data | Data |

## 手把手教你写一个markdown编辑器

> 笔者在18年年末的时候接到一个开发任务——搭建一个AI项目的开放平台，其中的产品文档为转化为HTML格式的markdown文档。考虑到文档的即时更新，将文档信息做成了Ajax接口的形式。因此管理后台只需将textarea表单的内容通过markdown解析器进行HTML格式转化，然后将markdown内容和经转化的HTML文档都保存到数据库即可。
> 基本需求完成后，为了更好的用户体验，考虑将常用的编辑功能添加进来。改进版不仅支持了常用的文本编辑功能，还实现的UI界面的配置化，自定义语法解析器。本着造福伸手党的目的，以及积累些开源经验，笔者将该react 组件 [react-markdown-editor-lite](https://github.com/HarryChen0506/react-markdown-editor-lite) 进行了封装改造，并且发布到了开源社区。

### 预览
在线体验 [https://harrychen0506.github.io/react-markdown-editor-lite/](https://harrychen0506.github.io/react-markdown-editor-lite/)

![image](https://github.com//HarryChen0506/react-markdown-editor-lite/blob/master/image/react-markdown-editor-lite-v1.0.0.PNG?raw=true)

### 特点
* 轻量、基于React
* UI可配置, 如只显示编辑区或预览区
* 支持自定义markdown语法解析器,语法高亮等
* 支持常用的markdown编辑功能，如加粗，斜体等等...
* 支持功能按钮插拔化，用户可以自定义扩展组件
* 支持编辑区和预览区同步滚动

### 开发心得

- 文本编辑

  大多数常见的编辑器，包括富文本编辑器，利用了某些元素如div的contenteditable属性，配合selection、range、execCommand等API，实现了富文本编辑功能。这里面的实现比较复杂，所以有了"[为什么都说富文本编辑器是天坑？](https://www.zhihu.com/question/38699645)"这个说法。

  而markdown编辑器，核心的处理内容为简单语法的纯文本，复杂度相对来说比较低，并且input标签自带onSelect事件，可以很方便的获取选择信息（选择起始位置和选择文本值），因此要想实现编辑功能，只需将要改动的内容进行文本转换，然后进行重新拼接首尾，大功告成。
  
- markdown解析

  考察了几个社区流行的markdown解析器，比较流行的有[markdown](https://www.npmjs.com/package/markdown), [markdown-it](https://www.npmjs.com/package/markdown-it), [marked](https://www.npmjs.com/package/marked) 等等。综合考虑扩展性以及稳定性，笔者推荐使用markdown-it作为markdown的词法解析器，因为该解析器有比较多的插件，并且支持语法高亮。

- 同步滚动

  当选择分栏编辑的时候，滚动左侧的编辑区，右侧的预览区能自动滚动到对应的区域。方案参考了《[手把手教你用 100行代码实现基于 react的 markdown 输入 + 即时预览在线编辑器（一）](https://github.com/accforgit/blog-data/blob/master/%E5%9C%A8%E7%BA%BF%E7%BC%96%E8%BE%91%E5%99%A8/README/README1.md)》。只需先计算出输入框容器元素与预览框容器元素之间最大scroll范围的比例值，然后根据主动滚动元素自身的scrollTop做相应的比例换算，即可知道对方区域的scrollTop值。

- 关于UI
 
  - 项目的字体库选择了Font Awesome风格，并且只选取了项目所需要的一些图标。
  - 编辑器的整体css均可通过全局覆盖的形式进行自定义。目前暂时只支持灰色主题。
  - 编辑器的显示区域包括菜单栏，编辑器，预览区，工具栏，通过配置组件的config属性，可以选择默认的展示区域。
  
### Install

```js
npm install react-markdown-editor-lite --save
```

### Props

| Property | Description | Type | default | Remarks |
| --- | --- | --- | --- | --- |
| value | markdown content | String | '' | required |
| style | component container style | Object | {height: '100%'} | not required |
| config | component config | Object | {view: {...}, logger: {...}} | not required |
| onChange | emitting when editor has changed | Function | ({html, md}) => {} | not required |
| onImageUpload | when image uploaded, callback emitting will get image markdown text | (file: File, callback: (url: string) => void) => void; | ({file, callback}) => {} | not required |
| renderHTML | Render markdown text to HTML. You can return either string, function or Promise | (text: string) => string|function|Promise | none | **required** |

### Example

``` js
'use strict';
import React from 'react'
import ReactDOM from 'react-dom'
import MdEditor from 'react-markdown-editor-lite'
import MarkdownIt from 'markdown-it'
import emoji from 'markdown-it-emoji'
import subscript from 'markdown-it-sub'
import superscript from 'markdown-it-sup'
import footnote from 'markdown-it-footnote'
import deflist from 'markdown-it-deflist'
import abbreviation from 'markdown-it-abbr'
import insert from 'markdown-it-ins'
import mark from 'markdown-it-mark'
import tasklists from 'markdown-it-task-lists'
import hljs from 'highlight.js'
import 'highlight.js/styles/atom-one-light.css'
// import 'highlight.js/styles/github.css'
import './index.less';

const MOCK_DATA = "I Love React."
export default class Demo extends React.Component {
  mdEditor = null
  mdParser = null
  constructor(props) {
    super(props)
    // initial a parsera
    this.mdParser = new MarkdownIt({
      html: true,
      linkify: true,
      typographer: true,
      highlight: function (str, lang) {
        if (lang && hljs.getLanguage(lang)) {
          try {
            return hljs.highlight(lang, str).value
          } catch (__) {}
        }    
        return '' // use external default escaping
      }
    })
    .use(emoji)
    .use(subscript)
    .use(superscript)
    .use(footnote)
    .use(deflist)
    .use(abbreviation)
    .use(insert)
    .use(mark)
    .use(tasklists, { enabled: this.taskLists })
    this.renderHTML = this.renderHTML.bind(this)
  }
  handleEditorChange({html, md}) {
    console.log('handleEditorChange', html, md)
  }
  handleImageUpload(file, callback) {
    const reader = new FileReader()
    reader.onload = () => {      
      const convertBase64UrlToBlob = (urlData) => {  
        let arr = urlData.split(','), mime = arr[0].match(/:(.*?);/)[1]
        let bstr = atob(arr[1])
        let n = bstr.length
        let u8arr = new Uint8Array(n)
        while (n--) {
          u8arr[n] = bstr.charCodeAt(n)
        }
        return new Blob([u8arr], {type:mime})
      }
      const blob = convertBase64UrlToBlob(reader.result)
      setTimeout(() => {
        // setTimeout 模拟异步上传图片
        // 当异步上传获取图片地址后，执行calback回调（参数为imageUrl字符串），即可将图片地址写入markdown
        callback('https://avatars0.githubusercontent.com/u/21263805?s=40&v=4')
      }, 1000)
    }
    reader.readAsDataURL(file)
  }
  renderHTML(text) {
    // 模拟异步渲染Markdown
    return new Promise((resolve) => {
      setTimeout(() => {
        resolve(this.mdParser.render(text))
      }, 1000)
    })
  }
  handleGetMdValue = () => {   
    this.mdEditor && alert(this.mdEditor.getMdValue())      
  }
  handleGetHtmlValue = () => {    
    this.mdEditor && alert(this.mdEditor.getHtmlValue())
  }
  render() {
    return (      
      <div>
        <nav>
          <button onClick={this.handleGetMdValue} >getMdValue</button>  
          <button onClick={this.handleGetHtmlValue} >getHtmlValue</button>  
        </nav>
        <section style="height: 500px">
          <MdEditor 
            ref={node => this.mdEditor = node}
            value={MOCK_DATA}
            style={{height: '400px'}}
            renderHTML={this.renderHTML}
            config={{
              view: {
                menu: true,
                md: true,
                html: true
              },
              imageUrl: 'https://octodex.github.com/images/minion.png'
            }}
            onChange={this.handleEditorChange} 
            onImageUpload={this.handleImageUpload}
          />
        </section>                        
      </div>      
    )
  }
}
```

### 最后

   欢迎大家使用和反馈，[项目地址](https://github.com/HarryChen0506/react-markdown-editor-lite) (https://github.com/HarryChen0506/react-markdown-editor-lite)， 你的点赞将是我莫大的动力😊

![1.png](https://s3.ca-central-1.amazonaws.com/res-blog-public/res-dev/blog_1636946743939_1.png)', firstPicture='', viewCount=83, createDate='Sun Nov 07 14:09:29 EST 2021', updateDate='Tue Jan 18 22:54:08 EST 2022'}}, total=null}
2022-01-19 21:04:15:779 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 58ms
2022-01-19 21:04:15:779 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 21:04:15:792 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 21:04:15:792 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 21:04:15:792 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 21:04:15:792 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 21:04:15:792 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 21:04:15:792 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 21:04:15:792 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 21:04:15:792 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 21:04:15:792 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 21:04:15:792 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 21:04:15:792 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 21:04:15:792 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 21:04:15:792 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=32createdate=Wed Jan 19 20:27:15 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/4.png, replyComments=null, CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='ljh19911025@gmail.com', nickname='sfs@ss.c', parentCommentNickname='null', content='sds', status='0'}}, CommentListVo{commentId=31createdate=Wed Jan 19 20:17:39 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/58.png, replyComments=null, CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='ljh19911025@gmail.com', nickname='ivan', parentCommentNickname='null', content='sssssssss', status='0'}}, CommentListVo{commentId=30createdate=Wed Jan 19 20:17:20 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/78.png, replyComments=null, CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='sfsf', parentCommentNickname='null', content='djjsf', status='0'}}, CommentListVo{commentId=20createdate=Wed Jan 19 11:47:08 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/26.png, replyComments=[CommentListVo{commentId=21createdate=Wed Jan 19 11:47:21 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/89.png, replyComments=[CommentListVo{commentId=22createdate=Wed Jan 19 11:47:39 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/75.png, replyComments=null, CommentVo=CommentVo{parentCommentId=21, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='sfs@ss.c', content='eeeeee', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='tet', content='ree', status='0'}}, CommentListVo{commentId=27createdate=Wed Jan 19 17:01:06 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/2.png, replyComments=[CommentListVo{commentId=28createdate=Wed Jan 19 20:16:38 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/51.png, replyComments=null, CommentVo=CommentVo{parentCommentId=27, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='sds', content='dddd', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='ljh19911025@gmail.com', nickname='sds', parentCommentNickname='tet', content='wwww', status='0'}}, CommentListVo{commentId=29createdate=Wed Jan 19 20:17:06 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/99.png, replyComments=[CommentListVo{commentId=34createdate=Wed Jan 19 20:32:55 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/21.png, replyComments=null, CommentVo=CommentVo{parentCommentId=29, articleId=10005, email='ljh19911025@gmail.com', nickname='sfsf', parentCommentNickname='sfsf', content='dfd', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='test@gg.com', nickname='sfsf', parentCommentNickname='tet', content='reply tet', status='0'}}, CommentListVo{commentId=33createdate=Wed Jan 19 20:32:40 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/42.png, replyComments=null, CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='ljh19911025@gmail.com', nickname='ivan', parentCommentNickname='tet', content='ddd', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='tet', parentCommentNickname='null', content='etet', status='0'}}], total=4}
2022-01-19 21:04:15:792 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=32createdate=Wed Jan 19 20:27:15 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/4.png, replyComments=null, CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='ljh19911025@gmail.com', nickname='sfs@ss.c', parentCommentNickname='null', content='sds', status='0'}}, CommentListVo{commentId=31createdate=Wed Jan 19 20:17:39 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/58.png, replyComments=null, CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='ljh19911025@gmail.com', nickname='ivan', parentCommentNickname='null', content='sssssssss', status='0'}}, CommentListVo{commentId=30createdate=Wed Jan 19 20:17:20 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/78.png, replyComments=null, CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='sfsf', parentCommentNickname='null', content='djjsf', status='0'}}, CommentListVo{commentId=20createdate=Wed Jan 19 11:47:08 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/26.png, replyComments=[CommentListVo{commentId=21createdate=Wed Jan 19 11:47:21 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/89.png, replyComments=[CommentListVo{commentId=22createdate=Wed Jan 19 11:47:39 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/75.png, replyComments=null, CommentVo=CommentVo{parentCommentId=21, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='sfs@ss.c', content='eeeeee', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='tet', content='ree', status='0'}}, CommentListVo{commentId=27createdate=Wed Jan 19 17:01:06 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/2.png, replyComments=[CommentListVo{commentId=28createdate=Wed Jan 19 20:16:38 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/51.png, replyComments=null, CommentVo=CommentVo{parentCommentId=27, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='sds', content='dddd', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='ljh19911025@gmail.com', nickname='sds', parentCommentNickname='tet', content='wwww', status='0'}}, CommentListVo{commentId=29createdate=Wed Jan 19 20:17:06 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/99.png, replyComments=[CommentListVo{commentId=34createdate=Wed Jan 19 20:32:55 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/21.png, replyComments=null, CommentVo=CommentVo{parentCommentId=29, articleId=10005, email='ljh19911025@gmail.com', nickname='sfsf', parentCommentNickname='sfsf', content='dfd', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='test@gg.com', nickname='sfsf', parentCommentNickname='tet', content='reply tet', status='0'}}, CommentListVo{commentId=33createdate=Wed Jan 19 20:32:40 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/42.png, replyComments=null, CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='ljh19911025@gmail.com', nickname='ivan', parentCommentNickname='tet', content='ddd', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='tet', parentCommentNickname='null', content='etet', status='0'}}], total=4}
2022-01-19 21:04:15:792 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 73ms
2022-01-19 21:04:15:792 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 73ms
2022-01-19 21:04:15:792 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 21:04:15:792 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 21:04:16:358 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 21:04:16:358 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 21:04:16:358 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 21:04:16:358 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 21:04:16:358 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 21:04:16:358 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 21:04:16:358 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=32createdate=Wed Jan 19 20:27:15 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/4.png, replyComments=null, CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='ljh19911025@gmail.com', nickname='sfs@ss.c', parentCommentNickname='null', content='sds', status='0'}}, CommentListVo{commentId=31createdate=Wed Jan 19 20:17:39 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/58.png, replyComments=null, CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='ljh19911025@gmail.com', nickname='ivan', parentCommentNickname='null', content='sssssssss', status='0'}}, CommentListVo{commentId=30createdate=Wed Jan 19 20:17:20 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/78.png, replyComments=null, CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='sfsf', parentCommentNickname='null', content='djjsf', status='0'}}, CommentListVo{commentId=20createdate=Wed Jan 19 11:47:08 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/26.png, replyComments=[CommentListVo{commentId=21createdate=Wed Jan 19 11:47:21 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/89.png, replyComments=[CommentListVo{commentId=22createdate=Wed Jan 19 11:47:39 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/75.png, replyComments=null, CommentVo=CommentVo{parentCommentId=21, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='sfs@ss.c', content='eeeeee', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='tet', content='ree', status='0'}}, CommentListVo{commentId=27createdate=Wed Jan 19 17:01:06 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/2.png, replyComments=[CommentListVo{commentId=28createdate=Wed Jan 19 20:16:38 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/51.png, replyComments=null, CommentVo=CommentVo{parentCommentId=27, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='sds', content='dddd', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='ljh19911025@gmail.com', nickname='sds', parentCommentNickname='tet', content='wwww', status='0'}}, CommentListVo{commentId=29createdate=Wed Jan 19 20:17:06 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/99.png, replyComments=[CommentListVo{commentId=34createdate=Wed Jan 19 20:32:55 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/21.png, replyComments=null, CommentVo=CommentVo{parentCommentId=29, articleId=10005, email='ljh19911025@gmail.com', nickname='sfsf', parentCommentNickname='sfsf', content='dfd', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='test@gg.com', nickname='sfsf', parentCommentNickname='tet', content='reply tet', status='0'}}, CommentListVo{commentId=33createdate=Wed Jan 19 20:32:40 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/42.png, replyComments=null, CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='ljh19911025@gmail.com', nickname='ivan', parentCommentNickname='tet', content='ddd', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='tet', parentCommentNickname='null', content='etet', status='0'}}], total=4}
2022-01-19 21:04:16:358 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 14ms
2022-01-19 21:04:16:358 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 21:07:40:363 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 21:07:40:369 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 21:07:40:369 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 21:07:40:369 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/article/10005
2022-01-19 21:07:40:369 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.ArticleController.getPublicArticleDetail
2022-01-19 21:07:40:369 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 21:07:40:369 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=ArticleVo{userInfo=UserInfoVo{userId=100001, nickName='ivan', userName='ivan', avatar='https://res-blog-public.s3.ca-central-1.amazonaws.com/default_avatar.jpg'}, category=CategoryVo{categoryId=1, name='Life ', articleCount=null}, BaseArticleVo{articleId=10005, status=1, type=1, title='dd', description='This is the doc of React markdown editor lite.
Enjoy!!', content='| Head | Head | Head | Head |
| --- | --- | --- | --- |
| Data | Data | Data | Data |
| Data | Data | Data | Data |

## 手把手教你写一个markdown编辑器

> 笔者在18年年末的时候接到一个开发任务——搭建一个AI项目的开放平台，其中的产品文档为转化为HTML格式的markdown文档。考虑到文档的即时更新，将文档信息做成了Ajax接口的形式。因此管理后台只需将textarea表单的内容通过markdown解析器进行HTML格式转化，然后将markdown内容和经转化的HTML文档都保存到数据库即可。
> 基本需求完成后，为了更好的用户体验，考虑将常用的编辑功能添加进来。改进版不仅支持了常用的文本编辑功能，还实现的UI界面的配置化，自定义语法解析器。本着造福伸手党的目的，以及积累些开源经验，笔者将该react 组件 [react-markdown-editor-lite](https://github.com/HarryChen0506/react-markdown-editor-lite) 进行了封装改造，并且发布到了开源社区。

### 预览
在线体验 [https://harrychen0506.github.io/react-markdown-editor-lite/](https://harrychen0506.github.io/react-markdown-editor-lite/)

![image](https://github.com//HarryChen0506/react-markdown-editor-lite/blob/master/image/react-markdown-editor-lite-v1.0.0.PNG?raw=true)

### 特点
* 轻量、基于React
* UI可配置, 如只显示编辑区或预览区
* 支持自定义markdown语法解析器,语法高亮等
* 支持常用的markdown编辑功能，如加粗，斜体等等...
* 支持功能按钮插拔化，用户可以自定义扩展组件
* 支持编辑区和预览区同步滚动

### 开发心得

- 文本编辑

  大多数常见的编辑器，包括富文本编辑器，利用了某些元素如div的contenteditable属性，配合selection、range、execCommand等API，实现了富文本编辑功能。这里面的实现比较复杂，所以有了"[为什么都说富文本编辑器是天坑？](https://www.zhihu.com/question/38699645)"这个说法。

  而markdown编辑器，核心的处理内容为简单语法的纯文本，复杂度相对来说比较低，并且input标签自带onSelect事件，可以很方便的获取选择信息（选择起始位置和选择文本值），因此要想实现编辑功能，只需将要改动的内容进行文本转换，然后进行重新拼接首尾，大功告成。
  
- markdown解析

  考察了几个社区流行的markdown解析器，比较流行的有[markdown](https://www.npmjs.com/package/markdown), [markdown-it](https://www.npmjs.com/package/markdown-it), [marked](https://www.npmjs.com/package/marked) 等等。综合考虑扩展性以及稳定性，笔者推荐使用markdown-it作为markdown的词法解析器，因为该解析器有比较多的插件，并且支持语法高亮。

- 同步滚动

  当选择分栏编辑的时候，滚动左侧的编辑区，右侧的预览区能自动滚动到对应的区域。方案参考了《[手把手教你用 100行代码实现基于 react的 markdown 输入 + 即时预览在线编辑器（一）](https://github.com/accforgit/blog-data/blob/master/%E5%9C%A8%E7%BA%BF%E7%BC%96%E8%BE%91%E5%99%A8/README/README1.md)》。只需先计算出输入框容器元素与预览框容器元素之间最大scroll范围的比例值，然后根据主动滚动元素自身的scrollTop做相应的比例换算，即可知道对方区域的scrollTop值。

- 关于UI
 
  - 项目的字体库选择了Font Awesome风格，并且只选取了项目所需要的一些图标。
  - 编辑器的整体css均可通过全局覆盖的形式进行自定义。目前暂时只支持灰色主题。
  - 编辑器的显示区域包括菜单栏，编辑器，预览区，工具栏，通过配置组件的config属性，可以选择默认的展示区域。
  
### Install

```js
npm install react-markdown-editor-lite --save
```

### Props

| Property | Description | Type | default | Remarks |
| --- | --- | --- | --- | --- |
| value | markdown content | String | '' | required |
| style | component container style | Object | {height: '100%'} | not required |
| config | component config | Object | {view: {...}, logger: {...}} | not required |
| onChange | emitting when editor has changed | Function | ({html, md}) => {} | not required |
| onImageUpload | when image uploaded, callback emitting will get image markdown text | (file: File, callback: (url: string) => void) => void; | ({file, callback}) => {} | not required |
| renderHTML | Render markdown text to HTML. You can return either string, function or Promise | (text: string) => string|function|Promise | none | **required** |

### Example

``` js
'use strict';
import React from 'react'
import ReactDOM from 'react-dom'
import MdEditor from 'react-markdown-editor-lite'
import MarkdownIt from 'markdown-it'
import emoji from 'markdown-it-emoji'
import subscript from 'markdown-it-sub'
import superscript from 'markdown-it-sup'
import footnote from 'markdown-it-footnote'
import deflist from 'markdown-it-deflist'
import abbreviation from 'markdown-it-abbr'
import insert from 'markdown-it-ins'
import mark from 'markdown-it-mark'
import tasklists from 'markdown-it-task-lists'
import hljs from 'highlight.js'
import 'highlight.js/styles/atom-one-light.css'
// import 'highlight.js/styles/github.css'
import './index.less';

const MOCK_DATA = "I Love React."
export default class Demo extends React.Component {
  mdEditor = null
  mdParser = null
  constructor(props) {
    super(props)
    // initial a parsera
    this.mdParser = new MarkdownIt({
      html: true,
      linkify: true,
      typographer: true,
      highlight: function (str, lang) {
        if (lang && hljs.getLanguage(lang)) {
          try {
            return hljs.highlight(lang, str).value
          } catch (__) {}
        }    
        return '' // use external default escaping
      }
    })
    .use(emoji)
    .use(subscript)
    .use(superscript)
    .use(footnote)
    .use(deflist)
    .use(abbreviation)
    .use(insert)
    .use(mark)
    .use(tasklists, { enabled: this.taskLists })
    this.renderHTML = this.renderHTML.bind(this)
  }
  handleEditorChange({html, md}) {
    console.log('handleEditorChange', html, md)
  }
  handleImageUpload(file, callback) {
    const reader = new FileReader()
    reader.onload = () => {      
      const convertBase64UrlToBlob = (urlData) => {  
        let arr = urlData.split(','), mime = arr[0].match(/:(.*?);/)[1]
        let bstr = atob(arr[1])
        let n = bstr.length
        let u8arr = new Uint8Array(n)
        while (n--) {
          u8arr[n] = bstr.charCodeAt(n)
        }
        return new Blob([u8arr], {type:mime})
      }
      const blob = convertBase64UrlToBlob(reader.result)
      setTimeout(() => {
        // setTimeout 模拟异步上传图片
        // 当异步上传获取图片地址后，执行calback回调（参数为imageUrl字符串），即可将图片地址写入markdown
        callback('https://avatars0.githubusercontent.com/u/21263805?s=40&v=4')
      }, 1000)
    }
    reader.readAsDataURL(file)
  }
  renderHTML(text) {
    // 模拟异步渲染Markdown
    return new Promise((resolve) => {
      setTimeout(() => {
        resolve(this.mdParser.render(text))
      }, 1000)
    })
  }
  handleGetMdValue = () => {   
    this.mdEditor && alert(this.mdEditor.getMdValue())      
  }
  handleGetHtmlValue = () => {    
    this.mdEditor && alert(this.mdEditor.getHtmlValue())
  }
  render() {
    return (      
      <div>
        <nav>
          <button onClick={this.handleGetMdValue} >getMdValue</button>  
          <button onClick={this.handleGetHtmlValue} >getHtmlValue</button>  
        </nav>
        <section style="height: 500px">
          <MdEditor 
            ref={node => this.mdEditor = node}
            value={MOCK_DATA}
            style={{height: '400px'}}
            renderHTML={this.renderHTML}
            config={{
              view: {
                menu: true,
                md: true,
                html: true
              },
              imageUrl: 'https://octodex.github.com/images/minion.png'
            }}
            onChange={this.handleEditorChange} 
            onImageUpload={this.handleImageUpload}
          />
        </section>                        
      </div>      
    )
  }
}
```

### 最后

   欢迎大家使用和反馈，[项目地址](https://github.com/HarryChen0506/react-markdown-editor-lite) (https://github.com/HarryChen0506/react-markdown-editor-lite)， 你的点赞将是我莫大的动力😊

![1.png](https://s3.ca-central-1.amazonaws.com/res-blog-public/res-dev/blog_1636946743939_1.png)', firstPicture='', viewCount=83, createDate='Sun Nov 07 14:09:29 EST 2021', updateDate='Tue Jan 18 22:54:08 EST 2022'}}, total=null}
2022-01-19 21:07:40:369 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 46ms
2022-01-19 21:07:40:369 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 21:07:40:371 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 21:07:40:371 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 21:07:40:371 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 21:07:40:371 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 21:07:40:371 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 21:07:40:372 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 21:07:40:372 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 21:07:40:372 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 21:07:40:372 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 21:07:40:372 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 21:07:40:372 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 21:07:40:372 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 21:07:40:372 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=32createdate=Wed Jan 19 20:27:15 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/4.png, replyComments=null, CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='ljh19911025@gmail.com', nickname='sfs@ss.c', parentCommentNickname='null', content='sds', status='0'}}, CommentListVo{commentId=31createdate=Wed Jan 19 20:17:39 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/58.png, replyComments=null, CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='ljh19911025@gmail.com', nickname='ivan', parentCommentNickname='null', content='sssssssss', status='0'}}, CommentListVo{commentId=30createdate=Wed Jan 19 20:17:20 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/78.png, replyComments=null, CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='sfsf', parentCommentNickname='null', content='djjsf', status='0'}}, CommentListVo{commentId=20createdate=Wed Jan 19 11:47:08 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/26.png, replyComments=[CommentListVo{commentId=21createdate=Wed Jan 19 11:47:21 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/89.png, replyComments=[CommentListVo{commentId=22createdate=Wed Jan 19 11:47:39 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/75.png, replyComments=null, CommentVo=CommentVo{parentCommentId=21, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='sfs@ss.c', content='eeeeee', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='tet', content='ree', status='0'}}, CommentListVo{commentId=27createdate=Wed Jan 19 17:01:06 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/2.png, replyComments=[CommentListVo{commentId=28createdate=Wed Jan 19 20:16:38 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/51.png, replyComments=null, CommentVo=CommentVo{parentCommentId=27, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='sds', content='dddd', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='ljh19911025@gmail.com', nickname='sds', parentCommentNickname='tet', content='wwww', status='0'}}, CommentListVo{commentId=29createdate=Wed Jan 19 20:17:06 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/99.png, replyComments=[CommentListVo{commentId=34createdate=Wed Jan 19 20:32:55 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/21.png, replyComments=null, CommentVo=CommentVo{parentCommentId=29, articleId=10005, email='ljh19911025@gmail.com', nickname='sfsf', parentCommentNickname='sfsf', content='dfd', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='test@gg.com', nickname='sfsf', parentCommentNickname='tet', content='reply tet', status='0'}}, CommentListVo{commentId=33createdate=Wed Jan 19 20:32:40 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/42.png, replyComments=null, CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='ljh19911025@gmail.com', nickname='ivan', parentCommentNickname='tet', content='ddd', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='tet', parentCommentNickname='null', content='etet', status='0'}}], total=4}
2022-01-19 21:07:40:372 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 55ms
2022-01-19 21:07:40:372 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 21:07:40:372 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=32createdate=Wed Jan 19 20:27:15 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/4.png, replyComments=null, CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='ljh19911025@gmail.com', nickname='sfs@ss.c', parentCommentNickname='null', content='sds', status='0'}}, CommentListVo{commentId=31createdate=Wed Jan 19 20:17:39 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/58.png, replyComments=null, CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='ljh19911025@gmail.com', nickname='ivan', parentCommentNickname='null', content='sssssssss', status='0'}}, CommentListVo{commentId=30createdate=Wed Jan 19 20:17:20 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/78.png, replyComments=null, CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='sfsf', parentCommentNickname='null', content='djjsf', status='0'}}, CommentListVo{commentId=20createdate=Wed Jan 19 11:47:08 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/26.png, replyComments=[CommentListVo{commentId=21createdate=Wed Jan 19 11:47:21 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/89.png, replyComments=[CommentListVo{commentId=22createdate=Wed Jan 19 11:47:39 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/75.png, replyComments=null, CommentVo=CommentVo{parentCommentId=21, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='sfs@ss.c', content='eeeeee', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='tet', content='ree', status='0'}}, CommentListVo{commentId=27createdate=Wed Jan 19 17:01:06 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/2.png, replyComments=[CommentListVo{commentId=28createdate=Wed Jan 19 20:16:38 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/51.png, replyComments=null, CommentVo=CommentVo{parentCommentId=27, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='sds', content='dddd', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='ljh19911025@gmail.com', nickname='sds', parentCommentNickname='tet', content='wwww', status='0'}}, CommentListVo{commentId=29createdate=Wed Jan 19 20:17:06 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/99.png, replyComments=[CommentListVo{commentId=34createdate=Wed Jan 19 20:32:55 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/21.png, replyComments=null, CommentVo=CommentVo{parentCommentId=29, articleId=10005, email='ljh19911025@gmail.com', nickname='sfsf', parentCommentNickname='sfsf', content='dfd', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='test@gg.com', nickname='sfsf', parentCommentNickname='tet', content='reply tet', status='0'}}, CommentListVo{commentId=33createdate=Wed Jan 19 20:32:40 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/42.png, replyComments=null, CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='ljh19911025@gmail.com', nickname='ivan', parentCommentNickname='tet', content='ddd', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='tet', parentCommentNickname='null', content='etet', status='0'}}], total=4}
2022-01-19 21:07:40:372 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 51ms
2022-01-19 21:07:40:372 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 21:07:40:970 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 21:07:40:970 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 21:07:40:970 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 21:07:40:970 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 21:07:40:970 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 21:07:40:970 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 21:07:40:970 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=32createdate=Wed Jan 19 20:27:15 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/4.png, replyComments=null, CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='ljh19911025@gmail.com', nickname='sfs@ss.c', parentCommentNickname='null', content='sds', status='0'}}, CommentListVo{commentId=31createdate=Wed Jan 19 20:17:39 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/58.png, replyComments=null, CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='ljh19911025@gmail.com', nickname='ivan', parentCommentNickname='null', content='sssssssss', status='0'}}, CommentListVo{commentId=30createdate=Wed Jan 19 20:17:20 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/78.png, replyComments=null, CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='sfsf', parentCommentNickname='null', content='djjsf', status='0'}}, CommentListVo{commentId=20createdate=Wed Jan 19 11:47:08 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/26.png, replyComments=[CommentListVo{commentId=21createdate=Wed Jan 19 11:47:21 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/89.png, replyComments=[CommentListVo{commentId=22createdate=Wed Jan 19 11:47:39 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/75.png, replyComments=null, CommentVo=CommentVo{parentCommentId=21, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='sfs@ss.c', content='eeeeee', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='tet', content='ree', status='0'}}, CommentListVo{commentId=27createdate=Wed Jan 19 17:01:06 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/2.png, replyComments=[CommentListVo{commentId=28createdate=Wed Jan 19 20:16:38 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/51.png, replyComments=null, CommentVo=CommentVo{parentCommentId=27, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='sds', content='dddd', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='ljh19911025@gmail.com', nickname='sds', parentCommentNickname='tet', content='wwww', status='0'}}, CommentListVo{commentId=29createdate=Wed Jan 19 20:17:06 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/99.png, replyComments=[CommentListVo{commentId=34createdate=Wed Jan 19 20:32:55 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/21.png, replyComments=null, CommentVo=CommentVo{parentCommentId=29, articleId=10005, email='ljh19911025@gmail.com', nickname='sfsf', parentCommentNickname='sfsf', content='dfd', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='test@gg.com', nickname='sfsf', parentCommentNickname='tet', content='reply tet', status='0'}}, CommentListVo{commentId=33createdate=Wed Jan 19 20:32:40 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/42.png, replyComments=null, CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='ljh19911025@gmail.com', nickname='ivan', parentCommentNickname='tet', content='ddd', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='tet', parentCommentNickname='null', content='etet', status='0'}}], total=4}
2022-01-19 21:07:40:970 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 17ms
2022-01-19 21:07:40:970 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 21:07:50:041 [HikariPool-1 housekeeper] WARN  com.zaxxer.hikari.pool.HikariPool HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=57s322ms).
2022-01-19 21:09:41:142 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 21:09:41:143 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 21:09:41:143 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 21:09:41:143 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/article/10005
2022-01-19 21:09:41:143 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.ArticleController.getPublicArticleDetail
2022-01-19 21:09:41:143 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 21:09:41:143 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 21:09:41:143 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 21:09:41:143 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 21:09:41:143 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 21:09:41:143 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=ArticleVo{userInfo=UserInfoVo{userId=100001, nickName='ivan', userName='ivan', avatar='https://res-blog-public.s3.ca-central-1.amazonaws.com/default_avatar.jpg'}, category=CategoryVo{categoryId=1, name='Life ', articleCount=null}, BaseArticleVo{articleId=10005, status=1, type=1, title='dd', description='This is the doc of React markdown editor lite.
Enjoy!!', content='| Head | Head | Head | Head |
| --- | --- | --- | --- |
| Data | Data | Data | Data |
| Data | Data | Data | Data |

## 手把手教你写一个markdown编辑器

> 笔者在18年年末的时候接到一个开发任务——搭建一个AI项目的开放平台，其中的产品文档为转化为HTML格式的markdown文档。考虑到文档的即时更新，将文档信息做成了Ajax接口的形式。因此管理后台只需将textarea表单的内容通过markdown解析器进行HTML格式转化，然后将markdown内容和经转化的HTML文档都保存到数据库即可。
> 基本需求完成后，为了更好的用户体验，考虑将常用的编辑功能添加进来。改进版不仅支持了常用的文本编辑功能，还实现的UI界面的配置化，自定义语法解析器。本着造福伸手党的目的，以及积累些开源经验，笔者将该react 组件 [react-markdown-editor-lite](https://github.com/HarryChen0506/react-markdown-editor-lite) 进行了封装改造，并且发布到了开源社区。

### 预览
在线体验 [https://harrychen0506.github.io/react-markdown-editor-lite/](https://harrychen0506.github.io/react-markdown-editor-lite/)

![image](https://github.com//HarryChen0506/react-markdown-editor-lite/blob/master/image/react-markdown-editor-lite-v1.0.0.PNG?raw=true)

### 特点
* 轻量、基于React
* UI可配置, 如只显示编辑区或预览区
* 支持自定义markdown语法解析器,语法高亮等
* 支持常用的markdown编辑功能，如加粗，斜体等等...
* 支持功能按钮插拔化，用户可以自定义扩展组件
* 支持编辑区和预览区同步滚动

### 开发心得

- 文本编辑

  大多数常见的编辑器，包括富文本编辑器，利用了某些元素如div的contenteditable属性，配合selection、range、execCommand等API，实现了富文本编辑功能。这里面的实现比较复杂，所以有了"[为什么都说富文本编辑器是天坑？](https://www.zhihu.com/question/38699645)"这个说法。

  而markdown编辑器，核心的处理内容为简单语法的纯文本，复杂度相对来说比较低，并且input标签自带onSelect事件，可以很方便的获取选择信息（选择起始位置和选择文本值），因此要想实现编辑功能，只需将要改动的内容进行文本转换，然后进行重新拼接首尾，大功告成。
  
- markdown解析

  考察了几个社区流行的markdown解析器，比较流行的有[markdown](https://www.npmjs.com/package/markdown), [markdown-it](https://www.npmjs.com/package/markdown-it), [marked](https://www.npmjs.com/package/marked) 等等。综合考虑扩展性以及稳定性，笔者推荐使用markdown-it作为markdown的词法解析器，因为该解析器有比较多的插件，并且支持语法高亮。

- 同步滚动

  当选择分栏编辑的时候，滚动左侧的编辑区，右侧的预览区能自动滚动到对应的区域。方案参考了《[手把手教你用 100行代码实现基于 react的 markdown 输入 + 即时预览在线编辑器（一）](https://github.com/accforgit/blog-data/blob/master/%E5%9C%A8%E7%BA%BF%E7%BC%96%E8%BE%91%E5%99%A8/README/README1.md)》。只需先计算出输入框容器元素与预览框容器元素之间最大scroll范围的比例值，然后根据主动滚动元素自身的scrollTop做相应的比例换算，即可知道对方区域的scrollTop值。

- 关于UI
 
  - 项目的字体库选择了Font Awesome风格，并且只选取了项目所需要的一些图标。
  - 编辑器的整体css均可通过全局覆盖的形式进行自定义。目前暂时只支持灰色主题。
  - 编辑器的显示区域包括菜单栏，编辑器，预览区，工具栏，通过配置组件的config属性，可以选择默认的展示区域。
  
### Install

```js
npm install react-markdown-editor-lite --save
```

### Props

| Property | Description | Type | default | Remarks |
| --- | --- | --- | --- | --- |
| value | markdown content | String | '' | required |
| style | component container style | Object | {height: '100%'} | not required |
| config | component config | Object | {view: {...}, logger: {...}} | not required |
| onChange | emitting when editor has changed | Function | ({html, md}) => {} | not required |
| onImageUpload | when image uploaded, callback emitting will get image markdown text | (file: File, callback: (url: string) => void) => void; | ({file, callback}) => {} | not required |
| renderHTML | Render markdown text to HTML. You can return either string, function or Promise | (text: string) => string|function|Promise | none | **required** |

### Example

``` js
'use strict';
import React from 'react'
import ReactDOM from 'react-dom'
import MdEditor from 'react-markdown-editor-lite'
import MarkdownIt from 'markdown-it'
import emoji from 'markdown-it-emoji'
import subscript from 'markdown-it-sub'
import superscript from 'markdown-it-sup'
import footnote from 'markdown-it-footnote'
import deflist from 'markdown-it-deflist'
import abbreviation from 'markdown-it-abbr'
import insert from 'markdown-it-ins'
import mark from 'markdown-it-mark'
import tasklists from 'markdown-it-task-lists'
import hljs from 'highlight.js'
import 'highlight.js/styles/atom-one-light.css'
// import 'highlight.js/styles/github.css'
import './index.less';

const MOCK_DATA = "I Love React."
export default class Demo extends React.Component {
  mdEditor = null
  mdParser = null
  constructor(props) {
    super(props)
    // initial a parsera
    this.mdParser = new MarkdownIt({
      html: true,
      linkify: true,
      typographer: true,
      highlight: function (str, lang) {
        if (lang && hljs.getLanguage(lang)) {
          try {
            return hljs.highlight(lang, str).value
          } catch (__) {}
        }    
        return '' // use external default escaping
      }
    })
    .use(emoji)
    .use(subscript)
    .use(superscript)
    .use(footnote)
    .use(deflist)
    .use(abbreviation)
    .use(insert)
    .use(mark)
    .use(tasklists, { enabled: this.taskLists })
    this.renderHTML = this.renderHTML.bind(this)
  }
  handleEditorChange({html, md}) {
    console.log('handleEditorChange', html, md)
  }
  handleImageUpload(file, callback) {
    const reader = new FileReader()
    reader.onload = () => {      
      const convertBase64UrlToBlob = (urlData) => {  
        let arr = urlData.split(','), mime = arr[0].match(/:(.*?);/)[1]
        let bstr = atob(arr[1])
        let n = bstr.length
        let u8arr = new Uint8Array(n)
        while (n--) {
          u8arr[n] = bstr.charCodeAt(n)
        }
        return new Blob([u8arr], {type:mime})
      }
      const blob = convertBase64UrlToBlob(reader.result)
      setTimeout(() => {
        // setTimeout 模拟异步上传图片
        // 当异步上传获取图片地址后，执行calback回调（参数为imageUrl字符串），即可将图片地址写入markdown
        callback('https://avatars0.githubusercontent.com/u/21263805?s=40&v=4')
      }, 1000)
    }
    reader.readAsDataURL(file)
  }
  renderHTML(text) {
    // 模拟异步渲染Markdown
    return new Promise((resolve) => {
      setTimeout(() => {
        resolve(this.mdParser.render(text))
      }, 1000)
    })
  }
  handleGetMdValue = () => {   
    this.mdEditor && alert(this.mdEditor.getMdValue())      
  }
  handleGetHtmlValue = () => {    
    this.mdEditor && alert(this.mdEditor.getHtmlValue())
  }
  render() {
    return (      
      <div>
        <nav>
          <button onClick={this.handleGetMdValue} >getMdValue</button>  
          <button onClick={this.handleGetHtmlValue} >getHtmlValue</button>  
        </nav>
        <section style="height: 500px">
          <MdEditor 
            ref={node => this.mdEditor = node}
            value={MOCK_DATA}
            style={{height: '400px'}}
            renderHTML={this.renderHTML}
            config={{
              view: {
                menu: true,
                md: true,
                html: true
              },
              imageUrl: 'https://octodex.github.com/images/minion.png'
            }}
            onChange={this.handleEditorChange} 
            onImageUpload={this.handleImageUpload}
          />
        </section>                        
      </div>      
    )
  }
}
```

### 最后

   欢迎大家使用和反馈，[项目地址](https://github.com/HarryChen0506/react-markdown-editor-lite) (https://github.com/HarryChen0506/react-markdown-editor-lite)， 你的点赞将是我莫大的动力😊

![1.png](https://s3.ca-central-1.amazonaws.com/res-blog-public/res-dev/blog_1636946743939_1.png)', firstPicture='', viewCount=83, createDate='Sun Nov 07 14:09:29 EST 2021', updateDate='Tue Jan 18 22:54:08 EST 2022'}}, total=null}
2022-01-19 21:09:41:143 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 21:09:41:143 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 18ms
2022-01-19 21:09:41:143 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 21:09:41:143 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 21:09:41:143 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=32createdate=Wed Jan 19 20:27:15 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/4.png, replyComments=null, CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='ljh19911025@gmail.com', nickname='sfs@ss.c', parentCommentNickname='null', content='sds', status='0'}}, CommentListVo{commentId=31createdate=Wed Jan 19 20:17:39 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/58.png, replyComments=null, CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='ljh19911025@gmail.com', nickname='ivan', parentCommentNickname='null', content='sssssssss', status='0'}}, CommentListVo{commentId=30createdate=Wed Jan 19 20:17:20 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/78.png, replyComments=null, CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='sfsf', parentCommentNickname='null', content='djjsf', status='0'}}, CommentListVo{commentId=20createdate=Wed Jan 19 11:47:08 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/26.png, replyComments=[CommentListVo{commentId=21createdate=Wed Jan 19 11:47:21 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/89.png, replyComments=[CommentListVo{commentId=22createdate=Wed Jan 19 11:47:39 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/75.png, replyComments=null, CommentVo=CommentVo{parentCommentId=21, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='sfs@ss.c', content='eeeeee', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='tet', content='ree', status='0'}}, CommentListVo{commentId=27createdate=Wed Jan 19 17:01:06 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/2.png, replyComments=[CommentListVo{commentId=28createdate=Wed Jan 19 20:16:38 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/51.png, replyComments=null, CommentVo=CommentVo{parentCommentId=27, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='sds', content='dddd', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='ljh19911025@gmail.com', nickname='sds', parentCommentNickname='tet', content='wwww', status='0'}}, CommentListVo{commentId=29createdate=Wed Jan 19 20:17:06 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/99.png, replyComments=[CommentListVo{commentId=34createdate=Wed Jan 19 20:32:55 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/21.png, replyComments=null, CommentVo=CommentVo{parentCommentId=29, articleId=10005, email='ljh19911025@gmail.com', nickname='sfsf', parentCommentNickname='sfsf', content='dfd', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='test@gg.com', nickname='sfsf', parentCommentNickname='tet', content='reply tet', status='0'}}, CommentListVo{commentId=33createdate=Wed Jan 19 20:32:40 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/42.png, replyComments=null, CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='ljh19911025@gmail.com', nickname='ivan', parentCommentNickname='tet', content='ddd', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='tet', parentCommentNickname='null', content='etet', status='0'}}], total=4}
2022-01-19 21:09:41:143 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 21:09:41:143 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 18ms
2022-01-19 21:09:41:143 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 21:09:41:143 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 21:09:41:143 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 21:09:41:143 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 21:09:41:143 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 21:09:41:143 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 21:09:41:143 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=32createdate=Wed Jan 19 20:27:15 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/4.png, replyComments=null, CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='ljh19911025@gmail.com', nickname='sfs@ss.c', parentCommentNickname='null', content='sds', status='0'}}, CommentListVo{commentId=31createdate=Wed Jan 19 20:17:39 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/58.png, replyComments=null, CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='ljh19911025@gmail.com', nickname='ivan', parentCommentNickname='null', content='sssssssss', status='0'}}, CommentListVo{commentId=30createdate=Wed Jan 19 20:17:20 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/78.png, replyComments=null, CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='sfsf', parentCommentNickname='null', content='djjsf', status='0'}}, CommentListVo{commentId=20createdate=Wed Jan 19 11:47:08 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/26.png, replyComments=[CommentListVo{commentId=21createdate=Wed Jan 19 11:47:21 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/89.png, replyComments=[CommentListVo{commentId=22createdate=Wed Jan 19 11:47:39 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/75.png, replyComments=null, CommentVo=CommentVo{parentCommentId=21, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='sfs@ss.c', content='eeeeee', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='tet', content='ree', status='0'}}, CommentListVo{commentId=27createdate=Wed Jan 19 17:01:06 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/2.png, replyComments=[CommentListVo{commentId=28createdate=Wed Jan 19 20:16:38 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/51.png, replyComments=null, CommentVo=CommentVo{parentCommentId=27, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='sds', content='dddd', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='ljh19911025@gmail.com', nickname='sds', parentCommentNickname='tet', content='wwww', status='0'}}, CommentListVo{commentId=29createdate=Wed Jan 19 20:17:06 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/99.png, replyComments=[CommentListVo{commentId=34createdate=Wed Jan 19 20:32:55 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/21.png, replyComments=null, CommentVo=CommentVo{parentCommentId=29, articleId=10005, email='ljh19911025@gmail.com', nickname='sfsf', parentCommentNickname='sfsf', content='dfd', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='test@gg.com', nickname='sfsf', parentCommentNickname='tet', content='reply tet', status='0'}}, CommentListVo{commentId=33createdate=Wed Jan 19 20:32:40 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/42.png, replyComments=null, CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='ljh19911025@gmail.com', nickname='ivan', parentCommentNickname='tet', content='ddd', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='tet', parentCommentNickname='null', content='etet', status='0'}}], total=4}
2022-01-19 21:09:41:144 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 18ms
2022-01-19 21:09:41:144 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 21:09:41:691 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 21:09:41:691 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 21:09:41:691 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 21:09:41:691 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 21:09:41:691 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 21:09:41:691 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 21:09:41:691 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=32createdate=Wed Jan 19 20:27:15 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/4.png, replyComments=null, CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='ljh19911025@gmail.com', nickname='sfs@ss.c', parentCommentNickname='null', content='sds', status='0'}}, CommentListVo{commentId=31createdate=Wed Jan 19 20:17:39 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/58.png, replyComments=null, CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='ljh19911025@gmail.com', nickname='ivan', parentCommentNickname='null', content='sssssssss', status='0'}}, CommentListVo{commentId=30createdate=Wed Jan 19 20:17:20 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/78.png, replyComments=null, CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='sfsf', parentCommentNickname='null', content='djjsf', status='0'}}, CommentListVo{commentId=20createdate=Wed Jan 19 11:47:08 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/26.png, replyComments=[CommentListVo{commentId=21createdate=Wed Jan 19 11:47:21 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/89.png, replyComments=[CommentListVo{commentId=22createdate=Wed Jan 19 11:47:39 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/75.png, replyComments=null, CommentVo=CommentVo{parentCommentId=21, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='sfs@ss.c', content='eeeeee', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='tet', content='ree', status='0'}}, CommentListVo{commentId=27createdate=Wed Jan 19 17:01:06 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/2.png, replyComments=[CommentListVo{commentId=28createdate=Wed Jan 19 20:16:38 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/51.png, replyComments=null, CommentVo=CommentVo{parentCommentId=27, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='sds', content='dddd', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='ljh19911025@gmail.com', nickname='sds', parentCommentNickname='tet', content='wwww', status='0'}}, CommentListVo{commentId=29createdate=Wed Jan 19 20:17:06 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/99.png, replyComments=[CommentListVo{commentId=34createdate=Wed Jan 19 20:32:55 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/21.png, replyComments=null, CommentVo=CommentVo{parentCommentId=29, articleId=10005, email='ljh19911025@gmail.com', nickname='sfsf', parentCommentNickname='sfsf', content='dfd', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='test@gg.com', nickname='sfsf', parentCommentNickname='tet', content='reply tet', status='0'}}, CommentListVo{commentId=33createdate=Wed Jan 19 20:32:40 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/42.png, replyComments=null, CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='ljh19911025@gmail.com', nickname='ivan', parentCommentNickname='tet', content='ddd', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='tet', parentCommentNickname='null', content='etet', status='0'}}], total=4}
2022-01-19 21:09:41:692 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 9ms
2022-01-19 21:09:41:692 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 21:10:03:624 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 21:10:03:624 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 21:10:03:624 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 21:10:03:624 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/article/10005
2022-01-19 21:10:03:624 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.ArticleController.getPublicArticleDetail
2022-01-19 21:10:03:624 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 21:10:03:624 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=ArticleVo{userInfo=UserInfoVo{userId=100001, nickName='ivan', userName='ivan', avatar='https://res-blog-public.s3.ca-central-1.amazonaws.com/default_avatar.jpg'}, category=CategoryVo{categoryId=1, name='Life ', articleCount=null}, BaseArticleVo{articleId=10005, status=1, type=1, title='dd', description='This is the doc of React markdown editor lite.
Enjoy!!', content='| Head | Head | Head | Head |
| --- | --- | --- | --- |
| Data | Data | Data | Data |
| Data | Data | Data | Data |

## 手把手教你写一个markdown编辑器

> 笔者在18年年末的时候接到一个开发任务——搭建一个AI项目的开放平台，其中的产品文档为转化为HTML格式的markdown文档。考虑到文档的即时更新，将文档信息做成了Ajax接口的形式。因此管理后台只需将textarea表单的内容通过markdown解析器进行HTML格式转化，然后将markdown内容和经转化的HTML文档都保存到数据库即可。
> 基本需求完成后，为了更好的用户体验，考虑将常用的编辑功能添加进来。改进版不仅支持了常用的文本编辑功能，还实现的UI界面的配置化，自定义语法解析器。本着造福伸手党的目的，以及积累些开源经验，笔者将该react 组件 [react-markdown-editor-lite](https://github.com/HarryChen0506/react-markdown-editor-lite) 进行了封装改造，并且发布到了开源社区。

### 预览
在线体验 [https://harrychen0506.github.io/react-markdown-editor-lite/](https://harrychen0506.github.io/react-markdown-editor-lite/)

![image](https://github.com//HarryChen0506/react-markdown-editor-lite/blob/master/image/react-markdown-editor-lite-v1.0.0.PNG?raw=true)

### 特点
* 轻量、基于React
* UI可配置, 如只显示编辑区或预览区
* 支持自定义markdown语法解析器,语法高亮等
* 支持常用的markdown编辑功能，如加粗，斜体等等...
* 支持功能按钮插拔化，用户可以自定义扩展组件
* 支持编辑区和预览区同步滚动

### 开发心得

- 文本编辑

  大多数常见的编辑器，包括富文本编辑器，利用了某些元素如div的contenteditable属性，配合selection、range、execCommand等API，实现了富文本编辑功能。这里面的实现比较复杂，所以有了"[为什么都说富文本编辑器是天坑？](https://www.zhihu.com/question/38699645)"这个说法。

  而markdown编辑器，核心的处理内容为简单语法的纯文本，复杂度相对来说比较低，并且input标签自带onSelect事件，可以很方便的获取选择信息（选择起始位置和选择文本值），因此要想实现编辑功能，只需将要改动的内容进行文本转换，然后进行重新拼接首尾，大功告成。
  
- markdown解析

  考察了几个社区流行的markdown解析器，比较流行的有[markdown](https://www.npmjs.com/package/markdown), [markdown-it](https://www.npmjs.com/package/markdown-it), [marked](https://www.npmjs.com/package/marked) 等等。综合考虑扩展性以及稳定性，笔者推荐使用markdown-it作为markdown的词法解析器，因为该解析器有比较多的插件，并且支持语法高亮。

- 同步滚动

  当选择分栏编辑的时候，滚动左侧的编辑区，右侧的预览区能自动滚动到对应的区域。方案参考了《[手把手教你用 100行代码实现基于 react的 markdown 输入 + 即时预览在线编辑器（一）](https://github.com/accforgit/blog-data/blob/master/%E5%9C%A8%E7%BA%BF%E7%BC%96%E8%BE%91%E5%99%A8/README/README1.md)》。只需先计算出输入框容器元素与预览框容器元素之间最大scroll范围的比例值，然后根据主动滚动元素自身的scrollTop做相应的比例换算，即可知道对方区域的scrollTop值。

- 关于UI
 
  - 项目的字体库选择了Font Awesome风格，并且只选取了项目所需要的一些图标。
  - 编辑器的整体css均可通过全局覆盖的形式进行自定义。目前暂时只支持灰色主题。
  - 编辑器的显示区域包括菜单栏，编辑器，预览区，工具栏，通过配置组件的config属性，可以选择默认的展示区域。
  
### Install

```js
npm install react-markdown-editor-lite --save
```

### Props

| Property | Description | Type | default | Remarks |
| --- | --- | --- | --- | --- |
| value | markdown content | String | '' | required |
| style | component container style | Object | {height: '100%'} | not required |
| config | component config | Object | {view: {...}, logger: {...}} | not required |
| onChange | emitting when editor has changed | Function | ({html, md}) => {} | not required |
| onImageUpload | when image uploaded, callback emitting will get image markdown text | (file: File, callback: (url: string) => void) => void; | ({file, callback}) => {} | not required |
| renderHTML | Render markdown text to HTML. You can return either string, function or Promise | (text: string) => string|function|Promise | none | **required** |

### Example

``` js
'use strict';
import React from 'react'
import ReactDOM from 'react-dom'
import MdEditor from 'react-markdown-editor-lite'
import MarkdownIt from 'markdown-it'
import emoji from 'markdown-it-emoji'
import subscript from 'markdown-it-sub'
import superscript from 'markdown-it-sup'
import footnote from 'markdown-it-footnote'
import deflist from 'markdown-it-deflist'
import abbreviation from 'markdown-it-abbr'
import insert from 'markdown-it-ins'
import mark from 'markdown-it-mark'
import tasklists from 'markdown-it-task-lists'
import hljs from 'highlight.js'
import 'highlight.js/styles/atom-one-light.css'
// import 'highlight.js/styles/github.css'
import './index.less';

const MOCK_DATA = "I Love React."
export default class Demo extends React.Component {
  mdEditor = null
  mdParser = null
  constructor(props) {
    super(props)
    // initial a parsera
    this.mdParser = new MarkdownIt({
      html: true,
      linkify: true,
      typographer: true,
      highlight: function (str, lang) {
        if (lang && hljs.getLanguage(lang)) {
          try {
            return hljs.highlight(lang, str).value
          } catch (__) {}
        }    
        return '' // use external default escaping
      }
    })
    .use(emoji)
    .use(subscript)
    .use(superscript)
    .use(footnote)
    .use(deflist)
    .use(abbreviation)
    .use(insert)
    .use(mark)
    .use(tasklists, { enabled: this.taskLists })
    this.renderHTML = this.renderHTML.bind(this)
  }
  handleEditorChange({html, md}) {
    console.log('handleEditorChange', html, md)
  }
  handleImageUpload(file, callback) {
    const reader = new FileReader()
    reader.onload = () => {      
      const convertBase64UrlToBlob = (urlData) => {  
        let arr = urlData.split(','), mime = arr[0].match(/:(.*?);/)[1]
        let bstr = atob(arr[1])
        let n = bstr.length
        let u8arr = new Uint8Array(n)
        while (n--) {
          u8arr[n] = bstr.charCodeAt(n)
        }
        return new Blob([u8arr], {type:mime})
      }
      const blob = convertBase64UrlToBlob(reader.result)
      setTimeout(() => {
        // setTimeout 模拟异步上传图片
        // 当异步上传获取图片地址后，执行calback回调（参数为imageUrl字符串），即可将图片地址写入markdown
        callback('https://avatars0.githubusercontent.com/u/21263805?s=40&v=4')
      }, 1000)
    }
    reader.readAsDataURL(file)
  }
  renderHTML(text) {
    // 模拟异步渲染Markdown
    return new Promise((resolve) => {
      setTimeout(() => {
        resolve(this.mdParser.render(text))
      }, 1000)
    })
  }
  handleGetMdValue = () => {   
    this.mdEditor && alert(this.mdEditor.getMdValue())      
  }
  handleGetHtmlValue = () => {    
    this.mdEditor && alert(this.mdEditor.getHtmlValue())
  }
  render() {
    return (      
      <div>
        <nav>
          <button onClick={this.handleGetMdValue} >getMdValue</button>  
          <button onClick={this.handleGetHtmlValue} >getHtmlValue</button>  
        </nav>
        <section style="height: 500px">
          <MdEditor 
            ref={node => this.mdEditor = node}
            value={MOCK_DATA}
            style={{height: '400px'}}
            renderHTML={this.renderHTML}
            config={{
              view: {
                menu: true,
                md: true,
                html: true
              },
              imageUrl: 'https://octodex.github.com/images/minion.png'
            }}
            onChange={this.handleEditorChange} 
            onImageUpload={this.handleImageUpload}
          />
        </section>                        
      </div>      
    )
  }
}
```

### 最后

   欢迎大家使用和反馈，[项目地址](https://github.com/HarryChen0506/react-markdown-editor-lite) (https://github.com/HarryChen0506/react-markdown-editor-lite)， 你的点赞将是我莫大的动力😊

![1.png](https://s3.ca-central-1.amazonaws.com/res-blog-public/res-dev/blog_1636946743939_1.png)', firstPicture='', viewCount=83, createDate='Sun Nov 07 14:09:29 EST 2021', updateDate='Tue Jan 18 22:54:08 EST 2022'}}, total=null}
2022-01-19 21:10:03:624 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 18ms
2022-01-19 21:10:03:624 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 21:10:03:626 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 21:10:03:627 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 21:10:03:627 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 21:10:03:627 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 21:10:03:627 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 21:10:03:627 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 21:10:03:627 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=32createdate=Wed Jan 19 20:27:15 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/4.png, replyComments=null, CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='ljh19911025@gmail.com', nickname='sfs@ss.c', parentCommentNickname='null', content='sds', status='0'}}, CommentListVo{commentId=31createdate=Wed Jan 19 20:17:39 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/58.png, replyComments=null, CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='ljh19911025@gmail.com', nickname='ivan', parentCommentNickname='null', content='sssssssss', status='0'}}, CommentListVo{commentId=30createdate=Wed Jan 19 20:17:20 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/78.png, replyComments=null, CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='sfsf', parentCommentNickname='null', content='djjsf', status='0'}}, CommentListVo{commentId=20createdate=Wed Jan 19 11:47:08 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/26.png, replyComments=[CommentListVo{commentId=21createdate=Wed Jan 19 11:47:21 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/89.png, replyComments=[CommentListVo{commentId=22createdate=Wed Jan 19 11:47:39 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/75.png, replyComments=null, CommentVo=CommentVo{parentCommentId=21, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='sfs@ss.c', content='eeeeee', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='tet', content='ree', status='0'}}, CommentListVo{commentId=27createdate=Wed Jan 19 17:01:06 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/2.png, replyComments=[CommentListVo{commentId=28createdate=Wed Jan 19 20:16:38 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/51.png, replyComments=null, CommentVo=CommentVo{parentCommentId=27, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='sds', content='dddd', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='ljh19911025@gmail.com', nickname='sds', parentCommentNickname='tet', content='wwww', status='0'}}, CommentListVo{commentId=29createdate=Wed Jan 19 20:17:06 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/99.png, replyComments=[CommentListVo{commentId=34createdate=Wed Jan 19 20:32:55 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/21.png, replyComments=null, CommentVo=CommentVo{parentCommentId=29, articleId=10005, email='ljh19911025@gmail.com', nickname='sfsf', parentCommentNickname='sfsf', content='dfd', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='test@gg.com', nickname='sfsf', parentCommentNickname='tet', content='reply tet', status='0'}}, CommentListVo{commentId=33createdate=Wed Jan 19 20:32:40 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/42.png, replyComments=null, CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='ljh19911025@gmail.com', nickname='ivan', parentCommentNickname='tet', content='ddd', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='tet', parentCommentNickname='null', content='etet', status='0'}}], total=4}
2022-01-19 21:10:03:627 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 20ms
2022-01-19 21:10:03:627 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 21:10:03:631 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 21:10:03:631 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 21:10:03:631 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 21:10:03:631 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 21:10:03:631 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 21:10:03:631 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 21:10:03:631 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=32createdate=Wed Jan 19 20:27:15 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/4.png, replyComments=null, CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='ljh19911025@gmail.com', nickname='sfs@ss.c', parentCommentNickname='null', content='sds', status='0'}}, CommentListVo{commentId=31createdate=Wed Jan 19 20:17:39 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/58.png, replyComments=null, CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='ljh19911025@gmail.com', nickname='ivan', parentCommentNickname='null', content='sssssssss', status='0'}}, CommentListVo{commentId=30createdate=Wed Jan 19 20:17:20 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/78.png, replyComments=null, CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='sfsf', parentCommentNickname='null', content='djjsf', status='0'}}, CommentListVo{commentId=20createdate=Wed Jan 19 11:47:08 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/26.png, replyComments=[CommentListVo{commentId=21createdate=Wed Jan 19 11:47:21 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/89.png, replyComments=[CommentListVo{commentId=22createdate=Wed Jan 19 11:47:39 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/75.png, replyComments=null, CommentVo=CommentVo{parentCommentId=21, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='sfs@ss.c', content='eeeeee', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='tet', content='ree', status='0'}}, CommentListVo{commentId=27createdate=Wed Jan 19 17:01:06 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/2.png, replyComments=[CommentListVo{commentId=28createdate=Wed Jan 19 20:16:38 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/51.png, replyComments=null, CommentVo=CommentVo{parentCommentId=27, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='sds', content='dddd', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='ljh19911025@gmail.com', nickname='sds', parentCommentNickname='tet', content='wwww', status='0'}}, CommentListVo{commentId=29createdate=Wed Jan 19 20:17:06 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/99.png, replyComments=[CommentListVo{commentId=34createdate=Wed Jan 19 20:32:55 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/21.png, replyComments=null, CommentVo=CommentVo{parentCommentId=29, articleId=10005, email='ljh19911025@gmail.com', nickname='sfsf', parentCommentNickname='sfsf', content='dfd', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='test@gg.com', nickname='sfsf', parentCommentNickname='tet', content='reply tet', status='0'}}, CommentListVo{commentId=33createdate=Wed Jan 19 20:32:40 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/42.png, replyComments=null, CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='ljh19911025@gmail.com', nickname='ivan', parentCommentNickname='tet', content='ddd', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='tet', parentCommentNickname='null', content='etet', status='0'}}], total=4}
2022-01-19 21:10:03:632 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 25ms
2022-01-19 21:10:03:632 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 21:10:04:203 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 21:10:04:204 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 21:10:04:204 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 21:10:04:204 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 21:10:04:204 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 21:10:04:204 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 21:10:04:204 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=32createdate=Wed Jan 19 20:27:15 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/4.png, replyComments=null, CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='ljh19911025@gmail.com', nickname='sfs@ss.c', parentCommentNickname='null', content='sds', status='0'}}, CommentListVo{commentId=31createdate=Wed Jan 19 20:17:39 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/58.png, replyComments=null, CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='ljh19911025@gmail.com', nickname='ivan', parentCommentNickname='null', content='sssssssss', status='0'}}, CommentListVo{commentId=30createdate=Wed Jan 19 20:17:20 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/78.png, replyComments=null, CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='sfsf', parentCommentNickname='null', content='djjsf', status='0'}}, CommentListVo{commentId=20createdate=Wed Jan 19 11:47:08 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/26.png, replyComments=[CommentListVo{commentId=21createdate=Wed Jan 19 11:47:21 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/89.png, replyComments=[CommentListVo{commentId=22createdate=Wed Jan 19 11:47:39 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/75.png, replyComments=null, CommentVo=CommentVo{parentCommentId=21, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='sfs@ss.c', content='eeeeee', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='tet', content='ree', status='0'}}, CommentListVo{commentId=27createdate=Wed Jan 19 17:01:06 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/2.png, replyComments=[CommentListVo{commentId=28createdate=Wed Jan 19 20:16:38 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/51.png, replyComments=null, CommentVo=CommentVo{parentCommentId=27, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='sds', content='dddd', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='ljh19911025@gmail.com', nickname='sds', parentCommentNickname='tet', content='wwww', status='0'}}, CommentListVo{commentId=29createdate=Wed Jan 19 20:17:06 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/99.png, replyComments=[CommentListVo{commentId=34createdate=Wed Jan 19 20:32:55 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/21.png, replyComments=null, CommentVo=CommentVo{parentCommentId=29, articleId=10005, email='ljh19911025@gmail.com', nickname='sfsf', parentCommentNickname='sfsf', content='dfd', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='test@gg.com', nickname='sfsf', parentCommentNickname='tet', content='reply tet', status='0'}}, CommentListVo{commentId=33createdate=Wed Jan 19 20:32:40 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/42.png, replyComments=null, CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='ljh19911025@gmail.com', nickname='ivan', parentCommentNickname='tet', content='ddd', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='tet', parentCommentNickname='null', content='etet', status='0'}}], total=4}
2022-01-19 21:10:04:204 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 12ms
2022-01-19 21:10:04:204 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 21:12:38:006 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 21:12:38:006 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 21:12:38:006 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: POST
2022-01-19 21:12:38:006 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment
2022-01-19 21:12:38:006 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.postComment
2022-01-19 21:12:38:006 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: CommentVo{parentCommentId=29, articleId=10005, email='sfs@ss.c', nickname='ivan', parentCommentNickname='sfsf', content='what?', status='null'}
2022-01-19 21:12:38:006 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=null, total=null}
2022-01-19 21:12:38:007 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 5ms
2022-01-19 21:12:38:007 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 21:12:38:026 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 21:12:38:026 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 21:12:38:026 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 21:12:38:026 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 21:12:38:026 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 21:12:38:026 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 21:12:38:026 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=32createdate=Wed Jan 19 20:27:15 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/4.png, replyComments=null, CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='ljh19911025@gmail.com', nickname='sfs@ss.c', parentCommentNickname='null', content='sds', status='0'}}, CommentListVo{commentId=31createdate=Wed Jan 19 20:17:39 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/58.png, replyComments=null, CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='ljh19911025@gmail.com', nickname='ivan', parentCommentNickname='null', content='sssssssss', status='0'}}, CommentListVo{commentId=30createdate=Wed Jan 19 20:17:20 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/78.png, replyComments=null, CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='sfsf', parentCommentNickname='null', content='djjsf', status='0'}}, CommentListVo{commentId=20createdate=Wed Jan 19 11:47:08 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/26.png, replyComments=[CommentListVo{commentId=21createdate=Wed Jan 19 11:47:21 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/89.png, replyComments=[CommentListVo{commentId=22createdate=Wed Jan 19 11:47:39 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/75.png, replyComments=null, CommentVo=CommentVo{parentCommentId=21, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='sfs@ss.c', content='eeeeee', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='tet', content='ree', status='0'}}, CommentListVo{commentId=27createdate=Wed Jan 19 17:01:06 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/2.png, replyComments=[CommentListVo{commentId=28createdate=Wed Jan 19 20:16:38 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/51.png, replyComments=null, CommentVo=CommentVo{parentCommentId=27, articleId=10005, email='sdfsd@Ck.com', nickname='sfs@ss.c', parentCommentNickname='sds', content='dddd', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='ljh19911025@gmail.com', nickname='sds', parentCommentNickname='tet', content='wwww', status='0'}}, CommentListVo{commentId=29createdate=Wed Jan 19 20:17:06 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/99.png, replyComments=[CommentListVo{commentId=34createdate=Wed Jan 19 20:32:55 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/21.png, replyComments=null, CommentVo=CommentVo{parentCommentId=29, articleId=10005, email='ljh19911025@gmail.com', nickname='sfsf', parentCommentNickname='sfsf', content='dfd', status='0'}}, CommentListVo{commentId=35createdate=Wed Jan 19 21:12:38 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/93.png, replyComments=null, CommentVo=CommentVo{parentCommentId=29, articleId=10005, email='sfs@ss.c', nickname='ivan', parentCommentNickname='sfsf', content='what?', status='0'}}], CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='test@gg.com', nickname='sfsf', parentCommentNickname='tet', content='reply tet', status='0'}}, CommentListVo{commentId=33createdate=Wed Jan 19 20:32:40 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/42.png, replyComments=null, CommentVo=CommentVo{parentCommentId=20, articleId=10005, email='ljh19911025@gmail.com', nickname='ivan', parentCommentNickname='tet', content='ddd', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='tet', parentCommentNickname='null', content='etet', status='0'}}], total=4}
2022-01-19 21:12:38:026 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 4ms
2022-01-19 21:12:38:026 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 21:15:45:465 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 21:15:45:465 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 21:15:45:466 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 21:15:45:466 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 21:15:45:466 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 21:15:45:466 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 21:15:45:466 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 21:15:45:466 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 21:15:45:466 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 21:15:45:466 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 21:15:45:466 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 21:15:45:466 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 21:15:45:466 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[], total=0}
2022-01-19 21:15:45:466 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[], total=0}
2022-01-19 21:15:45:466 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 5ms
2022-01-19 21:15:45:466 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 21:15:45:466 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 5ms
2022-01-19 21:15:45:466 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 21:15:45:470 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 21:15:45:470 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 21:15:45:470 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 21:15:45:470 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/article/10005
2022-01-19 21:15:45:470 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.ArticleController.getPublicArticleDetail
2022-01-19 21:15:45:470 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 21:15:45:470 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=ArticleVo{userInfo=UserInfoVo{userId=100001, nickName='ivan', userName='ivan', avatar='https://res-blog-public.s3.ca-central-1.amazonaws.com/default_avatar.jpg'}, category=CategoryVo{categoryId=1, name='Life ', articleCount=null}, BaseArticleVo{articleId=10005, status=1, type=1, title='dd', description='This is the doc of React markdown editor lite.
Enjoy!!', content='| Head | Head | Head | Head |
| --- | --- | --- | --- |
| Data | Data | Data | Data |
| Data | Data | Data | Data |

## 手把手教你写一个markdown编辑器

> 笔者在18年年末的时候接到一个开发任务——搭建一个AI项目的开放平台，其中的产品文档为转化为HTML格式的markdown文档。考虑到文档的即时更新，将文档信息做成了Ajax接口的形式。因此管理后台只需将textarea表单的内容通过markdown解析器进行HTML格式转化，然后将markdown内容和经转化的HTML文档都保存到数据库即可。
> 基本需求完成后，为了更好的用户体验，考虑将常用的编辑功能添加进来。改进版不仅支持了常用的文本编辑功能，还实现的UI界面的配置化，自定义语法解析器。本着造福伸手党的目的，以及积累些开源经验，笔者将该react 组件 [react-markdown-editor-lite](https://github.com/HarryChen0506/react-markdown-editor-lite) 进行了封装改造，并且发布到了开源社区。

### 预览
在线体验 [https://harrychen0506.github.io/react-markdown-editor-lite/](https://harrychen0506.github.io/react-markdown-editor-lite/)

![image](https://github.com//HarryChen0506/react-markdown-editor-lite/blob/master/image/react-markdown-editor-lite-v1.0.0.PNG?raw=true)

### 特点
* 轻量、基于React
* UI可配置, 如只显示编辑区或预览区
* 支持自定义markdown语法解析器,语法高亮等
* 支持常用的markdown编辑功能，如加粗，斜体等等...
* 支持功能按钮插拔化，用户可以自定义扩展组件
* 支持编辑区和预览区同步滚动

### 开发心得

- 文本编辑

  大多数常见的编辑器，包括富文本编辑器，利用了某些元素如div的contenteditable属性，配合selection、range、execCommand等API，实现了富文本编辑功能。这里面的实现比较复杂，所以有了"[为什么都说富文本编辑器是天坑？](https://www.zhihu.com/question/38699645)"这个说法。

  而markdown编辑器，核心的处理内容为简单语法的纯文本，复杂度相对来说比较低，并且input标签自带onSelect事件，可以很方便的获取选择信息（选择起始位置和选择文本值），因此要想实现编辑功能，只需将要改动的内容进行文本转换，然后进行重新拼接首尾，大功告成。
  
- markdown解析

  考察了几个社区流行的markdown解析器，比较流行的有[markdown](https://www.npmjs.com/package/markdown), [markdown-it](https://www.npmjs.com/package/markdown-it), [marked](https://www.npmjs.com/package/marked) 等等。综合考虑扩展性以及稳定性，笔者推荐使用markdown-it作为markdown的词法解析器，因为该解析器有比较多的插件，并且支持语法高亮。

- 同步滚动

  当选择分栏编辑的时候，滚动左侧的编辑区，右侧的预览区能自动滚动到对应的区域。方案参考了《[手把手教你用 100行代码实现基于 react的 markdown 输入 + 即时预览在线编辑器（一）](https://github.com/accforgit/blog-data/blob/master/%E5%9C%A8%E7%BA%BF%E7%BC%96%E8%BE%91%E5%99%A8/README/README1.md)》。只需先计算出输入框容器元素与预览框容器元素之间最大scroll范围的比例值，然后根据主动滚动元素自身的scrollTop做相应的比例换算，即可知道对方区域的scrollTop值。

- 关于UI
 
  - 项目的字体库选择了Font Awesome风格，并且只选取了项目所需要的一些图标。
  - 编辑器的整体css均可通过全局覆盖的形式进行自定义。目前暂时只支持灰色主题。
  - 编辑器的显示区域包括菜单栏，编辑器，预览区，工具栏，通过配置组件的config属性，可以选择默认的展示区域。
  
### Install

```js
npm install react-markdown-editor-lite --save
```

### Props

| Property | Description | Type | default | Remarks |
| --- | --- | --- | --- | --- |
| value | markdown content | String | '' | required |
| style | component container style | Object | {height: '100%'} | not required |
| config | component config | Object | {view: {...}, logger: {...}} | not required |
| onChange | emitting when editor has changed | Function | ({html, md}) => {} | not required |
| onImageUpload | when image uploaded, callback emitting will get image markdown text | (file: File, callback: (url: string) => void) => void; | ({file, callback}) => {} | not required |
| renderHTML | Render markdown text to HTML. You can return either string, function or Promise | (text: string) => string|function|Promise | none | **required** |

### Example

``` js
'use strict';
import React from 'react'
import ReactDOM from 'react-dom'
import MdEditor from 'react-markdown-editor-lite'
import MarkdownIt from 'markdown-it'
import emoji from 'markdown-it-emoji'
import subscript from 'markdown-it-sub'
import superscript from 'markdown-it-sup'
import footnote from 'markdown-it-footnote'
import deflist from 'markdown-it-deflist'
import abbreviation from 'markdown-it-abbr'
import insert from 'markdown-it-ins'
import mark from 'markdown-it-mark'
import tasklists from 'markdown-it-task-lists'
import hljs from 'highlight.js'
import 'highlight.js/styles/atom-one-light.css'
// import 'highlight.js/styles/github.css'
import './index.less';

const MOCK_DATA = "I Love React."
export default class Demo extends React.Component {
  mdEditor = null
  mdParser = null
  constructor(props) {
    super(props)
    // initial a parsera
    this.mdParser = new MarkdownIt({
      html: true,
      linkify: true,
      typographer: true,
      highlight: function (str, lang) {
        if (lang && hljs.getLanguage(lang)) {
          try {
            return hljs.highlight(lang, str).value
          } catch (__) {}
        }    
        return '' // use external default escaping
      }
    })
    .use(emoji)
    .use(subscript)
    .use(superscript)
    .use(footnote)
    .use(deflist)
    .use(abbreviation)
    .use(insert)
    .use(mark)
    .use(tasklists, { enabled: this.taskLists })
    this.renderHTML = this.renderHTML.bind(this)
  }
  handleEditorChange({html, md}) {
    console.log('handleEditorChange', html, md)
  }
  handleImageUpload(file, callback) {
    const reader = new FileReader()
    reader.onload = () => {      
      const convertBase64UrlToBlob = (urlData) => {  
        let arr = urlData.split(','), mime = arr[0].match(/:(.*?);/)[1]
        let bstr = atob(arr[1])
        let n = bstr.length
        let u8arr = new Uint8Array(n)
        while (n--) {
          u8arr[n] = bstr.charCodeAt(n)
        }
        return new Blob([u8arr], {type:mime})
      }
      const blob = convertBase64UrlToBlob(reader.result)
      setTimeout(() => {
        // setTimeout 模拟异步上传图片
        // 当异步上传获取图片地址后，执行calback回调（参数为imageUrl字符串），即可将图片地址写入markdown
        callback('https://avatars0.githubusercontent.com/u/21263805?s=40&v=4')
      }, 1000)
    }
    reader.readAsDataURL(file)
  }
  renderHTML(text) {
    // 模拟异步渲染Markdown
    return new Promise((resolve) => {
      setTimeout(() => {
        resolve(this.mdParser.render(text))
      }, 1000)
    })
  }
  handleGetMdValue = () => {   
    this.mdEditor && alert(this.mdEditor.getMdValue())      
  }
  handleGetHtmlValue = () => {    
    this.mdEditor && alert(this.mdEditor.getHtmlValue())
  }
  render() {
    return (      
      <div>
        <nav>
          <button onClick={this.handleGetMdValue} >getMdValue</button>  
          <button onClick={this.handleGetHtmlValue} >getHtmlValue</button>  
        </nav>
        <section style="height: 500px">
          <MdEditor 
            ref={node => this.mdEditor = node}
            value={MOCK_DATA}
            style={{height: '400px'}}
            renderHTML={this.renderHTML}
            config={{
              view: {
                menu: true,
                md: true,
                html: true
              },
              imageUrl: 'https://octodex.github.com/images/minion.png'
            }}
            onChange={this.handleEditorChange} 
            onImageUpload={this.handleImageUpload}
          />
        </section>                        
      </div>      
    )
  }
}
```

### 最后

   欢迎大家使用和反馈，[项目地址](https://github.com/HarryChen0506/react-markdown-editor-lite) (https://github.com/HarryChen0506/react-markdown-editor-lite)， 你的点赞将是我莫大的动力😊

![1.png](https://s3.ca-central-1.amazonaws.com/res-blog-public/res-dev/blog_1636946743939_1.png)', firstPicture='', viewCount=83, createDate='Sun Nov 07 14:09:29 EST 2021', updateDate='Tue Jan 18 22:54:08 EST 2022'}}, total=null}
2022-01-19 21:15:45:470 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 7ms
2022-01-19 21:15:45:470 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 21:15:45:973 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 21:15:45:973 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 21:15:45:973 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 21:15:45:973 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 21:15:45:973 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 21:15:45:973 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 21:15:45:973 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[], total=0}
2022-01-19 21:15:45:973 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 4ms
2022-01-19 21:15:45:973 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 21:15:59:500 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 21:15:59:500 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 21:15:59:500 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: POST
2022-01-19 21:15:59:500 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment
2022-01-19 21:15:59:500 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.postComment
2022-01-19 21:15:59:500 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: CommentVo{parentCommentId=null, articleId=10005, email='1@11.com', nickname='1', parentCommentNickname='null', content='1', status='null'}
2022-01-19 21:15:59:500 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=null, total=null}
2022-01-19 21:15:59:500 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 2ms
2022-01-19 21:15:59:500 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 21:15:59:522 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 21:15:59:522 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 21:15:59:522 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 21:15:59:522 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 21:15:59:522 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 21:15:59:522 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 21:15:59:522 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=36createdate=Wed Jan 19 21:15:59 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/19.png, replyComments=null, CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='1@11.com', nickname='1', parentCommentNickname='null', content='1', status='0'}}], total=1}
2022-01-19 21:15:59:523 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 1ms
2022-01-19 21:15:59:523 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 21:16:11:587 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 21:16:11:587 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 21:16:11:587 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: POST
2022-01-19 21:16:11:587 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment
2022-01-19 21:16:11:587 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.postComment
2022-01-19 21:16:11:587 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: CommentVo{parentCommentId=36, articleId=10005, email='2sdf@dd.c', nickname='2', parentCommentNickname='1', content='2', status='null'}
2022-01-19 21:16:11:587 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=null, total=null}
2022-01-19 21:16:11:587 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 2ms
2022-01-19 21:16:11:587 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 21:16:11:606 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 21:16:11:606 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 21:16:11:606 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 21:16:11:606 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 21:16:11:606 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 21:16:11:606 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 21:16:11:606 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=36createdate=Wed Jan 19 21:15:59 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/19.png, replyComments=[CommentListVo{commentId=37createdate=Wed Jan 19 21:16:11 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/46.png, replyComments=null, CommentVo=CommentVo{parentCommentId=36, articleId=10005, email='2sdf@dd.c', nickname='2', parentCommentNickname='1', content='2', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='1@11.com', nickname='1', parentCommentNickname='null', content='1', status='0'}}], total=1}
2022-01-19 21:16:11:606 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 2ms
2022-01-19 21:16:11:606 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 21:16:27:115 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 21:16:27:115 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 21:16:27:115 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: POST
2022-01-19 21:16:27:115 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment
2022-01-19 21:16:27:115 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.postComment
2022-01-19 21:16:27:115 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: CommentVo{parentCommentId=37, articleId=10005, email='sdfsd@Ck.com', nickname='2.1', parentCommentNickname='2', content='2.1', status='null'}
2022-01-19 21:16:27:115 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=null, total=null}
2022-01-19 21:16:27:115 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 3ms
2022-01-19 21:16:27:115 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 21:16:27:133 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 21:16:27:133 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 21:16:27:133 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 21:16:27:133 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 21:16:27:133 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 21:16:27:133 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 21:16:27:133 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=36createdate=Wed Jan 19 21:15:59 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/19.png, replyComments=[CommentListVo{commentId=37createdate=Wed Jan 19 21:16:11 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/46.png, replyComments=[CommentListVo{commentId=38createdate=Wed Jan 19 21:16:27 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/95.png, replyComments=null, CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sdfsd@Ck.com', nickname='2.1', parentCommentNickname='2', content='2.1', status='0'}}], CommentVo=CommentVo{parentCommentId=36, articleId=10005, email='2sdf@dd.c', nickname='2', parentCommentNickname='1', content='2', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='1@11.com', nickname='1', parentCommentNickname='null', content='1', status='0'}}], total=1}
2022-01-19 21:16:27:133 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 2ms
2022-01-19 21:16:27:133 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 21:22:25:725 [HikariPool-1 housekeeper] WARN  com.zaxxer.hikari.pool.HikariPool HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=3m5s617ms).
2022-01-19 21:35:11:601 [HikariPool-1 housekeeper] WARN  com.zaxxer.hikari.pool.HikariPool HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=8m15s842ms).
2022-01-19 21:47:09:341 [HikariPool-1 housekeeper] WARN  com.zaxxer.hikari.pool.HikariPool HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=6m57s712ms).
2022-01-19 21:57:50:169 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 21:57:50:170 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 21:57:50:170 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 21:57:50:170 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 21:57:50:170 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 21:57:50:170 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 21:57:50:170 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 21:57:50:170 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 21:57:50:170 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 21:57:50:170 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 21:57:50:170 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 21:57:50:170 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=36createdate=Wed Jan 19 21:15:59 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/19.png, replyComments=[CommentListVo{commentId=37createdate=Wed Jan 19 21:16:11 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/46.png, replyComments=[CommentListVo{commentId=38createdate=Wed Jan 19 21:16:27 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/95.png, replyComments=null, CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sdfsd@Ck.com', nickname='2.1', parentCommentNickname='2', content='2.1', status='0'}}], CommentVo=CommentVo{parentCommentId=36, articleId=10005, email='2sdf@dd.c', nickname='2', parentCommentNickname='1', content='2', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='1@11.com', nickname='1', parentCommentNickname='null', content='1', status='0'}}], total=1}
2022-01-19 21:57:50:170 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 21:57:50:170 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 7ms
2022-01-19 21:57:50:170 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 21:57:50:170 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=36createdate=Wed Jan 19 21:15:59 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/19.png, replyComments=[CommentListVo{commentId=37createdate=Wed Jan 19 21:16:11 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/46.png, replyComments=[CommentListVo{commentId=38createdate=Wed Jan 19 21:16:27 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/95.png, replyComments=null, CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sdfsd@Ck.com', nickname='2.1', parentCommentNickname='2', content='2.1', status='0'}}], CommentVo=CommentVo{parentCommentId=36, articleId=10005, email='2sdf@dd.c', nickname='2', parentCommentNickname='1', content='2', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='1@11.com', nickname='1', parentCommentNickname='null', content='1', status='0'}}], total=1}
2022-01-19 21:57:50:170 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 8ms
2022-01-19 21:57:50:170 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 21:57:50:175 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 21:57:50:175 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 21:57:50:175 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 21:57:50:175 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/article/10005
2022-01-19 21:57:50:176 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.ArticleController.getPublicArticleDetail
2022-01-19 21:57:50:176 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 21:57:50:176 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=ArticleVo{userInfo=UserInfoVo{userId=100001, nickName='ivan', userName='ivan', avatar='https://res-blog-public.s3.ca-central-1.amazonaws.com/default_avatar.jpg'}, category=CategoryVo{categoryId=1, name='Life ', articleCount=null}, BaseArticleVo{articleId=10005, status=1, type=1, title='dd', description='This is the doc of React markdown editor lite.
Enjoy!!', content='| Head | Head | Head | Head |
| --- | --- | --- | --- |
| Data | Data | Data | Data |
| Data | Data | Data | Data |

## 手把手教你写一个markdown编辑器

> 笔者在18年年末的时候接到一个开发任务——搭建一个AI项目的开放平台，其中的产品文档为转化为HTML格式的markdown文档。考虑到文档的即时更新，将文档信息做成了Ajax接口的形式。因此管理后台只需将textarea表单的内容通过markdown解析器进行HTML格式转化，然后将markdown内容和经转化的HTML文档都保存到数据库即可。
> 基本需求完成后，为了更好的用户体验，考虑将常用的编辑功能添加进来。改进版不仅支持了常用的文本编辑功能，还实现的UI界面的配置化，自定义语法解析器。本着造福伸手党的目的，以及积累些开源经验，笔者将该react 组件 [react-markdown-editor-lite](https://github.com/HarryChen0506/react-markdown-editor-lite) 进行了封装改造，并且发布到了开源社区。

### 预览
在线体验 [https://harrychen0506.github.io/react-markdown-editor-lite/](https://harrychen0506.github.io/react-markdown-editor-lite/)

![image](https://github.com//HarryChen0506/react-markdown-editor-lite/blob/master/image/react-markdown-editor-lite-v1.0.0.PNG?raw=true)

### 特点
* 轻量、基于React
* UI可配置, 如只显示编辑区或预览区
* 支持自定义markdown语法解析器,语法高亮等
* 支持常用的markdown编辑功能，如加粗，斜体等等...
* 支持功能按钮插拔化，用户可以自定义扩展组件
* 支持编辑区和预览区同步滚动

### 开发心得

- 文本编辑

  大多数常见的编辑器，包括富文本编辑器，利用了某些元素如div的contenteditable属性，配合selection、range、execCommand等API，实现了富文本编辑功能。这里面的实现比较复杂，所以有了"[为什么都说富文本编辑器是天坑？](https://www.zhihu.com/question/38699645)"这个说法。

  而markdown编辑器，核心的处理内容为简单语法的纯文本，复杂度相对来说比较低，并且input标签自带onSelect事件，可以很方便的获取选择信息（选择起始位置和选择文本值），因此要想实现编辑功能，只需将要改动的内容进行文本转换，然后进行重新拼接首尾，大功告成。
  
- markdown解析

  考察了几个社区流行的markdown解析器，比较流行的有[markdown](https://www.npmjs.com/package/markdown), [markdown-it](https://www.npmjs.com/package/markdown-it), [marked](https://www.npmjs.com/package/marked) 等等。综合考虑扩展性以及稳定性，笔者推荐使用markdown-it作为markdown的词法解析器，因为该解析器有比较多的插件，并且支持语法高亮。

- 同步滚动

  当选择分栏编辑的时候，滚动左侧的编辑区，右侧的预览区能自动滚动到对应的区域。方案参考了《[手把手教你用 100行代码实现基于 react的 markdown 输入 + 即时预览在线编辑器（一）](https://github.com/accforgit/blog-data/blob/master/%E5%9C%A8%E7%BA%BF%E7%BC%96%E8%BE%91%E5%99%A8/README/README1.md)》。只需先计算出输入框容器元素与预览框容器元素之间最大scroll范围的比例值，然后根据主动滚动元素自身的scrollTop做相应的比例换算，即可知道对方区域的scrollTop值。

- 关于UI
 
  - 项目的字体库选择了Font Awesome风格，并且只选取了项目所需要的一些图标。
  - 编辑器的整体css均可通过全局覆盖的形式进行自定义。目前暂时只支持灰色主题。
  - 编辑器的显示区域包括菜单栏，编辑器，预览区，工具栏，通过配置组件的config属性，可以选择默认的展示区域。
  
### Install

```js
npm install react-markdown-editor-lite --save
```

### Props

| Property | Description | Type | default | Remarks |
| --- | --- | --- | --- | --- |
| value | markdown content | String | '' | required |
| style | component container style | Object | {height: '100%'} | not required |
| config | component config | Object | {view: {...}, logger: {...}} | not required |
| onChange | emitting when editor has changed | Function | ({html, md}) => {} | not required |
| onImageUpload | when image uploaded, callback emitting will get image markdown text | (file: File, callback: (url: string) => void) => void; | ({file, callback}) => {} | not required |
| renderHTML | Render markdown text to HTML. You can return either string, function or Promise | (text: string) => string|function|Promise | none | **required** |

### Example

``` js
'use strict';
import React from 'react'
import ReactDOM from 'react-dom'
import MdEditor from 'react-markdown-editor-lite'
import MarkdownIt from 'markdown-it'
import emoji from 'markdown-it-emoji'
import subscript from 'markdown-it-sub'
import superscript from 'markdown-it-sup'
import footnote from 'markdown-it-footnote'
import deflist from 'markdown-it-deflist'
import abbreviation from 'markdown-it-abbr'
import insert from 'markdown-it-ins'
import mark from 'markdown-it-mark'
import tasklists from 'markdown-it-task-lists'
import hljs from 'highlight.js'
import 'highlight.js/styles/atom-one-light.css'
// import 'highlight.js/styles/github.css'
import './index.less';

const MOCK_DATA = "I Love React."
export default class Demo extends React.Component {
  mdEditor = null
  mdParser = null
  constructor(props) {
    super(props)
    // initial a parsera
    this.mdParser = new MarkdownIt({
      html: true,
      linkify: true,
      typographer: true,
      highlight: function (str, lang) {
        if (lang && hljs.getLanguage(lang)) {
          try {
            return hljs.highlight(lang, str).value
          } catch (__) {}
        }    
        return '' // use external default escaping
      }
    })
    .use(emoji)
    .use(subscript)
    .use(superscript)
    .use(footnote)
    .use(deflist)
    .use(abbreviation)
    .use(insert)
    .use(mark)
    .use(tasklists, { enabled: this.taskLists })
    this.renderHTML = this.renderHTML.bind(this)
  }
  handleEditorChange({html, md}) {
    console.log('handleEditorChange', html, md)
  }
  handleImageUpload(file, callback) {
    const reader = new FileReader()
    reader.onload = () => {      
      const convertBase64UrlToBlob = (urlData) => {  
        let arr = urlData.split(','), mime = arr[0].match(/:(.*?);/)[1]
        let bstr = atob(arr[1])
        let n = bstr.length
        let u8arr = new Uint8Array(n)
        while (n--) {
          u8arr[n] = bstr.charCodeAt(n)
        }
        return new Blob([u8arr], {type:mime})
      }
      const blob = convertBase64UrlToBlob(reader.result)
      setTimeout(() => {
        // setTimeout 模拟异步上传图片
        // 当异步上传获取图片地址后，执行calback回调（参数为imageUrl字符串），即可将图片地址写入markdown
        callback('https://avatars0.githubusercontent.com/u/21263805?s=40&v=4')
      }, 1000)
    }
    reader.readAsDataURL(file)
  }
  renderHTML(text) {
    // 模拟异步渲染Markdown
    return new Promise((resolve) => {
      setTimeout(() => {
        resolve(this.mdParser.render(text))
      }, 1000)
    })
  }
  handleGetMdValue = () => {   
    this.mdEditor && alert(this.mdEditor.getMdValue())      
  }
  handleGetHtmlValue = () => {    
    this.mdEditor && alert(this.mdEditor.getHtmlValue())
  }
  render() {
    return (      
      <div>
        <nav>
          <button onClick={this.handleGetMdValue} >getMdValue</button>  
          <button onClick={this.handleGetHtmlValue} >getHtmlValue</button>  
        </nav>
        <section style="height: 500px">
          <MdEditor 
            ref={node => this.mdEditor = node}
            value={MOCK_DATA}
            style={{height: '400px'}}
            renderHTML={this.renderHTML}
            config={{
              view: {
                menu: true,
                md: true,
                html: true
              },
              imageUrl: 'https://octodex.github.com/images/minion.png'
            }}
            onChange={this.handleEditorChange} 
            onImageUpload={this.handleImageUpload}
          />
        </section>                        
      </div>      
    )
  }
}
```

### 最后

   欢迎大家使用和反馈，[项目地址](https://github.com/HarryChen0506/react-markdown-editor-lite) (https://github.com/HarryChen0506/react-markdown-editor-lite)， 你的点赞将是我莫大的动力😊

![1.png](https://s3.ca-central-1.amazonaws.com/res-blog-public/res-dev/blog_1636946743939_1.png)', firstPicture='', viewCount=83, createDate='Sun Nov 07 14:09:29 EST 2021', updateDate='Tue Jan 18 22:54:08 EST 2022'}}, total=null}
2022-01-19 21:57:50:176 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 16ms
2022-01-19 21:57:50:176 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 21:57:50:253 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 21:57:50:253 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 21:57:50:253 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 21:57:50:253 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 21:57:50:253 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 21:57:50:253 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 21:57:50:253 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=36createdate=Wed Jan 19 21:15:59 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/19.png, replyComments=[CommentListVo{commentId=37createdate=Wed Jan 19 21:16:11 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/46.png, replyComments=[CommentListVo{commentId=38createdate=Wed Jan 19 21:16:27 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/95.png, replyComments=null, CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sdfsd@Ck.com', nickname='2.1', parentCommentNickname='2', content='2.1', status='0'}}], CommentVo=CommentVo{parentCommentId=36, articleId=10005, email='2sdf@dd.c', nickname='2', parentCommentNickname='1', content='2', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='1@11.com', nickname='1', parentCommentNickname='null', content='1', status='0'}}], total=1}
2022-01-19 21:57:50:253 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 4ms
2022-01-19 21:57:50:253 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 21:58:04:680 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 21:58:04:680 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 21:58:04:680 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 21:58:04:680 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 21:58:04:680 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 21:58:04:680 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 21:58:04:680 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=36createdate=Wed Jan 19 21:15:59 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/19.png, replyComments=[CommentListVo{commentId=37createdate=Wed Jan 19 21:16:11 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/46.png, replyComments=[CommentListVo{commentId=38createdate=Wed Jan 19 21:16:27 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/95.png, replyComments=null, CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sdfsd@Ck.com', nickname='2.1', parentCommentNickname='2', content='2.1', status='0'}}], CommentVo=CommentVo{parentCommentId=36, articleId=10005, email='2sdf@dd.c', nickname='2', parentCommentNickname='1', content='2', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='1@11.com', nickname='1', parentCommentNickname='null', content='1', status='0'}}], total=1}
2022-01-19 21:58:04:681 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 16ms
2022-01-19 21:58:04:681 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 21:58:04:692 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 21:58:04:692 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 21:58:04:692 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 21:58:04:692 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/article/10005
2022-01-19 21:58:04:692 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.ArticleController.getPublicArticleDetail
2022-01-19 21:58:04:692 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 21:58:04:692 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=ArticleVo{userInfo=UserInfoVo{userId=100001, nickName='ivan', userName='ivan', avatar='https://res-blog-public.s3.ca-central-1.amazonaws.com/default_avatar.jpg'}, category=CategoryVo{categoryId=1, name='Life ', articleCount=null}, BaseArticleVo{articleId=10005, status=1, type=1, title='dd', description='This is the doc of React markdown editor lite.
Enjoy!!', content='| Head | Head | Head | Head |
| --- | --- | --- | --- |
| Data | Data | Data | Data |
| Data | Data | Data | Data |

## 手把手教你写一个markdown编辑器

> 笔者在18年年末的时候接到一个开发任务——搭建一个AI项目的开放平台，其中的产品文档为转化为HTML格式的markdown文档。考虑到文档的即时更新，将文档信息做成了Ajax接口的形式。因此管理后台只需将textarea表单的内容通过markdown解析器进行HTML格式转化，然后将markdown内容和经转化的HTML文档都保存到数据库即可。
> 基本需求完成后，为了更好的用户体验，考虑将常用的编辑功能添加进来。改进版不仅支持了常用的文本编辑功能，还实现的UI界面的配置化，自定义语法解析器。本着造福伸手党的目的，以及积累些开源经验，笔者将该react 组件 [react-markdown-editor-lite](https://github.com/HarryChen0506/react-markdown-editor-lite) 进行了封装改造，并且发布到了开源社区。

### 预览
在线体验 [https://harrychen0506.github.io/react-markdown-editor-lite/](https://harrychen0506.github.io/react-markdown-editor-lite/)

![image](https://github.com//HarryChen0506/react-markdown-editor-lite/blob/master/image/react-markdown-editor-lite-v1.0.0.PNG?raw=true)

### 特点
* 轻量、基于React
* UI可配置, 如只显示编辑区或预览区
* 支持自定义markdown语法解析器,语法高亮等
* 支持常用的markdown编辑功能，如加粗，斜体等等...
* 支持功能按钮插拔化，用户可以自定义扩展组件
* 支持编辑区和预览区同步滚动

### 开发心得

- 文本编辑

  大多数常见的编辑器，包括富文本编辑器，利用了某些元素如div的contenteditable属性，配合selection、range、execCommand等API，实现了富文本编辑功能。这里面的实现比较复杂，所以有了"[为什么都说富文本编辑器是天坑？](https://www.zhihu.com/question/38699645)"这个说法。

  而markdown编辑器，核心的处理内容为简单语法的纯文本，复杂度相对来说比较低，并且input标签自带onSelect事件，可以很方便的获取选择信息（选择起始位置和选择文本值），因此要想实现编辑功能，只需将要改动的内容进行文本转换，然后进行重新拼接首尾，大功告成。
  
- markdown解析

  考察了几个社区流行的markdown解析器，比较流行的有[markdown](https://www.npmjs.com/package/markdown), [markdown-it](https://www.npmjs.com/package/markdown-it), [marked](https://www.npmjs.com/package/marked) 等等。综合考虑扩展性以及稳定性，笔者推荐使用markdown-it作为markdown的词法解析器，因为该解析器有比较多的插件，并且支持语法高亮。

- 同步滚动

  当选择分栏编辑的时候，滚动左侧的编辑区，右侧的预览区能自动滚动到对应的区域。方案参考了《[手把手教你用 100行代码实现基于 react的 markdown 输入 + 即时预览在线编辑器（一）](https://github.com/accforgit/blog-data/blob/master/%E5%9C%A8%E7%BA%BF%E7%BC%96%E8%BE%91%E5%99%A8/README/README1.md)》。只需先计算出输入框容器元素与预览框容器元素之间最大scroll范围的比例值，然后根据主动滚动元素自身的scrollTop做相应的比例换算，即可知道对方区域的scrollTop值。

- 关于UI
 
  - 项目的字体库选择了Font Awesome风格，并且只选取了项目所需要的一些图标。
  - 编辑器的整体css均可通过全局覆盖的形式进行自定义。目前暂时只支持灰色主题。
  - 编辑器的显示区域包括菜单栏，编辑器，预览区，工具栏，通过配置组件的config属性，可以选择默认的展示区域。
  
### Install

```js
npm install react-markdown-editor-lite --save
```

### Props

| Property | Description | Type | default | Remarks |
| --- | --- | --- | --- | --- |
| value | markdown content | String | '' | required |
| style | component container style | Object | {height: '100%'} | not required |
| config | component config | Object | {view: {...}, logger: {...}} | not required |
| onChange | emitting when editor has changed | Function | ({html, md}) => {} | not required |
| onImageUpload | when image uploaded, callback emitting will get image markdown text | (file: File, callback: (url: string) => void) => void; | ({file, callback}) => {} | not required |
| renderHTML | Render markdown text to HTML. You can return either string, function or Promise | (text: string) => string|function|Promise | none | **required** |

### Example

``` js
'use strict';
import React from 'react'
import ReactDOM from 'react-dom'
import MdEditor from 'react-markdown-editor-lite'
import MarkdownIt from 'markdown-it'
import emoji from 'markdown-it-emoji'
import subscript from 'markdown-it-sub'
import superscript from 'markdown-it-sup'
import footnote from 'markdown-it-footnote'
import deflist from 'markdown-it-deflist'
import abbreviation from 'markdown-it-abbr'
import insert from 'markdown-it-ins'
import mark from 'markdown-it-mark'
import tasklists from 'markdown-it-task-lists'
import hljs from 'highlight.js'
import 'highlight.js/styles/atom-one-light.css'
// import 'highlight.js/styles/github.css'
import './index.less';

const MOCK_DATA = "I Love React."
export default class Demo extends React.Component {
  mdEditor = null
  mdParser = null
  constructor(props) {
    super(props)
    // initial a parsera
    this.mdParser = new MarkdownIt({
      html: true,
      linkify: true,
      typographer: true,
      highlight: function (str, lang) {
        if (lang && hljs.getLanguage(lang)) {
          try {
            return hljs.highlight(lang, str).value
          } catch (__) {}
        }    
        return '' // use external default escaping
      }
    })
    .use(emoji)
    .use(subscript)
    .use(superscript)
    .use(footnote)
    .use(deflist)
    .use(abbreviation)
    .use(insert)
    .use(mark)
    .use(tasklists, { enabled: this.taskLists })
    this.renderHTML = this.renderHTML.bind(this)
  }
  handleEditorChange({html, md}) {
    console.log('handleEditorChange', html, md)
  }
  handleImageUpload(file, callback) {
    const reader = new FileReader()
    reader.onload = () => {      
      const convertBase64UrlToBlob = (urlData) => {  
        let arr = urlData.split(','), mime = arr[0].match(/:(.*?);/)[1]
        let bstr = atob(arr[1])
        let n = bstr.length
        let u8arr = new Uint8Array(n)
        while (n--) {
          u8arr[n] = bstr.charCodeAt(n)
        }
        return new Blob([u8arr], {type:mime})
      }
      const blob = convertBase64UrlToBlob(reader.result)
      setTimeout(() => {
        // setTimeout 模拟异步上传图片
        // 当异步上传获取图片地址后，执行calback回调（参数为imageUrl字符串），即可将图片地址写入markdown
        callback('https://avatars0.githubusercontent.com/u/21263805?s=40&v=4')
      }, 1000)
    }
    reader.readAsDataURL(file)
  }
  renderHTML(text) {
    // 模拟异步渲染Markdown
    return new Promise((resolve) => {
      setTimeout(() => {
        resolve(this.mdParser.render(text))
      }, 1000)
    })
  }
  handleGetMdValue = () => {   
    this.mdEditor && alert(this.mdEditor.getMdValue())      
  }
  handleGetHtmlValue = () => {    
    this.mdEditor && alert(this.mdEditor.getHtmlValue())
  }
  render() {
    return (      
      <div>
        <nav>
          <button onClick={this.handleGetMdValue} >getMdValue</button>  
          <button onClick={this.handleGetHtmlValue} >getHtmlValue</button>  
        </nav>
        <section style="height: 500px">
          <MdEditor 
            ref={node => this.mdEditor = node}
            value={MOCK_DATA}
            style={{height: '400px'}}
            renderHTML={this.renderHTML}
            config={{
              view: {
                menu: true,
                md: true,
                html: true
              },
              imageUrl: 'https://octodex.github.com/images/minion.png'
            }}
            onChange={this.handleEditorChange} 
            onImageUpload={this.handleImageUpload}
          />
        </section>                        
      </div>      
    )
  }
}
```

### 最后

   欢迎大家使用和反馈，[项目地址](https://github.com/HarryChen0506/react-markdown-editor-lite) (https://github.com/HarryChen0506/react-markdown-editor-lite)， 你的点赞将是我莫大的动力😊

![1.png](https://s3.ca-central-1.amazonaws.com/res-blog-public/res-dev/blog_1636946743939_1.png)', firstPicture='', viewCount=83, createDate='Sun Nov 07 14:09:29 EST 2021', updateDate='Tue Jan 18 22:54:08 EST 2022'}}, total=null}
2022-01-19 21:58:04:692 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 32ms
2022-01-19 21:58:04:692 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 21:58:04:709 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 21:58:04:709 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 21:58:04:709 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 21:58:04:709 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 21:58:04:709 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 21:58:04:709 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 21:58:04:709 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=36createdate=Wed Jan 19 21:15:59 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/19.png, replyComments=[CommentListVo{commentId=37createdate=Wed Jan 19 21:16:11 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/46.png, replyComments=[CommentListVo{commentId=38createdate=Wed Jan 19 21:16:27 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/95.png, replyComments=null, CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sdfsd@Ck.com', nickname='2.1', parentCommentNickname='2', content='2.1', status='0'}}], CommentVo=CommentVo{parentCommentId=36, articleId=10005, email='2sdf@dd.c', nickname='2', parentCommentNickname='1', content='2', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='1@11.com', nickname='1', parentCommentNickname='null', content='1', status='0'}}], total=1}
2022-01-19 21:58:04:709 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 48ms
2022-01-19 21:58:04:709 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 21:58:05:210 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 21:58:05:210 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 21:58:05:210 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 21:58:05:210 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 21:58:05:210 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 21:58:05:210 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 21:58:05:210 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=36createdate=Wed Jan 19 21:15:59 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/19.png, replyComments=[CommentListVo{commentId=37createdate=Wed Jan 19 21:16:11 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/46.png, replyComments=[CommentListVo{commentId=38createdate=Wed Jan 19 21:16:27 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/95.png, replyComments=null, CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sdfsd@Ck.com', nickname='2.1', parentCommentNickname='2', content='2.1', status='0'}}], CommentVo=CommentVo{parentCommentId=36, articleId=10005, email='2sdf@dd.c', nickname='2', parentCommentNickname='1', content='2', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='1@11.com', nickname='1', parentCommentNickname='null', content='1', status='0'}}], total=1}
2022-01-19 21:58:05:210 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 2ms
2022-01-19 21:58:05:210 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 21:58:59:951 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 21:58:59:951 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 21:58:59:951 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 21:58:59:951 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 21:58:59:951 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 21:58:59:951 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 21:58:59:951 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=36createdate=Wed Jan 19 21:15:59 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/19.png, replyComments=[CommentListVo{commentId=37createdate=Wed Jan 19 21:16:11 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/46.png, replyComments=[CommentListVo{commentId=38createdate=Wed Jan 19 21:16:27 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/95.png, replyComments=null, CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sdfsd@Ck.com', nickname='2.1', parentCommentNickname='2', content='2.1', status='0'}}], CommentVo=CommentVo{parentCommentId=36, articleId=10005, email='2sdf@dd.c', nickname='2', parentCommentNickname='1', content='2', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='1@11.com', nickname='1', parentCommentNickname='null', content='1', status='0'}}], total=1}
2022-01-19 21:58:59:951 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 13ms
2022-01-19 21:58:59:951 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 21:58:59:952 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 21:58:59:952 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 21:58:59:952 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 21:58:59:952 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 21:58:59:952 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 21:58:59:952 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 21:58:59:952 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=36createdate=Wed Jan 19 21:15:59 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/19.png, replyComments=[CommentListVo{commentId=37createdate=Wed Jan 19 21:16:11 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/46.png, replyComments=[CommentListVo{commentId=38createdate=Wed Jan 19 21:16:27 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/95.png, replyComments=null, CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sdfsd@Ck.com', nickname='2.1', parentCommentNickname='2', content='2.1', status='0'}}], CommentVo=CommentVo{parentCommentId=36, articleId=10005, email='2sdf@dd.c', nickname='2', parentCommentNickname='1', content='2', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='1@11.com', nickname='1', parentCommentNickname='null', content='1', status='0'}}], total=1}
2022-01-19 21:58:59:952 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 14ms
2022-01-19 21:58:59:952 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 21:58:59:960 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 21:58:59:960 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 21:58:59:960 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 21:58:59:960 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/article/10005
2022-01-19 21:58:59:960 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.ArticleController.getPublicArticleDetail
2022-01-19 21:58:59:960 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 21:58:59:960 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=ArticleVo{userInfo=UserInfoVo{userId=100001, nickName='ivan', userName='ivan', avatar='https://res-blog-public.s3.ca-central-1.amazonaws.com/default_avatar.jpg'}, category=CategoryVo{categoryId=1, name='Life ', articleCount=null}, BaseArticleVo{articleId=10005, status=1, type=1, title='dd', description='This is the doc of React markdown editor lite.
Enjoy!!', content='| Head | Head | Head | Head |
| --- | --- | --- | --- |
| Data | Data | Data | Data |
| Data | Data | Data | Data |

## 手把手教你写一个markdown编辑器

> 笔者在18年年末的时候接到一个开发任务——搭建一个AI项目的开放平台，其中的产品文档为转化为HTML格式的markdown文档。考虑到文档的即时更新，将文档信息做成了Ajax接口的形式。因此管理后台只需将textarea表单的内容通过markdown解析器进行HTML格式转化，然后将markdown内容和经转化的HTML文档都保存到数据库即可。
> 基本需求完成后，为了更好的用户体验，考虑将常用的编辑功能添加进来。改进版不仅支持了常用的文本编辑功能，还实现的UI界面的配置化，自定义语法解析器。本着造福伸手党的目的，以及积累些开源经验，笔者将该react 组件 [react-markdown-editor-lite](https://github.com/HarryChen0506/react-markdown-editor-lite) 进行了封装改造，并且发布到了开源社区。

### 预览
在线体验 [https://harrychen0506.github.io/react-markdown-editor-lite/](https://harrychen0506.github.io/react-markdown-editor-lite/)

![image](https://github.com//HarryChen0506/react-markdown-editor-lite/blob/master/image/react-markdown-editor-lite-v1.0.0.PNG?raw=true)

### 特点
* 轻量、基于React
* UI可配置, 如只显示编辑区或预览区
* 支持自定义markdown语法解析器,语法高亮等
* 支持常用的markdown编辑功能，如加粗，斜体等等...
* 支持功能按钮插拔化，用户可以自定义扩展组件
* 支持编辑区和预览区同步滚动

### 开发心得

- 文本编辑

  大多数常见的编辑器，包括富文本编辑器，利用了某些元素如div的contenteditable属性，配合selection、range、execCommand等API，实现了富文本编辑功能。这里面的实现比较复杂，所以有了"[为什么都说富文本编辑器是天坑？](https://www.zhihu.com/question/38699645)"这个说法。

  而markdown编辑器，核心的处理内容为简单语法的纯文本，复杂度相对来说比较低，并且input标签自带onSelect事件，可以很方便的获取选择信息（选择起始位置和选择文本值），因此要想实现编辑功能，只需将要改动的内容进行文本转换，然后进行重新拼接首尾，大功告成。
  
- markdown解析

  考察了几个社区流行的markdown解析器，比较流行的有[markdown](https://www.npmjs.com/package/markdown), [markdown-it](https://www.npmjs.com/package/markdown-it), [marked](https://www.npmjs.com/package/marked) 等等。综合考虑扩展性以及稳定性，笔者推荐使用markdown-it作为markdown的词法解析器，因为该解析器有比较多的插件，并且支持语法高亮。

- 同步滚动

  当选择分栏编辑的时候，滚动左侧的编辑区，右侧的预览区能自动滚动到对应的区域。方案参考了《[手把手教你用 100行代码实现基于 react的 markdown 输入 + 即时预览在线编辑器（一）](https://github.com/accforgit/blog-data/blob/master/%E5%9C%A8%E7%BA%BF%E7%BC%96%E8%BE%91%E5%99%A8/README/README1.md)》。只需先计算出输入框容器元素与预览框容器元素之间最大scroll范围的比例值，然后根据主动滚动元素自身的scrollTop做相应的比例换算，即可知道对方区域的scrollTop值。

- 关于UI
 
  - 项目的字体库选择了Font Awesome风格，并且只选取了项目所需要的一些图标。
  - 编辑器的整体css均可通过全局覆盖的形式进行自定义。目前暂时只支持灰色主题。
  - 编辑器的显示区域包括菜单栏，编辑器，预览区，工具栏，通过配置组件的config属性，可以选择默认的展示区域。
  
### Install

```js
npm install react-markdown-editor-lite --save
```

### Props

| Property | Description | Type | default | Remarks |
| --- | --- | --- | --- | --- |
| value | markdown content | String | '' | required |
| style | component container style | Object | {height: '100%'} | not required |
| config | component config | Object | {view: {...}, logger: {...}} | not required |
| onChange | emitting when editor has changed | Function | ({html, md}) => {} | not required |
| onImageUpload | when image uploaded, callback emitting will get image markdown text | (file: File, callback: (url: string) => void) => void; | ({file, callback}) => {} | not required |
| renderHTML | Render markdown text to HTML. You can return either string, function or Promise | (text: string) => string|function|Promise | none | **required** |

### Example

``` js
'use strict';
import React from 'react'
import ReactDOM from 'react-dom'
import MdEditor from 'react-markdown-editor-lite'
import MarkdownIt from 'markdown-it'
import emoji from 'markdown-it-emoji'
import subscript from 'markdown-it-sub'
import superscript from 'markdown-it-sup'
import footnote from 'markdown-it-footnote'
import deflist from 'markdown-it-deflist'
import abbreviation from 'markdown-it-abbr'
import insert from 'markdown-it-ins'
import mark from 'markdown-it-mark'
import tasklists from 'markdown-it-task-lists'
import hljs from 'highlight.js'
import 'highlight.js/styles/atom-one-light.css'
// import 'highlight.js/styles/github.css'
import './index.less';

const MOCK_DATA = "I Love React."
export default class Demo extends React.Component {
  mdEditor = null
  mdParser = null
  constructor(props) {
    super(props)
    // initial a parsera
    this.mdParser = new MarkdownIt({
      html: true,
      linkify: true,
      typographer: true,
      highlight: function (str, lang) {
        if (lang && hljs.getLanguage(lang)) {
          try {
            return hljs.highlight(lang, str).value
          } catch (__) {}
        }    
        return '' // use external default escaping
      }
    })
    .use(emoji)
    .use(subscript)
    .use(superscript)
    .use(footnote)
    .use(deflist)
    .use(abbreviation)
    .use(insert)
    .use(mark)
    .use(tasklists, { enabled: this.taskLists })
    this.renderHTML = this.renderHTML.bind(this)
  }
  handleEditorChange({html, md}) {
    console.log('handleEditorChange', html, md)
  }
  handleImageUpload(file, callback) {
    const reader = new FileReader()
    reader.onload = () => {      
      const convertBase64UrlToBlob = (urlData) => {  
        let arr = urlData.split(','), mime = arr[0].match(/:(.*?);/)[1]
        let bstr = atob(arr[1])
        let n = bstr.length
        let u8arr = new Uint8Array(n)
        while (n--) {
          u8arr[n] = bstr.charCodeAt(n)
        }
        return new Blob([u8arr], {type:mime})
      }
      const blob = convertBase64UrlToBlob(reader.result)
      setTimeout(() => {
        // setTimeout 模拟异步上传图片
        // 当异步上传获取图片地址后，执行calback回调（参数为imageUrl字符串），即可将图片地址写入markdown
        callback('https://avatars0.githubusercontent.com/u/21263805?s=40&v=4')
      }, 1000)
    }
    reader.readAsDataURL(file)
  }
  renderHTML(text) {
    // 模拟异步渲染Markdown
    return new Promise((resolve) => {
      setTimeout(() => {
        resolve(this.mdParser.render(text))
      }, 1000)
    })
  }
  handleGetMdValue = () => {   
    this.mdEditor && alert(this.mdEditor.getMdValue())      
  }
  handleGetHtmlValue = () => {    
    this.mdEditor && alert(this.mdEditor.getHtmlValue())
  }
  render() {
    return (      
      <div>
        <nav>
          <button onClick={this.handleGetMdValue} >getMdValue</button>  
          <button onClick={this.handleGetHtmlValue} >getHtmlValue</button>  
        </nav>
        <section style="height: 500px">
          <MdEditor 
            ref={node => this.mdEditor = node}
            value={MOCK_DATA}
            style={{height: '400px'}}
            renderHTML={this.renderHTML}
            config={{
              view: {
                menu: true,
                md: true,
                html: true
              },
              imageUrl: 'https://octodex.github.com/images/minion.png'
            }}
            onChange={this.handleEditorChange} 
            onImageUpload={this.handleImageUpload}
          />
        </section>                        
      </div>      
    )
  }
}
```

### 最后

   欢迎大家使用和反馈，[项目地址](https://github.com/HarryChen0506/react-markdown-editor-lite) (https://github.com/HarryChen0506/react-markdown-editor-lite)， 你的点赞将是我莫大的动力😊

![1.png](https://s3.ca-central-1.amazonaws.com/res-blog-public/res-dev/blog_1636946743939_1.png)', firstPicture='', viewCount=83, createDate='Sun Nov 07 14:09:29 EST 2021', updateDate='Tue Jan 18 22:54:08 EST 2022'}}, total=null}
2022-01-19 21:58:59:961 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 22ms
2022-01-19 21:58:59:961 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 21:59:00:493 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 21:59:00:493 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 21:59:00:493 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 21:59:00:494 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 21:59:00:494 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 21:59:00:494 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 21:59:00:494 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=36createdate=Wed Jan 19 21:15:59 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/19.png, replyComments=[CommentListVo{commentId=37createdate=Wed Jan 19 21:16:11 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/46.png, replyComments=[CommentListVo{commentId=38createdate=Wed Jan 19 21:16:27 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/95.png, replyComments=null, CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sdfsd@Ck.com', nickname='2.1', parentCommentNickname='2', content='2.1', status='0'}}], CommentVo=CommentVo{parentCommentId=36, articleId=10005, email='2sdf@dd.c', nickname='2', parentCommentNickname='1', content='2', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='1@11.com', nickname='1', parentCommentNickname='null', content='1', status='0'}}], total=1}
2022-01-19 21:59:00:494 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 2ms
2022-01-19 21:59:00:494 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 21:59:41:434 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 21:59:41:434 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 21:59:41:434 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 21:59:41:434 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/article/10005
2022-01-19 21:59:41:434 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.ArticleController.getPublicArticleDetail
2022-01-19 21:59:41:434 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 21:59:41:434 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=ArticleVo{userInfo=UserInfoVo{userId=100001, nickName='ivan', userName='ivan', avatar='https://res-blog-public.s3.ca-central-1.amazonaws.com/default_avatar.jpg'}, category=CategoryVo{categoryId=1, name='Life ', articleCount=null}, BaseArticleVo{articleId=10005, status=1, type=1, title='dd', description='This is the doc of React markdown editor lite.
Enjoy!!', content='| Head | Head | Head | Head |
| --- | --- | --- | --- |
| Data | Data | Data | Data |
| Data | Data | Data | Data |

## 手把手教你写一个markdown编辑器

> 笔者在18年年末的时候接到一个开发任务——搭建一个AI项目的开放平台，其中的产品文档为转化为HTML格式的markdown文档。考虑到文档的即时更新，将文档信息做成了Ajax接口的形式。因此管理后台只需将textarea表单的内容通过markdown解析器进行HTML格式转化，然后将markdown内容和经转化的HTML文档都保存到数据库即可。
> 基本需求完成后，为了更好的用户体验，考虑将常用的编辑功能添加进来。改进版不仅支持了常用的文本编辑功能，还实现的UI界面的配置化，自定义语法解析器。本着造福伸手党的目的，以及积累些开源经验，笔者将该react 组件 [react-markdown-editor-lite](https://github.com/HarryChen0506/react-markdown-editor-lite) 进行了封装改造，并且发布到了开源社区。

### 预览
在线体验 [https://harrychen0506.github.io/react-markdown-editor-lite/](https://harrychen0506.github.io/react-markdown-editor-lite/)

![image](https://github.com//HarryChen0506/react-markdown-editor-lite/blob/master/image/react-markdown-editor-lite-v1.0.0.PNG?raw=true)

### 特点
* 轻量、基于React
* UI可配置, 如只显示编辑区或预览区
* 支持自定义markdown语法解析器,语法高亮等
* 支持常用的markdown编辑功能，如加粗，斜体等等...
* 支持功能按钮插拔化，用户可以自定义扩展组件
* 支持编辑区和预览区同步滚动

### 开发心得

- 文本编辑

  大多数常见的编辑器，包括富文本编辑器，利用了某些元素如div的contenteditable属性，配合selection、range、execCommand等API，实现了富文本编辑功能。这里面的实现比较复杂，所以有了"[为什么都说富文本编辑器是天坑？](https://www.zhihu.com/question/38699645)"这个说法。

  而markdown编辑器，核心的处理内容为简单语法的纯文本，复杂度相对来说比较低，并且input标签自带onSelect事件，可以很方便的获取选择信息（选择起始位置和选择文本值），因此要想实现编辑功能，只需将要改动的内容进行文本转换，然后进行重新拼接首尾，大功告成。
  
- markdown解析

  考察了几个社区流行的markdown解析器，比较流行的有[markdown](https://www.npmjs.com/package/markdown), [markdown-it](https://www.npmjs.com/package/markdown-it), [marked](https://www.npmjs.com/package/marked) 等等。综合考虑扩展性以及稳定性，笔者推荐使用markdown-it作为markdown的词法解析器，因为该解析器有比较多的插件，并且支持语法高亮。

- 同步滚动

  当选择分栏编辑的时候，滚动左侧的编辑区，右侧的预览区能自动滚动到对应的区域。方案参考了《[手把手教你用 100行代码实现基于 react的 markdown 输入 + 即时预览在线编辑器（一）](https://github.com/accforgit/blog-data/blob/master/%E5%9C%A8%E7%BA%BF%E7%BC%96%E8%BE%91%E5%99%A8/README/README1.md)》。只需先计算出输入框容器元素与预览框容器元素之间最大scroll范围的比例值，然后根据主动滚动元素自身的scrollTop做相应的比例换算，即可知道对方区域的scrollTop值。

- 关于UI
 
  - 项目的字体库选择了Font Awesome风格，并且只选取了项目所需要的一些图标。
  - 编辑器的整体css均可通过全局覆盖的形式进行自定义。目前暂时只支持灰色主题。
  - 编辑器的显示区域包括菜单栏，编辑器，预览区，工具栏，通过配置组件的config属性，可以选择默认的展示区域。
  
### Install

```js
npm install react-markdown-editor-lite --save
```

### Props

| Property | Description | Type | default | Remarks |
| --- | --- | --- | --- | --- |
| value | markdown content | String | '' | required |
| style | component container style | Object | {height: '100%'} | not required |
| config | component config | Object | {view: {...}, logger: {...}} | not required |
| onChange | emitting when editor has changed | Function | ({html, md}) => {} | not required |
| onImageUpload | when image uploaded, callback emitting will get image markdown text | (file: File, callback: (url: string) => void) => void; | ({file, callback}) => {} | not required |
| renderHTML | Render markdown text to HTML. You can return either string, function or Promise | (text: string) => string|function|Promise | none | **required** |

### Example

``` js
'use strict';
import React from 'react'
import ReactDOM from 'react-dom'
import MdEditor from 'react-markdown-editor-lite'
import MarkdownIt from 'markdown-it'
import emoji from 'markdown-it-emoji'
import subscript from 'markdown-it-sub'
import superscript from 'markdown-it-sup'
import footnote from 'markdown-it-footnote'
import deflist from 'markdown-it-deflist'
import abbreviation from 'markdown-it-abbr'
import insert from 'markdown-it-ins'
import mark from 'markdown-it-mark'
import tasklists from 'markdown-it-task-lists'
import hljs from 'highlight.js'
import 'highlight.js/styles/atom-one-light.css'
// import 'highlight.js/styles/github.css'
import './index.less';

const MOCK_DATA = "I Love React."
export default class Demo extends React.Component {
  mdEditor = null
  mdParser = null
  constructor(props) {
    super(props)
    // initial a parsera
    this.mdParser = new MarkdownIt({
      html: true,
      linkify: true,
      typographer: true,
      highlight: function (str, lang) {
        if (lang && hljs.getLanguage(lang)) {
          try {
            return hljs.highlight(lang, str).value
          } catch (__) {}
        }    
        return '' // use external default escaping
      }
    })
    .use(emoji)
    .use(subscript)
    .use(superscript)
    .use(footnote)
    .use(deflist)
    .use(abbreviation)
    .use(insert)
    .use(mark)
    .use(tasklists, { enabled: this.taskLists })
    this.renderHTML = this.renderHTML.bind(this)
  }
  handleEditorChange({html, md}) {
    console.log('handleEditorChange', html, md)
  }
  handleImageUpload(file, callback) {
    const reader = new FileReader()
    reader.onload = () => {      
      const convertBase64UrlToBlob = (urlData) => {  
        let arr = urlData.split(','), mime = arr[0].match(/:(.*?);/)[1]
        let bstr = atob(arr[1])
        let n = bstr.length
        let u8arr = new Uint8Array(n)
        while (n--) {
          u8arr[n] = bstr.charCodeAt(n)
        }
        return new Blob([u8arr], {type:mime})
      }
      const blob = convertBase64UrlToBlob(reader.result)
      setTimeout(() => {
        // setTimeout 模拟异步上传图片
        // 当异步上传获取图片地址后，执行calback回调（参数为imageUrl字符串），即可将图片地址写入markdown
        callback('https://avatars0.githubusercontent.com/u/21263805?s=40&v=4')
      }, 1000)
    }
    reader.readAsDataURL(file)
  }
  renderHTML(text) {
    // 模拟异步渲染Markdown
    return new Promise((resolve) => {
      setTimeout(() => {
        resolve(this.mdParser.render(text))
      }, 1000)
    })
  }
  handleGetMdValue = () => {   
    this.mdEditor && alert(this.mdEditor.getMdValue())      
  }
  handleGetHtmlValue = () => {    
    this.mdEditor && alert(this.mdEditor.getHtmlValue())
  }
  render() {
    return (      
      <div>
        <nav>
          <button onClick={this.handleGetMdValue} >getMdValue</button>  
          <button onClick={this.handleGetHtmlValue} >getHtmlValue</button>  
        </nav>
        <section style="height: 500px">
          <MdEditor 
            ref={node => this.mdEditor = node}
            value={MOCK_DATA}
            style={{height: '400px'}}
            renderHTML={this.renderHTML}
            config={{
              view: {
                menu: true,
                md: true,
                html: true
              },
              imageUrl: 'https://octodex.github.com/images/minion.png'
            }}
            onChange={this.handleEditorChange} 
            onImageUpload={this.handleImageUpload}
          />
        </section>                        
      </div>      
    )
  }
}
```

### 最后

   欢迎大家使用和反馈，[项目地址](https://github.com/HarryChen0506/react-markdown-editor-lite) (https://github.com/HarryChen0506/react-markdown-editor-lite)， 你的点赞将是我莫大的动力😊

![1.png](https://s3.ca-central-1.amazonaws.com/res-blog-public/res-dev/blog_1636946743939_1.png)', firstPicture='', viewCount=83, createDate='Sun Nov 07 14:09:29 EST 2021', updateDate='Tue Jan 18 22:54:08 EST 2022'}}, total=null}
2022-01-19 21:59:41:434 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 8ms
2022-01-19 21:59:41:434 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 21:59:41:435 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 21:59:41:435 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 21:59:41:435 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 21:59:41:435 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 21:59:41:435 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 21:59:41:435 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 21:59:41:435 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=36createdate=Wed Jan 19 21:15:59 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/19.png, replyComments=[CommentListVo{commentId=37createdate=Wed Jan 19 21:16:11 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/46.png, replyComments=[CommentListVo{commentId=38createdate=Wed Jan 19 21:16:27 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/95.png, replyComments=null, CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sdfsd@Ck.com', nickname='2.1', parentCommentNickname='2', content='2.1', status='0'}}], CommentVo=CommentVo{parentCommentId=36, articleId=10005, email='2sdf@dd.c', nickname='2', parentCommentNickname='1', content='2', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='1@11.com', nickname='1', parentCommentNickname='null', content='1', status='0'}}], total=1}
2022-01-19 21:59:41:435 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 9ms
2022-01-19 21:59:41:435 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 21:59:41:439 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 21:59:41:439 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 21:59:41:439 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 21:59:41:439 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 21:59:41:440 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 21:59:41:440 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 21:59:41:440 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=36createdate=Wed Jan 19 21:15:59 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/19.png, replyComments=[CommentListVo{commentId=37createdate=Wed Jan 19 21:16:11 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/46.png, replyComments=[CommentListVo{commentId=38createdate=Wed Jan 19 21:16:27 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/95.png, replyComments=null, CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sdfsd@Ck.com', nickname='2.1', parentCommentNickname='2', content='2.1', status='0'}}], CommentVo=CommentVo{parentCommentId=36, articleId=10005, email='2sdf@dd.c', nickname='2', parentCommentNickname='1', content='2', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='1@11.com', nickname='1', parentCommentNickname='null', content='1', status='0'}}], total=1}
2022-01-19 21:59:41:440 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 12ms
2022-01-19 21:59:41:440 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 21:59:41:968 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 21:59:41:968 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 21:59:41:968 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 21:59:41:968 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 21:59:41:968 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 21:59:41:968 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 21:59:41:968 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=36createdate=Wed Jan 19 21:15:59 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/19.png, replyComments=[CommentListVo{commentId=37createdate=Wed Jan 19 21:16:11 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/46.png, replyComments=[CommentListVo{commentId=38createdate=Wed Jan 19 21:16:27 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/95.png, replyComments=null, CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sdfsd@Ck.com', nickname='2.1', parentCommentNickname='2', content='2.1', status='0'}}], CommentVo=CommentVo{parentCommentId=36, articleId=10005, email='2sdf@dd.c', nickname='2', parentCommentNickname='1', content='2', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='1@11.com', nickname='1', parentCommentNickname='null', content='1', status='0'}}], total=1}
2022-01-19 21:59:41:969 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 4ms
2022-01-19 21:59:41:969 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 22:00:37:854 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 22:00:37:855 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 22:00:37:855 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 22:00:37:855 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/article/10005
2022-01-19 22:00:37:855 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.ArticleController.getPublicArticleDetail
2022-01-19 22:00:37:855 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 22:00:37:855 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=ArticleVo{userInfo=UserInfoVo{userId=100001, nickName='ivan', userName='ivan', avatar='https://res-blog-public.s3.ca-central-1.amazonaws.com/default_avatar.jpg'}, category=CategoryVo{categoryId=1, name='Life ', articleCount=null}, BaseArticleVo{articleId=10005, status=1, type=1, title='dd', description='This is the doc of React markdown editor lite.
Enjoy!!', content='| Head | Head | Head | Head |
| --- | --- | --- | --- |
| Data | Data | Data | Data |
| Data | Data | Data | Data |

## 手把手教你写一个markdown编辑器

> 笔者在18年年末的时候接到一个开发任务——搭建一个AI项目的开放平台，其中的产品文档为转化为HTML格式的markdown文档。考虑到文档的即时更新，将文档信息做成了Ajax接口的形式。因此管理后台只需将textarea表单的内容通过markdown解析器进行HTML格式转化，然后将markdown内容和经转化的HTML文档都保存到数据库即可。
> 基本需求完成后，为了更好的用户体验，考虑将常用的编辑功能添加进来。改进版不仅支持了常用的文本编辑功能，还实现的UI界面的配置化，自定义语法解析器。本着造福伸手党的目的，以及积累些开源经验，笔者将该react 组件 [react-markdown-editor-lite](https://github.com/HarryChen0506/react-markdown-editor-lite) 进行了封装改造，并且发布到了开源社区。

### 预览
在线体验 [https://harrychen0506.github.io/react-markdown-editor-lite/](https://harrychen0506.github.io/react-markdown-editor-lite/)

![image](https://github.com//HarryChen0506/react-markdown-editor-lite/blob/master/image/react-markdown-editor-lite-v1.0.0.PNG?raw=true)

### 特点
* 轻量、基于React
* UI可配置, 如只显示编辑区或预览区
* 支持自定义markdown语法解析器,语法高亮等
* 支持常用的markdown编辑功能，如加粗，斜体等等...
* 支持功能按钮插拔化，用户可以自定义扩展组件
* 支持编辑区和预览区同步滚动

### 开发心得

- 文本编辑

  大多数常见的编辑器，包括富文本编辑器，利用了某些元素如div的contenteditable属性，配合selection、range、execCommand等API，实现了富文本编辑功能。这里面的实现比较复杂，所以有了"[为什么都说富文本编辑器是天坑？](https://www.zhihu.com/question/38699645)"这个说法。

  而markdown编辑器，核心的处理内容为简单语法的纯文本，复杂度相对来说比较低，并且input标签自带onSelect事件，可以很方便的获取选择信息（选择起始位置和选择文本值），因此要想实现编辑功能，只需将要改动的内容进行文本转换，然后进行重新拼接首尾，大功告成。
  
- markdown解析

  考察了几个社区流行的markdown解析器，比较流行的有[markdown](https://www.npmjs.com/package/markdown), [markdown-it](https://www.npmjs.com/package/markdown-it), [marked](https://www.npmjs.com/package/marked) 等等。综合考虑扩展性以及稳定性，笔者推荐使用markdown-it作为markdown的词法解析器，因为该解析器有比较多的插件，并且支持语法高亮。

- 同步滚动

  当选择分栏编辑的时候，滚动左侧的编辑区，右侧的预览区能自动滚动到对应的区域。方案参考了《[手把手教你用 100行代码实现基于 react的 markdown 输入 + 即时预览在线编辑器（一）](https://github.com/accforgit/blog-data/blob/master/%E5%9C%A8%E7%BA%BF%E7%BC%96%E8%BE%91%E5%99%A8/README/README1.md)》。只需先计算出输入框容器元素与预览框容器元素之间最大scroll范围的比例值，然后根据主动滚动元素自身的scrollTop做相应的比例换算，即可知道对方区域的scrollTop值。

- 关于UI
 
  - 项目的字体库选择了Font Awesome风格，并且只选取了项目所需要的一些图标。
  - 编辑器的整体css均可通过全局覆盖的形式进行自定义。目前暂时只支持灰色主题。
  - 编辑器的显示区域包括菜单栏，编辑器，预览区，工具栏，通过配置组件的config属性，可以选择默认的展示区域。
  
### Install

```js
npm install react-markdown-editor-lite --save
```

### Props

| Property | Description | Type | default | Remarks |
| --- | --- | --- | --- | --- |
| value | markdown content | String | '' | required |
| style | component container style | Object | {height: '100%'} | not required |
| config | component config | Object | {view: {...}, logger: {...}} | not required |
| onChange | emitting when editor has changed | Function | ({html, md}) => {} | not required |
| onImageUpload | when image uploaded, callback emitting will get image markdown text | (file: File, callback: (url: string) => void) => void; | ({file, callback}) => {} | not required |
| renderHTML | Render markdown text to HTML. You can return either string, function or Promise | (text: string) => string|function|Promise | none | **required** |

### Example

``` js
'use strict';
import React from 'react'
import ReactDOM from 'react-dom'
import MdEditor from 'react-markdown-editor-lite'
import MarkdownIt from 'markdown-it'
import emoji from 'markdown-it-emoji'
import subscript from 'markdown-it-sub'
import superscript from 'markdown-it-sup'
import footnote from 'markdown-it-footnote'
import deflist from 'markdown-it-deflist'
import abbreviation from 'markdown-it-abbr'
import insert from 'markdown-it-ins'
import mark from 'markdown-it-mark'
import tasklists from 'markdown-it-task-lists'
import hljs from 'highlight.js'
import 'highlight.js/styles/atom-one-light.css'
// import 'highlight.js/styles/github.css'
import './index.less';

const MOCK_DATA = "I Love React."
export default class Demo extends React.Component {
  mdEditor = null
  mdParser = null
  constructor(props) {
    super(props)
    // initial a parsera
    this.mdParser = new MarkdownIt({
      html: true,
      linkify: true,
      typographer: true,
      highlight: function (str, lang) {
        if (lang && hljs.getLanguage(lang)) {
          try {
            return hljs.highlight(lang, str).value
          } catch (__) {}
        }    
        return '' // use external default escaping
      }
    })
    .use(emoji)
    .use(subscript)
    .use(superscript)
    .use(footnote)
    .use(deflist)
    .use(abbreviation)
    .use(insert)
    .use(mark)
    .use(tasklists, { enabled: this.taskLists })
    this.renderHTML = this.renderHTML.bind(this)
  }
  handleEditorChange({html, md}) {
    console.log('handleEditorChange', html, md)
  }
  handleImageUpload(file, callback) {
    const reader = new FileReader()
    reader.onload = () => {      
      const convertBase64UrlToBlob = (urlData) => {  
        let arr = urlData.split(','), mime = arr[0].match(/:(.*?);/)[1]
        let bstr = atob(arr[1])
        let n = bstr.length
        let u8arr = new Uint8Array(n)
        while (n--) {
          u8arr[n] = bstr.charCodeAt(n)
        }
        return new Blob([u8arr], {type:mime})
      }
      const blob = convertBase64UrlToBlob(reader.result)
      setTimeout(() => {
        // setTimeout 模拟异步上传图片
        // 当异步上传获取图片地址后，执行calback回调（参数为imageUrl字符串），即可将图片地址写入markdown
        callback('https://avatars0.githubusercontent.com/u/21263805?s=40&v=4')
      }, 1000)
    }
    reader.readAsDataURL(file)
  }
  renderHTML(text) {
    // 模拟异步渲染Markdown
    return new Promise((resolve) => {
      setTimeout(() => {
        resolve(this.mdParser.render(text))
      }, 1000)
    })
  }
  handleGetMdValue = () => {   
    this.mdEditor && alert(this.mdEditor.getMdValue())      
  }
  handleGetHtmlValue = () => {    
    this.mdEditor && alert(this.mdEditor.getHtmlValue())
  }
  render() {
    return (      
      <div>
        <nav>
          <button onClick={this.handleGetMdValue} >getMdValue</button>  
          <button onClick={this.handleGetHtmlValue} >getHtmlValue</button>  
        </nav>
        <section style="height: 500px">
          <MdEditor 
            ref={node => this.mdEditor = node}
            value={MOCK_DATA}
            style={{height: '400px'}}
            renderHTML={this.renderHTML}
            config={{
              view: {
                menu: true,
                md: true,
                html: true
              },
              imageUrl: 'https://octodex.github.com/images/minion.png'
            }}
            onChange={this.handleEditorChange} 
            onImageUpload={this.handleImageUpload}
          />
        </section>                        
      </div>      
    )
  }
}
```

### 最后

   欢迎大家使用和反馈，[项目地址](https://github.com/HarryChen0506/react-markdown-editor-lite) (https://github.com/HarryChen0506/react-markdown-editor-lite)， 你的点赞将是我莫大的动力😊

![1.png](https://s3.ca-central-1.amazonaws.com/res-blog-public/res-dev/blog_1636946743939_1.png)', firstPicture='', viewCount=83, createDate='Sun Nov 07 14:09:29 EST 2021', updateDate='Tue Jan 18 22:54:08 EST 2022'}}, total=null}
2022-01-19 22:00:37:855 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 24ms
2022-01-19 22:00:37:855 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 22:00:37:859 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 22:00:37:859 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 22:00:37:859 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 22:00:37:859 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 22:00:37:859 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 22:00:37:859 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 22:00:37:859 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=36createdate=Wed Jan 19 21:15:59 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/19.png, replyComments=[CommentListVo{commentId=37createdate=Wed Jan 19 21:16:11 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/46.png, replyComments=[CommentListVo{commentId=38createdate=Wed Jan 19 21:16:27 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/95.png, replyComments=null, CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sdfsd@Ck.com', nickname='2.1', parentCommentNickname='2', content='2.1', status='0'}}], CommentVo=CommentVo{parentCommentId=36, articleId=10005, email='2sdf@dd.c', nickname='2', parentCommentNickname='1', content='2', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='1@11.com', nickname='1', parentCommentNickname='null', content='1', status='0'}}], total=1}
2022-01-19 22:00:37:859 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 29ms
2022-01-19 22:00:37:859 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 22:00:37:862 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 22:00:37:862 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 22:00:37:862 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 22:00:37:862 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 22:00:37:862 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 22:00:37:862 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 22:00:37:862 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=36createdate=Wed Jan 19 21:15:59 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/19.png, replyComments=[CommentListVo{commentId=37createdate=Wed Jan 19 21:16:11 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/46.png, replyComments=[CommentListVo{commentId=38createdate=Wed Jan 19 21:16:27 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/95.png, replyComments=null, CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sdfsd@Ck.com', nickname='2.1', parentCommentNickname='2', content='2.1', status='0'}}], CommentVo=CommentVo{parentCommentId=36, articleId=10005, email='2sdf@dd.c', nickname='2', parentCommentNickname='1', content='2', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='1@11.com', nickname='1', parentCommentNickname='null', content='1', status='0'}}], total=1}
2022-01-19 22:00:37:862 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 30ms
2022-01-19 22:00:37:862 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 22:00:37:934 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 22:00:37:934 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 22:00:37:934 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 22:00:37:934 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 22:00:37:934 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 22:00:37:934 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 22:00:37:934 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=36createdate=Wed Jan 19 21:15:59 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/19.png, replyComments=[CommentListVo{commentId=37createdate=Wed Jan 19 21:16:11 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/46.png, replyComments=[CommentListVo{commentId=38createdate=Wed Jan 19 21:16:27 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/95.png, replyComments=null, CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sdfsd@Ck.com', nickname='2.1', parentCommentNickname='2', content='2.1', status='0'}}], CommentVo=CommentVo{parentCommentId=36, articleId=10005, email='2sdf@dd.c', nickname='2', parentCommentNickname='1', content='2', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='1@11.com', nickname='1', parentCommentNickname='null', content='1', status='0'}}], total=1}
2022-01-19 22:00:37:934 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 2ms
2022-01-19 22:00:37:934 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 22:02:44:632 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 22:02:44:632 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 22:02:44:632 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 22:02:44:632 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 22:02:44:632 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 22:02:44:632 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 22:02:44:632 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 22:02:44:632 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 22:02:44:632 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 22:02:44:632 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 22:02:44:632 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 22:02:44:632 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 22:02:44:632 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=36createdate=Wed Jan 19 21:15:59 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/19.png, replyComments=[CommentListVo{commentId=37createdate=Wed Jan 19 21:16:11 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/46.png, replyComments=[CommentListVo{commentId=38createdate=Wed Jan 19 21:16:27 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/95.png, replyComments=null, CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sdfsd@Ck.com', nickname='2.1', parentCommentNickname='2', content='2.1', status='0'}}], CommentVo=CommentVo{parentCommentId=36, articleId=10005, email='2sdf@dd.c', nickname='2', parentCommentNickname='1', content='2', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='1@11.com', nickname='1', parentCommentNickname='null', content='1', status='0'}}], total=1}
2022-01-19 22:02:44:632 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=36createdate=Wed Jan 19 21:15:59 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/19.png, replyComments=[CommentListVo{commentId=37createdate=Wed Jan 19 21:16:11 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/46.png, replyComments=[CommentListVo{commentId=38createdate=Wed Jan 19 21:16:27 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/95.png, replyComments=null, CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sdfsd@Ck.com', nickname='2.1', parentCommentNickname='2', content='2.1', status='0'}}], CommentVo=CommentVo{parentCommentId=36, articleId=10005, email='2sdf@dd.c', nickname='2', parentCommentNickname='1', content='2', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='1@11.com', nickname='1', parentCommentNickname='null', content='1', status='0'}}], total=1}
2022-01-19 22:02:44:632 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 4ms
2022-01-19 22:02:44:632 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 4ms
2022-01-19 22:02:44:632 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 22:02:44:632 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 22:02:44:645 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 22:02:44:645 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 22:02:44:645 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 22:02:44:645 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/article/10005
2022-01-19 22:02:44:645 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.ArticleController.getPublicArticleDetail
2022-01-19 22:02:44:645 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 22:02:44:645 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=ArticleVo{userInfo=UserInfoVo{userId=100001, nickName='ivan', userName='ivan', avatar='https://res-blog-public.s3.ca-central-1.amazonaws.com/default_avatar.jpg'}, category=CategoryVo{categoryId=1, name='Life ', articleCount=null}, BaseArticleVo{articleId=10005, status=1, type=1, title='dd', description='This is the doc of React markdown editor lite.
Enjoy!!', content='| Head | Head | Head | Head |
| --- | --- | --- | --- |
| Data | Data | Data | Data |
| Data | Data | Data | Data |

## 手把手教你写一个markdown编辑器

> 笔者在18年年末的时候接到一个开发任务——搭建一个AI项目的开放平台，其中的产品文档为转化为HTML格式的markdown文档。考虑到文档的即时更新，将文档信息做成了Ajax接口的形式。因此管理后台只需将textarea表单的内容通过markdown解析器进行HTML格式转化，然后将markdown内容和经转化的HTML文档都保存到数据库即可。
> 基本需求完成后，为了更好的用户体验，考虑将常用的编辑功能添加进来。改进版不仅支持了常用的文本编辑功能，还实现的UI界面的配置化，自定义语法解析器。本着造福伸手党的目的，以及积累些开源经验，笔者将该react 组件 [react-markdown-editor-lite](https://github.com/HarryChen0506/react-markdown-editor-lite) 进行了封装改造，并且发布到了开源社区。

### 预览
在线体验 [https://harrychen0506.github.io/react-markdown-editor-lite/](https://harrychen0506.github.io/react-markdown-editor-lite/)

![image](https://github.com//HarryChen0506/react-markdown-editor-lite/blob/master/image/react-markdown-editor-lite-v1.0.0.PNG?raw=true)

### 特点
* 轻量、基于React
* UI可配置, 如只显示编辑区或预览区
* 支持自定义markdown语法解析器,语法高亮等
* 支持常用的markdown编辑功能，如加粗，斜体等等...
* 支持功能按钮插拔化，用户可以自定义扩展组件
* 支持编辑区和预览区同步滚动

### 开发心得

- 文本编辑

  大多数常见的编辑器，包括富文本编辑器，利用了某些元素如div的contenteditable属性，配合selection、range、execCommand等API，实现了富文本编辑功能。这里面的实现比较复杂，所以有了"[为什么都说富文本编辑器是天坑？](https://www.zhihu.com/question/38699645)"这个说法。

  而markdown编辑器，核心的处理内容为简单语法的纯文本，复杂度相对来说比较低，并且input标签自带onSelect事件，可以很方便的获取选择信息（选择起始位置和选择文本值），因此要想实现编辑功能，只需将要改动的内容进行文本转换，然后进行重新拼接首尾，大功告成。
  
- markdown解析

  考察了几个社区流行的markdown解析器，比较流行的有[markdown](https://www.npmjs.com/package/markdown), [markdown-it](https://www.npmjs.com/package/markdown-it), [marked](https://www.npmjs.com/package/marked) 等等。综合考虑扩展性以及稳定性，笔者推荐使用markdown-it作为markdown的词法解析器，因为该解析器有比较多的插件，并且支持语法高亮。

- 同步滚动

  当选择分栏编辑的时候，滚动左侧的编辑区，右侧的预览区能自动滚动到对应的区域。方案参考了《[手把手教你用 100行代码实现基于 react的 markdown 输入 + 即时预览在线编辑器（一）](https://github.com/accforgit/blog-data/blob/master/%E5%9C%A8%E7%BA%BF%E7%BC%96%E8%BE%91%E5%99%A8/README/README1.md)》。只需先计算出输入框容器元素与预览框容器元素之间最大scroll范围的比例值，然后根据主动滚动元素自身的scrollTop做相应的比例换算，即可知道对方区域的scrollTop值。

- 关于UI
 
  - 项目的字体库选择了Font Awesome风格，并且只选取了项目所需要的一些图标。
  - 编辑器的整体css均可通过全局覆盖的形式进行自定义。目前暂时只支持灰色主题。
  - 编辑器的显示区域包括菜单栏，编辑器，预览区，工具栏，通过配置组件的config属性，可以选择默认的展示区域。
  
### Install

```js
npm install react-markdown-editor-lite --save
```

### Props

| Property | Description | Type | default | Remarks |
| --- | --- | --- | --- | --- |
| value | markdown content | String | '' | required |
| style | component container style | Object | {height: '100%'} | not required |
| config | component config | Object | {view: {...}, logger: {...}} | not required |
| onChange | emitting when editor has changed | Function | ({html, md}) => {} | not required |
| onImageUpload | when image uploaded, callback emitting will get image markdown text | (file: File, callback: (url: string) => void) => void; | ({file, callback}) => {} | not required |
| renderHTML | Render markdown text to HTML. You can return either string, function or Promise | (text: string) => string|function|Promise | none | **required** |

### Example

``` js
'use strict';
import React from 'react'
import ReactDOM from 'react-dom'
import MdEditor from 'react-markdown-editor-lite'
import MarkdownIt from 'markdown-it'
import emoji from 'markdown-it-emoji'
import subscript from 'markdown-it-sub'
import superscript from 'markdown-it-sup'
import footnote from 'markdown-it-footnote'
import deflist from 'markdown-it-deflist'
import abbreviation from 'markdown-it-abbr'
import insert from 'markdown-it-ins'
import mark from 'markdown-it-mark'
import tasklists from 'markdown-it-task-lists'
import hljs from 'highlight.js'
import 'highlight.js/styles/atom-one-light.css'
// import 'highlight.js/styles/github.css'
import './index.less';

const MOCK_DATA = "I Love React."
export default class Demo extends React.Component {
  mdEditor = null
  mdParser = null
  constructor(props) {
    super(props)
    // initial a parsera
    this.mdParser = new MarkdownIt({
      html: true,
      linkify: true,
      typographer: true,
      highlight: function (str, lang) {
        if (lang && hljs.getLanguage(lang)) {
          try {
            return hljs.highlight(lang, str).value
          } catch (__) {}
        }    
        return '' // use external default escaping
      }
    })
    .use(emoji)
    .use(subscript)
    .use(superscript)
    .use(footnote)
    .use(deflist)
    .use(abbreviation)
    .use(insert)
    .use(mark)
    .use(tasklists, { enabled: this.taskLists })
    this.renderHTML = this.renderHTML.bind(this)
  }
  handleEditorChange({html, md}) {
    console.log('handleEditorChange', html, md)
  }
  handleImageUpload(file, callback) {
    const reader = new FileReader()
    reader.onload = () => {      
      const convertBase64UrlToBlob = (urlData) => {  
        let arr = urlData.split(','), mime = arr[0].match(/:(.*?);/)[1]
        let bstr = atob(arr[1])
        let n = bstr.length
        let u8arr = new Uint8Array(n)
        while (n--) {
          u8arr[n] = bstr.charCodeAt(n)
        }
        return new Blob([u8arr], {type:mime})
      }
      const blob = convertBase64UrlToBlob(reader.result)
      setTimeout(() => {
        // setTimeout 模拟异步上传图片
        // 当异步上传获取图片地址后，执行calback回调（参数为imageUrl字符串），即可将图片地址写入markdown
        callback('https://avatars0.githubusercontent.com/u/21263805?s=40&v=4')
      }, 1000)
    }
    reader.readAsDataURL(file)
  }
  renderHTML(text) {
    // 模拟异步渲染Markdown
    return new Promise((resolve) => {
      setTimeout(() => {
        resolve(this.mdParser.render(text))
      }, 1000)
    })
  }
  handleGetMdValue = () => {   
    this.mdEditor && alert(this.mdEditor.getMdValue())      
  }
  handleGetHtmlValue = () => {    
    this.mdEditor && alert(this.mdEditor.getHtmlValue())
  }
  render() {
    return (      
      <div>
        <nav>
          <button onClick={this.handleGetMdValue} >getMdValue</button>  
          <button onClick={this.handleGetHtmlValue} >getHtmlValue</button>  
        </nav>
        <section style="height: 500px">
          <MdEditor 
            ref={node => this.mdEditor = node}
            value={MOCK_DATA}
            style={{height: '400px'}}
            renderHTML={this.renderHTML}
            config={{
              view: {
                menu: true,
                md: true,
                html: true
              },
              imageUrl: 'https://octodex.github.com/images/minion.png'
            }}
            onChange={this.handleEditorChange} 
            onImageUpload={this.handleImageUpload}
          />
        </section>                        
      </div>      
    )
  }
}
```

### 最后

   欢迎大家使用和反馈，[项目地址](https://github.com/HarryChen0506/react-markdown-editor-lite) (https://github.com/HarryChen0506/react-markdown-editor-lite)， 你的点赞将是我莫大的动力😊

![1.png](https://s3.ca-central-1.amazonaws.com/res-blog-public/res-dev/blog_1636946743939_1.png)', firstPicture='', viewCount=83, createDate='Sun Nov 07 14:09:29 EST 2021', updateDate='Tue Jan 18 22:54:08 EST 2022'}}, total=null}
2022-01-19 22:02:44:645 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 17ms
2022-01-19 22:02:44:645 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 22:02:45:142 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 22:02:45:143 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 22:02:45:143 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 22:02:45:143 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 22:02:45:143 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 22:02:45:143 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 22:02:45:143 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=36createdate=Wed Jan 19 21:15:59 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/19.png, replyComments=[CommentListVo{commentId=37createdate=Wed Jan 19 21:16:11 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/46.png, replyComments=[CommentListVo{commentId=38createdate=Wed Jan 19 21:16:27 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/95.png, replyComments=null, CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sdfsd@Ck.com', nickname='2.1', parentCommentNickname='2', content='2.1', status='0'}}], CommentVo=CommentVo{parentCommentId=36, articleId=10005, email='2sdf@dd.c', nickname='2', parentCommentNickname='1', content='2', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='1@11.com', nickname='1', parentCommentNickname='null', content='1', status='0'}}], total=1}
2022-01-19 22:02:45:143 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 2ms
2022-01-19 22:02:45:143 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 22:03:07:202 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 22:03:07:203 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 22:03:07:203 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: POST
2022-01-19 22:03:07:203 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment
2022-01-19 22:03:07:203 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.postComment
2022-01-19 22:03:07:203 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: CommentVo{parentCommentId=37, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='2', content='ddddd', status='null'}
2022-01-19 22:03:07:203 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=null, total=null}
2022-01-19 22:03:07:203 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 2ms
2022-01-19 22:03:07:203 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 22:03:07:224 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 22:03:07:224 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 22:03:07:224 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 22:03:07:224 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 22:03:07:224 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 22:03:07:224 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 22:03:07:224 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=36createdate=Wed Jan 19 21:15:59 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/19.png, replyComments=[CommentListVo{commentId=37createdate=Wed Jan 19 21:16:11 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/46.png, replyComments=[CommentListVo{commentId=38createdate=Wed Jan 19 21:16:27 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/95.png, replyComments=null, CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sdfsd@Ck.com', nickname='2.1', parentCommentNickname='2', content='2.1', status='0'}}, CommentListVo{commentId=39createdate=Wed Jan 19 22:03:07 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/86.png, replyComments=null, CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='2', content='ddddd', status='0'}}], CommentVo=CommentVo{parentCommentId=36, articleId=10005, email='2sdf@dd.c', nickname='2', parentCommentNickname='1', content='2', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='1@11.com', nickname='1', parentCommentNickname='null', content='1', status='0'}}], total=1}
2022-01-19 22:03:07:224 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 3ms
2022-01-19 22:03:07:224 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 22:04:30:275 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 22:04:30:275 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 22:04:30:275 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: POST
2022-01-19 22:04:30:275 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment
2022-01-19 22:04:30:275 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.postComment
2022-01-19 22:04:30:275 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: CommentVo{parentCommentId=38, articleId=10005, email='test@gg.com', nickname='sfs@ss.c', parentCommentNickname='2.1', content='sdfsf', status='null'}
2022-01-19 22:04:30:275 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=null, total=null}
2022-01-19 22:04:30:275 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 2ms
2022-01-19 22:04:30:275 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 22:04:30:295 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 22:04:30:295 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 22:04:30:295 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 22:04:30:295 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 22:04:30:295 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 22:04:30:295 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 22:04:30:295 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=36createdate=Wed Jan 19 21:15:59 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/19.png, replyComments=[CommentListVo{commentId=37createdate=Wed Jan 19 21:16:11 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/46.png, replyComments=[CommentListVo{commentId=38createdate=Wed Jan 19 21:16:27 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/95.png, replyComments=[CommentListVo{commentId=40createdate=Wed Jan 19 22:04:30 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/88.png, replyComments=null, CommentVo=CommentVo{parentCommentId=38, articleId=10005, email='test@gg.com', nickname='sfs@ss.c', parentCommentNickname='2.1', content='sdfsf', status='0'}}], CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sdfsd@Ck.com', nickname='2.1', parentCommentNickname='2', content='2.1', status='0'}}, CommentListVo{commentId=39createdate=Wed Jan 19 22:03:07 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/86.png, replyComments=null, CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='2', content='ddddd', status='0'}}], CommentVo=CommentVo{parentCommentId=36, articleId=10005, email='2sdf@dd.c', nickname='2', parentCommentNickname='1', content='2', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='1@11.com', nickname='1', parentCommentNickname='null', content='1', status='0'}}], total=1}
2022-01-19 22:04:30:295 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 2ms
2022-01-19 22:04:30:295 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 22:10:40:994 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 22:10:40:995 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 22:10:40:995 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 22:10:40:995 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/article/10005
2022-01-19 22:10:40:995 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.ArticleController.getPublicArticleDetail
2022-01-19 22:10:40:995 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 22:10:40:995 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=ArticleVo{userInfo=UserInfoVo{userId=100001, nickName='ivan', userName='ivan', avatar='https://res-blog-public.s3.ca-central-1.amazonaws.com/default_avatar.jpg'}, category=CategoryVo{categoryId=1, name='Life ', articleCount=null}, BaseArticleVo{articleId=10005, status=1, type=1, title='dd', description='This is the doc of React markdown editor lite.
Enjoy!!', content='| Head | Head | Head | Head |
| --- | --- | --- | --- |
| Data | Data | Data | Data |
| Data | Data | Data | Data |

## 手把手教你写一个markdown编辑器

> 笔者在18年年末的时候接到一个开发任务——搭建一个AI项目的开放平台，其中的产品文档为转化为HTML格式的markdown文档。考虑到文档的即时更新，将文档信息做成了Ajax接口的形式。因此管理后台只需将textarea表单的内容通过markdown解析器进行HTML格式转化，然后将markdown内容和经转化的HTML文档都保存到数据库即可。
> 基本需求完成后，为了更好的用户体验，考虑将常用的编辑功能添加进来。改进版不仅支持了常用的文本编辑功能，还实现的UI界面的配置化，自定义语法解析器。本着造福伸手党的目的，以及积累些开源经验，笔者将该react 组件 [react-markdown-editor-lite](https://github.com/HarryChen0506/react-markdown-editor-lite) 进行了封装改造，并且发布到了开源社区。

### 预览
在线体验 [https://harrychen0506.github.io/react-markdown-editor-lite/](https://harrychen0506.github.io/react-markdown-editor-lite/)

![image](https://github.com//HarryChen0506/react-markdown-editor-lite/blob/master/image/react-markdown-editor-lite-v1.0.0.PNG?raw=true)

### 特点
* 轻量、基于React
* UI可配置, 如只显示编辑区或预览区
* 支持自定义markdown语法解析器,语法高亮等
* 支持常用的markdown编辑功能，如加粗，斜体等等...
* 支持功能按钮插拔化，用户可以自定义扩展组件
* 支持编辑区和预览区同步滚动

### 开发心得

- 文本编辑

  大多数常见的编辑器，包括富文本编辑器，利用了某些元素如div的contenteditable属性，配合selection、range、execCommand等API，实现了富文本编辑功能。这里面的实现比较复杂，所以有了"[为什么都说富文本编辑器是天坑？](https://www.zhihu.com/question/38699645)"这个说法。

  而markdown编辑器，核心的处理内容为简单语法的纯文本，复杂度相对来说比较低，并且input标签自带onSelect事件，可以很方便的获取选择信息（选择起始位置和选择文本值），因此要想实现编辑功能，只需将要改动的内容进行文本转换，然后进行重新拼接首尾，大功告成。
  
- markdown解析

  考察了几个社区流行的markdown解析器，比较流行的有[markdown](https://www.npmjs.com/package/markdown), [markdown-it](https://www.npmjs.com/package/markdown-it), [marked](https://www.npmjs.com/package/marked) 等等。综合考虑扩展性以及稳定性，笔者推荐使用markdown-it作为markdown的词法解析器，因为该解析器有比较多的插件，并且支持语法高亮。

- 同步滚动

  当选择分栏编辑的时候，滚动左侧的编辑区，右侧的预览区能自动滚动到对应的区域。方案参考了《[手把手教你用 100行代码实现基于 react的 markdown 输入 + 即时预览在线编辑器（一）](https://github.com/accforgit/blog-data/blob/master/%E5%9C%A8%E7%BA%BF%E7%BC%96%E8%BE%91%E5%99%A8/README/README1.md)》。只需先计算出输入框容器元素与预览框容器元素之间最大scroll范围的比例值，然后根据主动滚动元素自身的scrollTop做相应的比例换算，即可知道对方区域的scrollTop值。

- 关于UI
 
  - 项目的字体库选择了Font Awesome风格，并且只选取了项目所需要的一些图标。
  - 编辑器的整体css均可通过全局覆盖的形式进行自定义。目前暂时只支持灰色主题。
  - 编辑器的显示区域包括菜单栏，编辑器，预览区，工具栏，通过配置组件的config属性，可以选择默认的展示区域。
  
### Install

```js
npm install react-markdown-editor-lite --save
```

### Props

| Property | Description | Type | default | Remarks |
| --- | --- | --- | --- | --- |
| value | markdown content | String | '' | required |
| style | component container style | Object | {height: '100%'} | not required |
| config | component config | Object | {view: {...}, logger: {...}} | not required |
| onChange | emitting when editor has changed | Function | ({html, md}) => {} | not required |
| onImageUpload | when image uploaded, callback emitting will get image markdown text | (file: File, callback: (url: string) => void) => void; | ({file, callback}) => {} | not required |
| renderHTML | Render markdown text to HTML. You can return either string, function or Promise | (text: string) => string|function|Promise | none | **required** |

### Example

``` js
'use strict';
import React from 'react'
import ReactDOM from 'react-dom'
import MdEditor from 'react-markdown-editor-lite'
import MarkdownIt from 'markdown-it'
import emoji from 'markdown-it-emoji'
import subscript from 'markdown-it-sub'
import superscript from 'markdown-it-sup'
import footnote from 'markdown-it-footnote'
import deflist from 'markdown-it-deflist'
import abbreviation from 'markdown-it-abbr'
import insert from 'markdown-it-ins'
import mark from 'markdown-it-mark'
import tasklists from 'markdown-it-task-lists'
import hljs from 'highlight.js'
import 'highlight.js/styles/atom-one-light.css'
// import 'highlight.js/styles/github.css'
import './index.less';

const MOCK_DATA = "I Love React."
export default class Demo extends React.Component {
  mdEditor = null
  mdParser = null
  constructor(props) {
    super(props)
    // initial a parsera
    this.mdParser = new MarkdownIt({
      html: true,
      linkify: true,
      typographer: true,
      highlight: function (str, lang) {
        if (lang && hljs.getLanguage(lang)) {
          try {
            return hljs.highlight(lang, str).value
          } catch (__) {}
        }    
        return '' // use external default escaping
      }
    })
    .use(emoji)
    .use(subscript)
    .use(superscript)
    .use(footnote)
    .use(deflist)
    .use(abbreviation)
    .use(insert)
    .use(mark)
    .use(tasklists, { enabled: this.taskLists })
    this.renderHTML = this.renderHTML.bind(this)
  }
  handleEditorChange({html, md}) {
    console.log('handleEditorChange', html, md)
  }
  handleImageUpload(file, callback) {
    const reader = new FileReader()
    reader.onload = () => {      
      const convertBase64UrlToBlob = (urlData) => {  
        let arr = urlData.split(','), mime = arr[0].match(/:(.*?);/)[1]
        let bstr = atob(arr[1])
        let n = bstr.length
        let u8arr = new Uint8Array(n)
        while (n--) {
          u8arr[n] = bstr.charCodeAt(n)
        }
        return new Blob([u8arr], {type:mime})
      }
      const blob = convertBase64UrlToBlob(reader.result)
      setTimeout(() => {
        // setTimeout 模拟异步上传图片
        // 当异步上传获取图片地址后，执行calback回调（参数为imageUrl字符串），即可将图片地址写入markdown
        callback('https://avatars0.githubusercontent.com/u/21263805?s=40&v=4')
      }, 1000)
    }
    reader.readAsDataURL(file)
  }
  renderHTML(text) {
    // 模拟异步渲染Markdown
    return new Promise((resolve) => {
      setTimeout(() => {
        resolve(this.mdParser.render(text))
      }, 1000)
    })
  }
  handleGetMdValue = () => {   
    this.mdEditor && alert(this.mdEditor.getMdValue())      
  }
  handleGetHtmlValue = () => {    
    this.mdEditor && alert(this.mdEditor.getHtmlValue())
  }
  render() {
    return (      
      <div>
        <nav>
          <button onClick={this.handleGetMdValue} >getMdValue</button>  
          <button onClick={this.handleGetHtmlValue} >getHtmlValue</button>  
        </nav>
        <section style="height: 500px">
          <MdEditor 
            ref={node => this.mdEditor = node}
            value={MOCK_DATA}
            style={{height: '400px'}}
            renderHTML={this.renderHTML}
            config={{
              view: {
                menu: true,
                md: true,
                html: true
              },
              imageUrl: 'https://octodex.github.com/images/minion.png'
            }}
            onChange={this.handleEditorChange} 
            onImageUpload={this.handleImageUpload}
          />
        </section>                        
      </div>      
    )
  }
}
```

### 最后

   欢迎大家使用和反馈，[项目地址](https://github.com/HarryChen0506/react-markdown-editor-lite) (https://github.com/HarryChen0506/react-markdown-editor-lite)， 你的点赞将是我莫大的动力😊

![1.png](https://s3.ca-central-1.amazonaws.com/res-blog-public/res-dev/blog_1636946743939_1.png)', firstPicture='', viewCount=83, createDate='Sun Nov 07 14:09:29 EST 2021', updateDate='Tue Jan 18 22:54:08 EST 2022'}}, total=null}
2022-01-19 22:10:40:995 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 8ms
2022-01-19 22:10:40:995 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 22:10:40:997 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 22:10:40:997 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 22:10:40:997 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 22:10:40:997 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 22:10:40:997 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 22:10:40:997 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 22:10:40:997 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=36createdate=Wed Jan 19 21:15:59 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/19.png, replyComments=[CommentListVo{commentId=37createdate=Wed Jan 19 21:16:11 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/46.png, replyComments=[CommentListVo{commentId=38createdate=Wed Jan 19 21:16:27 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/95.png, replyComments=[CommentListVo{commentId=40createdate=Wed Jan 19 22:04:30 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/88.png, replyComments=null, CommentVo=CommentVo{parentCommentId=38, articleId=10005, email='test@gg.com', nickname='sfs@ss.c', parentCommentNickname='2.1', content='sdfsf', status='0'}}], CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sdfsd@Ck.com', nickname='2.1', parentCommentNickname='2', content='2.1', status='0'}}, CommentListVo{commentId=39createdate=Wed Jan 19 22:03:07 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/86.png, replyComments=null, CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='2', content='ddddd', status='0'}}], CommentVo=CommentVo{parentCommentId=36, articleId=10005, email='2sdf@dd.c', nickname='2', parentCommentNickname='1', content='2', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='1@11.com', nickname='1', parentCommentNickname='null', content='1', status='0'}}], total=1}
2022-01-19 22:10:40:997 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 11ms
2022-01-19 22:10:40:997 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 22:10:41:000 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 22:10:41:000 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 22:10:41:000 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 22:10:41:000 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 22:10:41:000 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 22:10:41:000 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 22:10:41:000 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=36createdate=Wed Jan 19 21:15:59 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/19.png, replyComments=[CommentListVo{commentId=37createdate=Wed Jan 19 21:16:11 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/46.png, replyComments=[CommentListVo{commentId=38createdate=Wed Jan 19 21:16:27 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/95.png, replyComments=[CommentListVo{commentId=40createdate=Wed Jan 19 22:04:30 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/88.png, replyComments=null, CommentVo=CommentVo{parentCommentId=38, articleId=10005, email='test@gg.com', nickname='sfs@ss.c', parentCommentNickname='2.1', content='sdfsf', status='0'}}], CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sdfsd@Ck.com', nickname='2.1', parentCommentNickname='2', content='2.1', status='0'}}, CommentListVo{commentId=39createdate=Wed Jan 19 22:03:07 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/86.png, replyComments=null, CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='2', content='ddddd', status='0'}}], CommentVo=CommentVo{parentCommentId=36, articleId=10005, email='2sdf@dd.c', nickname='2', parentCommentNickname='1', content='2', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='1@11.com', nickname='1', parentCommentNickname='null', content='1', status='0'}}], total=1}
2022-01-19 22:10:41:000 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 12ms
2022-01-19 22:10:41:000 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 22:10:41:499 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 22:10:41:500 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 22:10:41:500 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 22:10:41:500 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 22:10:41:500 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 22:10:41:500 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 22:10:41:500 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=36createdate=Wed Jan 19 21:15:59 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/19.png, replyComments=[CommentListVo{commentId=37createdate=Wed Jan 19 21:16:11 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/46.png, replyComments=[CommentListVo{commentId=38createdate=Wed Jan 19 21:16:27 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/95.png, replyComments=[CommentListVo{commentId=40createdate=Wed Jan 19 22:04:30 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/88.png, replyComments=null, CommentVo=CommentVo{parentCommentId=38, articleId=10005, email='test@gg.com', nickname='sfs@ss.c', parentCommentNickname='2.1', content='sdfsf', status='0'}}], CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sdfsd@Ck.com', nickname='2.1', parentCommentNickname='2', content='2.1', status='0'}}, CommentListVo{commentId=39createdate=Wed Jan 19 22:03:07 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/86.png, replyComments=null, CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='2', content='ddddd', status='0'}}], CommentVo=CommentVo{parentCommentId=36, articleId=10005, email='2sdf@dd.c', nickname='2', parentCommentNickname='1', content='2', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='1@11.com', nickname='1', parentCommentNickname='null', content='1', status='0'}}], total=1}
2022-01-19 22:10:41:500 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 2ms
2022-01-19 22:10:41:500 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 22:10:43:029 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 22:10:43:029 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 22:10:43:029 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 22:10:43:029 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 22:10:43:029 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 22:10:43:029 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 22:10:43:030 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=36createdate=Wed Jan 19 21:15:59 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/19.png, replyComments=[CommentListVo{commentId=37createdate=Wed Jan 19 21:16:11 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/46.png, replyComments=[CommentListVo{commentId=38createdate=Wed Jan 19 21:16:27 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/95.png, replyComments=[CommentListVo{commentId=40createdate=Wed Jan 19 22:04:30 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/88.png, replyComments=null, CommentVo=CommentVo{parentCommentId=38, articleId=10005, email='test@gg.com', nickname='sfs@ss.c', parentCommentNickname='2.1', content='sdfsf', status='0'}}], CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sdfsd@Ck.com', nickname='2.1', parentCommentNickname='2', content='2.1', status='0'}}, CommentListVo{commentId=39createdate=Wed Jan 19 22:03:07 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/86.png, replyComments=null, CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='2', content='ddddd', status='0'}}], CommentVo=CommentVo{parentCommentId=36, articleId=10005, email='2sdf@dd.c', nickname='2', parentCommentNickname='1', content='2', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='1@11.com', nickname='1', parentCommentNickname='null', content='1', status='0'}}], total=1}
2022-01-19 22:10:43:030 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 13ms
2022-01-19 22:10:43:030 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 22:10:43:031 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 22:10:43:031 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 22:10:43:031 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 22:10:43:031 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 22:10:43:031 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 22:10:43:031 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 22:10:43:031 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=36createdate=Wed Jan 19 21:15:59 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/19.png, replyComments=[CommentListVo{commentId=37createdate=Wed Jan 19 21:16:11 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/46.png, replyComments=[CommentListVo{commentId=38createdate=Wed Jan 19 21:16:27 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/95.png, replyComments=[CommentListVo{commentId=40createdate=Wed Jan 19 22:04:30 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/88.png, replyComments=null, CommentVo=CommentVo{parentCommentId=38, articleId=10005, email='test@gg.com', nickname='sfs@ss.c', parentCommentNickname='2.1', content='sdfsf', status='0'}}], CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sdfsd@Ck.com', nickname='2.1', parentCommentNickname='2', content='2.1', status='0'}}, CommentListVo{commentId=39createdate=Wed Jan 19 22:03:07 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/86.png, replyComments=null, CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='2', content='ddddd', status='0'}}], CommentVo=CommentVo{parentCommentId=36, articleId=10005, email='2sdf@dd.c', nickname='2', parentCommentNickname='1', content='2', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='1@11.com', nickname='1', parentCommentNickname='null', content='1', status='0'}}], total=1}
2022-01-19 22:10:43:031 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 15ms
2022-01-19 22:10:43:031 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 22:10:43:031 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 22:10:43:031 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 22:10:43:031 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 22:10:43:031 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/article/10005
2022-01-19 22:10:43:031 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.ArticleController.getPublicArticleDetail
2022-01-19 22:10:43:032 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 22:10:43:032 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=ArticleVo{userInfo=UserInfoVo{userId=100001, nickName='ivan', userName='ivan', avatar='https://res-blog-public.s3.ca-central-1.amazonaws.com/default_avatar.jpg'}, category=CategoryVo{categoryId=1, name='Life ', articleCount=null}, BaseArticleVo{articleId=10005, status=1, type=1, title='dd', description='This is the doc of React markdown editor lite.
Enjoy!!', content='| Head | Head | Head | Head |
| --- | --- | --- | --- |
| Data | Data | Data | Data |
| Data | Data | Data | Data |

## 手把手教你写一个markdown编辑器

> 笔者在18年年末的时候接到一个开发任务——搭建一个AI项目的开放平台，其中的产品文档为转化为HTML格式的markdown文档。考虑到文档的即时更新，将文档信息做成了Ajax接口的形式。因此管理后台只需将textarea表单的内容通过markdown解析器进行HTML格式转化，然后将markdown内容和经转化的HTML文档都保存到数据库即可。
> 基本需求完成后，为了更好的用户体验，考虑将常用的编辑功能添加进来。改进版不仅支持了常用的文本编辑功能，还实现的UI界面的配置化，自定义语法解析器。本着造福伸手党的目的，以及积累些开源经验，笔者将该react 组件 [react-markdown-editor-lite](https://github.com/HarryChen0506/react-markdown-editor-lite) 进行了封装改造，并且发布到了开源社区。

### 预览
在线体验 [https://harrychen0506.github.io/react-markdown-editor-lite/](https://harrychen0506.github.io/react-markdown-editor-lite/)

![image](https://github.com//HarryChen0506/react-markdown-editor-lite/blob/master/image/react-markdown-editor-lite-v1.0.0.PNG?raw=true)

### 特点
* 轻量、基于React
* UI可配置, 如只显示编辑区或预览区
* 支持自定义markdown语法解析器,语法高亮等
* 支持常用的markdown编辑功能，如加粗，斜体等等...
* 支持功能按钮插拔化，用户可以自定义扩展组件
* 支持编辑区和预览区同步滚动

### 开发心得

- 文本编辑

  大多数常见的编辑器，包括富文本编辑器，利用了某些元素如div的contenteditable属性，配合selection、range、execCommand等API，实现了富文本编辑功能。这里面的实现比较复杂，所以有了"[为什么都说富文本编辑器是天坑？](https://www.zhihu.com/question/38699645)"这个说法。

  而markdown编辑器，核心的处理内容为简单语法的纯文本，复杂度相对来说比较低，并且input标签自带onSelect事件，可以很方便的获取选择信息（选择起始位置和选择文本值），因此要想实现编辑功能，只需将要改动的内容进行文本转换，然后进行重新拼接首尾，大功告成。
  
- markdown解析

  考察了几个社区流行的markdown解析器，比较流行的有[markdown](https://www.npmjs.com/package/markdown), [markdown-it](https://www.npmjs.com/package/markdown-it), [marked](https://www.npmjs.com/package/marked) 等等。综合考虑扩展性以及稳定性，笔者推荐使用markdown-it作为markdown的词法解析器，因为该解析器有比较多的插件，并且支持语法高亮。

- 同步滚动

  当选择分栏编辑的时候，滚动左侧的编辑区，右侧的预览区能自动滚动到对应的区域。方案参考了《[手把手教你用 100行代码实现基于 react的 markdown 输入 + 即时预览在线编辑器（一）](https://github.com/accforgit/blog-data/blob/master/%E5%9C%A8%E7%BA%BF%E7%BC%96%E8%BE%91%E5%99%A8/README/README1.md)》。只需先计算出输入框容器元素与预览框容器元素之间最大scroll范围的比例值，然后根据主动滚动元素自身的scrollTop做相应的比例换算，即可知道对方区域的scrollTop值。

- 关于UI
 
  - 项目的字体库选择了Font Awesome风格，并且只选取了项目所需要的一些图标。
  - 编辑器的整体css均可通过全局覆盖的形式进行自定义。目前暂时只支持灰色主题。
  - 编辑器的显示区域包括菜单栏，编辑器，预览区，工具栏，通过配置组件的config属性，可以选择默认的展示区域。
  
### Install

```js
npm install react-markdown-editor-lite --save
```

### Props

| Property | Description | Type | default | Remarks |
| --- | --- | --- | --- | --- |
| value | markdown content | String | '' | required |
| style | component container style | Object | {height: '100%'} | not required |
| config | component config | Object | {view: {...}, logger: {...}} | not required |
| onChange | emitting when editor has changed | Function | ({html, md}) => {} | not required |
| onImageUpload | when image uploaded, callback emitting will get image markdown text | (file: File, callback: (url: string) => void) => void; | ({file, callback}) => {} | not required |
| renderHTML | Render markdown text to HTML. You can return either string, function or Promise | (text: string) => string|function|Promise | none | **required** |

### Example

``` js
'use strict';
import React from 'react'
import ReactDOM from 'react-dom'
import MdEditor from 'react-markdown-editor-lite'
import MarkdownIt from 'markdown-it'
import emoji from 'markdown-it-emoji'
import subscript from 'markdown-it-sub'
import superscript from 'markdown-it-sup'
import footnote from 'markdown-it-footnote'
import deflist from 'markdown-it-deflist'
import abbreviation from 'markdown-it-abbr'
import insert from 'markdown-it-ins'
import mark from 'markdown-it-mark'
import tasklists from 'markdown-it-task-lists'
import hljs from 'highlight.js'
import 'highlight.js/styles/atom-one-light.css'
// import 'highlight.js/styles/github.css'
import './index.less';

const MOCK_DATA = "I Love React."
export default class Demo extends React.Component {
  mdEditor = null
  mdParser = null
  constructor(props) {
    super(props)
    // initial a parsera
    this.mdParser = new MarkdownIt({
      html: true,
      linkify: true,
      typographer: true,
      highlight: function (str, lang) {
        if (lang && hljs.getLanguage(lang)) {
          try {
            return hljs.highlight(lang, str).value
          } catch (__) {}
        }    
        return '' // use external default escaping
      }
    })
    .use(emoji)
    .use(subscript)
    .use(superscript)
    .use(footnote)
    .use(deflist)
    .use(abbreviation)
    .use(insert)
    .use(mark)
    .use(tasklists, { enabled: this.taskLists })
    this.renderHTML = this.renderHTML.bind(this)
  }
  handleEditorChange({html, md}) {
    console.log('handleEditorChange', html, md)
  }
  handleImageUpload(file, callback) {
    const reader = new FileReader()
    reader.onload = () => {      
      const convertBase64UrlToBlob = (urlData) => {  
        let arr = urlData.split(','), mime = arr[0].match(/:(.*?);/)[1]
        let bstr = atob(arr[1])
        let n = bstr.length
        let u8arr = new Uint8Array(n)
        while (n--) {
          u8arr[n] = bstr.charCodeAt(n)
        }
        return new Blob([u8arr], {type:mime})
      }
      const blob = convertBase64UrlToBlob(reader.result)
      setTimeout(() => {
        // setTimeout 模拟异步上传图片
        // 当异步上传获取图片地址后，执行calback回调（参数为imageUrl字符串），即可将图片地址写入markdown
        callback('https://avatars0.githubusercontent.com/u/21263805?s=40&v=4')
      }, 1000)
    }
    reader.readAsDataURL(file)
  }
  renderHTML(text) {
    // 模拟异步渲染Markdown
    return new Promise((resolve) => {
      setTimeout(() => {
        resolve(this.mdParser.render(text))
      }, 1000)
    })
  }
  handleGetMdValue = () => {   
    this.mdEditor && alert(this.mdEditor.getMdValue())      
  }
  handleGetHtmlValue = () => {    
    this.mdEditor && alert(this.mdEditor.getHtmlValue())
  }
  render() {
    return (      
      <div>
        <nav>
          <button onClick={this.handleGetMdValue} >getMdValue</button>  
          <button onClick={this.handleGetHtmlValue} >getHtmlValue</button>  
        </nav>
        <section style="height: 500px">
          <MdEditor 
            ref={node => this.mdEditor = node}
            value={MOCK_DATA}
            style={{height: '400px'}}
            renderHTML={this.renderHTML}
            config={{
              view: {
                menu: true,
                md: true,
                html: true
              },
              imageUrl: 'https://octodex.github.com/images/minion.png'
            }}
            onChange={this.handleEditorChange} 
            onImageUpload={this.handleImageUpload}
          />
        </section>                        
      </div>      
    )
  }
}
```

### 最后

   欢迎大家使用和反馈，[项目地址](https://github.com/HarryChen0506/react-markdown-editor-lite) (https://github.com/HarryChen0506/react-markdown-editor-lite)， 你的点赞将是我莫大的动力😊

![1.png](https://s3.ca-central-1.amazonaws.com/res-blog-public/res-dev/blog_1636946743939_1.png)', firstPicture='', viewCount=83, createDate='Sun Nov 07 14:09:29 EST 2021', updateDate='Tue Jan 18 22:54:08 EST 2022'}}, total=null}
2022-01-19 22:10:43:032 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 15ms
2022-01-19 22:10:43:032 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 22:10:43:514 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 22:10:43:514 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 22:10:43:514 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 22:10:43:514 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 22:10:43:514 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 22:10:43:515 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 22:10:43:515 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=36createdate=Wed Jan 19 21:15:59 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/19.png, replyComments=[CommentListVo{commentId=37createdate=Wed Jan 19 21:16:11 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/46.png, replyComments=[CommentListVo{commentId=38createdate=Wed Jan 19 21:16:27 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/95.png, replyComments=[CommentListVo{commentId=40createdate=Wed Jan 19 22:04:30 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/88.png, replyComments=null, CommentVo=CommentVo{parentCommentId=38, articleId=10005, email='test@gg.com', nickname='sfs@ss.c', parentCommentNickname='2.1', content='sdfsf', status='0'}}], CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sdfsd@Ck.com', nickname='2.1', parentCommentNickname='2', content='2.1', status='0'}}, CommentListVo{commentId=39createdate=Wed Jan 19 22:03:07 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/86.png, replyComments=null, CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='2', content='ddddd', status='0'}}], CommentVo=CommentVo{parentCommentId=36, articleId=10005, email='2sdf@dd.c', nickname='2', parentCommentNickname='1', content='2', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='1@11.com', nickname='1', parentCommentNickname='null', content='1', status='0'}}], total=1}
2022-01-19 22:10:43:515 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 1ms
2022-01-19 22:10:43:515 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 22:10:46:365 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 22:10:46:365 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 22:10:46:365 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 22:10:46:365 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 22:10:46:366 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 22:10:46:366 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 22:10:46:366 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=36createdate=Wed Jan 19 21:15:59 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/19.png, replyComments=[CommentListVo{commentId=37createdate=Wed Jan 19 21:16:11 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/46.png, replyComments=[CommentListVo{commentId=38createdate=Wed Jan 19 21:16:27 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/95.png, replyComments=[CommentListVo{commentId=40createdate=Wed Jan 19 22:04:30 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/88.png, replyComments=null, CommentVo=CommentVo{parentCommentId=38, articleId=10005, email='test@gg.com', nickname='sfs@ss.c', parentCommentNickname='2.1', content='sdfsf', status='0'}}], CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sdfsd@Ck.com', nickname='2.1', parentCommentNickname='2', content='2.1', status='0'}}, CommentListVo{commentId=39createdate=Wed Jan 19 22:03:07 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/86.png, replyComments=null, CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='2', content='ddddd', status='0'}}], CommentVo=CommentVo{parentCommentId=36, articleId=10005, email='2sdf@dd.c', nickname='2', parentCommentNickname='1', content='2', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='1@11.com', nickname='1', parentCommentNickname='null', content='1', status='0'}}], total=1}
2022-01-19 22:10:46:366 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 16ms
2022-01-19 22:10:46:366 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 22:10:46:367 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 22:10:46:367 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 22:10:46:367 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 22:10:46:367 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/article/10005
2022-01-19 22:10:46:367 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.ArticleController.getPublicArticleDetail
2022-01-19 22:10:46:367 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 22:10:46:367 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=ArticleVo{userInfo=UserInfoVo{userId=100001, nickName='ivan', userName='ivan', avatar='https://res-blog-public.s3.ca-central-1.amazonaws.com/default_avatar.jpg'}, category=CategoryVo{categoryId=1, name='Life ', articleCount=null}, BaseArticleVo{articleId=10005, status=1, type=1, title='dd', description='This is the doc of React markdown editor lite.
Enjoy!!', content='| Head | Head | Head | Head |
| --- | --- | --- | --- |
| Data | Data | Data | Data |
| Data | Data | Data | Data |

## 手把手教你写一个markdown编辑器

> 笔者在18年年末的时候接到一个开发任务——搭建一个AI项目的开放平台，其中的产品文档为转化为HTML格式的markdown文档。考虑到文档的即时更新，将文档信息做成了Ajax接口的形式。因此管理后台只需将textarea表单的内容通过markdown解析器进行HTML格式转化，然后将markdown内容和经转化的HTML文档都保存到数据库即可。
> 基本需求完成后，为了更好的用户体验，考虑将常用的编辑功能添加进来。改进版不仅支持了常用的文本编辑功能，还实现的UI界面的配置化，自定义语法解析器。本着造福伸手党的目的，以及积累些开源经验，笔者将该react 组件 [react-markdown-editor-lite](https://github.com/HarryChen0506/react-markdown-editor-lite) 进行了封装改造，并且发布到了开源社区。

### 预览
在线体验 [https://harrychen0506.github.io/react-markdown-editor-lite/](https://harrychen0506.github.io/react-markdown-editor-lite/)

![image](https://github.com//HarryChen0506/react-markdown-editor-lite/blob/master/image/react-markdown-editor-lite-v1.0.0.PNG?raw=true)

### 特点
* 轻量、基于React
* UI可配置, 如只显示编辑区或预览区
* 支持自定义markdown语法解析器,语法高亮等
* 支持常用的markdown编辑功能，如加粗，斜体等等...
* 支持功能按钮插拔化，用户可以自定义扩展组件
* 支持编辑区和预览区同步滚动

### 开发心得

- 文本编辑

  大多数常见的编辑器，包括富文本编辑器，利用了某些元素如div的contenteditable属性，配合selection、range、execCommand等API，实现了富文本编辑功能。这里面的实现比较复杂，所以有了"[为什么都说富文本编辑器是天坑？](https://www.zhihu.com/question/38699645)"这个说法。

  而markdown编辑器，核心的处理内容为简单语法的纯文本，复杂度相对来说比较低，并且input标签自带onSelect事件，可以很方便的获取选择信息（选择起始位置和选择文本值），因此要想实现编辑功能，只需将要改动的内容进行文本转换，然后进行重新拼接首尾，大功告成。
  
- markdown解析

  考察了几个社区流行的markdown解析器，比较流行的有[markdown](https://www.npmjs.com/package/markdown), [markdown-it](https://www.npmjs.com/package/markdown-it), [marked](https://www.npmjs.com/package/marked) 等等。综合考虑扩展性以及稳定性，笔者推荐使用markdown-it作为markdown的词法解析器，因为该解析器有比较多的插件，并且支持语法高亮。

- 同步滚动

  当选择分栏编辑的时候，滚动左侧的编辑区，右侧的预览区能自动滚动到对应的区域。方案参考了《[手把手教你用 100行代码实现基于 react的 markdown 输入 + 即时预览在线编辑器（一）](https://github.com/accforgit/blog-data/blob/master/%E5%9C%A8%E7%BA%BF%E7%BC%96%E8%BE%91%E5%99%A8/README/README1.md)》。只需先计算出输入框容器元素与预览框容器元素之间最大scroll范围的比例值，然后根据主动滚动元素自身的scrollTop做相应的比例换算，即可知道对方区域的scrollTop值。

- 关于UI
 
  - 项目的字体库选择了Font Awesome风格，并且只选取了项目所需要的一些图标。
  - 编辑器的整体css均可通过全局覆盖的形式进行自定义。目前暂时只支持灰色主题。
  - 编辑器的显示区域包括菜单栏，编辑器，预览区，工具栏，通过配置组件的config属性，可以选择默认的展示区域。
  
### Install

```js
npm install react-markdown-editor-lite --save
```

### Props

| Property | Description | Type | default | Remarks |
| --- | --- | --- | --- | --- |
| value | markdown content | String | '' | required |
| style | component container style | Object | {height: '100%'} | not required |
| config | component config | Object | {view: {...}, logger: {...}} | not required |
| onChange | emitting when editor has changed | Function | ({html, md}) => {} | not required |
| onImageUpload | when image uploaded, callback emitting will get image markdown text | (file: File, callback: (url: string) => void) => void; | ({file, callback}) => {} | not required |
| renderHTML | Render markdown text to HTML. You can return either string, function or Promise | (text: string) => string|function|Promise | none | **required** |

### Example

``` js
'use strict';
import React from 'react'
import ReactDOM from 'react-dom'
import MdEditor from 'react-markdown-editor-lite'
import MarkdownIt from 'markdown-it'
import emoji from 'markdown-it-emoji'
import subscript from 'markdown-it-sub'
import superscript from 'markdown-it-sup'
import footnote from 'markdown-it-footnote'
import deflist from 'markdown-it-deflist'
import abbreviation from 'markdown-it-abbr'
import insert from 'markdown-it-ins'
import mark from 'markdown-it-mark'
import tasklists from 'markdown-it-task-lists'
import hljs from 'highlight.js'
import 'highlight.js/styles/atom-one-light.css'
// import 'highlight.js/styles/github.css'
import './index.less';

const MOCK_DATA = "I Love React."
export default class Demo extends React.Component {
  mdEditor = null
  mdParser = null
  constructor(props) {
    super(props)
    // initial a parsera
    this.mdParser = new MarkdownIt({
      html: true,
      linkify: true,
      typographer: true,
      highlight: function (str, lang) {
        if (lang && hljs.getLanguage(lang)) {
          try {
            return hljs.highlight(lang, str).value
          } catch (__) {}
        }    
        return '' // use external default escaping
      }
    })
    .use(emoji)
    .use(subscript)
    .use(superscript)
    .use(footnote)
    .use(deflist)
    .use(abbreviation)
    .use(insert)
    .use(mark)
    .use(tasklists, { enabled: this.taskLists })
    this.renderHTML = this.renderHTML.bind(this)
  }
  handleEditorChange({html, md}) {
    console.log('handleEditorChange', html, md)
  }
  handleImageUpload(file, callback) {
    const reader = new FileReader()
    reader.onload = () => {      
      const convertBase64UrlToBlob = (urlData) => {  
        let arr = urlData.split(','), mime = arr[0].match(/:(.*?);/)[1]
        let bstr = atob(arr[1])
        let n = bstr.length
        let u8arr = new Uint8Array(n)
        while (n--) {
          u8arr[n] = bstr.charCodeAt(n)
        }
        return new Blob([u8arr], {type:mime})
      }
      const blob = convertBase64UrlToBlob(reader.result)
      setTimeout(() => {
        // setTimeout 模拟异步上传图片
        // 当异步上传获取图片地址后，执行calback回调（参数为imageUrl字符串），即可将图片地址写入markdown
        callback('https://avatars0.githubusercontent.com/u/21263805?s=40&v=4')
      }, 1000)
    }
    reader.readAsDataURL(file)
  }
  renderHTML(text) {
    // 模拟异步渲染Markdown
    return new Promise((resolve) => {
      setTimeout(() => {
        resolve(this.mdParser.render(text))
      }, 1000)
    })
  }
  handleGetMdValue = () => {   
    this.mdEditor && alert(this.mdEditor.getMdValue())      
  }
  handleGetHtmlValue = () => {    
    this.mdEditor && alert(this.mdEditor.getHtmlValue())
  }
  render() {
    return (      
      <div>
        <nav>
          <button onClick={this.handleGetMdValue} >getMdValue</button>  
          <button onClick={this.handleGetHtmlValue} >getHtmlValue</button>  
        </nav>
        <section style="height: 500px">
          <MdEditor 
            ref={node => this.mdEditor = node}
            value={MOCK_DATA}
            style={{height: '400px'}}
            renderHTML={this.renderHTML}
            config={{
              view: {
                menu: true,
                md: true,
                html: true
              },
              imageUrl: 'https://octodex.github.com/images/minion.png'
            }}
            onChange={this.handleEditorChange} 
            onImageUpload={this.handleImageUpload}
          />
        </section>                        
      </div>      
    )
  }
}
```

### 最后

   欢迎大家使用和反馈，[项目地址](https://github.com/HarryChen0506/react-markdown-editor-lite) (https://github.com/HarryChen0506/react-markdown-editor-lite)， 你的点赞将是我莫大的动力😊

![1.png](https://s3.ca-central-1.amazonaws.com/res-blog-public/res-dev/blog_1636946743939_1.png)', firstPicture='', viewCount=83, createDate='Sun Nov 07 14:09:29 EST 2021', updateDate='Tue Jan 18 22:54:08 EST 2022'}}, total=null}
2022-01-19 22:10:46:367 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 18ms
2022-01-19 22:10:46:367 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 22:10:46:368 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 22:10:46:369 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 22:10:46:369 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 22:10:46:369 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 22:10:46:369 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 22:10:46:369 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 22:10:46:369 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=36createdate=Wed Jan 19 21:15:59 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/19.png, replyComments=[CommentListVo{commentId=37createdate=Wed Jan 19 21:16:11 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/46.png, replyComments=[CommentListVo{commentId=38createdate=Wed Jan 19 21:16:27 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/95.png, replyComments=[CommentListVo{commentId=40createdate=Wed Jan 19 22:04:30 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/88.png, replyComments=null, CommentVo=CommentVo{parentCommentId=38, articleId=10005, email='test@gg.com', nickname='sfs@ss.c', parentCommentNickname='2.1', content='sdfsf', status='0'}}], CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sdfsd@Ck.com', nickname='2.1', parentCommentNickname='2', content='2.1', status='0'}}, CommentListVo{commentId=39createdate=Wed Jan 19 22:03:07 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/86.png, replyComments=null, CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='2', content='ddddd', status='0'}}], CommentVo=CommentVo{parentCommentId=36, articleId=10005, email='2sdf@dd.c', nickname='2', parentCommentNickname='1', content='2', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='1@11.com', nickname='1', parentCommentNickname='null', content='1', status='0'}}], total=1}
2022-01-19 22:10:46:369 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 18ms
2022-01-19 22:10:46:369 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 22:10:46:447 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 22:10:46:447 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 22:10:46:447 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 22:10:46:447 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 22:10:46:447 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 22:10:46:447 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 22:10:46:447 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=36createdate=Wed Jan 19 21:15:59 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/19.png, replyComments=[CommentListVo{commentId=37createdate=Wed Jan 19 21:16:11 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/46.png, replyComments=[CommentListVo{commentId=38createdate=Wed Jan 19 21:16:27 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/95.png, replyComments=[CommentListVo{commentId=40createdate=Wed Jan 19 22:04:30 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/88.png, replyComments=null, CommentVo=CommentVo{parentCommentId=38, articleId=10005, email='test@gg.com', nickname='sfs@ss.c', parentCommentNickname='2.1', content='sdfsf', status='0'}}], CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sdfsd@Ck.com', nickname='2.1', parentCommentNickname='2', content='2.1', status='0'}}, CommentListVo{commentId=39createdate=Wed Jan 19 22:03:07 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/86.png, replyComments=null, CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='2', content='ddddd', status='0'}}], CommentVo=CommentVo{parentCommentId=36, articleId=10005, email='2sdf@dd.c', nickname='2', parentCommentNickname='1', content='2', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='1@11.com', nickname='1', parentCommentNickname='null', content='1', status='0'}}], total=1}
2022-01-19 22:10:46:447 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 2ms
2022-01-19 22:10:46:447 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 22:11:28:745 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 22:11:28:746 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 22:11:28:746 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 22:11:28:746 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/article/10005
2022-01-19 22:11:28:746 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.ArticleController.getPublicArticleDetail
2022-01-19 22:11:28:746 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 22:11:28:746 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=ArticleVo{userInfo=UserInfoVo{userId=100001, nickName='ivan', userName='ivan', avatar='https://res-blog-public.s3.ca-central-1.amazonaws.com/default_avatar.jpg'}, category=CategoryVo{categoryId=1, name='Life ', articleCount=null}, BaseArticleVo{articleId=10005, status=1, type=1, title='dd', description='This is the doc of React markdown editor lite.
Enjoy!!', content='| Head | Head | Head | Head |
| --- | --- | --- | --- |
| Data | Data | Data | Data |
| Data | Data | Data | Data |

## 手把手教你写一个markdown编辑器

> 笔者在18年年末的时候接到一个开发任务——搭建一个AI项目的开放平台，其中的产品文档为转化为HTML格式的markdown文档。考虑到文档的即时更新，将文档信息做成了Ajax接口的形式。因此管理后台只需将textarea表单的内容通过markdown解析器进行HTML格式转化，然后将markdown内容和经转化的HTML文档都保存到数据库即可。
> 基本需求完成后，为了更好的用户体验，考虑将常用的编辑功能添加进来。改进版不仅支持了常用的文本编辑功能，还实现的UI界面的配置化，自定义语法解析器。本着造福伸手党的目的，以及积累些开源经验，笔者将该react 组件 [react-markdown-editor-lite](https://github.com/HarryChen0506/react-markdown-editor-lite) 进行了封装改造，并且发布到了开源社区。

### 预览
在线体验 [https://harrychen0506.github.io/react-markdown-editor-lite/](https://harrychen0506.github.io/react-markdown-editor-lite/)

![image](https://github.com//HarryChen0506/react-markdown-editor-lite/blob/master/image/react-markdown-editor-lite-v1.0.0.PNG?raw=true)

### 特点
* 轻量、基于React
* UI可配置, 如只显示编辑区或预览区
* 支持自定义markdown语法解析器,语法高亮等
* 支持常用的markdown编辑功能，如加粗，斜体等等...
* 支持功能按钮插拔化，用户可以自定义扩展组件
* 支持编辑区和预览区同步滚动

### 开发心得

- 文本编辑

  大多数常见的编辑器，包括富文本编辑器，利用了某些元素如div的contenteditable属性，配合selection、range、execCommand等API，实现了富文本编辑功能。这里面的实现比较复杂，所以有了"[为什么都说富文本编辑器是天坑？](https://www.zhihu.com/question/38699645)"这个说法。

  而markdown编辑器，核心的处理内容为简单语法的纯文本，复杂度相对来说比较低，并且input标签自带onSelect事件，可以很方便的获取选择信息（选择起始位置和选择文本值），因此要想实现编辑功能，只需将要改动的内容进行文本转换，然后进行重新拼接首尾，大功告成。
  
- markdown解析

  考察了几个社区流行的markdown解析器，比较流行的有[markdown](https://www.npmjs.com/package/markdown), [markdown-it](https://www.npmjs.com/package/markdown-it), [marked](https://www.npmjs.com/package/marked) 等等。综合考虑扩展性以及稳定性，笔者推荐使用markdown-it作为markdown的词法解析器，因为该解析器有比较多的插件，并且支持语法高亮。

- 同步滚动

  当选择分栏编辑的时候，滚动左侧的编辑区，右侧的预览区能自动滚动到对应的区域。方案参考了《[手把手教你用 100行代码实现基于 react的 markdown 输入 + 即时预览在线编辑器（一）](https://github.com/accforgit/blog-data/blob/master/%E5%9C%A8%E7%BA%BF%E7%BC%96%E8%BE%91%E5%99%A8/README/README1.md)》。只需先计算出输入框容器元素与预览框容器元素之间最大scroll范围的比例值，然后根据主动滚动元素自身的scrollTop做相应的比例换算，即可知道对方区域的scrollTop值。

- 关于UI
 
  - 项目的字体库选择了Font Awesome风格，并且只选取了项目所需要的一些图标。
  - 编辑器的整体css均可通过全局覆盖的形式进行自定义。目前暂时只支持灰色主题。
  - 编辑器的显示区域包括菜单栏，编辑器，预览区，工具栏，通过配置组件的config属性，可以选择默认的展示区域。
  
### Install

```js
npm install react-markdown-editor-lite --save
```

### Props

| Property | Description | Type | default | Remarks |
| --- | --- | --- | --- | --- |
| value | markdown content | String | '' | required |
| style | component container style | Object | {height: '100%'} | not required |
| config | component config | Object | {view: {...}, logger: {...}} | not required |
| onChange | emitting when editor has changed | Function | ({html, md}) => {} | not required |
| onImageUpload | when image uploaded, callback emitting will get image markdown text | (file: File, callback: (url: string) => void) => void; | ({file, callback}) => {} | not required |
| renderHTML | Render markdown text to HTML. You can return either string, function or Promise | (text: string) => string|function|Promise | none | **required** |

### Example

``` js
'use strict';
import React from 'react'
import ReactDOM from 'react-dom'
import MdEditor from 'react-markdown-editor-lite'
import MarkdownIt from 'markdown-it'
import emoji from 'markdown-it-emoji'
import subscript from 'markdown-it-sub'
import superscript from 'markdown-it-sup'
import footnote from 'markdown-it-footnote'
import deflist from 'markdown-it-deflist'
import abbreviation from 'markdown-it-abbr'
import insert from 'markdown-it-ins'
import mark from 'markdown-it-mark'
import tasklists from 'markdown-it-task-lists'
import hljs from 'highlight.js'
import 'highlight.js/styles/atom-one-light.css'
// import 'highlight.js/styles/github.css'
import './index.less';

const MOCK_DATA = "I Love React."
export default class Demo extends React.Component {
  mdEditor = null
  mdParser = null
  constructor(props) {
    super(props)
    // initial a parsera
    this.mdParser = new MarkdownIt({
      html: true,
      linkify: true,
      typographer: true,
      highlight: function (str, lang) {
        if (lang && hljs.getLanguage(lang)) {
          try {
            return hljs.highlight(lang, str).value
          } catch (__) {}
        }    
        return '' // use external default escaping
      }
    })
    .use(emoji)
    .use(subscript)
    .use(superscript)
    .use(footnote)
    .use(deflist)
    .use(abbreviation)
    .use(insert)
    .use(mark)
    .use(tasklists, { enabled: this.taskLists })
    this.renderHTML = this.renderHTML.bind(this)
  }
  handleEditorChange({html, md}) {
    console.log('handleEditorChange', html, md)
  }
  handleImageUpload(file, callback) {
    const reader = new FileReader()
    reader.onload = () => {      
      const convertBase64UrlToBlob = (urlData) => {  
        let arr = urlData.split(','), mime = arr[0].match(/:(.*?);/)[1]
        let bstr = atob(arr[1])
        let n = bstr.length
        let u8arr = new Uint8Array(n)
        while (n--) {
          u8arr[n] = bstr.charCodeAt(n)
        }
        return new Blob([u8arr], {type:mime})
      }
      const blob = convertBase64UrlToBlob(reader.result)
      setTimeout(() => {
        // setTimeout 模拟异步上传图片
        // 当异步上传获取图片地址后，执行calback回调（参数为imageUrl字符串），即可将图片地址写入markdown
        callback('https://avatars0.githubusercontent.com/u/21263805?s=40&v=4')
      }, 1000)
    }
    reader.readAsDataURL(file)
  }
  renderHTML(text) {
    // 模拟异步渲染Markdown
    return new Promise((resolve) => {
      setTimeout(() => {
        resolve(this.mdParser.render(text))
      }, 1000)
    })
  }
  handleGetMdValue = () => {   
    this.mdEditor && alert(this.mdEditor.getMdValue())      
  }
  handleGetHtmlValue = () => {    
    this.mdEditor && alert(this.mdEditor.getHtmlValue())
  }
  render() {
    return (      
      <div>
        <nav>
          <button onClick={this.handleGetMdValue} >getMdValue</button>  
          <button onClick={this.handleGetHtmlValue} >getHtmlValue</button>  
        </nav>
        <section style="height: 500px">
          <MdEditor 
            ref={node => this.mdEditor = node}
            value={MOCK_DATA}
            style={{height: '400px'}}
            renderHTML={this.renderHTML}
            config={{
              view: {
                menu: true,
                md: true,
                html: true
              },
              imageUrl: 'https://octodex.github.com/images/minion.png'
            }}
            onChange={this.handleEditorChange} 
            onImageUpload={this.handleImageUpload}
          />
        </section>                        
      </div>      
    )
  }
}
```

### 最后

   欢迎大家使用和反馈，[项目地址](https://github.com/HarryChen0506/react-markdown-editor-lite) (https://github.com/HarryChen0506/react-markdown-editor-lite)， 你的点赞将是我莫大的动力😊

![1.png](https://s3.ca-central-1.amazonaws.com/res-blog-public/res-dev/blog_1636946743939_1.png)', firstPicture='', viewCount=83, createDate='Sun Nov 07 14:09:29 EST 2021', updateDate='Tue Jan 18 22:54:08 EST 2022'}}, total=null}
2022-01-19 22:11:28:746 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 29ms
2022-01-19 22:11:28:746 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 22:11:28:751 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 22:11:28:751 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 22:11:28:751 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 22:11:28:751 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 22:11:28:751 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 22:11:28:751 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 22:11:28:751 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 22:11:28:751 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 22:11:28:751 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 22:11:28:751 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 22:11:28:751 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 22:11:28:751 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 22:11:28:751 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=36createdate=Wed Jan 19 21:15:59 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/19.png, replyComments=[CommentListVo{commentId=37createdate=Wed Jan 19 21:16:11 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/46.png, replyComments=[CommentListVo{commentId=38createdate=Wed Jan 19 21:16:27 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/95.png, replyComments=[CommentListVo{commentId=40createdate=Wed Jan 19 22:04:30 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/88.png, replyComments=null, CommentVo=CommentVo{parentCommentId=38, articleId=10005, email='test@gg.com', nickname='sfs@ss.c', parentCommentNickname='2.1', content='sdfsf', status='0'}}], CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sdfsd@Ck.com', nickname='2.1', parentCommentNickname='2', content='2.1', status='0'}}, CommentListVo{commentId=39createdate=Wed Jan 19 22:03:07 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/86.png, replyComments=null, CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='2', content='ddddd', status='0'}}], CommentVo=CommentVo{parentCommentId=36, articleId=10005, email='2sdf@dd.c', nickname='2', parentCommentNickname='1', content='2', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='1@11.com', nickname='1', parentCommentNickname='null', content='1', status='0'}}], total=1}
2022-01-19 22:11:28:751 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=36createdate=Wed Jan 19 21:15:59 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/19.png, replyComments=[CommentListVo{commentId=37createdate=Wed Jan 19 21:16:11 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/46.png, replyComments=[CommentListVo{commentId=38createdate=Wed Jan 19 21:16:27 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/95.png, replyComments=[CommentListVo{commentId=40createdate=Wed Jan 19 22:04:30 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/88.png, replyComments=null, CommentVo=CommentVo{parentCommentId=38, articleId=10005, email='test@gg.com', nickname='sfs@ss.c', parentCommentNickname='2.1', content='sdfsf', status='0'}}], CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sdfsd@Ck.com', nickname='2.1', parentCommentNickname='2', content='2.1', status='0'}}, CommentListVo{commentId=39createdate=Wed Jan 19 22:03:07 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/86.png, replyComments=null, CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='2', content='ddddd', status='0'}}], CommentVo=CommentVo{parentCommentId=36, articleId=10005, email='2sdf@dd.c', nickname='2', parentCommentNickname='1', content='2', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='1@11.com', nickname='1', parentCommentNickname='null', content='1', status='0'}}], total=1}
2022-01-19 22:11:28:751 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 35ms
2022-01-19 22:11:28:751 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 35ms
2022-01-19 22:11:28:751 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 22:11:28:751 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 22:11:29:268 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 22:11:29:268 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 22:11:29:268 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 22:11:29:268 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 22:11:29:268 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 22:11:29:268 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 22:11:29:268 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=36createdate=Wed Jan 19 21:15:59 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/19.png, replyComments=[CommentListVo{commentId=37createdate=Wed Jan 19 21:16:11 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/46.png, replyComments=[CommentListVo{commentId=38createdate=Wed Jan 19 21:16:27 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/95.png, replyComments=[CommentListVo{commentId=40createdate=Wed Jan 19 22:04:30 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/88.png, replyComments=null, CommentVo=CommentVo{parentCommentId=38, articleId=10005, email='test@gg.com', nickname='sfs@ss.c', parentCommentNickname='2.1', content='sdfsf', status='0'}}], CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sdfsd@Ck.com', nickname='2.1', parentCommentNickname='2', content='2.1', status='0'}}, CommentListVo{commentId=39createdate=Wed Jan 19 22:03:07 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/86.png, replyComments=null, CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='2', content='ddddd', status='0'}}], CommentVo=CommentVo{parentCommentId=36, articleId=10005, email='2sdf@dd.c', nickname='2', parentCommentNickname='1', content='2', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='1@11.com', nickname='1', parentCommentNickname='null', content='1', status='0'}}], total=1}
2022-01-19 22:11:29:268 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 3ms
2022-01-19 22:11:29:268 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 22:11:48:432 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 22:11:48:432 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 22:11:48:432 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 22:11:48:432 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 22:11:48:432 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 22:11:48:432 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 22:11:48:432 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 22:11:48:432 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 22:11:48:432 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 22:11:48:432 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 22:11:48:433 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 22:11:48:433 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 22:11:48:433 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=36createdate=Wed Jan 19 21:15:59 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/19.png, replyComments=[CommentListVo{commentId=37createdate=Wed Jan 19 21:16:11 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/46.png, replyComments=[CommentListVo{commentId=38createdate=Wed Jan 19 21:16:27 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/95.png, replyComments=[CommentListVo{commentId=40createdate=Wed Jan 19 22:04:30 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/88.png, replyComments=null, CommentVo=CommentVo{parentCommentId=38, articleId=10005, email='test@gg.com', nickname='sfs@ss.c', parentCommentNickname='2.1', content='sdfsf', status='0'}}], CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sdfsd@Ck.com', nickname='2.1', parentCommentNickname='2', content='2.1', status='0'}}, CommentListVo{commentId=39createdate=Wed Jan 19 22:03:07 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/86.png, replyComments=null, CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='2', content='ddddd', status='0'}}], CommentVo=CommentVo{parentCommentId=36, articleId=10005, email='2sdf@dd.c', nickname='2', parentCommentNickname='1', content='2', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='1@11.com', nickname='1', parentCommentNickname='null', content='1', status='0'}}], total=1}
2022-01-19 22:11:48:433 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 8ms
2022-01-19 22:11:48:433 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 22:11:48:433 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=36createdate=Wed Jan 19 21:15:59 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/19.png, replyComments=[CommentListVo{commentId=37createdate=Wed Jan 19 21:16:11 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/46.png, replyComments=[CommentListVo{commentId=38createdate=Wed Jan 19 21:16:27 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/95.png, replyComments=[CommentListVo{commentId=40createdate=Wed Jan 19 22:04:30 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/88.png, replyComments=null, CommentVo=CommentVo{parentCommentId=38, articleId=10005, email='test@gg.com', nickname='sfs@ss.c', parentCommentNickname='2.1', content='sdfsf', status='0'}}], CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sdfsd@Ck.com', nickname='2.1', parentCommentNickname='2', content='2.1', status='0'}}, CommentListVo{commentId=39createdate=Wed Jan 19 22:03:07 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/86.png, replyComments=null, CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='2', content='ddddd', status='0'}}], CommentVo=CommentVo{parentCommentId=36, articleId=10005, email='2sdf@dd.c', nickname='2', parentCommentNickname='1', content='2', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='1@11.com', nickname='1', parentCommentNickname='null', content='1', status='0'}}], total=1}
2022-01-19 22:11:48:433 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 8ms
2022-01-19 22:11:48:433 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 22:11:48:439 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 22:11:48:439 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 22:11:48:439 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 22:11:48:439 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/article/10005
2022-01-19 22:11:48:439 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.ArticleController.getPublicArticleDetail
2022-01-19 22:11:48:439 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 22:11:48:439 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=ArticleVo{userInfo=UserInfoVo{userId=100001, nickName='ivan', userName='ivan', avatar='https://res-blog-public.s3.ca-central-1.amazonaws.com/default_avatar.jpg'}, category=CategoryVo{categoryId=1, name='Life ', articleCount=null}, BaseArticleVo{articleId=10005, status=1, type=1, title='dd', description='This is the doc of React markdown editor lite.
Enjoy!!', content='| Head | Head | Head | Head |
| --- | --- | --- | --- |
| Data | Data | Data | Data |
| Data | Data | Data | Data |

## 手把手教你写一个markdown编辑器

> 笔者在18年年末的时候接到一个开发任务——搭建一个AI项目的开放平台，其中的产品文档为转化为HTML格式的markdown文档。考虑到文档的即时更新，将文档信息做成了Ajax接口的形式。因此管理后台只需将textarea表单的内容通过markdown解析器进行HTML格式转化，然后将markdown内容和经转化的HTML文档都保存到数据库即可。
> 基本需求完成后，为了更好的用户体验，考虑将常用的编辑功能添加进来。改进版不仅支持了常用的文本编辑功能，还实现的UI界面的配置化，自定义语法解析器。本着造福伸手党的目的，以及积累些开源经验，笔者将该react 组件 [react-markdown-editor-lite](https://github.com/HarryChen0506/react-markdown-editor-lite) 进行了封装改造，并且发布到了开源社区。

### 预览
在线体验 [https://harrychen0506.github.io/react-markdown-editor-lite/](https://harrychen0506.github.io/react-markdown-editor-lite/)

![image](https://github.com//HarryChen0506/react-markdown-editor-lite/blob/master/image/react-markdown-editor-lite-v1.0.0.PNG?raw=true)

### 特点
* 轻量、基于React
* UI可配置, 如只显示编辑区或预览区
* 支持自定义markdown语法解析器,语法高亮等
* 支持常用的markdown编辑功能，如加粗，斜体等等...
* 支持功能按钮插拔化，用户可以自定义扩展组件
* 支持编辑区和预览区同步滚动

### 开发心得

- 文本编辑

  大多数常见的编辑器，包括富文本编辑器，利用了某些元素如div的contenteditable属性，配合selection、range、execCommand等API，实现了富文本编辑功能。这里面的实现比较复杂，所以有了"[为什么都说富文本编辑器是天坑？](https://www.zhihu.com/question/38699645)"这个说法。

  而markdown编辑器，核心的处理内容为简单语法的纯文本，复杂度相对来说比较低，并且input标签自带onSelect事件，可以很方便的获取选择信息（选择起始位置和选择文本值），因此要想实现编辑功能，只需将要改动的内容进行文本转换，然后进行重新拼接首尾，大功告成。
  
- markdown解析

  考察了几个社区流行的markdown解析器，比较流行的有[markdown](https://www.npmjs.com/package/markdown), [markdown-it](https://www.npmjs.com/package/markdown-it), [marked](https://www.npmjs.com/package/marked) 等等。综合考虑扩展性以及稳定性，笔者推荐使用markdown-it作为markdown的词法解析器，因为该解析器有比较多的插件，并且支持语法高亮。

- 同步滚动

  当选择分栏编辑的时候，滚动左侧的编辑区，右侧的预览区能自动滚动到对应的区域。方案参考了《[手把手教你用 100行代码实现基于 react的 markdown 输入 + 即时预览在线编辑器（一）](https://github.com/accforgit/blog-data/blob/master/%E5%9C%A8%E7%BA%BF%E7%BC%96%E8%BE%91%E5%99%A8/README/README1.md)》。只需先计算出输入框容器元素与预览框容器元素之间最大scroll范围的比例值，然后根据主动滚动元素自身的scrollTop做相应的比例换算，即可知道对方区域的scrollTop值。

- 关于UI
 
  - 项目的字体库选择了Font Awesome风格，并且只选取了项目所需要的一些图标。
  - 编辑器的整体css均可通过全局覆盖的形式进行自定义。目前暂时只支持灰色主题。
  - 编辑器的显示区域包括菜单栏，编辑器，预览区，工具栏，通过配置组件的config属性，可以选择默认的展示区域。
  
### Install

```js
npm install react-markdown-editor-lite --save
```

### Props

| Property | Description | Type | default | Remarks |
| --- | --- | --- | --- | --- |
| value | markdown content | String | '' | required |
| style | component container style | Object | {height: '100%'} | not required |
| config | component config | Object | {view: {...}, logger: {...}} | not required |
| onChange | emitting when editor has changed | Function | ({html, md}) => {} | not required |
| onImageUpload | when image uploaded, callback emitting will get image markdown text | (file: File, callback: (url: string) => void) => void; | ({file, callback}) => {} | not required |
| renderHTML | Render markdown text to HTML. You can return either string, function or Promise | (text: string) => string|function|Promise | none | **required** |

### Example

``` js
'use strict';
import React from 'react'
import ReactDOM from 'react-dom'
import MdEditor from 'react-markdown-editor-lite'
import MarkdownIt from 'markdown-it'
import emoji from 'markdown-it-emoji'
import subscript from 'markdown-it-sub'
import superscript from 'markdown-it-sup'
import footnote from 'markdown-it-footnote'
import deflist from 'markdown-it-deflist'
import abbreviation from 'markdown-it-abbr'
import insert from 'markdown-it-ins'
import mark from 'markdown-it-mark'
import tasklists from 'markdown-it-task-lists'
import hljs from 'highlight.js'
import 'highlight.js/styles/atom-one-light.css'
// import 'highlight.js/styles/github.css'
import './index.less';

const MOCK_DATA = "I Love React."
export default class Demo extends React.Component {
  mdEditor = null
  mdParser = null
  constructor(props) {
    super(props)
    // initial a parsera
    this.mdParser = new MarkdownIt({
      html: true,
      linkify: true,
      typographer: true,
      highlight: function (str, lang) {
        if (lang && hljs.getLanguage(lang)) {
          try {
            return hljs.highlight(lang, str).value
          } catch (__) {}
        }    
        return '' // use external default escaping
      }
    })
    .use(emoji)
    .use(subscript)
    .use(superscript)
    .use(footnote)
    .use(deflist)
    .use(abbreviation)
    .use(insert)
    .use(mark)
    .use(tasklists, { enabled: this.taskLists })
    this.renderHTML = this.renderHTML.bind(this)
  }
  handleEditorChange({html, md}) {
    console.log('handleEditorChange', html, md)
  }
  handleImageUpload(file, callback) {
    const reader = new FileReader()
    reader.onload = () => {      
      const convertBase64UrlToBlob = (urlData) => {  
        let arr = urlData.split(','), mime = arr[0].match(/:(.*?);/)[1]
        let bstr = atob(arr[1])
        let n = bstr.length
        let u8arr = new Uint8Array(n)
        while (n--) {
          u8arr[n] = bstr.charCodeAt(n)
        }
        return new Blob([u8arr], {type:mime})
      }
      const blob = convertBase64UrlToBlob(reader.result)
      setTimeout(() => {
        // setTimeout 模拟异步上传图片
        // 当异步上传获取图片地址后，执行calback回调（参数为imageUrl字符串），即可将图片地址写入markdown
        callback('https://avatars0.githubusercontent.com/u/21263805?s=40&v=4')
      }, 1000)
    }
    reader.readAsDataURL(file)
  }
  renderHTML(text) {
    // 模拟异步渲染Markdown
    return new Promise((resolve) => {
      setTimeout(() => {
        resolve(this.mdParser.render(text))
      }, 1000)
    })
  }
  handleGetMdValue = () => {   
    this.mdEditor && alert(this.mdEditor.getMdValue())      
  }
  handleGetHtmlValue = () => {    
    this.mdEditor && alert(this.mdEditor.getHtmlValue())
  }
  render() {
    return (      
      <div>
        <nav>
          <button onClick={this.handleGetMdValue} >getMdValue</button>  
          <button onClick={this.handleGetHtmlValue} >getHtmlValue</button>  
        </nav>
        <section style="height: 500px">
          <MdEditor 
            ref={node => this.mdEditor = node}
            value={MOCK_DATA}
            style={{height: '400px'}}
            renderHTML={this.renderHTML}
            config={{
              view: {
                menu: true,
                md: true,
                html: true
              },
              imageUrl: 'https://octodex.github.com/images/minion.png'
            }}
            onChange={this.handleEditorChange} 
            onImageUpload={this.handleImageUpload}
          />
        </section>                        
      </div>      
    )
  }
}
```

### 最后

   欢迎大家使用和反馈，[项目地址](https://github.com/HarryChen0506/react-markdown-editor-lite) (https://github.com/HarryChen0506/react-markdown-editor-lite)， 你的点赞将是我莫大的动力😊

![1.png](https://s3.ca-central-1.amazonaws.com/res-blog-public/res-dev/blog_1636946743939_1.png)', firstPicture='', viewCount=83, createDate='Sun Nov 07 14:09:29 EST 2021', updateDate='Tue Jan 18 22:54:08 EST 2022'}}, total=null}
2022-01-19 22:11:48:439 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 15ms
2022-01-19 22:11:48:439 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 22:11:48:929 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 22:11:48:929 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 22:11:48:929 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 22:11:48:929 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 22:11:48:929 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 22:11:48:929 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 22:11:48:929 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=36createdate=Wed Jan 19 21:15:59 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/19.png, replyComments=[CommentListVo{commentId=37createdate=Wed Jan 19 21:16:11 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/46.png, replyComments=[CommentListVo{commentId=38createdate=Wed Jan 19 21:16:27 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/95.png, replyComments=[CommentListVo{commentId=40createdate=Wed Jan 19 22:04:30 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/88.png, replyComments=null, CommentVo=CommentVo{parentCommentId=38, articleId=10005, email='test@gg.com', nickname='sfs@ss.c', parentCommentNickname='2.1', content='sdfsf', status='0'}}], CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sdfsd@Ck.com', nickname='2.1', parentCommentNickname='2', content='2.1', status='0'}}, CommentListVo{commentId=39createdate=Wed Jan 19 22:03:07 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/86.png, replyComments=null, CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='2', content='ddddd', status='0'}}], CommentVo=CommentVo{parentCommentId=36, articleId=10005, email='2sdf@dd.c', nickname='2', parentCommentNickname='1', content='2', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='1@11.com', nickname='1', parentCommentNickname='null', content='1', status='0'}}], total=1}
2022-01-19 22:11:48:929 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 2ms
2022-01-19 22:11:48:929 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 22:15:11:950 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 22:15:11:950 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 22:15:11:950 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 22:15:11:950 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 22:15:11:950 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 22:15:11:950 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 22:15:11:950 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=36createdate=Wed Jan 19 21:15:59 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/19.png, replyComments=[CommentListVo{commentId=37createdate=Wed Jan 19 21:16:11 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/46.png, replyComments=[CommentListVo{commentId=38createdate=Wed Jan 19 21:16:27 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/95.png, replyComments=[CommentListVo{commentId=40createdate=Wed Jan 19 22:04:30 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/88.png, replyComments=null, CommentVo=CommentVo{parentCommentId=38, articleId=10005, email='test@gg.com', nickname='sfs@ss.c', parentCommentNickname='2.1', content='sdfsf', status='0'}}], CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sdfsd@Ck.com', nickname='2.1', parentCommentNickname='2', content='2.1', status='0'}}, CommentListVo{commentId=39createdate=Wed Jan 19 22:03:07 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/86.png, replyComments=null, CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='2', content='ddddd', status='0'}}], CommentVo=CommentVo{parentCommentId=36, articleId=10005, email='2sdf@dd.c', nickname='2', parentCommentNickname='1', content='2', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='1@11.com', nickname='1', parentCommentNickname='null', content='1', status='0'}}], total=1}
2022-01-19 22:15:11:950 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 2ms
2022-01-19 22:15:11:950 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 22:15:11:950 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 22:15:11:950 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 22:15:11:950 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 22:15:11:950 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 22:15:11:950 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 22:15:11:950 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 22:15:11:950 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=36createdate=Wed Jan 19 21:15:59 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/19.png, replyComments=[CommentListVo{commentId=37createdate=Wed Jan 19 21:16:11 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/46.png, replyComments=[CommentListVo{commentId=38createdate=Wed Jan 19 21:16:27 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/95.png, replyComments=[CommentListVo{commentId=40createdate=Wed Jan 19 22:04:30 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/88.png, replyComments=null, CommentVo=CommentVo{parentCommentId=38, articleId=10005, email='test@gg.com', nickname='sfs@ss.c', parentCommentNickname='2.1', content='sdfsf', status='0'}}], CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sdfsd@Ck.com', nickname='2.1', parentCommentNickname='2', content='2.1', status='0'}}, CommentListVo{commentId=39createdate=Wed Jan 19 22:03:07 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/86.png, replyComments=null, CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='2', content='ddddd', status='0'}}], CommentVo=CommentVo{parentCommentId=36, articleId=10005, email='2sdf@dd.c', nickname='2', parentCommentNickname='1', content='2', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='1@11.com', nickname='1', parentCommentNickname='null', content='1', status='0'}}], total=1}
2022-01-19 22:15:11:950 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 3ms
2022-01-19 22:15:11:950 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 22:15:11:952 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 22:15:11:952 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 22:15:11:952 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 22:15:11:952 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/article/10005
2022-01-19 22:15:11:952 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.ArticleController.getPublicArticleDetail
2022-01-19 22:15:11:952 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 22:15:11:952 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=ArticleVo{userInfo=UserInfoVo{userId=100001, nickName='ivan', userName='ivan', avatar='https://res-blog-public.s3.ca-central-1.amazonaws.com/default_avatar.jpg'}, category=CategoryVo{categoryId=1, name='Life ', articleCount=null}, BaseArticleVo{articleId=10005, status=1, type=1, title='dd', description='This is the doc of React markdown editor lite.
Enjoy!!', content='| Head | Head | Head | Head |
| --- | --- | --- | --- |
| Data | Data | Data | Data |
| Data | Data | Data | Data |

## 手把手教你写一个markdown编辑器

> 笔者在18年年末的时候接到一个开发任务——搭建一个AI项目的开放平台，其中的产品文档为转化为HTML格式的markdown文档。考虑到文档的即时更新，将文档信息做成了Ajax接口的形式。因此管理后台只需将textarea表单的内容通过markdown解析器进行HTML格式转化，然后将markdown内容和经转化的HTML文档都保存到数据库即可。
> 基本需求完成后，为了更好的用户体验，考虑将常用的编辑功能添加进来。改进版不仅支持了常用的文本编辑功能，还实现的UI界面的配置化，自定义语法解析器。本着造福伸手党的目的，以及积累些开源经验，笔者将该react 组件 [react-markdown-editor-lite](https://github.com/HarryChen0506/react-markdown-editor-lite) 进行了封装改造，并且发布到了开源社区。

### 预览
在线体验 [https://harrychen0506.github.io/react-markdown-editor-lite/](https://harrychen0506.github.io/react-markdown-editor-lite/)

![image](https://github.com//HarryChen0506/react-markdown-editor-lite/blob/master/image/react-markdown-editor-lite-v1.0.0.PNG?raw=true)

### 特点
* 轻量、基于React
* UI可配置, 如只显示编辑区或预览区
* 支持自定义markdown语法解析器,语法高亮等
* 支持常用的markdown编辑功能，如加粗，斜体等等...
* 支持功能按钮插拔化，用户可以自定义扩展组件
* 支持编辑区和预览区同步滚动

### 开发心得

- 文本编辑

  大多数常见的编辑器，包括富文本编辑器，利用了某些元素如div的contenteditable属性，配合selection、range、execCommand等API，实现了富文本编辑功能。这里面的实现比较复杂，所以有了"[为什么都说富文本编辑器是天坑？](https://www.zhihu.com/question/38699645)"这个说法。

  而markdown编辑器，核心的处理内容为简单语法的纯文本，复杂度相对来说比较低，并且input标签自带onSelect事件，可以很方便的获取选择信息（选择起始位置和选择文本值），因此要想实现编辑功能，只需将要改动的内容进行文本转换，然后进行重新拼接首尾，大功告成。
  
- markdown解析

  考察了几个社区流行的markdown解析器，比较流行的有[markdown](https://www.npmjs.com/package/markdown), [markdown-it](https://www.npmjs.com/package/markdown-it), [marked](https://www.npmjs.com/package/marked) 等等。综合考虑扩展性以及稳定性，笔者推荐使用markdown-it作为markdown的词法解析器，因为该解析器有比较多的插件，并且支持语法高亮。

- 同步滚动

  当选择分栏编辑的时候，滚动左侧的编辑区，右侧的预览区能自动滚动到对应的区域。方案参考了《[手把手教你用 100行代码实现基于 react的 markdown 输入 + 即时预览在线编辑器（一）](https://github.com/accforgit/blog-data/blob/master/%E5%9C%A8%E7%BA%BF%E7%BC%96%E8%BE%91%E5%99%A8/README/README1.md)》。只需先计算出输入框容器元素与预览框容器元素之间最大scroll范围的比例值，然后根据主动滚动元素自身的scrollTop做相应的比例换算，即可知道对方区域的scrollTop值。

- 关于UI
 
  - 项目的字体库选择了Font Awesome风格，并且只选取了项目所需要的一些图标。
  - 编辑器的整体css均可通过全局覆盖的形式进行自定义。目前暂时只支持灰色主题。
  - 编辑器的显示区域包括菜单栏，编辑器，预览区，工具栏，通过配置组件的config属性，可以选择默认的展示区域。
  
### Install

```js
npm install react-markdown-editor-lite --save
```

### Props

| Property | Description | Type | default | Remarks |
| --- | --- | --- | --- | --- |
| value | markdown content | String | '' | required |
| style | component container style | Object | {height: '100%'} | not required |
| config | component config | Object | {view: {...}, logger: {...}} | not required |
| onChange | emitting when editor has changed | Function | ({html, md}) => {} | not required |
| onImageUpload | when image uploaded, callback emitting will get image markdown text | (file: File, callback: (url: string) => void) => void; | ({file, callback}) => {} | not required |
| renderHTML | Render markdown text to HTML. You can return either string, function or Promise | (text: string) => string|function|Promise | none | **required** |

### Example

``` js
'use strict';
import React from 'react'
import ReactDOM from 'react-dom'
import MdEditor from 'react-markdown-editor-lite'
import MarkdownIt from 'markdown-it'
import emoji from 'markdown-it-emoji'
import subscript from 'markdown-it-sub'
import superscript from 'markdown-it-sup'
import footnote from 'markdown-it-footnote'
import deflist from 'markdown-it-deflist'
import abbreviation from 'markdown-it-abbr'
import insert from 'markdown-it-ins'
import mark from 'markdown-it-mark'
import tasklists from 'markdown-it-task-lists'
import hljs from 'highlight.js'
import 'highlight.js/styles/atom-one-light.css'
// import 'highlight.js/styles/github.css'
import './index.less';

const MOCK_DATA = "I Love React."
export default class Demo extends React.Component {
  mdEditor = null
  mdParser = null
  constructor(props) {
    super(props)
    // initial a parsera
    this.mdParser = new MarkdownIt({
      html: true,
      linkify: true,
      typographer: true,
      highlight: function (str, lang) {
        if (lang && hljs.getLanguage(lang)) {
          try {
            return hljs.highlight(lang, str).value
          } catch (__) {}
        }    
        return '' // use external default escaping
      }
    })
    .use(emoji)
    .use(subscript)
    .use(superscript)
    .use(footnote)
    .use(deflist)
    .use(abbreviation)
    .use(insert)
    .use(mark)
    .use(tasklists, { enabled: this.taskLists })
    this.renderHTML = this.renderHTML.bind(this)
  }
  handleEditorChange({html, md}) {
    console.log('handleEditorChange', html, md)
  }
  handleImageUpload(file, callback) {
    const reader = new FileReader()
    reader.onload = () => {      
      const convertBase64UrlToBlob = (urlData) => {  
        let arr = urlData.split(','), mime = arr[0].match(/:(.*?);/)[1]
        let bstr = atob(arr[1])
        let n = bstr.length
        let u8arr = new Uint8Array(n)
        while (n--) {
          u8arr[n] = bstr.charCodeAt(n)
        }
        return new Blob([u8arr], {type:mime})
      }
      const blob = convertBase64UrlToBlob(reader.result)
      setTimeout(() => {
        // setTimeout 模拟异步上传图片
        // 当异步上传获取图片地址后，执行calback回调（参数为imageUrl字符串），即可将图片地址写入markdown
        callback('https://avatars0.githubusercontent.com/u/21263805?s=40&v=4')
      }, 1000)
    }
    reader.readAsDataURL(file)
  }
  renderHTML(text) {
    // 模拟异步渲染Markdown
    return new Promise((resolve) => {
      setTimeout(() => {
        resolve(this.mdParser.render(text))
      }, 1000)
    })
  }
  handleGetMdValue = () => {   
    this.mdEditor && alert(this.mdEditor.getMdValue())      
  }
  handleGetHtmlValue = () => {    
    this.mdEditor && alert(this.mdEditor.getHtmlValue())
  }
  render() {
    return (      
      <div>
        <nav>
          <button onClick={this.handleGetMdValue} >getMdValue</button>  
          <button onClick={this.handleGetHtmlValue} >getHtmlValue</button>  
        </nav>
        <section style="height: 500px">
          <MdEditor 
            ref={node => this.mdEditor = node}
            value={MOCK_DATA}
            style={{height: '400px'}}
            renderHTML={this.renderHTML}
            config={{
              view: {
                menu: true,
                md: true,
                html: true
              },
              imageUrl: 'https://octodex.github.com/images/minion.png'
            }}
            onChange={this.handleEditorChange} 
            onImageUpload={this.handleImageUpload}
          />
        </section>                        
      </div>      
    )
  }
}
```

### 最后

   欢迎大家使用和反馈，[项目地址](https://github.com/HarryChen0506/react-markdown-editor-lite) (https://github.com/HarryChen0506/react-markdown-editor-lite)， 你的点赞将是我莫大的动力😊

![1.png](https://s3.ca-central-1.amazonaws.com/res-blog-public/res-dev/blog_1636946743939_1.png)', firstPicture='', viewCount=83, createDate='Sun Nov 07 14:09:29 EST 2021', updateDate='Tue Jan 18 22:54:08 EST 2022'}}, total=null}
2022-01-19 22:15:11:952 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 6ms
2022-01-19 22:15:11:952 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 22:15:12:020 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 22:15:12:020 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 22:15:12:020 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 22:15:12:020 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 22:15:12:020 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 22:15:12:020 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 22:15:12:020 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=36createdate=Wed Jan 19 21:15:59 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/19.png, replyComments=[CommentListVo{commentId=37createdate=Wed Jan 19 21:16:11 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/46.png, replyComments=[CommentListVo{commentId=38createdate=Wed Jan 19 21:16:27 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/95.png, replyComments=[CommentListVo{commentId=40createdate=Wed Jan 19 22:04:30 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/88.png, replyComments=null, CommentVo=CommentVo{parentCommentId=38, articleId=10005, email='test@gg.com', nickname='sfs@ss.c', parentCommentNickname='2.1', content='sdfsf', status='0'}}], CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sdfsd@Ck.com', nickname='2.1', parentCommentNickname='2', content='2.1', status='0'}}, CommentListVo{commentId=39createdate=Wed Jan 19 22:03:07 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/86.png, replyComments=null, CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='2', content='ddddd', status='0'}}], CommentVo=CommentVo{parentCommentId=36, articleId=10005, email='2sdf@dd.c', nickname='2', parentCommentNickname='1', content='2', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='1@11.com', nickname='1', parentCommentNickname='null', content='1', status='0'}}], total=1}
2022-01-19 22:15:12:020 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 2ms
2022-01-19 22:15:12:020 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 22:15:31:650 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 22:15:31:650 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 22:15:31:650 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 22:15:31:650 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 22:15:31:650 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 22:15:31:650 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 22:15:31:650 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=36createdate=Wed Jan 19 21:15:59 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/19.png, replyComments=[CommentListVo{commentId=37createdate=Wed Jan 19 21:16:11 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/46.png, replyComments=[CommentListVo{commentId=38createdate=Wed Jan 19 21:16:27 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/95.png, replyComments=[CommentListVo{commentId=40createdate=Wed Jan 19 22:04:30 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/88.png, replyComments=null, CommentVo=CommentVo{parentCommentId=38, articleId=10005, email='test@gg.com', nickname='sfs@ss.c', parentCommentNickname='2.1', content='sdfsf', status='0'}}], CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sdfsd@Ck.com', nickname='2.1', parentCommentNickname='2', content='2.1', status='0'}}, CommentListVo{commentId=39createdate=Wed Jan 19 22:03:07 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/86.png, replyComments=null, CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='2', content='ddddd', status='0'}}], CommentVo=CommentVo{parentCommentId=36, articleId=10005, email='2sdf@dd.c', nickname='2', parentCommentNickname='1', content='2', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='1@11.com', nickname='1', parentCommentNickname='null', content='1', status='0'}}], total=1}
2022-01-19 22:15:31:651 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 10ms
2022-01-19 22:15:31:651 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 22:15:31:650 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 22:15:31:651 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 22:15:31:651 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 22:15:31:651 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 22:15:31:651 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 22:15:31:651 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 22:15:31:651 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=36createdate=Wed Jan 19 21:15:59 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/19.png, replyComments=[CommentListVo{commentId=37createdate=Wed Jan 19 21:16:11 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/46.png, replyComments=[CommentListVo{commentId=38createdate=Wed Jan 19 21:16:27 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/95.png, replyComments=[CommentListVo{commentId=40createdate=Wed Jan 19 22:04:30 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/88.png, replyComments=null, CommentVo=CommentVo{parentCommentId=38, articleId=10005, email='test@gg.com', nickname='sfs@ss.c', parentCommentNickname='2.1', content='sdfsf', status='0'}}], CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sdfsd@Ck.com', nickname='2.1', parentCommentNickname='2', content='2.1', status='0'}}, CommentListVo{commentId=39createdate=Wed Jan 19 22:03:07 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/86.png, replyComments=null, CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='2', content='ddddd', status='0'}}], CommentVo=CommentVo{parentCommentId=36, articleId=10005, email='2sdf@dd.c', nickname='2', parentCommentNickname='1', content='2', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='1@11.com', nickname='1', parentCommentNickname='null', content='1', status='0'}}], total=1}
2022-01-19 22:15:31:651 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 11ms
2022-01-19 22:15:31:651 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 22:15:31:652 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 22:15:31:652 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 22:15:31:652 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 22:15:31:653 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/article/10005
2022-01-19 22:15:31:653 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.ArticleController.getPublicArticleDetail
2022-01-19 22:15:31:653 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 22:15:31:653 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=ArticleVo{userInfo=UserInfoVo{userId=100001, nickName='ivan', userName='ivan', avatar='https://res-blog-public.s3.ca-central-1.amazonaws.com/default_avatar.jpg'}, category=CategoryVo{categoryId=1, name='Life ', articleCount=null}, BaseArticleVo{articleId=10005, status=1, type=1, title='dd', description='This is the doc of React markdown editor lite.
Enjoy!!', content='| Head | Head | Head | Head |
| --- | --- | --- | --- |
| Data | Data | Data | Data |
| Data | Data | Data | Data |

## 手把手教你写一个markdown编辑器

> 笔者在18年年末的时候接到一个开发任务——搭建一个AI项目的开放平台，其中的产品文档为转化为HTML格式的markdown文档。考虑到文档的即时更新，将文档信息做成了Ajax接口的形式。因此管理后台只需将textarea表单的内容通过markdown解析器进行HTML格式转化，然后将markdown内容和经转化的HTML文档都保存到数据库即可。
> 基本需求完成后，为了更好的用户体验，考虑将常用的编辑功能添加进来。改进版不仅支持了常用的文本编辑功能，还实现的UI界面的配置化，自定义语法解析器。本着造福伸手党的目的，以及积累些开源经验，笔者将该react 组件 [react-markdown-editor-lite](https://github.com/HarryChen0506/react-markdown-editor-lite) 进行了封装改造，并且发布到了开源社区。

### 预览
在线体验 [https://harrychen0506.github.io/react-markdown-editor-lite/](https://harrychen0506.github.io/react-markdown-editor-lite/)

![image](https://github.com//HarryChen0506/react-markdown-editor-lite/blob/master/image/react-markdown-editor-lite-v1.0.0.PNG?raw=true)

### 特点
* 轻量、基于React
* UI可配置, 如只显示编辑区或预览区
* 支持自定义markdown语法解析器,语法高亮等
* 支持常用的markdown编辑功能，如加粗，斜体等等...
* 支持功能按钮插拔化，用户可以自定义扩展组件
* 支持编辑区和预览区同步滚动

### 开发心得

- 文本编辑

  大多数常见的编辑器，包括富文本编辑器，利用了某些元素如div的contenteditable属性，配合selection、range、execCommand等API，实现了富文本编辑功能。这里面的实现比较复杂，所以有了"[为什么都说富文本编辑器是天坑？](https://www.zhihu.com/question/38699645)"这个说法。

  而markdown编辑器，核心的处理内容为简单语法的纯文本，复杂度相对来说比较低，并且input标签自带onSelect事件，可以很方便的获取选择信息（选择起始位置和选择文本值），因此要想实现编辑功能，只需将要改动的内容进行文本转换，然后进行重新拼接首尾，大功告成。
  
- markdown解析

  考察了几个社区流行的markdown解析器，比较流行的有[markdown](https://www.npmjs.com/package/markdown), [markdown-it](https://www.npmjs.com/package/markdown-it), [marked](https://www.npmjs.com/package/marked) 等等。综合考虑扩展性以及稳定性，笔者推荐使用markdown-it作为markdown的词法解析器，因为该解析器有比较多的插件，并且支持语法高亮。

- 同步滚动

  当选择分栏编辑的时候，滚动左侧的编辑区，右侧的预览区能自动滚动到对应的区域。方案参考了《[手把手教你用 100行代码实现基于 react的 markdown 输入 + 即时预览在线编辑器（一）](https://github.com/accforgit/blog-data/blob/master/%E5%9C%A8%E7%BA%BF%E7%BC%96%E8%BE%91%E5%99%A8/README/README1.md)》。只需先计算出输入框容器元素与预览框容器元素之间最大scroll范围的比例值，然后根据主动滚动元素自身的scrollTop做相应的比例换算，即可知道对方区域的scrollTop值。

- 关于UI
 
  - 项目的字体库选择了Font Awesome风格，并且只选取了项目所需要的一些图标。
  - 编辑器的整体css均可通过全局覆盖的形式进行自定义。目前暂时只支持灰色主题。
  - 编辑器的显示区域包括菜单栏，编辑器，预览区，工具栏，通过配置组件的config属性，可以选择默认的展示区域。
  
### Install

```js
npm install react-markdown-editor-lite --save
```

### Props

| Property | Description | Type | default | Remarks |
| --- | --- | --- | --- | --- |
| value | markdown content | String | '' | required |
| style | component container style | Object | {height: '100%'} | not required |
| config | component config | Object | {view: {...}, logger: {...}} | not required |
| onChange | emitting when editor has changed | Function | ({html, md}) => {} | not required |
| onImageUpload | when image uploaded, callback emitting will get image markdown text | (file: File, callback: (url: string) => void) => void; | ({file, callback}) => {} | not required |
| renderHTML | Render markdown text to HTML. You can return either string, function or Promise | (text: string) => string|function|Promise | none | **required** |

### Example

``` js
'use strict';
import React from 'react'
import ReactDOM from 'react-dom'
import MdEditor from 'react-markdown-editor-lite'
import MarkdownIt from 'markdown-it'
import emoji from 'markdown-it-emoji'
import subscript from 'markdown-it-sub'
import superscript from 'markdown-it-sup'
import footnote from 'markdown-it-footnote'
import deflist from 'markdown-it-deflist'
import abbreviation from 'markdown-it-abbr'
import insert from 'markdown-it-ins'
import mark from 'markdown-it-mark'
import tasklists from 'markdown-it-task-lists'
import hljs from 'highlight.js'
import 'highlight.js/styles/atom-one-light.css'
// import 'highlight.js/styles/github.css'
import './index.less';

const MOCK_DATA = "I Love React."
export default class Demo extends React.Component {
  mdEditor = null
  mdParser = null
  constructor(props) {
    super(props)
    // initial a parsera
    this.mdParser = new MarkdownIt({
      html: true,
      linkify: true,
      typographer: true,
      highlight: function (str, lang) {
        if (lang && hljs.getLanguage(lang)) {
          try {
            return hljs.highlight(lang, str).value
          } catch (__) {}
        }    
        return '' // use external default escaping
      }
    })
    .use(emoji)
    .use(subscript)
    .use(superscript)
    .use(footnote)
    .use(deflist)
    .use(abbreviation)
    .use(insert)
    .use(mark)
    .use(tasklists, { enabled: this.taskLists })
    this.renderHTML = this.renderHTML.bind(this)
  }
  handleEditorChange({html, md}) {
    console.log('handleEditorChange', html, md)
  }
  handleImageUpload(file, callback) {
    const reader = new FileReader()
    reader.onload = () => {      
      const convertBase64UrlToBlob = (urlData) => {  
        let arr = urlData.split(','), mime = arr[0].match(/:(.*?);/)[1]
        let bstr = atob(arr[1])
        let n = bstr.length
        let u8arr = new Uint8Array(n)
        while (n--) {
          u8arr[n] = bstr.charCodeAt(n)
        }
        return new Blob([u8arr], {type:mime})
      }
      const blob = convertBase64UrlToBlob(reader.result)
      setTimeout(() => {
        // setTimeout 模拟异步上传图片
        // 当异步上传获取图片地址后，执行calback回调（参数为imageUrl字符串），即可将图片地址写入markdown
        callback('https://avatars0.githubusercontent.com/u/21263805?s=40&v=4')
      }, 1000)
    }
    reader.readAsDataURL(file)
  }
  renderHTML(text) {
    // 模拟异步渲染Markdown
    return new Promise((resolve) => {
      setTimeout(() => {
        resolve(this.mdParser.render(text))
      }, 1000)
    })
  }
  handleGetMdValue = () => {   
    this.mdEditor && alert(this.mdEditor.getMdValue())      
  }
  handleGetHtmlValue = () => {    
    this.mdEditor && alert(this.mdEditor.getHtmlValue())
  }
  render() {
    return (      
      <div>
        <nav>
          <button onClick={this.handleGetMdValue} >getMdValue</button>  
          <button onClick={this.handleGetHtmlValue} >getHtmlValue</button>  
        </nav>
        <section style="height: 500px">
          <MdEditor 
            ref={node => this.mdEditor = node}
            value={MOCK_DATA}
            style={{height: '400px'}}
            renderHTML={this.renderHTML}
            config={{
              view: {
                menu: true,
                md: true,
                html: true
              },
              imageUrl: 'https://octodex.github.com/images/minion.png'
            }}
            onChange={this.handleEditorChange} 
            onImageUpload={this.handleImageUpload}
          />
        </section>                        
      </div>      
    )
  }
}
```

### 最后

   欢迎大家使用和反馈，[项目地址](https://github.com/HarryChen0506/react-markdown-editor-lite) (https://github.com/HarryChen0506/react-markdown-editor-lite)， 你的点赞将是我莫大的动力😊

![1.png](https://s3.ca-central-1.amazonaws.com/res-blog-public/res-dev/blog_1636946743939_1.png)', firstPicture='', viewCount=83, createDate='Sun Nov 07 14:09:29 EST 2021', updateDate='Tue Jan 18 22:54:08 EST 2022'}}, total=null}
2022-01-19 22:15:31:653 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 14ms
2022-01-19 22:15:31:653 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 22:15:32:183 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 22:15:32:183 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 22:15:32:183 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 22:15:32:183 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 22:15:32:183 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 22:15:32:183 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 22:15:32:183 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=36createdate=Wed Jan 19 21:15:59 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/19.png, replyComments=[CommentListVo{commentId=37createdate=Wed Jan 19 21:16:11 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/46.png, replyComments=[CommentListVo{commentId=38createdate=Wed Jan 19 21:16:27 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/95.png, replyComments=[CommentListVo{commentId=40createdate=Wed Jan 19 22:04:30 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/88.png, replyComments=null, CommentVo=CommentVo{parentCommentId=38, articleId=10005, email='test@gg.com', nickname='sfs@ss.c', parentCommentNickname='2.1', content='sdfsf', status='0'}}], CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sdfsd@Ck.com', nickname='2.1', parentCommentNickname='2', content='2.1', status='0'}}, CommentListVo{commentId=39createdate=Wed Jan 19 22:03:07 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/86.png, replyComments=null, CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='2', content='ddddd', status='0'}}], CommentVo=CommentVo{parentCommentId=36, articleId=10005, email='2sdf@dd.c', nickname='2', parentCommentNickname='1', content='2', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='1@11.com', nickname='1', parentCommentNickname='null', content='1', status='0'}}], total=1}
2022-01-19 22:15:32:183 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 3ms
2022-01-19 22:15:32:183 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 22:18:33:296 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 22:18:33:296 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 22:18:33:296 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: POST
2022-01-19 22:18:33:296 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment
2022-01-19 22:18:33:296 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.postComment
2022-01-19 22:18:33:296 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: CommentVo{parentCommentId=null, articleId=10005, email='ivanliang25@gmail.com', nickname='suhuan', parentCommentNickname='null', content='hjksdjf', status='null'}
2022-01-19 22:18:33:296 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=null, total=null}
2022-01-19 22:18:33:296 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 2ms
2022-01-19 22:18:33:296 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 22:18:33:321 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 22:18:33:321 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 22:18:33:321 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 22:18:33:321 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 22:18:33:321 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 22:18:33:321 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 22:18:33:321 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=41createdate=Wed Jan 19 22:18:33 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/41.png, replyComments=null, CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='ivanliang25@gmail.com', nickname='suhuan', parentCommentNickname='null', content='hjksdjf', status='0'}}, CommentListVo{commentId=36createdate=Wed Jan 19 21:15:59 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/19.png, replyComments=[CommentListVo{commentId=37createdate=Wed Jan 19 21:16:11 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/46.png, replyComments=[CommentListVo{commentId=38createdate=Wed Jan 19 21:16:27 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/95.png, replyComments=[CommentListVo{commentId=40createdate=Wed Jan 19 22:04:30 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/88.png, replyComments=null, CommentVo=CommentVo{parentCommentId=38, articleId=10005, email='test@gg.com', nickname='sfs@ss.c', parentCommentNickname='2.1', content='sdfsf', status='0'}}], CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sdfsd@Ck.com', nickname='2.1', parentCommentNickname='2', content='2.1', status='0'}}, CommentListVo{commentId=39createdate=Wed Jan 19 22:03:07 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/86.png, replyComments=null, CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='2', content='ddddd', status='0'}}], CommentVo=CommentVo{parentCommentId=36, articleId=10005, email='2sdf@dd.c', nickname='2', parentCommentNickname='1', content='2', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='1@11.com', nickname='1', parentCommentNickname='null', content='1', status='0'}}], total=1}
2022-01-19 22:18:33:321 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 3ms
2022-01-19 22:18:33:321 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 22:18:43:384 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 22:18:43:389 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 22:18:43:398 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 22:18:43:394 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 22:18:43:398 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 22:18:43:398 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 22:18:43:399 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 22:18:43:399 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 22:18:43:399 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 22:18:43:398 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 22:18:43:399 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 22:18:43:399 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 22:18:43:399 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/article/10005
2022-01-19 22:18:43:399 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.ArticleController.getPublicArticleDetail
2022-01-19 22:18:43:399 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=41createdate=Wed Jan 19 22:18:33 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/41.png, replyComments=null, CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='ivanliang25@gmail.com', nickname='suhuan', parentCommentNickname='null', content='hjksdjf', status='0'}}, CommentListVo{commentId=36createdate=Wed Jan 19 21:15:59 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/19.png, replyComments=[CommentListVo{commentId=37createdate=Wed Jan 19 21:16:11 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/46.png, replyComments=[CommentListVo{commentId=38createdate=Wed Jan 19 21:16:27 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/95.png, replyComments=[CommentListVo{commentId=40createdate=Wed Jan 19 22:04:30 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/88.png, replyComments=null, CommentVo=CommentVo{parentCommentId=38, articleId=10005, email='test@gg.com', nickname='sfs@ss.c', parentCommentNickname='2.1', content='sdfsf', status='0'}}], CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sdfsd@Ck.com', nickname='2.1', parentCommentNickname='2', content='2.1', status='0'}}, CommentListVo{commentId=39createdate=Wed Jan 19 22:03:07 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/86.png, replyComments=null, CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='2', content='ddddd', status='0'}}], CommentVo=CommentVo{parentCommentId=36, articleId=10005, email='2sdf@dd.c', nickname='2', parentCommentNickname='1', content='2', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='1@11.com', nickname='1', parentCommentNickname='null', content='1', status='0'}}], total=2}
2022-01-19 22:18:43:399 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 22:18:43:399 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 22:18:43:399 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 13ms
2022-01-19 22:18:43:399 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 22:18:43:399 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 22:18:43:399 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=ArticleVo{userInfo=UserInfoVo{userId=100001, nickName='ivan', userName='ivan', avatar='https://res-blog-public.s3.ca-central-1.amazonaws.com/default_avatar.jpg'}, category=CategoryVo{categoryId=1, name='Life ', articleCount=null}, BaseArticleVo{articleId=10005, status=1, type=1, title='dd', description='This is the doc of React markdown editor lite.
Enjoy!!', content='| Head | Head | Head | Head |
| --- | --- | --- | --- |
| Data | Data | Data | Data |
| Data | Data | Data | Data |

## 手把手教你写一个markdown编辑器

> 笔者在18年年末的时候接到一个开发任务——搭建一个AI项目的开放平台，其中的产品文档为转化为HTML格式的markdown文档。考虑到文档的即时更新，将文档信息做成了Ajax接口的形式。因此管理后台只需将textarea表单的内容通过markdown解析器进行HTML格式转化，然后将markdown内容和经转化的HTML文档都保存到数据库即可。
> 基本需求完成后，为了更好的用户体验，考虑将常用的编辑功能添加进来。改进版不仅支持了常用的文本编辑功能，还实现的UI界面的配置化，自定义语法解析器。本着造福伸手党的目的，以及积累些开源经验，笔者将该react 组件 [react-markdown-editor-lite](https://github.com/HarryChen0506/react-markdown-editor-lite) 进行了封装改造，并且发布到了开源社区。

### 预览
在线体验 [https://harrychen0506.github.io/react-markdown-editor-lite/](https://harrychen0506.github.io/react-markdown-editor-lite/)

![image](https://github.com//HarryChen0506/react-markdown-editor-lite/blob/master/image/react-markdown-editor-lite-v1.0.0.PNG?raw=true)

### 特点
* 轻量、基于React
* UI可配置, 如只显示编辑区或预览区
* 支持自定义markdown语法解析器,语法高亮等
* 支持常用的markdown编辑功能，如加粗，斜体等等...
* 支持功能按钮插拔化，用户可以自定义扩展组件
* 支持编辑区和预览区同步滚动

### 开发心得

- 文本编辑

  大多数常见的编辑器，包括富文本编辑器，利用了某些元素如div的contenteditable属性，配合selection、range、execCommand等API，实现了富文本编辑功能。这里面的实现比较复杂，所以有了"[为什么都说富文本编辑器是天坑？](https://www.zhihu.com/question/38699645)"这个说法。

  而markdown编辑器，核心的处理内容为简单语法的纯文本，复杂度相对来说比较低，并且input标签自带onSelect事件，可以很方便的获取选择信息（选择起始位置和选择文本值），因此要想实现编辑功能，只需将要改动的内容进行文本转换，然后进行重新拼接首尾，大功告成。
  
- markdown解析

  考察了几个社区流行的markdown解析器，比较流行的有[markdown](https://www.npmjs.com/package/markdown), [markdown-it](https://www.npmjs.com/package/markdown-it), [marked](https://www.npmjs.com/package/marked) 等等。综合考虑扩展性以及稳定性，笔者推荐使用markdown-it作为markdown的词法解析器，因为该解析器有比较多的插件，并且支持语法高亮。

- 同步滚动

  当选择分栏编辑的时候，滚动左侧的编辑区，右侧的预览区能自动滚动到对应的区域。方案参考了《[手把手教你用 100行代码实现基于 react的 markdown 输入 + 即时预览在线编辑器（一）](https://github.com/accforgit/blog-data/blob/master/%E5%9C%A8%E7%BA%BF%E7%BC%96%E8%BE%91%E5%99%A8/README/README1.md)》。只需先计算出输入框容器元素与预览框容器元素之间最大scroll范围的比例值，然后根据主动滚动元素自身的scrollTop做相应的比例换算，即可知道对方区域的scrollTop值。

- 关于UI
 
  - 项目的字体库选择了Font Awesome风格，并且只选取了项目所需要的一些图标。
  - 编辑器的整体css均可通过全局覆盖的形式进行自定义。目前暂时只支持灰色主题。
  - 编辑器的显示区域包括菜单栏，编辑器，预览区，工具栏，通过配置组件的config属性，可以选择默认的展示区域。
  
### Install

```js
npm install react-markdown-editor-lite --save
```

### Props

| Property | Description | Type | default | Remarks |
| --- | --- | --- | --- | --- |
| value | markdown content | String | '' | required |
| style | component container style | Object | {height: '100%'} | not required |
| config | component config | Object | {view: {...}, logger: {...}} | not required |
| onChange | emitting when editor has changed | Function | ({html, md}) => {} | not required |
| onImageUpload | when image uploaded, callback emitting will get image markdown text | (file: File, callback: (url: string) => void) => void; | ({file, callback}) => {} | not required |
| renderHTML | Render markdown text to HTML. You can return either string, function or Promise | (text: string) => string|function|Promise | none | **required** |

### Example

``` js
'use strict';
import React from 'react'
import ReactDOM from 'react-dom'
import MdEditor from 'react-markdown-editor-lite'
import MarkdownIt from 'markdown-it'
import emoji from 'markdown-it-emoji'
import subscript from 'markdown-it-sub'
import superscript from 'markdown-it-sup'
import footnote from 'markdown-it-footnote'
import deflist from 'markdown-it-deflist'
import abbreviation from 'markdown-it-abbr'
import insert from 'markdown-it-ins'
import mark from 'markdown-it-mark'
import tasklists from 'markdown-it-task-lists'
import hljs from 'highlight.js'
import 'highlight.js/styles/atom-one-light.css'
// import 'highlight.js/styles/github.css'
import './index.less';

const MOCK_DATA = "I Love React."
export default class Demo extends React.Component {
  mdEditor = null
  mdParser = null
  constructor(props) {
    super(props)
    // initial a parsera
    this.mdParser = new MarkdownIt({
      html: true,
      linkify: true,
      typographer: true,
      highlight: function (str, lang) {
        if (lang && hljs.getLanguage(lang)) {
          try {
            return hljs.highlight(lang, str).value
          } catch (__) {}
        }    
        return '' // use external default escaping
      }
    })
    .use(emoji)
    .use(subscript)
    .use(superscript)
    .use(footnote)
    .use(deflist)
    .use(abbreviation)
    .use(insert)
    .use(mark)
    .use(tasklists, { enabled: this.taskLists })
    this.renderHTML = this.renderHTML.bind(this)
  }
  handleEditorChange({html, md}) {
    console.log('handleEditorChange', html, md)
  }
  handleImageUpload(file, callback) {
    const reader = new FileReader()
    reader.onload = () => {      
      const convertBase64UrlToBlob = (urlData) => {  
        let arr = urlData.split(','), mime = arr[0].match(/:(.*?);/)[1]
        let bstr = atob(arr[1])
        let n = bstr.length
        let u8arr = new Uint8Array(n)
        while (n--) {
          u8arr[n] = bstr.charCodeAt(n)
        }
        return new Blob([u8arr], {type:mime})
      }
      const blob = convertBase64UrlToBlob(reader.result)
      setTimeout(() => {
        // setTimeout 模拟异步上传图片
        // 当异步上传获取图片地址后，执行calback回调（参数为imageUrl字符串），即可将图片地址写入markdown
        callback('https://avatars0.githubusercontent.com/u/21263805?s=40&v=4')
      }, 1000)
    }
    reader.readAsDataURL(file)
  }
  renderHTML(text) {
    // 模拟异步渲染Markdown
    return new Promise((resolve) => {
      setTimeout(() => {
        resolve(this.mdParser.render(text))
      }, 1000)
    })
  }
  handleGetMdValue = () => {   
    this.mdEditor && alert(this.mdEditor.getMdValue())      
  }
  handleGetHtmlValue = () => {    
    this.mdEditor && alert(this.mdEditor.getHtmlValue())
  }
  render() {
    return (      
      <div>
        <nav>
          <button onClick={this.handleGetMdValue} >getMdValue</button>  
          <button onClick={this.handleGetHtmlValue} >getHtmlValue</button>  
        </nav>
        <section style="height: 500px">
          <MdEditor 
            ref={node => this.mdEditor = node}
            value={MOCK_DATA}
            style={{height: '400px'}}
            renderHTML={this.renderHTML}
            config={{
              view: {
                menu: true,
                md: true,
                html: true
              },
              imageUrl: 'https://octodex.github.com/images/minion.png'
            }}
            onChange={this.handleEditorChange} 
            onImageUpload={this.handleImageUpload}
          />
        </section>                        
      </div>      
    )
  }
}
```

### 最后

   欢迎大家使用和反馈，[项目地址](https://github.com/HarryChen0506/react-markdown-editor-lite) (https://github.com/HarryChen0506/react-markdown-editor-lite)， 你的点赞将是我莫大的动力😊

![1.png](https://s3.ca-central-1.amazonaws.com/res-blog-public/res-dev/blog_1636946743939_1.png)', firstPicture='', viewCount=83, createDate='Sun Nov 07 14:09:29 EST 2021', updateDate='Tue Jan 18 22:54:08 EST 2022'}}, total=null}
2022-01-19 22:18:43:399 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 7ms
2022-01-19 22:18:43:399 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 22:18:43:399 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=41createdate=Wed Jan 19 22:18:33 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/41.png, replyComments=null, CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='ivanliang25@gmail.com', nickname='suhuan', parentCommentNickname='null', content='hjksdjf', status='0'}}, CommentListVo{commentId=36createdate=Wed Jan 19 21:15:59 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/19.png, replyComments=[CommentListVo{commentId=37createdate=Wed Jan 19 21:16:11 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/46.png, replyComments=[CommentListVo{commentId=38createdate=Wed Jan 19 21:16:27 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/95.png, replyComments=[CommentListVo{commentId=40createdate=Wed Jan 19 22:04:30 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/88.png, replyComments=null, CommentVo=CommentVo{parentCommentId=38, articleId=10005, email='test@gg.com', nickname='sfs@ss.c', parentCommentNickname='2.1', content='sdfsf', status='0'}}], CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sdfsd@Ck.com', nickname='2.1', parentCommentNickname='2', content='2.1', status='0'}}, CommentListVo{commentId=39createdate=Wed Jan 19 22:03:07 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/86.png, replyComments=null, CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='2', content='ddddd', status='0'}}], CommentVo=CommentVo{parentCommentId=36, articleId=10005, email='2sdf@dd.c', nickname='2', parentCommentNickname='1', content='2', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='1@11.com', nickname='1', parentCommentNickname='null', content='1', status='0'}}], total=2}
2022-01-19 22:18:43:399 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 17ms
2022-01-19 22:18:43:399 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 22:18:43:399 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 22:18:43:914 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 22:18:43:914 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 22:18:43:914 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 22:18:43:914 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 22:18:43:914 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 22:18:43:914 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 22:18:43:914 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=41createdate=Wed Jan 19 22:18:33 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/41.png, replyComments=null, CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='ivanliang25@gmail.com', nickname='suhuan', parentCommentNickname='null', content='hjksdjf', status='0'}}, CommentListVo{commentId=36createdate=Wed Jan 19 21:15:59 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/19.png, replyComments=[CommentListVo{commentId=37createdate=Wed Jan 19 21:16:11 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/46.png, replyComments=[CommentListVo{commentId=38createdate=Wed Jan 19 21:16:27 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/95.png, replyComments=[CommentListVo{commentId=40createdate=Wed Jan 19 22:04:30 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/88.png, replyComments=null, CommentVo=CommentVo{parentCommentId=38, articleId=10005, email='test@gg.com', nickname='sfs@ss.c', parentCommentNickname='2.1', content='sdfsf', status='0'}}], CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sdfsd@Ck.com', nickname='2.1', parentCommentNickname='2', content='2.1', status='0'}}, CommentListVo{commentId=39createdate=Wed Jan 19 22:03:07 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/86.png, replyComments=null, CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='2', content='ddddd', status='0'}}], CommentVo=CommentVo{parentCommentId=36, articleId=10005, email='2sdf@dd.c', nickname='2', parentCommentNickname='1', content='2', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='1@11.com', nickname='1', parentCommentNickname='null', content='1', status='0'}}], total=2}
2022-01-19 22:18:43:914 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 5ms
2022-01-19 22:18:43:914 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 22:19:20:715 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 22:19:20:715 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 22:19:20:715 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 22:19:20:715 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/article/10005
2022-01-19 22:19:20:715 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.ArticleController.getPublicArticleDetail
2022-01-19 22:19:20:715 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 22:19:20:715 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=ArticleVo{userInfo=UserInfoVo{userId=100001, nickName='ivan', userName='ivan', avatar='https://res-blog-public.s3.ca-central-1.amazonaws.com/default_avatar.jpg'}, category=CategoryVo{categoryId=1, name='Life ', articleCount=null}, BaseArticleVo{articleId=10005, status=1, type=1, title='dd', description='This is the doc of React markdown editor lite.
Enjoy!!', content='| Head | Head | Head | Head |
| --- | --- | --- | --- |
| Data | Data | Data | Data |
| Data | Data | Data | Data |

## 手把手教你写一个markdown编辑器

> 笔者在18年年末的时候接到一个开发任务——搭建一个AI项目的开放平台，其中的产品文档为转化为HTML格式的markdown文档。考虑到文档的即时更新，将文档信息做成了Ajax接口的形式。因此管理后台只需将textarea表单的内容通过markdown解析器进行HTML格式转化，然后将markdown内容和经转化的HTML文档都保存到数据库即可。
> 基本需求完成后，为了更好的用户体验，考虑将常用的编辑功能添加进来。改进版不仅支持了常用的文本编辑功能，还实现的UI界面的配置化，自定义语法解析器。本着造福伸手党的目的，以及积累些开源经验，笔者将该react 组件 [react-markdown-editor-lite](https://github.com/HarryChen0506/react-markdown-editor-lite) 进行了封装改造，并且发布到了开源社区。

### 预览
在线体验 [https://harrychen0506.github.io/react-markdown-editor-lite/](https://harrychen0506.github.io/react-markdown-editor-lite/)

![image](https://github.com//HarryChen0506/react-markdown-editor-lite/blob/master/image/react-markdown-editor-lite-v1.0.0.PNG?raw=true)

### 特点
* 轻量、基于React
* UI可配置, 如只显示编辑区或预览区
* 支持自定义markdown语法解析器,语法高亮等
* 支持常用的markdown编辑功能，如加粗，斜体等等...
* 支持功能按钮插拔化，用户可以自定义扩展组件
* 支持编辑区和预览区同步滚动

### 开发心得

- 文本编辑

  大多数常见的编辑器，包括富文本编辑器，利用了某些元素如div的contenteditable属性，配合selection、range、execCommand等API，实现了富文本编辑功能。这里面的实现比较复杂，所以有了"[为什么都说富文本编辑器是天坑？](https://www.zhihu.com/question/38699645)"这个说法。

  而markdown编辑器，核心的处理内容为简单语法的纯文本，复杂度相对来说比较低，并且input标签自带onSelect事件，可以很方便的获取选择信息（选择起始位置和选择文本值），因此要想实现编辑功能，只需将要改动的内容进行文本转换，然后进行重新拼接首尾，大功告成。
  
- markdown解析

  考察了几个社区流行的markdown解析器，比较流行的有[markdown](https://www.npmjs.com/package/markdown), [markdown-it](https://www.npmjs.com/package/markdown-it), [marked](https://www.npmjs.com/package/marked) 等等。综合考虑扩展性以及稳定性，笔者推荐使用markdown-it作为markdown的词法解析器，因为该解析器有比较多的插件，并且支持语法高亮。

- 同步滚动

  当选择分栏编辑的时候，滚动左侧的编辑区，右侧的预览区能自动滚动到对应的区域。方案参考了《[手把手教你用 100行代码实现基于 react的 markdown 输入 + 即时预览在线编辑器（一）](https://github.com/accforgit/blog-data/blob/master/%E5%9C%A8%E7%BA%BF%E7%BC%96%E8%BE%91%E5%99%A8/README/README1.md)》。只需先计算出输入框容器元素与预览框容器元素之间最大scroll范围的比例值，然后根据主动滚动元素自身的scrollTop做相应的比例换算，即可知道对方区域的scrollTop值。

- 关于UI
 
  - 项目的字体库选择了Font Awesome风格，并且只选取了项目所需要的一些图标。
  - 编辑器的整体css均可通过全局覆盖的形式进行自定义。目前暂时只支持灰色主题。
  - 编辑器的显示区域包括菜单栏，编辑器，预览区，工具栏，通过配置组件的config属性，可以选择默认的展示区域。
  
### Install

```js
npm install react-markdown-editor-lite --save
```

### Props

| Property | Description | Type | default | Remarks |
| --- | --- | --- | --- | --- |
| value | markdown content | String | '' | required |
| style | component container style | Object | {height: '100%'} | not required |
| config | component config | Object | {view: {...}, logger: {...}} | not required |
| onChange | emitting when editor has changed | Function | ({html, md}) => {} | not required |
| onImageUpload | when image uploaded, callback emitting will get image markdown text | (file: File, callback: (url: string) => void) => void; | ({file, callback}) => {} | not required |
| renderHTML | Render markdown text to HTML. You can return either string, function or Promise | (text: string) => string|function|Promise | none | **required** |

### Example

``` js
'use strict';
import React from 'react'
import ReactDOM from 'react-dom'
import MdEditor from 'react-markdown-editor-lite'
import MarkdownIt from 'markdown-it'
import emoji from 'markdown-it-emoji'
import subscript from 'markdown-it-sub'
import superscript from 'markdown-it-sup'
import footnote from 'markdown-it-footnote'
import deflist from 'markdown-it-deflist'
import abbreviation from 'markdown-it-abbr'
import insert from 'markdown-it-ins'
import mark from 'markdown-it-mark'
import tasklists from 'markdown-it-task-lists'
import hljs from 'highlight.js'
import 'highlight.js/styles/atom-one-light.css'
// import 'highlight.js/styles/github.css'
import './index.less';

const MOCK_DATA = "I Love React."
export default class Demo extends React.Component {
  mdEditor = null
  mdParser = null
  constructor(props) {
    super(props)
    // initial a parsera
    this.mdParser = new MarkdownIt({
      html: true,
      linkify: true,
      typographer: true,
      highlight: function (str, lang) {
        if (lang && hljs.getLanguage(lang)) {
          try {
            return hljs.highlight(lang, str).value
          } catch (__) {}
        }    
        return '' // use external default escaping
      }
    })
    .use(emoji)
    .use(subscript)
    .use(superscript)
    .use(footnote)
    .use(deflist)
    .use(abbreviation)
    .use(insert)
    .use(mark)
    .use(tasklists, { enabled: this.taskLists })
    this.renderHTML = this.renderHTML.bind(this)
  }
  handleEditorChange({html, md}) {
    console.log('handleEditorChange', html, md)
  }
  handleImageUpload(file, callback) {
    const reader = new FileReader()
    reader.onload = () => {      
      const convertBase64UrlToBlob = (urlData) => {  
        let arr = urlData.split(','), mime = arr[0].match(/:(.*?);/)[1]
        let bstr = atob(arr[1])
        let n = bstr.length
        let u8arr = new Uint8Array(n)
        while (n--) {
          u8arr[n] = bstr.charCodeAt(n)
        }
        return new Blob([u8arr], {type:mime})
      }
      const blob = convertBase64UrlToBlob(reader.result)
      setTimeout(() => {
        // setTimeout 模拟异步上传图片
        // 当异步上传获取图片地址后，执行calback回调（参数为imageUrl字符串），即可将图片地址写入markdown
        callback('https://avatars0.githubusercontent.com/u/21263805?s=40&v=4')
      }, 1000)
    }
    reader.readAsDataURL(file)
  }
  renderHTML(text) {
    // 模拟异步渲染Markdown
    return new Promise((resolve) => {
      setTimeout(() => {
        resolve(this.mdParser.render(text))
      }, 1000)
    })
  }
  handleGetMdValue = () => {   
    this.mdEditor && alert(this.mdEditor.getMdValue())      
  }
  handleGetHtmlValue = () => {    
    this.mdEditor && alert(this.mdEditor.getHtmlValue())
  }
  render() {
    return (      
      <div>
        <nav>
          <button onClick={this.handleGetMdValue} >getMdValue</button>  
          <button onClick={this.handleGetHtmlValue} >getHtmlValue</button>  
        </nav>
        <section style="height: 500px">
          <MdEditor 
            ref={node => this.mdEditor = node}
            value={MOCK_DATA}
            style={{height: '400px'}}
            renderHTML={this.renderHTML}
            config={{
              view: {
                menu: true,
                md: true,
                html: true
              },
              imageUrl: 'https://octodex.github.com/images/minion.png'
            }}
            onChange={this.handleEditorChange} 
            onImageUpload={this.handleImageUpload}
          />
        </section>                        
      </div>      
    )
  }
}
```

### 最后

   欢迎大家使用和反馈，[项目地址](https://github.com/HarryChen0506/react-markdown-editor-lite) (https://github.com/HarryChen0506/react-markdown-editor-lite)， 你的点赞将是我莫大的动力😊

![1.png](https://s3.ca-central-1.amazonaws.com/res-blog-public/res-dev/blog_1636946743939_1.png)', firstPicture='', viewCount=83, createDate='Sun Nov 07 14:09:29 EST 2021', updateDate='Tue Jan 18 22:54:08 EST 2022'}}, total=null}
2022-01-19 22:19:20:716 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 16ms
2022-01-19 22:19:20:716 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 22:19:20:720 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 22:19:20:720 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 22:19:20:720 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 22:19:20:720 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 22:19:20:720 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 22:19:20:720 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 22:19:20:720 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 22:19:20:720 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 22:19:20:720 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 22:19:20:720 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 22:19:20:720 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 22:19:20:720 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 22:19:20:720 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=41createdate=Wed Jan 19 22:18:33 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/41.png, replyComments=null, CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='ivanliang25@gmail.com', nickname='suhuan', parentCommentNickname='null', content='hjksdjf', status='0'}}, CommentListVo{commentId=36createdate=Wed Jan 19 21:15:59 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/19.png, replyComments=[CommentListVo{commentId=37createdate=Wed Jan 19 21:16:11 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/46.png, replyComments=[CommentListVo{commentId=38createdate=Wed Jan 19 21:16:27 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/95.png, replyComments=[CommentListVo{commentId=40createdate=Wed Jan 19 22:04:30 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/88.png, replyComments=null, CommentVo=CommentVo{parentCommentId=38, articleId=10005, email='test@gg.com', nickname='sfs@ss.c', parentCommentNickname='2.1', content='sdfsf', status='0'}}], CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sdfsd@Ck.com', nickname='2.1', parentCommentNickname='2', content='2.1', status='0'}}, CommentListVo{commentId=39createdate=Wed Jan 19 22:03:07 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/86.png, replyComments=null, CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='2', content='ddddd', status='0'}}], CommentVo=CommentVo{parentCommentId=36, articleId=10005, email='2sdf@dd.c', nickname='2', parentCommentNickname='1', content='2', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='1@11.com', nickname='1', parentCommentNickname='null', content='1', status='0'}}], total=2}
2022-01-19 22:19:20:720 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=41createdate=Wed Jan 19 22:18:33 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/41.png, replyComments=null, CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='ivanliang25@gmail.com', nickname='suhuan', parentCommentNickname='null', content='hjksdjf', status='0'}}, CommentListVo{commentId=36createdate=Wed Jan 19 21:15:59 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/19.png, replyComments=[CommentListVo{commentId=37createdate=Wed Jan 19 21:16:11 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/46.png, replyComments=[CommentListVo{commentId=38createdate=Wed Jan 19 21:16:27 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/95.png, replyComments=[CommentListVo{commentId=40createdate=Wed Jan 19 22:04:30 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/88.png, replyComments=null, CommentVo=CommentVo{parentCommentId=38, articleId=10005, email='test@gg.com', nickname='sfs@ss.c', parentCommentNickname='2.1', content='sdfsf', status='0'}}], CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sdfsd@Ck.com', nickname='2.1', parentCommentNickname='2', content='2.1', status='0'}}, CommentListVo{commentId=39createdate=Wed Jan 19 22:03:07 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/86.png, replyComments=null, CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='2', content='ddddd', status='0'}}], CommentVo=CommentVo{parentCommentId=36, articleId=10005, email='2sdf@dd.c', nickname='2', parentCommentNickname='1', content='2', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='1@11.com', nickname='1', parentCommentNickname='null', content='1', status='0'}}], total=2}
2022-01-19 22:19:20:720 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 20ms
2022-01-19 22:19:20:720 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 22:19:20:720 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 21ms
2022-01-19 22:19:20:721 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 22:19:21:197 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 22:19:21:198 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 22:19:21:198 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 22:19:21:198 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 22:19:21:198 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 22:19:21:198 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 22:19:21:198 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=41createdate=Wed Jan 19 22:18:33 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/41.png, replyComments=null, CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='ivanliang25@gmail.com', nickname='suhuan', parentCommentNickname='null', content='hjksdjf', status='0'}}, CommentListVo{commentId=36createdate=Wed Jan 19 21:15:59 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/19.png, replyComments=[CommentListVo{commentId=37createdate=Wed Jan 19 21:16:11 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/46.png, replyComments=[CommentListVo{commentId=38createdate=Wed Jan 19 21:16:27 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/95.png, replyComments=[CommentListVo{commentId=40createdate=Wed Jan 19 22:04:30 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/88.png, replyComments=null, CommentVo=CommentVo{parentCommentId=38, articleId=10005, email='test@gg.com', nickname='sfs@ss.c', parentCommentNickname='2.1', content='sdfsf', status='0'}}], CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sdfsd@Ck.com', nickname='2.1', parentCommentNickname='2', content='2.1', status='0'}}, CommentListVo{commentId=39createdate=Wed Jan 19 22:03:07 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/86.png, replyComments=null, CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='2', content='ddddd', status='0'}}], CommentVo=CommentVo{parentCommentId=36, articleId=10005, email='2sdf@dd.c', nickname='2', parentCommentNickname='1', content='2', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='1@11.com', nickname='1', parentCommentNickname='null', content='1', status='0'}}], total=2}
2022-01-19 22:19:21:198 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 2ms
2022-01-19 22:19:21:198 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 22:21:54:781 [HikariPool-1 housekeeper] WARN  com.zaxxer.hikari.pool.HikariPool HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=45s264ms).
2022-01-19 22:29:59:145 [Thread-35] INFO  org.springframework.scheduling.concurrent.ThreadPoolTaskScheduler Shutting down ExecutorService 'taskScheduler'
2022-01-19 22:29:59:146 [Thread-35] INFO  org.springframework.scheduling.concurrent.ThreadPoolTaskExecutor Shutting down ExecutorService 'applicationTaskExecutor'
2022-01-19 22:29:59:148 [Thread-35] INFO  com.zaxxer.hikari.HikariDataSource HikariPool-1 - Shutdown initiated...
2022-01-19 22:29:59:149 [Thread-35] INFO  com.zaxxer.hikari.HikariDataSource HikariPool-1 - Shutdown completed.
2022-01-19 22:30:03:088 [restartedMain] INFO  com.ivan.sunnyblog.SunnyBlogApplication Starting SunnyBlogApplication on Jinghaos-MacBook-Air.local with PID 6417 (/Users/jinghaoliang/Documents/tech/Project/gitproject/blog/blog_backend/target/classes started by jinghaoliang in /Users/jinghaoliang/Documents/tech/Project/gitproject/blog/blog_backend)
2022-01-19 22:30:03:089 [restartedMain] INFO  com.ivan.sunnyblog.SunnyBlogApplication No active profile set, falling back to default profiles: default
2022-01-19 22:30:03:107 [restartedMain] INFO  org.springframework.boot.devtools.env.DevToolsPropertyDefaultsPostProcessor Devtools property defaults active! Set 'spring.devtools.add-properties' to 'false' to disable
2022-01-19 22:30:03:107 [restartedMain] INFO  org.springframework.boot.devtools.env.DevToolsPropertyDefaultsPostProcessor For additional web related logging consider setting the 'logging.level.web' property to 'DEBUG'
2022-01-19 22:30:03:409 [restartedMain] INFO  org.springframework.data.repository.config.RepositoryConfigurationDelegate Multiple Spring Data modules found, entering strict repository configuration mode!
2022-01-19 22:30:03:410 [restartedMain] INFO  org.springframework.data.repository.config.RepositoryConfigurationDelegate Bootstrapping Spring Data repositories in DEFAULT mode.
2022-01-19 22:30:03:432 [restartedMain] INFO  org.springframework.data.repository.config.RepositoryConfigurationDelegate Finished Spring Data repository scanning in 17ms. Found 0 repository interfaces.
2022-01-19 22:30:03:594 [restartedMain] INFO  o.s.context.support.PostProcessorRegistrationDelegate$BeanPostProcessorChecker Bean 'org.springframework.transaction.annotation.ProxyTransactionManagementConfiguration' of type [org.springframework.transaction.annotation.ProxyTransactionManagementConfiguration$$EnhancerBySpringCGLIB$$99d3f64d] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2022-01-19 22:30:03:771 [restartedMain] INFO  org.springframework.boot.web.embedded.tomcat.TomcatWebServer Tomcat initialized with port(s): 8081 (http)
2022-01-19 22:30:03:777 [restartedMain] INFO  org.apache.coyote.http11.Http11NioProtocol Initializing ProtocolHandler ["http-nio-8081"]
2022-01-19 22:30:03:782 [restartedMain] INFO  org.apache.catalina.core.StandardService Starting service [Tomcat]
2022-01-19 22:30:03:783 [restartedMain] INFO  org.apache.catalina.core.StandardEngine Starting Servlet engine: [Apache Tomcat/9.0.21]
2022-01-19 22:30:03:846 [restartedMain] INFO  org.apache.catalina.core.ContainerBase.[Tomcat].[localhost].[/] Initializing Spring embedded WebApplicationContext
2022-01-19 22:30:03:846 [restartedMain] INFO  org.springframework.web.context.ContextLoader Root WebApplicationContext: initialization completed in 739 ms
2022-01-19 22:30:03:997 [restartedMain] INFO  com.zaxxer.hikari.HikariDataSource HikariPool-1 - Starting...
2022-01-19 22:30:04:031 [restartedMain] INFO  com.zaxxer.hikari.HikariDataSource HikariPool-1 - Start completed.
2022-01-19 22:30:30:492 [restartedMain] INFO  org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor Autowired annotation is not supported on static fields: static com.amazonaws.services.s3.AmazonS3 com.ivan.sunnyblog.web.res.S3ResourceManager.s3Client
2022-01-19 22:30:30:915 [restartedMain] INFO  org.springframework.scheduling.concurrent.ThreadPoolTaskExecutor Initializing ExecutorService 'applicationTaskExecutor'
2022-01-19 22:30:31:108 [restartedMain] INFO  org.springframework.scheduling.concurrent.ThreadPoolTaskScheduler Initializing ExecutorService 'taskScheduler'
2022-01-19 22:30:31:151 [restartedMain] INFO  org.springframework.boot.devtools.autoconfigure.OptionalLiveReloadServer LiveReload server is running on port 35729
2022-01-19 22:30:31:213 [restartedMain] INFO  org.apache.coyote.http11.Http11NioProtocol Starting ProtocolHandler ["http-nio-8081"]
2022-01-19 22:30:31:235 [restartedMain] INFO  org.springframework.boot.web.embedded.tomcat.TomcatWebServer Tomcat started on port(s): 8081 (http) with context path ''
2022-01-19 22:30:31:238 [restartedMain] INFO  com.ivan.sunnyblog.SunnyBlogApplication Started SunnyBlogApplication in 28.332 seconds (JVM running for 28.788)
2022-01-19 22:30:45:860 [http-nio-8081-exec-3] INFO  org.apache.catalina.core.ContainerBase.[Tomcat].[localhost].[/] Initializing Spring DispatcherServlet 'dispatcherServlet'
2022-01-19 22:30:45:861 [http-nio-8081-exec-3] INFO  org.springframework.web.servlet.DispatcherServlet Initializing Servlet 'dispatcherServlet'
2022-01-19 22:30:45:866 [http-nio-8081-exec-3] INFO  org.springframework.web.servlet.DispatcherServlet Completed initialization in 5 ms
2022-01-19 22:30:46:099 [http-nio-8081-exec-1] INFO  org.jooq.Constants 
                                      
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@  @@        @@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@        @@@@@@@@@@
@@@@@@@@@@@@@@@@  @@  @@    @@@@@@@@@@
@@@@@@@@@@  @@@@  @@  @@    @@@@@@@@@@
@@@@@@@@@@        @@        @@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@        @@        @@@@@@@@@@
@@@@@@@@@@    @@  @@  @@@@  @@@@@@@@@@
@@@@@@@@@@    @@  @@  @@@@  @@@@@@@@@@
@@@@@@@@@@        @@  @  @  @@@@@@@@@@
@@@@@@@@@@        @@        @@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@  @@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@  Thank you for using jOOQ 3.11.11
                                      
2022-01-19 22:30:46:175 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 22:30:46:175 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 22:30:46:175 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 22:30:46:175 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 22:30:46:175 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 22:30:46:175 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 22:30:46:175 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 22:30:46:175 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 22:30:46:176 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 22:30:46:176 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 22:30:46:176 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 22:30:46:176 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 22:30:46:176 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=41createdate=Wed Jan 19 22:18:33 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/41.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='ivanliang25@gmail.com', nickname='suhuan', parentCommentNickname='null', content='hjksdjf', status='0'}}, CommentListVo{commentId=36createdate=Wed Jan 19 21:15:59 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/19.png, replyComments=[CommentListVo{commentId=37createdate=Wed Jan 19 21:16:11 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/46.png, replyComments=null, CommentVo=CommentVo{parentCommentId=36, articleId=10005, email='2sdf@dd.c', nickname='2', parentCommentNickname='1', content='2', status='0'}}, CommentListVo{commentId=38createdate=Wed Jan 19 21:16:27 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/95.png, replyComments=null, CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sdfsd@Ck.com', nickname='2.1', parentCommentNickname='2', content='2.1', status='0'}}, CommentListVo{commentId=39createdate=Wed Jan 19 22:03:07 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/86.png, replyComments=null, CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='2', content='ddddd', status='0'}}, CommentListVo{commentId=40createdate=Wed Jan 19 22:04:30 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/88.png, replyComments=null, CommentVo=CommentVo{parentCommentId=38, articleId=10005, email='test@gg.com', nickname='sfs@ss.c', parentCommentNickname='2.1', content='sdfsf', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='1@11.com', nickname='1', parentCommentNickname='null', content='1', status='0'}}], total=2}
2022-01-19 22:30:46:176 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 270ms
2022-01-19 22:30:46:176 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=41createdate=Wed Jan 19 22:18:33 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/41.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='ivanliang25@gmail.com', nickname='suhuan', parentCommentNickname='null', content='hjksdjf', status='0'}}, CommentListVo{commentId=36createdate=Wed Jan 19 21:15:59 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/19.png, replyComments=[CommentListVo{commentId=37createdate=Wed Jan 19 21:16:11 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/46.png, replyComments=null, CommentVo=CommentVo{parentCommentId=36, articleId=10005, email='2sdf@dd.c', nickname='2', parentCommentNickname='1', content='2', status='0'}}, CommentListVo{commentId=38createdate=Wed Jan 19 21:16:27 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/95.png, replyComments=null, CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sdfsd@Ck.com', nickname='2.1', parentCommentNickname='2', content='2.1', status='0'}}, CommentListVo{commentId=39createdate=Wed Jan 19 22:03:07 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/86.png, replyComments=null, CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='2', content='ddddd', status='0'}}, CommentListVo{commentId=40createdate=Wed Jan 19 22:04:30 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/88.png, replyComments=null, CommentVo=CommentVo{parentCommentId=38, articleId=10005, email='test@gg.com', nickname='sfs@ss.c', parentCommentNickname='2.1', content='sdfsf', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='1@11.com', nickname='1', parentCommentNickname='null', content='1', status='0'}}], total=2}
2022-01-19 22:30:46:176 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 270ms
2022-01-19 22:30:46:176 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 22:30:46:176 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 22:30:46:226 [http-nio-8081-exec-3] INFO  io.lettuce.core.EpollProvider Starting without optional epoll library
2022-01-19 22:30:46:226 [http-nio-8081-exec-3] INFO  io.lettuce.core.KqueueProvider Starting without optional kqueue library
2022-01-19 22:30:46:286 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 22:30:46:286 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 22:30:46:286 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 22:30:46:286 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/article/10005
2022-01-19 22:30:46:286 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.ArticleController.getPublicArticleDetail
2022-01-19 22:30:46:286 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 22:30:46:286 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=ArticleVo{userInfo=UserInfoVo{userId=100001, nickName='ivan', userName='ivan', avatar='https://res-blog-public.s3.ca-central-1.amazonaws.com/default_avatar.jpg'}, category=CategoryVo{categoryId=1, name='Life ', articleCount=null}, BaseArticleVo{articleId=10005, status=1, type=1, title='dd', description='This is the doc of React markdown editor lite.
Enjoy!!', content='| Head | Head | Head | Head |
| --- | --- | --- | --- |
| Data | Data | Data | Data |
| Data | Data | Data | Data |

## 手把手教你写一个markdown编辑器

> 笔者在18年年末的时候接到一个开发任务——搭建一个AI项目的开放平台，其中的产品文档为转化为HTML格式的markdown文档。考虑到文档的即时更新，将文档信息做成了Ajax接口的形式。因此管理后台只需将textarea表单的内容通过markdown解析器进行HTML格式转化，然后将markdown内容和经转化的HTML文档都保存到数据库即可。
> 基本需求完成后，为了更好的用户体验，考虑将常用的编辑功能添加进来。改进版不仅支持了常用的文本编辑功能，还实现的UI界面的配置化，自定义语法解析器。本着造福伸手党的目的，以及积累些开源经验，笔者将该react 组件 [react-markdown-editor-lite](https://github.com/HarryChen0506/react-markdown-editor-lite) 进行了封装改造，并且发布到了开源社区。

### 预览
在线体验 [https://harrychen0506.github.io/react-markdown-editor-lite/](https://harrychen0506.github.io/react-markdown-editor-lite/)

![image](https://github.com//HarryChen0506/react-markdown-editor-lite/blob/master/image/react-markdown-editor-lite-v1.0.0.PNG?raw=true)

### 特点
* 轻量、基于React
* UI可配置, 如只显示编辑区或预览区
* 支持自定义markdown语法解析器,语法高亮等
* 支持常用的markdown编辑功能，如加粗，斜体等等...
* 支持功能按钮插拔化，用户可以自定义扩展组件
* 支持编辑区和预览区同步滚动

### 开发心得

- 文本编辑

  大多数常见的编辑器，包括富文本编辑器，利用了某些元素如div的contenteditable属性，配合selection、range、execCommand等API，实现了富文本编辑功能。这里面的实现比较复杂，所以有了"[为什么都说富文本编辑器是天坑？](https://www.zhihu.com/question/38699645)"这个说法。

  而markdown编辑器，核心的处理内容为简单语法的纯文本，复杂度相对来说比较低，并且input标签自带onSelect事件，可以很方便的获取选择信息（选择起始位置和选择文本值），因此要想实现编辑功能，只需将要改动的内容进行文本转换，然后进行重新拼接首尾，大功告成。
  
- markdown解析

  考察了几个社区流行的markdown解析器，比较流行的有[markdown](https://www.npmjs.com/package/markdown), [markdown-it](https://www.npmjs.com/package/markdown-it), [marked](https://www.npmjs.com/package/marked) 等等。综合考虑扩展性以及稳定性，笔者推荐使用markdown-it作为markdown的词法解析器，因为该解析器有比较多的插件，并且支持语法高亮。

- 同步滚动

  当选择分栏编辑的时候，滚动左侧的编辑区，右侧的预览区能自动滚动到对应的区域。方案参考了《[手把手教你用 100行代码实现基于 react的 markdown 输入 + 即时预览在线编辑器（一）](https://github.com/accforgit/blog-data/blob/master/%E5%9C%A8%E7%BA%BF%E7%BC%96%E8%BE%91%E5%99%A8/README/README1.md)》。只需先计算出输入框容器元素与预览框容器元素之间最大scroll范围的比例值，然后根据主动滚动元素自身的scrollTop做相应的比例换算，即可知道对方区域的scrollTop值。

- 关于UI
 
  - 项目的字体库选择了Font Awesome风格，并且只选取了项目所需要的一些图标。
  - 编辑器的整体css均可通过全局覆盖的形式进行自定义。目前暂时只支持灰色主题。
  - 编辑器的显示区域包括菜单栏，编辑器，预览区，工具栏，通过配置组件的config属性，可以选择默认的展示区域。
  
### Install

```js
npm install react-markdown-editor-lite --save
```

### Props

| Property | Description | Type | default | Remarks |
| --- | --- | --- | --- | --- |
| value | markdown content | String | '' | required |
| style | component container style | Object | {height: '100%'} | not required |
| config | component config | Object | {view: {...}, logger: {...}} | not required |
| onChange | emitting when editor has changed | Function | ({html, md}) => {} | not required |
| onImageUpload | when image uploaded, callback emitting will get image markdown text | (file: File, callback: (url: string) => void) => void; | ({file, callback}) => {} | not required |
| renderHTML | Render markdown text to HTML. You can return either string, function or Promise | (text: string) => string|function|Promise | none | **required** |

### Example

``` js
'use strict';
import React from 'react'
import ReactDOM from 'react-dom'
import MdEditor from 'react-markdown-editor-lite'
import MarkdownIt from 'markdown-it'
import emoji from 'markdown-it-emoji'
import subscript from 'markdown-it-sub'
import superscript from 'markdown-it-sup'
import footnote from 'markdown-it-footnote'
import deflist from 'markdown-it-deflist'
import abbreviation from 'markdown-it-abbr'
import insert from 'markdown-it-ins'
import mark from 'markdown-it-mark'
import tasklists from 'markdown-it-task-lists'
import hljs from 'highlight.js'
import 'highlight.js/styles/atom-one-light.css'
// import 'highlight.js/styles/github.css'
import './index.less';

const MOCK_DATA = "I Love React."
export default class Demo extends React.Component {
  mdEditor = null
  mdParser = null
  constructor(props) {
    super(props)
    // initial a parsera
    this.mdParser = new MarkdownIt({
      html: true,
      linkify: true,
      typographer: true,
      highlight: function (str, lang) {
        if (lang && hljs.getLanguage(lang)) {
          try {
            return hljs.highlight(lang, str).value
          } catch (__) {}
        }    
        return '' // use external default escaping
      }
    })
    .use(emoji)
    .use(subscript)
    .use(superscript)
    .use(footnote)
    .use(deflist)
    .use(abbreviation)
    .use(insert)
    .use(mark)
    .use(tasklists, { enabled: this.taskLists })
    this.renderHTML = this.renderHTML.bind(this)
  }
  handleEditorChange({html, md}) {
    console.log('handleEditorChange', html, md)
  }
  handleImageUpload(file, callback) {
    const reader = new FileReader()
    reader.onload = () => {      
      const convertBase64UrlToBlob = (urlData) => {  
        let arr = urlData.split(','), mime = arr[0].match(/:(.*?);/)[1]
        let bstr = atob(arr[1])
        let n = bstr.length
        let u8arr = new Uint8Array(n)
        while (n--) {
          u8arr[n] = bstr.charCodeAt(n)
        }
        return new Blob([u8arr], {type:mime})
      }
      const blob = convertBase64UrlToBlob(reader.result)
      setTimeout(() => {
        // setTimeout 模拟异步上传图片
        // 当异步上传获取图片地址后，执行calback回调（参数为imageUrl字符串），即可将图片地址写入markdown
        callback('https://avatars0.githubusercontent.com/u/21263805?s=40&v=4')
      }, 1000)
    }
    reader.readAsDataURL(file)
  }
  renderHTML(text) {
    // 模拟异步渲染Markdown
    return new Promise((resolve) => {
      setTimeout(() => {
        resolve(this.mdParser.render(text))
      }, 1000)
    })
  }
  handleGetMdValue = () => {   
    this.mdEditor && alert(this.mdEditor.getMdValue())      
  }
  handleGetHtmlValue = () => {    
    this.mdEditor && alert(this.mdEditor.getHtmlValue())
  }
  render() {
    return (      
      <div>
        <nav>
          <button onClick={this.handleGetMdValue} >getMdValue</button>  
          <button onClick={this.handleGetHtmlValue} >getHtmlValue</button>  
        </nav>
        <section style="height: 500px">
          <MdEditor 
            ref={node => this.mdEditor = node}
            value={MOCK_DATA}
            style={{height: '400px'}}
            renderHTML={this.renderHTML}
            config={{
              view: {
                menu: true,
                md: true,
                html: true
              },
              imageUrl: 'https://octodex.github.com/images/minion.png'
            }}
            onChange={this.handleEditorChange} 
            onImageUpload={this.handleImageUpload}
          />
        </section>                        
      </div>      
    )
  }
}
```

### 最后

   欢迎大家使用和反馈，[项目地址](https://github.com/HarryChen0506/react-markdown-editor-lite) (https://github.com/HarryChen0506/react-markdown-editor-lite)， 你的点赞将是我莫大的动力😊

![1.png](https://s3.ca-central-1.amazonaws.com/res-blog-public/res-dev/blog_1636946743939_1.png)', firstPicture='', viewCount=83, createDate='Sun Nov 07 14:09:29 EST 2021', updateDate='Tue Jan 18 22:54:08 EST 2022'}}, total=null}
2022-01-19 22:30:46:287 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 392ms
2022-01-19 22:30:46:287 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 22:30:46:373 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 22:30:46:373 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 22:30:46:373 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 22:30:46:373 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 22:30:46:373 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 22:30:46:373 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 22:30:46:373 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=41createdate=Wed Jan 19 22:18:33 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/41.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='ivanliang25@gmail.com', nickname='suhuan', parentCommentNickname='null', content='hjksdjf', status='0'}}, CommentListVo{commentId=36createdate=Wed Jan 19 21:15:59 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/19.png, replyComments=[CommentListVo{commentId=37createdate=Wed Jan 19 21:16:11 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/46.png, replyComments=null, CommentVo=CommentVo{parentCommentId=36, articleId=10005, email='2sdf@dd.c', nickname='2', parentCommentNickname='1', content='2', status='0'}}, CommentListVo{commentId=38createdate=Wed Jan 19 21:16:27 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/95.png, replyComments=null, CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sdfsd@Ck.com', nickname='2.1', parentCommentNickname='2', content='2.1', status='0'}}, CommentListVo{commentId=39createdate=Wed Jan 19 22:03:07 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/86.png, replyComments=null, CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='2', content='ddddd', status='0'}}, CommentListVo{commentId=40createdate=Wed Jan 19 22:04:30 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/88.png, replyComments=null, CommentVo=CommentVo{parentCommentId=38, articleId=10005, email='test@gg.com', nickname='sfs@ss.c', parentCommentNickname='2.1', content='sdfsf', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='1@11.com', nickname='1', parentCommentNickname='null', content='1', status='0'}}], total=2}
2022-01-19 22:30:46:373 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 11ms
2022-01-19 22:30:46:373 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 22:33:25:795 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 22:33:25:796 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 22:33:25:796 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: POST
2022-01-19 22:33:25:796 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment
2022-01-19 22:33:25:796 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.postComment
2022-01-19 22:33:25:796 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: CommentVo{parentCommentId=37, articleId=10005, email='ivanliang25@gmail.com', nickname='test', parentCommentNickname='2', content='reply 2', status='null'}
2022-01-19 22:33:25:796 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=null, total=null}
2022-01-19 22:33:25:796 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 25ms
2022-01-19 22:33:25:796 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 22:33:25:838 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 22:33:25:838 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 22:33:25:838 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 22:33:25:838 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 22:33:25:838 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 22:33:25:838 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 22:33:25:838 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=41createdate=Wed Jan 19 22:18:33 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/41.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='ivanliang25@gmail.com', nickname='suhuan', parentCommentNickname='null', content='hjksdjf', status='0'}}, CommentListVo{commentId=36createdate=Wed Jan 19 21:15:59 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/19.png, replyComments=[CommentListVo{commentId=37createdate=Wed Jan 19 21:16:11 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/46.png, replyComments=null, CommentVo=CommentVo{parentCommentId=36, articleId=10005, email='2sdf@dd.c', nickname='2', parentCommentNickname='1', content='2', status='0'}}, CommentListVo{commentId=38createdate=Wed Jan 19 21:16:27 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/95.png, replyComments=null, CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sdfsd@Ck.com', nickname='2.1', parentCommentNickname='2', content='2.1', status='0'}}, CommentListVo{commentId=39createdate=Wed Jan 19 22:03:07 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/86.png, replyComments=null, CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='2', content='ddddd', status='0'}}, CommentListVo{commentId=42createdate=Wed Jan 19 22:33:25 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/96.png, replyComments=null, CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='ivanliang25@gmail.com', nickname='test', parentCommentNickname='2', content='reply 2', status='0'}}, CommentListVo{commentId=40createdate=Wed Jan 19 22:04:30 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/88.png, replyComments=null, CommentVo=CommentVo{parentCommentId=38, articleId=10005, email='test@gg.com', nickname='sfs@ss.c', parentCommentNickname='2.1', content='sdfsf', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='1@11.com', nickname='1', parentCommentNickname='null', content='1', status='0'}}], total=2}
2022-01-19 22:33:25:838 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 8ms
2022-01-19 22:33:25:838 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 22:40:04:353 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 22:40:04:354 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 22:40:04:354 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 22:40:04:354 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/article/10005
2022-01-19 22:40:04:354 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 22:40:04:354 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.ArticleController.getPublicArticleDetail
2022-01-19 22:40:04:354 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 22:40:04:354 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 22:40:04:354 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 22:40:04:354 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=ArticleVo{userInfo=UserInfoVo{userId=100001, nickName='ivan', userName='ivan', avatar='https://res-blog-public.s3.ca-central-1.amazonaws.com/default_avatar.jpg'}, category=CategoryVo{categoryId=1, name='Life ', articleCount=null}, BaseArticleVo{articleId=10005, status=1, type=1, title='dd', description='This is the doc of React markdown editor lite.
Enjoy!!', content='| Head | Head | Head | Head |
| --- | --- | --- | --- |
| Data | Data | Data | Data |
| Data | Data | Data | Data |

## 手把手教你写一个markdown编辑器

> 笔者在18年年末的时候接到一个开发任务——搭建一个AI项目的开放平台，其中的产品文档为转化为HTML格式的markdown文档。考虑到文档的即时更新，将文档信息做成了Ajax接口的形式。因此管理后台只需将textarea表单的内容通过markdown解析器进行HTML格式转化，然后将markdown内容和经转化的HTML文档都保存到数据库即可。
> 基本需求完成后，为了更好的用户体验，考虑将常用的编辑功能添加进来。改进版不仅支持了常用的文本编辑功能，还实现的UI界面的配置化，自定义语法解析器。本着造福伸手党的目的，以及积累些开源经验，笔者将该react 组件 [react-markdown-editor-lite](https://github.com/HarryChen0506/react-markdown-editor-lite) 进行了封装改造，并且发布到了开源社区。

### 预览
在线体验 [https://harrychen0506.github.io/react-markdown-editor-lite/](https://harrychen0506.github.io/react-markdown-editor-lite/)

![image](https://github.com//HarryChen0506/react-markdown-editor-lite/blob/master/image/react-markdown-editor-lite-v1.0.0.PNG?raw=true)

### 特点
* 轻量、基于React
* UI可配置, 如只显示编辑区或预览区
* 支持自定义markdown语法解析器,语法高亮等
* 支持常用的markdown编辑功能，如加粗，斜体等等...
* 支持功能按钮插拔化，用户可以自定义扩展组件
* 支持编辑区和预览区同步滚动

### 开发心得

- 文本编辑

  大多数常见的编辑器，包括富文本编辑器，利用了某些元素如div的contenteditable属性，配合selection、range、execCommand等API，实现了富文本编辑功能。这里面的实现比较复杂，所以有了"[为什么都说富文本编辑器是天坑？](https://www.zhihu.com/question/38699645)"这个说法。

  而markdown编辑器，核心的处理内容为简单语法的纯文本，复杂度相对来说比较低，并且input标签自带onSelect事件，可以很方便的获取选择信息（选择起始位置和选择文本值），因此要想实现编辑功能，只需将要改动的内容进行文本转换，然后进行重新拼接首尾，大功告成。
  
- markdown解析

  考察了几个社区流行的markdown解析器，比较流行的有[markdown](https://www.npmjs.com/package/markdown), [markdown-it](https://www.npmjs.com/package/markdown-it), [marked](https://www.npmjs.com/package/marked) 等等。综合考虑扩展性以及稳定性，笔者推荐使用markdown-it作为markdown的词法解析器，因为该解析器有比较多的插件，并且支持语法高亮。

- 同步滚动

  当选择分栏编辑的时候，滚动左侧的编辑区，右侧的预览区能自动滚动到对应的区域。方案参考了《[手把手教你用 100行代码实现基于 react的 markdown 输入 + 即时预览在线编辑器（一）](https://github.com/accforgit/blog-data/blob/master/%E5%9C%A8%E7%BA%BF%E7%BC%96%E8%BE%91%E5%99%A8/README/README1.md)》。只需先计算出输入框容器元素与预览框容器元素之间最大scroll范围的比例值，然后根据主动滚动元素自身的scrollTop做相应的比例换算，即可知道对方区域的scrollTop值。

- 关于UI
 
  - 项目的字体库选择了Font Awesome风格，并且只选取了项目所需要的一些图标。
  - 编辑器的整体css均可通过全局覆盖的形式进行自定义。目前暂时只支持灰色主题。
  - 编辑器的显示区域包括菜单栏，编辑器，预览区，工具栏，通过配置组件的config属性，可以选择默认的展示区域。
  
### Install

```js
npm install react-markdown-editor-lite --save
```

### Props

| Property | Description | Type | default | Remarks |
| --- | --- | --- | --- | --- |
| value | markdown content | String | '' | required |
| style | component container style | Object | {height: '100%'} | not required |
| config | component config | Object | {view: {...}, logger: {...}} | not required |
| onChange | emitting when editor has changed | Function | ({html, md}) => {} | not required |
| onImageUpload | when image uploaded, callback emitting will get image markdown text | (file: File, callback: (url: string) => void) => void; | ({file, callback}) => {} | not required |
| renderHTML | Render markdown text to HTML. You can return either string, function or Promise | (text: string) => string|function|Promise | none | **required** |

### Example

``` js
'use strict';
import React from 'react'
import ReactDOM from 'react-dom'
import MdEditor from 'react-markdown-editor-lite'
import MarkdownIt from 'markdown-it'
import emoji from 'markdown-it-emoji'
import subscript from 'markdown-it-sub'
import superscript from 'markdown-it-sup'
import footnote from 'markdown-it-footnote'
import deflist from 'markdown-it-deflist'
import abbreviation from 'markdown-it-abbr'
import insert from 'markdown-it-ins'
import mark from 'markdown-it-mark'
import tasklists from 'markdown-it-task-lists'
import hljs from 'highlight.js'
import 'highlight.js/styles/atom-one-light.css'
// import 'highlight.js/styles/github.css'
import './index.less';

const MOCK_DATA = "I Love React."
export default class Demo extends React.Component {
  mdEditor = null
  mdParser = null
  constructor(props) {
    super(props)
    // initial a parsera
    this.mdParser = new MarkdownIt({
      html: true,
      linkify: true,
      typographer: true,
      highlight: function (str, lang) {
        if (lang && hljs.getLanguage(lang)) {
          try {
            return hljs.highlight(lang, str).value
          } catch (__) {}
        }    
        return '' // use external default escaping
      }
    })
    .use(emoji)
    .use(subscript)
    .use(superscript)
    .use(footnote)
    .use(deflist)
    .use(abbreviation)
    .use(insert)
    .use(mark)
    .use(tasklists, { enabled: this.taskLists })
    this.renderHTML = this.renderHTML.bind(this)
  }
  handleEditorChange({html, md}) {
    console.log('handleEditorChange', html, md)
  }
  handleImageUpload(file, callback) {
    const reader = new FileReader()
    reader.onload = () => {      
      const convertBase64UrlToBlob = (urlData) => {  
        let arr = urlData.split(','), mime = arr[0].match(/:(.*?);/)[1]
        let bstr = atob(arr[1])
        let n = bstr.length
        let u8arr = new Uint8Array(n)
        while (n--) {
          u8arr[n] = bstr.charCodeAt(n)
        }
        return new Blob([u8arr], {type:mime})
      }
      const blob = convertBase64UrlToBlob(reader.result)
      setTimeout(() => {
        // setTimeout 模拟异步上传图片
        // 当异步上传获取图片地址后，执行calback回调（参数为imageUrl字符串），即可将图片地址写入markdown
        callback('https://avatars0.githubusercontent.com/u/21263805?s=40&v=4')
      }, 1000)
    }
    reader.readAsDataURL(file)
  }
  renderHTML(text) {
    // 模拟异步渲染Markdown
    return new Promise((resolve) => {
      setTimeout(() => {
        resolve(this.mdParser.render(text))
      }, 1000)
    })
  }
  handleGetMdValue = () => {   
    this.mdEditor && alert(this.mdEditor.getMdValue())      
  }
  handleGetHtmlValue = () => {    
    this.mdEditor && alert(this.mdEditor.getHtmlValue())
  }
  render() {
    return (      
      <div>
        <nav>
          <button onClick={this.handleGetMdValue} >getMdValue</button>  
          <button onClick={this.handleGetHtmlValue} >getHtmlValue</button>  
        </nav>
        <section style="height: 500px">
          <MdEditor 
            ref={node => this.mdEditor = node}
            value={MOCK_DATA}
            style={{height: '400px'}}
            renderHTML={this.renderHTML}
            config={{
              view: {
                menu: true,
                md: true,
                html: true
              },
              imageUrl: 'https://octodex.github.com/images/minion.png'
            }}
            onChange={this.handleEditorChange} 
            onImageUpload={this.handleImageUpload}
          />
        </section>                        
      </div>      
    )
  }
}
```

### 最后

   欢迎大家使用和反馈，[项目地址](https://github.com/HarryChen0506/react-markdown-editor-lite) (https://github.com/HarryChen0506/react-markdown-editor-lite)， 你的点赞将是我莫大的动力😊

![1.png](https://s3.ca-central-1.amazonaws.com/res-blog-public/res-dev/blog_1636946743939_1.png)', firstPicture='', viewCount=83, createDate='Sun Nov 07 14:09:29 EST 2021', updateDate='Tue Jan 18 22:54:08 EST 2022'}}, total=null}
2022-01-19 22:40:04:354 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 22:40:04:354 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 11ms
2022-01-19 22:40:04:354 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 22:40:04:354 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 22:40:04:354 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 22:40:04:354 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=41createdate=Wed Jan 19 22:18:33 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/41.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='ivanliang25@gmail.com', nickname='suhuan', parentCommentNickname='null', content='hjksdjf', status='0'}}, CommentListVo{commentId=36createdate=Wed Jan 19 21:15:59 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/19.png, replyComments=[CommentListVo{commentId=37createdate=Wed Jan 19 21:16:11 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/46.png, replyComments=null, CommentVo=CommentVo{parentCommentId=36, articleId=10005, email='2sdf@dd.c', nickname='2', parentCommentNickname='1', content='2', status='0'}}, CommentListVo{commentId=38createdate=Wed Jan 19 21:16:27 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/95.png, replyComments=null, CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sdfsd@Ck.com', nickname='2.1', parentCommentNickname='2', content='2.1', status='0'}}, CommentListVo{commentId=39createdate=Wed Jan 19 22:03:07 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/86.png, replyComments=null, CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='2', content='ddddd', status='0'}}, CommentListVo{commentId=42createdate=Wed Jan 19 22:33:25 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/96.png, replyComments=null, CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='ivanliang25@gmail.com', nickname='test', parentCommentNickname='2', content='reply 2', status='0'}}, CommentListVo{commentId=40createdate=Wed Jan 19 22:04:30 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/88.png, replyComments=null, CommentVo=CommentVo{parentCommentId=38, articleId=10005, email='test@gg.com', nickname='sfs@ss.c', parentCommentNickname='2.1', content='sdfsf', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='1@11.com', nickname='1', parentCommentNickname='null', content='1', status='0'}}], total=2}
2022-01-19 22:40:04:355 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 22ms
2022-01-19 22:40:04:355 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 22:40:04:361 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 22:40:04:361 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 22:40:04:361 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 22:40:04:361 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 22:40:04:361 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 22:40:04:361 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 22:40:04:361 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=41createdate=Wed Jan 19 22:18:33 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/41.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='ivanliang25@gmail.com', nickname='suhuan', parentCommentNickname='null', content='hjksdjf', status='0'}}, CommentListVo{commentId=36createdate=Wed Jan 19 21:15:59 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/19.png, replyComments=[CommentListVo{commentId=37createdate=Wed Jan 19 21:16:11 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/46.png, replyComments=null, CommentVo=CommentVo{parentCommentId=36, articleId=10005, email='2sdf@dd.c', nickname='2', parentCommentNickname='1', content='2', status='0'}}, CommentListVo{commentId=38createdate=Wed Jan 19 21:16:27 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/95.png, replyComments=null, CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sdfsd@Ck.com', nickname='2.1', parentCommentNickname='2', content='2.1', status='0'}}, CommentListVo{commentId=39createdate=Wed Jan 19 22:03:07 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/86.png, replyComments=null, CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='2', content='ddddd', status='0'}}, CommentListVo{commentId=42createdate=Wed Jan 19 22:33:25 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/96.png, replyComments=null, CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='ivanliang25@gmail.com', nickname='test', parentCommentNickname='2', content='reply 2', status='0'}}, CommentListVo{commentId=40createdate=Wed Jan 19 22:04:30 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/88.png, replyComments=null, CommentVo=CommentVo{parentCommentId=38, articleId=10005, email='test@gg.com', nickname='sfs@ss.c', parentCommentNickname='2.1', content='sdfsf', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='1@11.com', nickname='1', parentCommentNickname='null', content='1', status='0'}}], total=2}
2022-01-19 22:40:04:361 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 29ms
2022-01-19 22:40:04:361 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 22:40:04:444 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 22:40:04:444 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 22:40:04:445 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 22:40:04:445 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 22:40:04:445 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 22:40:04:445 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 22:40:04:445 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=41createdate=Wed Jan 19 22:18:33 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/41.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='ivanliang25@gmail.com', nickname='suhuan', parentCommentNickname='null', content='hjksdjf', status='0'}}, CommentListVo{commentId=36createdate=Wed Jan 19 21:15:59 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/19.png, replyComments=[CommentListVo{commentId=37createdate=Wed Jan 19 21:16:11 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/46.png, replyComments=null, CommentVo=CommentVo{parentCommentId=36, articleId=10005, email='2sdf@dd.c', nickname='2', parentCommentNickname='1', content='2', status='0'}}, CommentListVo{commentId=38createdate=Wed Jan 19 21:16:27 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/95.png, replyComments=null, CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sdfsd@Ck.com', nickname='2.1', parentCommentNickname='2', content='2.1', status='0'}}, CommentListVo{commentId=39createdate=Wed Jan 19 22:03:07 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/86.png, replyComments=null, CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='2', content='ddddd', status='0'}}, CommentListVo{commentId=42createdate=Wed Jan 19 22:33:25 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/96.png, replyComments=null, CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='ivanliang25@gmail.com', nickname='test', parentCommentNickname='2', content='reply 2', status='0'}}, CommentListVo{commentId=40createdate=Wed Jan 19 22:04:30 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/88.png, replyComments=null, CommentVo=CommentVo{parentCommentId=38, articleId=10005, email='test@gg.com', nickname='sfs@ss.c', parentCommentNickname='2.1', content='sdfsf', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='1@11.com', nickname='1', parentCommentNickname='null', content='1', status='0'}}], total=2}
2022-01-19 22:40:04:445 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 26ms
2022-01-19 22:40:04:445 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 22:40:14:877 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 22:40:14:877 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 22:40:14:877 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: POST
2022-01-19 22:40:14:877 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment
2022-01-19 22:40:14:877 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.postComment
2022-01-19 22:40:14:877 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: CommentVo{parentCommentId=null, articleId=10005, email='test@gg.com', nickname='sfsf', parentCommentNickname='null', content='sdfsdf', status='null'}
2022-01-19 22:40:14:877 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=null, total=null}
2022-01-19 22:40:14:877 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 22ms
2022-01-19 22:40:14:877 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 22:40:14:910 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 22:40:14:911 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 22:40:14:911 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 22:40:14:911 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 22:40:14:911 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 22:40:14:911 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 22:40:14:911 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=43createdate=Wed Jan 19 22:40:14 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/12.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='test@gg.com', nickname='sfsf', parentCommentNickname='null', content='sdfsdf', status='0'}}, CommentListVo{commentId=41createdate=Wed Jan 19 22:18:33 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/41.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='ivanliang25@gmail.com', nickname='suhuan', parentCommentNickname='null', content='hjksdjf', status='0'}}, CommentListVo{commentId=36createdate=Wed Jan 19 21:15:59 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/19.png, replyComments=[CommentListVo{commentId=37createdate=Wed Jan 19 21:16:11 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/46.png, replyComments=null, CommentVo=CommentVo{parentCommentId=36, articleId=10005, email='2sdf@dd.c', nickname='2', parentCommentNickname='1', content='2', status='0'}}, CommentListVo{commentId=38createdate=Wed Jan 19 21:16:27 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/95.png, replyComments=null, CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sdfsd@Ck.com', nickname='2.1', parentCommentNickname='2', content='2.1', status='0'}}, CommentListVo{commentId=39createdate=Wed Jan 19 22:03:07 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/86.png, replyComments=null, CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='2', content='ddddd', status='0'}}, CommentListVo{commentId=42createdate=Wed Jan 19 22:33:25 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/96.png, replyComments=null, CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='ivanliang25@gmail.com', nickname='test', parentCommentNickname='2', content='reply 2', status='0'}}, CommentListVo{commentId=40createdate=Wed Jan 19 22:04:30 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/88.png, replyComments=null, CommentVo=CommentVo{parentCommentId=38, articleId=10005, email='test@gg.com', nickname='sfs@ss.c', parentCommentNickname='2.1', content='sdfsf', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='1@11.com', nickname='1', parentCommentNickname='null', content='1', status='0'}}], total=2}
2022-01-19 22:40:14:911 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 7ms
2022-01-19 22:40:14:911 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 22:51:13:341 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 22:51:13:341 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 22:51:13:341 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 22:51:13:341 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 22:51:13:341 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 22:51:13:342 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 22:51:13:342 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 22:51:13:342 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/article/10005
2022-01-19 22:51:13:342 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 22:51:13:342 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.ArticleController.getPublicArticleDetail
2022-01-19 22:51:13:342 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 22:51:13:342 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 22:51:13:342 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=43createdate=Wed Jan 19 22:40:14 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/12.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='test@gg.com', nickname='sfsf', parentCommentNickname='null', content='sdfsdf', status='0'}}, CommentListVo{commentId=41createdate=Wed Jan 19 22:18:33 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/41.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='ivanliang25@gmail.com', nickname='suhuan', parentCommentNickname='null', content='hjksdjf', status='0'}}, CommentListVo{commentId=36createdate=Wed Jan 19 21:15:59 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/19.png, replyComments=[CommentListVo{commentId=37createdate=Wed Jan 19 21:16:11 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/46.png, replyComments=null, CommentVo=CommentVo{parentCommentId=36, articleId=10005, email='2sdf@dd.c', nickname='2', parentCommentNickname='1', content='2', status='0'}}, CommentListVo{commentId=38createdate=Wed Jan 19 21:16:27 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/95.png, replyComments=null, CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sdfsd@Ck.com', nickname='2.1', parentCommentNickname='2', content='2.1', status='0'}}, CommentListVo{commentId=39createdate=Wed Jan 19 22:03:07 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/86.png, replyComments=null, CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='2', content='ddddd', status='0'}}, CommentListVo{commentId=42createdate=Wed Jan 19 22:33:25 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/96.png, replyComments=null, CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='ivanliang25@gmail.com', nickname='test', parentCommentNickname='2', content='reply 2', status='0'}}, CommentListVo{commentId=40createdate=Wed Jan 19 22:04:30 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/88.png, replyComments=null, CommentVo=CommentVo{parentCommentId=38, articleId=10005, email='test@gg.com', nickname='sfs@ss.c', parentCommentNickname='2.1', content='sdfsf', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='1@11.com', nickname='1', parentCommentNickname='null', content='1', status='0'}}], total=3}
2022-01-19 22:51:13:342 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=ArticleVo{userInfo=UserInfoVo{userId=100001, nickName='ivan', userName='ivan', avatar='https://res-blog-public.s3.ca-central-1.amazonaws.com/default_avatar.jpg'}, category=CategoryVo{categoryId=1, name='Life ', articleCount=null}, BaseArticleVo{articleId=10005, status=1, type=1, title='dd', description='This is the doc of React markdown editor lite.
Enjoy!!', content='| Head | Head | Head | Head |
| --- | --- | --- | --- |
| Data | Data | Data | Data |
| Data | Data | Data | Data |

## 手把手教你写一个markdown编辑器

> 笔者在18年年末的时候接到一个开发任务——搭建一个AI项目的开放平台，其中的产品文档为转化为HTML格式的markdown文档。考虑到文档的即时更新，将文档信息做成了Ajax接口的形式。因此管理后台只需将textarea表单的内容通过markdown解析器进行HTML格式转化，然后将markdown内容和经转化的HTML文档都保存到数据库即可。
> 基本需求完成后，为了更好的用户体验，考虑将常用的编辑功能添加进来。改进版不仅支持了常用的文本编辑功能，还实现的UI界面的配置化，自定义语法解析器。本着造福伸手党的目的，以及积累些开源经验，笔者将该react 组件 [react-markdown-editor-lite](https://github.com/HarryChen0506/react-markdown-editor-lite) 进行了封装改造，并且发布到了开源社区。

### 预览
在线体验 [https://harrychen0506.github.io/react-markdown-editor-lite/](https://harrychen0506.github.io/react-markdown-editor-lite/)

![image](https://github.com//HarryChen0506/react-markdown-editor-lite/blob/master/image/react-markdown-editor-lite-v1.0.0.PNG?raw=true)

### 特点
* 轻量、基于React
* UI可配置, 如只显示编辑区或预览区
* 支持自定义markdown语法解析器,语法高亮等
* 支持常用的markdown编辑功能，如加粗，斜体等等...
* 支持功能按钮插拔化，用户可以自定义扩展组件
* 支持编辑区和预览区同步滚动

### 开发心得

- 文本编辑

  大多数常见的编辑器，包括富文本编辑器，利用了某些元素如div的contenteditable属性，配合selection、range、execCommand等API，实现了富文本编辑功能。这里面的实现比较复杂，所以有了"[为什么都说富文本编辑器是天坑？](https://www.zhihu.com/question/38699645)"这个说法。

  而markdown编辑器，核心的处理内容为简单语法的纯文本，复杂度相对来说比较低，并且input标签自带onSelect事件，可以很方便的获取选择信息（选择起始位置和选择文本值），因此要想实现编辑功能，只需将要改动的内容进行文本转换，然后进行重新拼接首尾，大功告成。
  
- markdown解析

  考察了几个社区流行的markdown解析器，比较流行的有[markdown](https://www.npmjs.com/package/markdown), [markdown-it](https://www.npmjs.com/package/markdown-it), [marked](https://www.npmjs.com/package/marked) 等等。综合考虑扩展性以及稳定性，笔者推荐使用markdown-it作为markdown的词法解析器，因为该解析器有比较多的插件，并且支持语法高亮。

- 同步滚动

  当选择分栏编辑的时候，滚动左侧的编辑区，右侧的预览区能自动滚动到对应的区域。方案参考了《[手把手教你用 100行代码实现基于 react的 markdown 输入 + 即时预览在线编辑器（一）](https://github.com/accforgit/blog-data/blob/master/%E5%9C%A8%E7%BA%BF%E7%BC%96%E8%BE%91%E5%99%A8/README/README1.md)》。只需先计算出输入框容器元素与预览框容器元素之间最大scroll范围的比例值，然后根据主动滚动元素自身的scrollTop做相应的比例换算，即可知道对方区域的scrollTop值。

- 关于UI
 
  - 项目的字体库选择了Font Awesome风格，并且只选取了项目所需要的一些图标。
  - 编辑器的整体css均可通过全局覆盖的形式进行自定义。目前暂时只支持灰色主题。
  - 编辑器的显示区域包括菜单栏，编辑器，预览区，工具栏，通过配置组件的config属性，可以选择默认的展示区域。
  
### Install

```js
npm install react-markdown-editor-lite --save
```

### Props

| Property | Description | Type | default | Remarks |
| --- | --- | --- | --- | --- |
| value | markdown content | String | '' | required |
| style | component container style | Object | {height: '100%'} | not required |
| config | component config | Object | {view: {...}, logger: {...}} | not required |
| onChange | emitting when editor has changed | Function | ({html, md}) => {} | not required |
| onImageUpload | when image uploaded, callback emitting will get image markdown text | (file: File, callback: (url: string) => void) => void; | ({file, callback}) => {} | not required |
| renderHTML | Render markdown text to HTML. You can return either string, function or Promise | (text: string) => string|function|Promise | none | **required** |

### Example

``` js
'use strict';
import React from 'react'
import ReactDOM from 'react-dom'
import MdEditor from 'react-markdown-editor-lite'
import MarkdownIt from 'markdown-it'
import emoji from 'markdown-it-emoji'
import subscript from 'markdown-it-sub'
import superscript from 'markdown-it-sup'
import footnote from 'markdown-it-footnote'
import deflist from 'markdown-it-deflist'
import abbreviation from 'markdown-it-abbr'
import insert from 'markdown-it-ins'
import mark from 'markdown-it-mark'
import tasklists from 'markdown-it-task-lists'
import hljs from 'highlight.js'
import 'highlight.js/styles/atom-one-light.css'
// import 'highlight.js/styles/github.css'
import './index.less';

const MOCK_DATA = "I Love React."
export default class Demo extends React.Component {
  mdEditor = null
  mdParser = null
  constructor(props) {
    super(props)
    // initial a parsera
    this.mdParser = new MarkdownIt({
      html: true,
      linkify: true,
      typographer: true,
      highlight: function (str, lang) {
        if (lang && hljs.getLanguage(lang)) {
          try {
            return hljs.highlight(lang, str).value
          } catch (__) {}
        }    
        return '' // use external default escaping
      }
    })
    .use(emoji)
    .use(subscript)
    .use(superscript)
    .use(footnote)
    .use(deflist)
    .use(abbreviation)
    .use(insert)
    .use(mark)
    .use(tasklists, { enabled: this.taskLists })
    this.renderHTML = this.renderHTML.bind(this)
  }
  handleEditorChange({html, md}) {
    console.log('handleEditorChange', html, md)
  }
  handleImageUpload(file, callback) {
    const reader = new FileReader()
    reader.onload = () => {      
      const convertBase64UrlToBlob = (urlData) => {  
        let arr = urlData.split(','), mime = arr[0].match(/:(.*?);/)[1]
        let bstr = atob(arr[1])
        let n = bstr.length
        let u8arr = new Uint8Array(n)
        while (n--) {
          u8arr[n] = bstr.charCodeAt(n)
        }
        return new Blob([u8arr], {type:mime})
      }
      const blob = convertBase64UrlToBlob(reader.result)
      setTimeout(() => {
        // setTimeout 模拟异步上传图片
        // 当异步上传获取图片地址后，执行calback回调（参数为imageUrl字符串），即可将图片地址写入markdown
        callback('https://avatars0.githubusercontent.com/u/21263805?s=40&v=4')
      }, 1000)
    }
    reader.readAsDataURL(file)
  }
  renderHTML(text) {
    // 模拟异步渲染Markdown
    return new Promise((resolve) => {
      setTimeout(() => {
        resolve(this.mdParser.render(text))
      }, 1000)
    })
  }
  handleGetMdValue = () => {   
    this.mdEditor && alert(this.mdEditor.getMdValue())      
  }
  handleGetHtmlValue = () => {    
    this.mdEditor && alert(this.mdEditor.getHtmlValue())
  }
  render() {
    return (      
      <div>
        <nav>
          <button onClick={this.handleGetMdValue} >getMdValue</button>  
          <button onClick={this.handleGetHtmlValue} >getHtmlValue</button>  
        </nav>
        <section style="height: 500px">
          <MdEditor 
            ref={node => this.mdEditor = node}
            value={MOCK_DATA}
            style={{height: '400px'}}
            renderHTML={this.renderHTML}
            config={{
              view: {
                menu: true,
                md: true,
                html: true
              },
              imageUrl: 'https://octodex.github.com/images/minion.png'
            }}
            onChange={this.handleEditorChange} 
            onImageUpload={this.handleImageUpload}
          />
        </section>                        
      </div>      
    )
  }
}
```

### 最后

   欢迎大家使用和反馈，[项目地址](https://github.com/HarryChen0506/react-markdown-editor-lite) (https://github.com/HarryChen0506/react-markdown-editor-lite)， 你的点赞将是我莫大的动力😊

![1.png](https://s3.ca-central-1.amazonaws.com/res-blog-public/res-dev/blog_1636946743939_1.png)', firstPicture='', viewCount=83, createDate='Sun Nov 07 14:09:29 EST 2021', updateDate='Tue Jan 18 22:54:08 EST 2022'}}, total=null}
2022-01-19 22:51:13:342 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 17ms
2022-01-19 22:51:13:342 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 17ms
2022-01-19 22:51:13:342 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 22:51:13:342 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 22:51:13:344 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 22:51:13:344 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 22:51:13:344 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 22:51:13:344 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 22:51:13:344 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 22:51:13:344 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 22:51:13:344 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=43createdate=Wed Jan 19 22:40:14 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/12.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='test@gg.com', nickname='sfsf', parentCommentNickname='null', content='sdfsdf', status='0'}}, CommentListVo{commentId=41createdate=Wed Jan 19 22:18:33 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/41.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='ivanliang25@gmail.com', nickname='suhuan', parentCommentNickname='null', content='hjksdjf', status='0'}}, CommentListVo{commentId=36createdate=Wed Jan 19 21:15:59 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/19.png, replyComments=[CommentListVo{commentId=37createdate=Wed Jan 19 21:16:11 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/46.png, replyComments=null, CommentVo=CommentVo{parentCommentId=36, articleId=10005, email='2sdf@dd.c', nickname='2', parentCommentNickname='1', content='2', status='0'}}, CommentListVo{commentId=38createdate=Wed Jan 19 21:16:27 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/95.png, replyComments=null, CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sdfsd@Ck.com', nickname='2.1', parentCommentNickname='2', content='2.1', status='0'}}, CommentListVo{commentId=39createdate=Wed Jan 19 22:03:07 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/86.png, replyComments=null, CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='2', content='ddddd', status='0'}}, CommentListVo{commentId=42createdate=Wed Jan 19 22:33:25 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/96.png, replyComments=null, CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='ivanliang25@gmail.com', nickname='test', parentCommentNickname='2', content='reply 2', status='0'}}, CommentListVo{commentId=40createdate=Wed Jan 19 22:04:30 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/88.png, replyComments=null, CommentVo=CommentVo{parentCommentId=38, articleId=10005, email='test@gg.com', nickname='sfs@ss.c', parentCommentNickname='2.1', content='sdfsf', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='1@11.com', nickname='1', parentCommentNickname='null', content='1', status='0'}}], total=3}
2022-01-19 22:51:13:344 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 16ms
2022-01-19 22:51:13:344 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 22:51:13:437 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 22:51:13:437 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 22:51:13:437 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 22:51:13:437 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 22:51:13:437 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 22:51:13:437 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 22:51:13:437 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=43createdate=Wed Jan 19 22:40:14 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/12.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='test@gg.com', nickname='sfsf', parentCommentNickname='null', content='sdfsdf', status='0'}}, CommentListVo{commentId=41createdate=Wed Jan 19 22:18:33 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/41.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='ivanliang25@gmail.com', nickname='suhuan', parentCommentNickname='null', content='hjksdjf', status='0'}}, CommentListVo{commentId=36createdate=Wed Jan 19 21:15:59 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/19.png, replyComments=[CommentListVo{commentId=37createdate=Wed Jan 19 21:16:11 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/46.png, replyComments=null, CommentVo=CommentVo{parentCommentId=36, articleId=10005, email='2sdf@dd.c', nickname='2', parentCommentNickname='1', content='2', status='0'}}, CommentListVo{commentId=38createdate=Wed Jan 19 21:16:27 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/95.png, replyComments=null, CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sdfsd@Ck.com', nickname='2.1', parentCommentNickname='2', content='2.1', status='0'}}, CommentListVo{commentId=39createdate=Wed Jan 19 22:03:07 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/86.png, replyComments=null, CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='2', content='ddddd', status='0'}}, CommentListVo{commentId=42createdate=Wed Jan 19 22:33:25 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/96.png, replyComments=null, CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='ivanliang25@gmail.com', nickname='test', parentCommentNickname='2', content='reply 2', status='0'}}, CommentListVo{commentId=40createdate=Wed Jan 19 22:04:30 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/88.png, replyComments=null, CommentVo=CommentVo{parentCommentId=38, articleId=10005, email='test@gg.com', nickname='sfs@ss.c', parentCommentNickname='2.1', content='sdfsf', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='1@11.com', nickname='1', parentCommentNickname='null', content='1', status='0'}}], total=3}
2022-01-19 22:51:13:438 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 9ms
2022-01-19 22:51:13:438 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 22:51:23:143 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 22:51:23:143 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 22:51:23:143 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: POST
2022-01-19 22:51:23:143 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment
2022-01-19 22:51:23:143 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.postComment
2022-01-19 22:51:23:143 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: CommentVo{parentCommentId=null, articleId=10005, email='sdfsd@Ck.com', nickname='1', parentCommentNickname='null', content='ddd', status='null'}
2022-01-19 22:51:23:143 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=null, total=null}
2022-01-19 22:51:23:143 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 3ms
2022-01-19 22:51:23:144 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 22:51:23:177 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 22:51:23:177 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 22:51:23:177 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 22:51:23:178 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 22:51:23:178 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 22:51:23:178 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 22:51:23:178 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=44createdate=Wed Jan 19 22:51:23 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/98.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sdfsd@Ck.com', nickname='1', parentCommentNickname='null', content='ddd', status='0'}}, CommentListVo{commentId=43createdate=Wed Jan 19 22:40:14 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/12.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='test@gg.com', nickname='sfsf', parentCommentNickname='null', content='sdfsdf', status='0'}}, CommentListVo{commentId=41createdate=Wed Jan 19 22:18:33 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/41.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='ivanliang25@gmail.com', nickname='suhuan', parentCommentNickname='null', content='hjksdjf', status='0'}}, CommentListVo{commentId=36createdate=Wed Jan 19 21:15:59 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/19.png, replyComments=[CommentListVo{commentId=37createdate=Wed Jan 19 21:16:11 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/46.png, replyComments=null, CommentVo=CommentVo{parentCommentId=36, articleId=10005, email='2sdf@dd.c', nickname='2', parentCommentNickname='1', content='2', status='0'}}, CommentListVo{commentId=38createdate=Wed Jan 19 21:16:27 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/95.png, replyComments=null, CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sdfsd@Ck.com', nickname='2.1', parentCommentNickname='2', content='2.1', status='0'}}, CommentListVo{commentId=39createdate=Wed Jan 19 22:03:07 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/86.png, replyComments=null, CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='2', content='ddddd', status='0'}}, CommentListVo{commentId=42createdate=Wed Jan 19 22:33:25 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/96.png, replyComments=null, CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='ivanliang25@gmail.com', nickname='test', parentCommentNickname='2', content='reply 2', status='0'}}, CommentListVo{commentId=40createdate=Wed Jan 19 22:04:30 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/88.png, replyComments=null, CommentVo=CommentVo{parentCommentId=38, articleId=10005, email='test@gg.com', nickname='sfs@ss.c', parentCommentNickname='2.1', content='sdfsf', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='1@11.com', nickname='1', parentCommentNickname='null', content='1', status='0'}}], total=3}
2022-01-19 22:51:23:178 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 6ms
2022-01-19 22:51:23:178 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 22:52:38:658 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 22:52:38:658 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 22:52:38:658 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: POST
2022-01-19 22:52:38:659 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment
2022-01-19 22:52:38:659 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.postComment
2022-01-19 22:52:38:659 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: CommentVo{parentCommentId=null, articleId=10005, email='ljh19911025@gmail.com', nickname='1', parentCommentNickname='null', content='ddd', status='null'}
2022-01-19 22:52:38:659 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=null, total=null}
2022-01-19 22:52:38:659 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 4ms
2022-01-19 22:52:38:659 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 22:52:38:691 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 22:52:38:691 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 22:52:38:691 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 22:52:38:691 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 22:52:38:691 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 22:52:38:691 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 22:52:38:691 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=45createdate=Wed Jan 19 22:52:38 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/37.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='ljh19911025@gmail.com', nickname='1', parentCommentNickname='null', content='ddd', status='0'}}, CommentListVo{commentId=44createdate=Wed Jan 19 22:51:23 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/98.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sdfsd@Ck.com', nickname='1', parentCommentNickname='null', content='ddd', status='0'}}, CommentListVo{commentId=43createdate=Wed Jan 19 22:40:14 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/12.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='test@gg.com', nickname='sfsf', parentCommentNickname='null', content='sdfsdf', status='0'}}, CommentListVo{commentId=41createdate=Wed Jan 19 22:18:33 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/41.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='ivanliang25@gmail.com', nickname='suhuan', parentCommentNickname='null', content='hjksdjf', status='0'}}, CommentListVo{commentId=36createdate=Wed Jan 19 21:15:59 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/19.png, replyComments=[CommentListVo{commentId=37createdate=Wed Jan 19 21:16:11 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/46.png, replyComments=null, CommentVo=CommentVo{parentCommentId=36, articleId=10005, email='2sdf@dd.c', nickname='2', parentCommentNickname='1', content='2', status='0'}}, CommentListVo{commentId=38createdate=Wed Jan 19 21:16:27 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/95.png, replyComments=null, CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sdfsd@Ck.com', nickname='2.1', parentCommentNickname='2', content='2.1', status='0'}}, CommentListVo{commentId=39createdate=Wed Jan 19 22:03:07 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/86.png, replyComments=null, CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='2', content='ddddd', status='0'}}, CommentListVo{commentId=42createdate=Wed Jan 19 22:33:25 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/96.png, replyComments=null, CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='ivanliang25@gmail.com', nickname='test', parentCommentNickname='2', content='reply 2', status='0'}}, CommentListVo{commentId=40createdate=Wed Jan 19 22:04:30 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/88.png, replyComments=null, CommentVo=CommentVo{parentCommentId=38, articleId=10005, email='test@gg.com', nickname='sfs@ss.c', parentCommentNickname='2.1', content='sdfsf', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='1@11.com', nickname='1', parentCommentNickname='null', content='1', status='0'}}], total=3}
2022-01-19 22:52:38:692 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 9ms
2022-01-19 22:52:38:692 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 22:57:02:717 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 22:57:02:718 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 22:57:02:718 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 22:57:02:718 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/article/10005
2022-01-19 22:57:02:718 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.ArticleController.getPublicArticleDetail
2022-01-19 22:57:02:718 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 22:57:02:718 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=ArticleVo{userInfo=UserInfoVo{userId=100001, nickName='ivan', userName='ivan', avatar='https://res-blog-public.s3.ca-central-1.amazonaws.com/default_avatar.jpg'}, category=CategoryVo{categoryId=1, name='Life ', articleCount=null}, BaseArticleVo{articleId=10005, status=1, type=1, title='dd', description='This is the doc of React markdown editor lite.
Enjoy!!', content='| Head | Head | Head | Head |
| --- | --- | --- | --- |
| Data | Data | Data | Data |
| Data | Data | Data | Data |

## 手把手教你写一个markdown编辑器

> 笔者在18年年末的时候接到一个开发任务——搭建一个AI项目的开放平台，其中的产品文档为转化为HTML格式的markdown文档。考虑到文档的即时更新，将文档信息做成了Ajax接口的形式。因此管理后台只需将textarea表单的内容通过markdown解析器进行HTML格式转化，然后将markdown内容和经转化的HTML文档都保存到数据库即可。
> 基本需求完成后，为了更好的用户体验，考虑将常用的编辑功能添加进来。改进版不仅支持了常用的文本编辑功能，还实现的UI界面的配置化，自定义语法解析器。本着造福伸手党的目的，以及积累些开源经验，笔者将该react 组件 [react-markdown-editor-lite](https://github.com/HarryChen0506/react-markdown-editor-lite) 进行了封装改造，并且发布到了开源社区。

### 预览
在线体验 [https://harrychen0506.github.io/react-markdown-editor-lite/](https://harrychen0506.github.io/react-markdown-editor-lite/)

![image](https://github.com//HarryChen0506/react-markdown-editor-lite/blob/master/image/react-markdown-editor-lite-v1.0.0.PNG?raw=true)

### 特点
* 轻量、基于React
* UI可配置, 如只显示编辑区或预览区
* 支持自定义markdown语法解析器,语法高亮等
* 支持常用的markdown编辑功能，如加粗，斜体等等...
* 支持功能按钮插拔化，用户可以自定义扩展组件
* 支持编辑区和预览区同步滚动

### 开发心得

- 文本编辑

  大多数常见的编辑器，包括富文本编辑器，利用了某些元素如div的contenteditable属性，配合selection、range、execCommand等API，实现了富文本编辑功能。这里面的实现比较复杂，所以有了"[为什么都说富文本编辑器是天坑？](https://www.zhihu.com/question/38699645)"这个说法。

  而markdown编辑器，核心的处理内容为简单语法的纯文本，复杂度相对来说比较低，并且input标签自带onSelect事件，可以很方便的获取选择信息（选择起始位置和选择文本值），因此要想实现编辑功能，只需将要改动的内容进行文本转换，然后进行重新拼接首尾，大功告成。
  
- markdown解析

  考察了几个社区流行的markdown解析器，比较流行的有[markdown](https://www.npmjs.com/package/markdown), [markdown-it](https://www.npmjs.com/package/markdown-it), [marked](https://www.npmjs.com/package/marked) 等等。综合考虑扩展性以及稳定性，笔者推荐使用markdown-it作为markdown的词法解析器，因为该解析器有比较多的插件，并且支持语法高亮。

- 同步滚动

  当选择分栏编辑的时候，滚动左侧的编辑区，右侧的预览区能自动滚动到对应的区域。方案参考了《[手把手教你用 100行代码实现基于 react的 markdown 输入 + 即时预览在线编辑器（一）](https://github.com/accforgit/blog-data/blob/master/%E5%9C%A8%E7%BA%BF%E7%BC%96%E8%BE%91%E5%99%A8/README/README1.md)》。只需先计算出输入框容器元素与预览框容器元素之间最大scroll范围的比例值，然后根据主动滚动元素自身的scrollTop做相应的比例换算，即可知道对方区域的scrollTop值。

- 关于UI
 
  - 项目的字体库选择了Font Awesome风格，并且只选取了项目所需要的一些图标。
  - 编辑器的整体css均可通过全局覆盖的形式进行自定义。目前暂时只支持灰色主题。
  - 编辑器的显示区域包括菜单栏，编辑器，预览区，工具栏，通过配置组件的config属性，可以选择默认的展示区域。
  
### Install

```js
npm install react-markdown-editor-lite --save
```

### Props

| Property | Description | Type | default | Remarks |
| --- | --- | --- | --- | --- |
| value | markdown content | String | '' | required |
| style | component container style | Object | {height: '100%'} | not required |
| config | component config | Object | {view: {...}, logger: {...}} | not required |
| onChange | emitting when editor has changed | Function | ({html, md}) => {} | not required |
| onImageUpload | when image uploaded, callback emitting will get image markdown text | (file: File, callback: (url: string) => void) => void; | ({file, callback}) => {} | not required |
| renderHTML | Render markdown text to HTML. You can return either string, function or Promise | (text: string) => string|function|Promise | none | **required** |

### Example

``` js
'use strict';
import React from 'react'
import ReactDOM from 'react-dom'
import MdEditor from 'react-markdown-editor-lite'
import MarkdownIt from 'markdown-it'
import emoji from 'markdown-it-emoji'
import subscript from 'markdown-it-sub'
import superscript from 'markdown-it-sup'
import footnote from 'markdown-it-footnote'
import deflist from 'markdown-it-deflist'
import abbreviation from 'markdown-it-abbr'
import insert from 'markdown-it-ins'
import mark from 'markdown-it-mark'
import tasklists from 'markdown-it-task-lists'
import hljs from 'highlight.js'
import 'highlight.js/styles/atom-one-light.css'
// import 'highlight.js/styles/github.css'
import './index.less';

const MOCK_DATA = "I Love React."
export default class Demo extends React.Component {
  mdEditor = null
  mdParser = null
  constructor(props) {
    super(props)
    // initial a parsera
    this.mdParser = new MarkdownIt({
      html: true,
      linkify: true,
      typographer: true,
      highlight: function (str, lang) {
        if (lang && hljs.getLanguage(lang)) {
          try {
            return hljs.highlight(lang, str).value
          } catch (__) {}
        }    
        return '' // use external default escaping
      }
    })
    .use(emoji)
    .use(subscript)
    .use(superscript)
    .use(footnote)
    .use(deflist)
    .use(abbreviation)
    .use(insert)
    .use(mark)
    .use(tasklists, { enabled: this.taskLists })
    this.renderHTML = this.renderHTML.bind(this)
  }
  handleEditorChange({html, md}) {
    console.log('handleEditorChange', html, md)
  }
  handleImageUpload(file, callback) {
    const reader = new FileReader()
    reader.onload = () => {      
      const convertBase64UrlToBlob = (urlData) => {  
        let arr = urlData.split(','), mime = arr[0].match(/:(.*?);/)[1]
        let bstr = atob(arr[1])
        let n = bstr.length
        let u8arr = new Uint8Array(n)
        while (n--) {
          u8arr[n] = bstr.charCodeAt(n)
        }
        return new Blob([u8arr], {type:mime})
      }
      const blob = convertBase64UrlToBlob(reader.result)
      setTimeout(() => {
        // setTimeout 模拟异步上传图片
        // 当异步上传获取图片地址后，执行calback回调（参数为imageUrl字符串），即可将图片地址写入markdown
        callback('https://avatars0.githubusercontent.com/u/21263805?s=40&v=4')
      }, 1000)
    }
    reader.readAsDataURL(file)
  }
  renderHTML(text) {
    // 模拟异步渲染Markdown
    return new Promise((resolve) => {
      setTimeout(() => {
        resolve(this.mdParser.render(text))
      }, 1000)
    })
  }
  handleGetMdValue = () => {   
    this.mdEditor && alert(this.mdEditor.getMdValue())      
  }
  handleGetHtmlValue = () => {    
    this.mdEditor && alert(this.mdEditor.getHtmlValue())
  }
  render() {
    return (      
      <div>
        <nav>
          <button onClick={this.handleGetMdValue} >getMdValue</button>  
          <button onClick={this.handleGetHtmlValue} >getHtmlValue</button>  
        </nav>
        <section style="height: 500px">
          <MdEditor 
            ref={node => this.mdEditor = node}
            value={MOCK_DATA}
            style={{height: '400px'}}
            renderHTML={this.renderHTML}
            config={{
              view: {
                menu: true,
                md: true,
                html: true
              },
              imageUrl: 'https://octodex.github.com/images/minion.png'
            }}
            onChange={this.handleEditorChange} 
            onImageUpload={this.handleImageUpload}
          />
        </section>                        
      </div>      
    )
  }
}
```

### 最后

   欢迎大家使用和反馈，[项目地址](https://github.com/HarryChen0506/react-markdown-editor-lite) (https://github.com/HarryChen0506/react-markdown-editor-lite)， 你的点赞将是我莫大的动力😊

![1.png](https://s3.ca-central-1.amazonaws.com/res-blog-public/res-dev/blog_1636946743939_1.png)', firstPicture='', viewCount=83, createDate='Sun Nov 07 14:09:29 EST 2021', updateDate='Tue Jan 18 22:54:08 EST 2022'}}, total=null}
2022-01-19 22:57:02:718 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 17ms
2022-01-19 22:57:02:718 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 22:57:02:724 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 22:57:02:725 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 22:57:02:725 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 22:57:02:725 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 22:57:02:725 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 22:57:02:725 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 22:57:02:725 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=45createdate=Wed Jan 19 22:52:38 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/37.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='ljh19911025@gmail.com', nickname='1', parentCommentNickname='null', content='ddd', status='0'}}, CommentListVo{commentId=44createdate=Wed Jan 19 22:51:23 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/98.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sdfsd@Ck.com', nickname='1', parentCommentNickname='null', content='ddd', status='0'}}, CommentListVo{commentId=43createdate=Wed Jan 19 22:40:14 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/12.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='test@gg.com', nickname='sfsf', parentCommentNickname='null', content='sdfsdf', status='0'}}, CommentListVo{commentId=41createdate=Wed Jan 19 22:18:33 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/41.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='ivanliang25@gmail.com', nickname='suhuan', parentCommentNickname='null', content='hjksdjf', status='0'}}, CommentListVo{commentId=36createdate=Wed Jan 19 21:15:59 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/19.png, replyComments=[CommentListVo{commentId=37createdate=Wed Jan 19 21:16:11 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/46.png, replyComments=null, CommentVo=CommentVo{parentCommentId=36, articleId=10005, email='2sdf@dd.c', nickname='2', parentCommentNickname='1', content='2', status='0'}}, CommentListVo{commentId=38createdate=Wed Jan 19 21:16:27 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/95.png, replyComments=null, CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sdfsd@Ck.com', nickname='2.1', parentCommentNickname='2', content='2.1', status='0'}}, CommentListVo{commentId=39createdate=Wed Jan 19 22:03:07 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/86.png, replyComments=null, CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='2', content='ddddd', status='0'}}, CommentListVo{commentId=42createdate=Wed Jan 19 22:33:25 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/96.png, replyComments=null, CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='ivanliang25@gmail.com', nickname='test', parentCommentNickname='2', content='reply 2', status='0'}}, CommentListVo{commentId=40createdate=Wed Jan 19 22:04:30 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/88.png, replyComments=null, CommentVo=CommentVo{parentCommentId=38, articleId=10005, email='test@gg.com', nickname='sfs@ss.c', parentCommentNickname='2.1', content='sdfsf', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='1@11.com', nickname='1', parentCommentNickname='null', content='1', status='0'}}], total=5}
2022-01-19 22:57:02:725 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 24ms
2022-01-19 22:57:02:725 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 22:57:02:725 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 22:57:02:725 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 22:57:02:725 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 22:57:02:725 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 22:57:02:725 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 22:57:02:726 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 22:57:02:726 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=45createdate=Wed Jan 19 22:52:38 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/37.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='ljh19911025@gmail.com', nickname='1', parentCommentNickname='null', content='ddd', status='0'}}, CommentListVo{commentId=44createdate=Wed Jan 19 22:51:23 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/98.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sdfsd@Ck.com', nickname='1', parentCommentNickname='null', content='ddd', status='0'}}, CommentListVo{commentId=43createdate=Wed Jan 19 22:40:14 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/12.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='test@gg.com', nickname='sfsf', parentCommentNickname='null', content='sdfsdf', status='0'}}, CommentListVo{commentId=41createdate=Wed Jan 19 22:18:33 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/41.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='ivanliang25@gmail.com', nickname='suhuan', parentCommentNickname='null', content='hjksdjf', status='0'}}, CommentListVo{commentId=36createdate=Wed Jan 19 21:15:59 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/19.png, replyComments=[CommentListVo{commentId=37createdate=Wed Jan 19 21:16:11 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/46.png, replyComments=null, CommentVo=CommentVo{parentCommentId=36, articleId=10005, email='2sdf@dd.c', nickname='2', parentCommentNickname='1', content='2', status='0'}}, CommentListVo{commentId=38createdate=Wed Jan 19 21:16:27 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/95.png, replyComments=null, CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sdfsd@Ck.com', nickname='2.1', parentCommentNickname='2', content='2.1', status='0'}}, CommentListVo{commentId=39createdate=Wed Jan 19 22:03:07 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/86.png, replyComments=null, CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='2', content='ddddd', status='0'}}, CommentListVo{commentId=42createdate=Wed Jan 19 22:33:25 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/96.png, replyComments=null, CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='ivanliang25@gmail.com', nickname='test', parentCommentNickname='2', content='reply 2', status='0'}}, CommentListVo{commentId=40createdate=Wed Jan 19 22:04:30 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/88.png, replyComments=null, CommentVo=CommentVo{parentCommentId=38, articleId=10005, email='test@gg.com', nickname='sfs@ss.c', parentCommentNickname='2.1', content='sdfsf', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='1@11.com', nickname='1', parentCommentNickname='null', content='1', status='0'}}], total=5}
2022-01-19 22:57:02:726 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 25ms
2022-01-19 22:57:02:726 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 22:57:02:820 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 22:57:02:821 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 22:57:02:821 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 22:57:02:821 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 22:57:02:821 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 22:57:02:821 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 22:57:02:821 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=45createdate=Wed Jan 19 22:52:38 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/37.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='ljh19911025@gmail.com', nickname='1', parentCommentNickname='null', content='ddd', status='0'}}, CommentListVo{commentId=44createdate=Wed Jan 19 22:51:23 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/98.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sdfsd@Ck.com', nickname='1', parentCommentNickname='null', content='ddd', status='0'}}, CommentListVo{commentId=43createdate=Wed Jan 19 22:40:14 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/12.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='test@gg.com', nickname='sfsf', parentCommentNickname='null', content='sdfsdf', status='0'}}, CommentListVo{commentId=41createdate=Wed Jan 19 22:18:33 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/41.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='ivanliang25@gmail.com', nickname='suhuan', parentCommentNickname='null', content='hjksdjf', status='0'}}, CommentListVo{commentId=36createdate=Wed Jan 19 21:15:59 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/19.png, replyComments=[CommentListVo{commentId=37createdate=Wed Jan 19 21:16:11 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/46.png, replyComments=null, CommentVo=CommentVo{parentCommentId=36, articleId=10005, email='2sdf@dd.c', nickname='2', parentCommentNickname='1', content='2', status='0'}}, CommentListVo{commentId=38createdate=Wed Jan 19 21:16:27 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/95.png, replyComments=null, CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sdfsd@Ck.com', nickname='2.1', parentCommentNickname='2', content='2.1', status='0'}}, CommentListVo{commentId=39createdate=Wed Jan 19 22:03:07 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/86.png, replyComments=null, CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='2', content='ddddd', status='0'}}, CommentListVo{commentId=42createdate=Wed Jan 19 22:33:25 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/96.png, replyComments=null, CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='ivanliang25@gmail.com', nickname='test', parentCommentNickname='2', content='reply 2', status='0'}}, CommentListVo{commentId=40createdate=Wed Jan 19 22:04:30 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/88.png, replyComments=null, CommentVo=CommentVo{parentCommentId=38, articleId=10005, email='test@gg.com', nickname='sfs@ss.c', parentCommentNickname='2.1', content='sdfsf', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='1@11.com', nickname='1', parentCommentNickname='null', content='1', status='0'}}], total=5}
2022-01-19 22:57:02:821 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 38ms
2022-01-19 22:57:02:821 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 22:57:18:010 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 22:57:18:010 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 22:57:18:011 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: POST
2022-01-19 22:57:18:011 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment
2022-01-19 22:57:18:011 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.postComment
2022-01-19 22:57:18:011 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: CommentVo{parentCommentId=null, articleId=10005, email='sfs@ss.c', nickname='sfs@ss.c', parentCommentNickname='null', content='sss', status='null'}
2022-01-19 22:57:18:011 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=null, total=null}
2022-01-19 22:57:18:011 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 4ms
2022-01-19 22:57:18:011 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 22:57:18:041 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 22:57:18:041 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 22:57:18:041 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 22:57:18:041 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 22:57:18:041 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 22:57:18:041 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 22:57:18:041 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=46createdate=Wed Jan 19 22:57:18 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/6.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='sfs@ss.c', parentCommentNickname='null', content='sss', status='0'}}, CommentListVo{commentId=45createdate=Wed Jan 19 22:52:38 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/37.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='ljh19911025@gmail.com', nickname='1', parentCommentNickname='null', content='ddd', status='0'}}, CommentListVo{commentId=44createdate=Wed Jan 19 22:51:23 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/98.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sdfsd@Ck.com', nickname='1', parentCommentNickname='null', content='ddd', status='0'}}, CommentListVo{commentId=43createdate=Wed Jan 19 22:40:14 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/12.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='test@gg.com', nickname='sfsf', parentCommentNickname='null', content='sdfsdf', status='0'}}, CommentListVo{commentId=41createdate=Wed Jan 19 22:18:33 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/41.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='ivanliang25@gmail.com', nickname='suhuan', parentCommentNickname='null', content='hjksdjf', status='0'}}], total=5}
2022-01-19 22:57:18:041 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 7ms
2022-01-19 22:57:18:041 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 22:57:26:494 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 22:57:26:495 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 22:57:26:495 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 22:57:26:495 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 22:57:26:495 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 22:57:26:495 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 22:57:26:495 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=46createdate=Wed Jan 19 22:57:18 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/6.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='sfs@ss.c', parentCommentNickname='null', content='sss', status='0'}}, CommentListVo{commentId=45createdate=Wed Jan 19 22:52:38 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/37.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='ljh19911025@gmail.com', nickname='1', parentCommentNickname='null', content='ddd', status='0'}}, CommentListVo{commentId=44createdate=Wed Jan 19 22:51:23 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/98.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sdfsd@Ck.com', nickname='1', parentCommentNickname='null', content='ddd', status='0'}}, CommentListVo{commentId=43createdate=Wed Jan 19 22:40:14 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/12.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='test@gg.com', nickname='sfsf', parentCommentNickname='null', content='sdfsdf', status='0'}}, CommentListVo{commentId=41createdate=Wed Jan 19 22:18:33 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/41.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='ivanliang25@gmail.com', nickname='suhuan', parentCommentNickname='null', content='hjksdjf', status='0'}}], total=6}
2022-01-19 22:57:26:496 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 8ms
2022-01-19 22:57:26:496 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 22:57:26:498 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 22:57:26:498 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 22:57:26:498 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 22:57:26:498 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/article/10005
2022-01-19 22:57:26:498 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.ArticleController.getPublicArticleDetail
2022-01-19 22:57:26:498 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 22:57:26:498 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=ArticleVo{userInfo=UserInfoVo{userId=100001, nickName='ivan', userName='ivan', avatar='https://res-blog-public.s3.ca-central-1.amazonaws.com/default_avatar.jpg'}, category=CategoryVo{categoryId=1, name='Life ', articleCount=null}, BaseArticleVo{articleId=10005, status=1, type=1, title='dd', description='This is the doc of React markdown editor lite.
Enjoy!!', content='| Head | Head | Head | Head |
| --- | --- | --- | --- |
| Data | Data | Data | Data |
| Data | Data | Data | Data |

## 手把手教你写一个markdown编辑器

> 笔者在18年年末的时候接到一个开发任务——搭建一个AI项目的开放平台，其中的产品文档为转化为HTML格式的markdown文档。考虑到文档的即时更新，将文档信息做成了Ajax接口的形式。因此管理后台只需将textarea表单的内容通过markdown解析器进行HTML格式转化，然后将markdown内容和经转化的HTML文档都保存到数据库即可。
> 基本需求完成后，为了更好的用户体验，考虑将常用的编辑功能添加进来。改进版不仅支持了常用的文本编辑功能，还实现的UI界面的配置化，自定义语法解析器。本着造福伸手党的目的，以及积累些开源经验，笔者将该react 组件 [react-markdown-editor-lite](https://github.com/HarryChen0506/react-markdown-editor-lite) 进行了封装改造，并且发布到了开源社区。

### 预览
在线体验 [https://harrychen0506.github.io/react-markdown-editor-lite/](https://harrychen0506.github.io/react-markdown-editor-lite/)

![image](https://github.com//HarryChen0506/react-markdown-editor-lite/blob/master/image/react-markdown-editor-lite-v1.0.0.PNG?raw=true)

### 特点
* 轻量、基于React
* UI可配置, 如只显示编辑区或预览区
* 支持自定义markdown语法解析器,语法高亮等
* 支持常用的markdown编辑功能，如加粗，斜体等等...
* 支持功能按钮插拔化，用户可以自定义扩展组件
* 支持编辑区和预览区同步滚动

### 开发心得

- 文本编辑

  大多数常见的编辑器，包括富文本编辑器，利用了某些元素如div的contenteditable属性，配合selection、range、execCommand等API，实现了富文本编辑功能。这里面的实现比较复杂，所以有了"[为什么都说富文本编辑器是天坑？](https://www.zhihu.com/question/38699645)"这个说法。

  而markdown编辑器，核心的处理内容为简单语法的纯文本，复杂度相对来说比较低，并且input标签自带onSelect事件，可以很方便的获取选择信息（选择起始位置和选择文本值），因此要想实现编辑功能，只需将要改动的内容进行文本转换，然后进行重新拼接首尾，大功告成。
  
- markdown解析

  考察了几个社区流行的markdown解析器，比较流行的有[markdown](https://www.npmjs.com/package/markdown), [markdown-it](https://www.npmjs.com/package/markdown-it), [marked](https://www.npmjs.com/package/marked) 等等。综合考虑扩展性以及稳定性，笔者推荐使用markdown-it作为markdown的词法解析器，因为该解析器有比较多的插件，并且支持语法高亮。

- 同步滚动

  当选择分栏编辑的时候，滚动左侧的编辑区，右侧的预览区能自动滚动到对应的区域。方案参考了《[手把手教你用 100行代码实现基于 react的 markdown 输入 + 即时预览在线编辑器（一）](https://github.com/accforgit/blog-data/blob/master/%E5%9C%A8%E7%BA%BF%E7%BC%96%E8%BE%91%E5%99%A8/README/README1.md)》。只需先计算出输入框容器元素与预览框容器元素之间最大scroll范围的比例值，然后根据主动滚动元素自身的scrollTop做相应的比例换算，即可知道对方区域的scrollTop值。

- 关于UI
 
  - 项目的字体库选择了Font Awesome风格，并且只选取了项目所需要的一些图标。
  - 编辑器的整体css均可通过全局覆盖的形式进行自定义。目前暂时只支持灰色主题。
  - 编辑器的显示区域包括菜单栏，编辑器，预览区，工具栏，通过配置组件的config属性，可以选择默认的展示区域。
  
### Install

```js
npm install react-markdown-editor-lite --save
```

### Props

| Property | Description | Type | default | Remarks |
| --- | --- | --- | --- | --- |
| value | markdown content | String | '' | required |
| style | component container style | Object | {height: '100%'} | not required |
| config | component config | Object | {view: {...}, logger: {...}} | not required |
| onChange | emitting when editor has changed | Function | ({html, md}) => {} | not required |
| onImageUpload | when image uploaded, callback emitting will get image markdown text | (file: File, callback: (url: string) => void) => void; | ({file, callback}) => {} | not required |
| renderHTML | Render markdown text to HTML. You can return either string, function or Promise | (text: string) => string|function|Promise | none | **required** |

### Example

``` js
'use strict';
import React from 'react'
import ReactDOM from 'react-dom'
import MdEditor from 'react-markdown-editor-lite'
import MarkdownIt from 'markdown-it'
import emoji from 'markdown-it-emoji'
import subscript from 'markdown-it-sub'
import superscript from 'markdown-it-sup'
import footnote from 'markdown-it-footnote'
import deflist from 'markdown-it-deflist'
import abbreviation from 'markdown-it-abbr'
import insert from 'markdown-it-ins'
import mark from 'markdown-it-mark'
import tasklists from 'markdown-it-task-lists'
import hljs from 'highlight.js'
import 'highlight.js/styles/atom-one-light.css'
// import 'highlight.js/styles/github.css'
import './index.less';

const MOCK_DATA = "I Love React."
export default class Demo extends React.Component {
  mdEditor = null
  mdParser = null
  constructor(props) {
    super(props)
    // initial a parsera
    this.mdParser = new MarkdownIt({
      html: true,
      linkify: true,
      typographer: true,
      highlight: function (str, lang) {
        if (lang && hljs.getLanguage(lang)) {
          try {
            return hljs.highlight(lang, str).value
          } catch (__) {}
        }    
        return '' // use external default escaping
      }
    })
    .use(emoji)
    .use(subscript)
    .use(superscript)
    .use(footnote)
    .use(deflist)
    .use(abbreviation)
    .use(insert)
    .use(mark)
    .use(tasklists, { enabled: this.taskLists })
    this.renderHTML = this.renderHTML.bind(this)
  }
  handleEditorChange({html, md}) {
    console.log('handleEditorChange', html, md)
  }
  handleImageUpload(file, callback) {
    const reader = new FileReader()
    reader.onload = () => {      
      const convertBase64UrlToBlob = (urlData) => {  
        let arr = urlData.split(','), mime = arr[0].match(/:(.*?);/)[1]
        let bstr = atob(arr[1])
        let n = bstr.length
        let u8arr = new Uint8Array(n)
        while (n--) {
          u8arr[n] = bstr.charCodeAt(n)
        }
        return new Blob([u8arr], {type:mime})
      }
      const blob = convertBase64UrlToBlob(reader.result)
      setTimeout(() => {
        // setTimeout 模拟异步上传图片
        // 当异步上传获取图片地址后，执行calback回调（参数为imageUrl字符串），即可将图片地址写入markdown
        callback('https://avatars0.githubusercontent.com/u/21263805?s=40&v=4')
      }, 1000)
    }
    reader.readAsDataURL(file)
  }
  renderHTML(text) {
    // 模拟异步渲染Markdown
    return new Promise((resolve) => {
      setTimeout(() => {
        resolve(this.mdParser.render(text))
      }, 1000)
    })
  }
  handleGetMdValue = () => {   
    this.mdEditor && alert(this.mdEditor.getMdValue())      
  }
  handleGetHtmlValue = () => {    
    this.mdEditor && alert(this.mdEditor.getHtmlValue())
  }
  render() {
    return (      
      <div>
        <nav>
          <button onClick={this.handleGetMdValue} >getMdValue</button>  
          <button onClick={this.handleGetHtmlValue} >getHtmlValue</button>  
        </nav>
        <section style="height: 500px">
          <MdEditor 
            ref={node => this.mdEditor = node}
            value={MOCK_DATA}
            style={{height: '400px'}}
            renderHTML={this.renderHTML}
            config={{
              view: {
                menu: true,
                md: true,
                html: true
              },
              imageUrl: 'https://octodex.github.com/images/minion.png'
            }}
            onChange={this.handleEditorChange} 
            onImageUpload={this.handleImageUpload}
          />
        </section>                        
      </div>      
    )
  }
}
```

### 最后

   欢迎大家使用和反馈，[项目地址](https://github.com/HarryChen0506/react-markdown-editor-lite) (https://github.com/HarryChen0506/react-markdown-editor-lite)， 你的点赞将是我莫大的动力😊

![1.png](https://s3.ca-central-1.amazonaws.com/res-blog-public/res-dev/blog_1636946743939_1.png)', firstPicture='', viewCount=83, createDate='Sun Nov 07 14:09:29 EST 2021', updateDate='Tue Jan 18 22:54:08 EST 2022'}}, total=null}
2022-01-19 22:57:26:498 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 13ms
2022-01-19 22:57:26:498 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 22:57:26:501 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 22:57:26:501 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 22:57:26:501 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 22:57:26:501 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 22:57:26:501 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 22:57:26:501 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 22:57:26:501 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=46createdate=Wed Jan 19 22:57:18 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/6.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='sfs@ss.c', parentCommentNickname='null', content='sss', status='0'}}, CommentListVo{commentId=45createdate=Wed Jan 19 22:52:38 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/37.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='ljh19911025@gmail.com', nickname='1', parentCommentNickname='null', content='ddd', status='0'}}, CommentListVo{commentId=44createdate=Wed Jan 19 22:51:23 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/98.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sdfsd@Ck.com', nickname='1', parentCommentNickname='null', content='ddd', status='0'}}, CommentListVo{commentId=43createdate=Wed Jan 19 22:40:14 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/12.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='test@gg.com', nickname='sfsf', parentCommentNickname='null', content='sdfsdf', status='0'}}, CommentListVo{commentId=41createdate=Wed Jan 19 22:18:33 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/41.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='ivanliang25@gmail.com', nickname='suhuan', parentCommentNickname='null', content='hjksdjf', status='0'}}], total=6}
2022-01-19 22:57:26:501 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 16ms
2022-01-19 22:57:26:501 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 22:57:27:016 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 22:57:27:016 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 22:57:27:016 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 22:57:27:016 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 22:57:27:016 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 22:57:27:016 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 22:57:27:016 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=46createdate=Wed Jan 19 22:57:18 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/6.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='sfs@ss.c', parentCommentNickname='null', content='sss', status='0'}}, CommentListVo{commentId=45createdate=Wed Jan 19 22:52:38 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/37.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='ljh19911025@gmail.com', nickname='1', parentCommentNickname='null', content='ddd', status='0'}}, CommentListVo{commentId=44createdate=Wed Jan 19 22:51:23 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/98.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sdfsd@Ck.com', nickname='1', parentCommentNickname='null', content='ddd', status='0'}}, CommentListVo{commentId=43createdate=Wed Jan 19 22:40:14 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/12.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='test@gg.com', nickname='sfsf', parentCommentNickname='null', content='sdfsdf', status='0'}}, CommentListVo{commentId=41createdate=Wed Jan 19 22:18:33 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/41.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='ivanliang25@gmail.com', nickname='suhuan', parentCommentNickname='null', content='hjksdjf', status='0'}}], total=6}
2022-01-19 22:57:27:017 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 8ms
2022-01-19 22:57:27:017 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 22:57:40:552 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 22:57:40:552 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 22:57:40:552 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: POST
2022-01-19 22:57:40:552 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment
2022-01-19 22:57:40:553 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.postComment
2022-01-19 22:57:40:553 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: CommentVo{parentCommentId=41, articleId=10005, email='test@gg.com', nickname='sds', parentCommentNickname='suhuan', content='ssss', status='null'}
2022-01-19 22:57:40:553 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=null, total=null}
2022-01-19 22:57:40:553 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 5ms
2022-01-19 22:57:40:553 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 22:57:40:607 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 22:57:40:607 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 22:57:40:607 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 22:57:40:607 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 22:57:40:607 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 22:57:40:607 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 22:57:40:607 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=46createdate=Wed Jan 19 22:57:18 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/6.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='sfs@ss.c', parentCommentNickname='null', content='sss', status='0'}}, CommentListVo{commentId=45createdate=Wed Jan 19 22:52:38 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/37.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='ljh19911025@gmail.com', nickname='1', parentCommentNickname='null', content='ddd', status='0'}}, CommentListVo{commentId=44createdate=Wed Jan 19 22:51:23 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/98.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sdfsd@Ck.com', nickname='1', parentCommentNickname='null', content='ddd', status='0'}}, CommentListVo{commentId=43createdate=Wed Jan 19 22:40:14 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/12.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='test@gg.com', nickname='sfsf', parentCommentNickname='null', content='sdfsdf', status='0'}}, CommentListVo{commentId=41createdate=Wed Jan 19 22:18:33 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/41.png, replyComments=[CommentListVo{commentId=47createdate=Wed Jan 19 22:57:40 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/11.png, replyComments=null, CommentVo=CommentVo{parentCommentId=41, articleId=10005, email='test@gg.com', nickname='sds', parentCommentNickname='suhuan', content='ssss', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='ivanliang25@gmail.com', nickname='suhuan', parentCommentNickname='null', content='hjksdjf', status='0'}}], total=6}
2022-01-19 22:57:40:607 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 5ms
2022-01-19 22:57:40:607 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 22:57:48:312 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 22:57:48:312 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 22:57:48:312 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: POST
2022-01-19 22:57:48:312 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment
2022-01-19 22:57:48:312 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.postComment
2022-01-19 22:57:48:313 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: CommentVo{parentCommentId=null, articleId=10005, email='ivanliang0818@gmail.com', nickname='ivan', parentCommentNickname='null', content='sss', status='null'}
2022-01-19 22:57:48:313 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=null, total=null}
2022-01-19 22:57:48:313 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 3ms
2022-01-19 22:57:48:313 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 22:57:48:339 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 22:57:48:340 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 22:57:48:340 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 22:57:48:340 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 22:57:48:340 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 22:57:48:340 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 22:57:48:340 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=48createdate=Wed Jan 19 22:57:48 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/32.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='ivanliang0818@gmail.com', nickname='ivan', parentCommentNickname='null', content='sss', status='0'}}, CommentListVo{commentId=46createdate=Wed Jan 19 22:57:18 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/6.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='sfs@ss.c', parentCommentNickname='null', content='sss', status='0'}}, CommentListVo{commentId=45createdate=Wed Jan 19 22:52:38 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/37.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='ljh19911025@gmail.com', nickname='1', parentCommentNickname='null', content='ddd', status='0'}}, CommentListVo{commentId=44createdate=Wed Jan 19 22:51:23 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/98.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sdfsd@Ck.com', nickname='1', parentCommentNickname='null', content='ddd', status='0'}}, CommentListVo{commentId=43createdate=Wed Jan 19 22:40:14 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/12.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='test@gg.com', nickname='sfsf', parentCommentNickname='null', content='sdfsdf', status='0'}}], total=6}
2022-01-19 22:57:48:340 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 4ms
2022-01-19 22:57:48:340 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 22:57:57:494 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 22:57:57:494 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 22:57:57:494 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 22:57:57:494 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 22:57:57:494 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 22:57:57:494 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 22:57:57:494 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=41createdate=Wed Jan 19 22:18:33 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/41.png, replyComments=[CommentListVo{commentId=47createdate=Wed Jan 19 22:57:40 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/11.png, replyComments=null, CommentVo=CommentVo{parentCommentId=41, articleId=10005, email='test@gg.com', nickname='sds', parentCommentNickname='suhuan', content='ssss', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='ivanliang25@gmail.com', nickname='suhuan', parentCommentNickname='null', content='hjksdjf', status='0'}}, CommentListVo{commentId=36createdate=Wed Jan 19 21:15:59 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/19.png, replyComments=[CommentListVo{commentId=37createdate=Wed Jan 19 21:16:11 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/46.png, replyComments=null, CommentVo=CommentVo{parentCommentId=36, articleId=10005, email='2sdf@dd.c', nickname='2', parentCommentNickname='1', content='2', status='0'}}, CommentListVo{commentId=38createdate=Wed Jan 19 21:16:27 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/95.png, replyComments=null, CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sdfsd@Ck.com', nickname='2.1', parentCommentNickname='2', content='2.1', status='0'}}, CommentListVo{commentId=39createdate=Wed Jan 19 22:03:07 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/86.png, replyComments=null, CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='2', content='ddddd', status='0'}}, CommentListVo{commentId=42createdate=Wed Jan 19 22:33:25 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/96.png, replyComments=null, CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='ivanliang25@gmail.com', nickname='test', parentCommentNickname='2', content='reply 2', status='0'}}, CommentListVo{commentId=40createdate=Wed Jan 19 22:04:30 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/88.png, replyComments=null, CommentVo=CommentVo{parentCommentId=38, articleId=10005, email='test@gg.com', nickname='sfs@ss.c', parentCommentNickname='2.1', content='sdfsf', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='1@11.com', nickname='1', parentCommentNickname='null', content='1', status='0'}}], total=6}
2022-01-19 22:57:57:494 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 5ms
2022-01-19 22:57:57:494 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 22:58:08:848 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 22:58:08:848 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 22:58:08:848 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: POST
2022-01-19 22:58:08:848 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment
2022-01-19 22:58:08:848 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.postComment
2022-01-19 22:58:08:848 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: CommentVo{parentCommentId=null, articleId=10005, email='sdfsd@Ck.com', nickname='sfsf', parentCommentNickname='null', content='ssss', status='null'}
2022-01-19 22:58:08:848 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=null, total=null}
2022-01-19 22:58:08:848 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 3ms
2022-01-19 22:58:08:848 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 22:58:08:868 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 22:58:08:868 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 22:58:08:868 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 22:58:08:868 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 22:58:08:868 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 22:58:08:868 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 22:58:08:868 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=43createdate=Wed Jan 19 22:40:14 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/12.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='test@gg.com', nickname='sfsf', parentCommentNickname='null', content='sdfsdf', status='0'}}, CommentListVo{commentId=41createdate=Wed Jan 19 22:18:33 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/41.png, replyComments=[CommentListVo{commentId=47createdate=Wed Jan 19 22:57:40 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/11.png, replyComments=null, CommentVo=CommentVo{parentCommentId=41, articleId=10005, email='test@gg.com', nickname='sds', parentCommentNickname='suhuan', content='ssss', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='ivanliang25@gmail.com', nickname='suhuan', parentCommentNickname='null', content='hjksdjf', status='0'}}, CommentListVo{commentId=36createdate=Wed Jan 19 21:15:59 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/19.png, replyComments=[CommentListVo{commentId=37createdate=Wed Jan 19 21:16:11 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/46.png, replyComments=null, CommentVo=CommentVo{parentCommentId=36, articleId=10005, email='2sdf@dd.c', nickname='2', parentCommentNickname='1', content='2', status='0'}}, CommentListVo{commentId=38createdate=Wed Jan 19 21:16:27 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/95.png, replyComments=null, CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sdfsd@Ck.com', nickname='2.1', parentCommentNickname='2', content='2.1', status='0'}}, CommentListVo{commentId=39createdate=Wed Jan 19 22:03:07 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/86.png, replyComments=null, CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='2', content='ddddd', status='0'}}, CommentListVo{commentId=42createdate=Wed Jan 19 22:33:25 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/96.png, replyComments=null, CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='ivanliang25@gmail.com', nickname='test', parentCommentNickname='2', content='reply 2', status='0'}}, CommentListVo{commentId=40createdate=Wed Jan 19 22:04:30 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/88.png, replyComments=null, CommentVo=CommentVo{parentCommentId=38, articleId=10005, email='test@gg.com', nickname='sfs@ss.c', parentCommentNickname='2.1', content='sdfsf', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='1@11.com', nickname='1', parentCommentNickname='null', content='1', status='0'}}], total=6}
2022-01-19 22:58:08:869 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 5ms
2022-01-19 22:58:08:869 [http-nio-8081-exec-1] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 22:58:15:220 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 22:58:15:220 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 22:58:15:220 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 22:58:15:220 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 22:58:15:221 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 22:58:15:221 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 22:58:15:221 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=49createdate=Wed Jan 19 22:58:08 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/12.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sdfsd@Ck.com', nickname='sfsf', parentCommentNickname='null', content='ssss', status='0'}}, CommentListVo{commentId=48createdate=Wed Jan 19 22:57:48 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/32.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='ivanliang0818@gmail.com', nickname='ivan', parentCommentNickname='null', content='sss', status='0'}}, CommentListVo{commentId=46createdate=Wed Jan 19 22:57:18 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/6.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sfs@ss.c', nickname='sfs@ss.c', parentCommentNickname='null', content='sss', status='0'}}, CommentListVo{commentId=45createdate=Wed Jan 19 22:52:38 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/37.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='ljh19911025@gmail.com', nickname='1', parentCommentNickname='null', content='ddd', status='0'}}, CommentListVo{commentId=44createdate=Wed Jan 19 22:51:23 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/98.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='sdfsd@Ck.com', nickname='1', parentCommentNickname='null', content='ddd', status='0'}}], total=6}
2022-01-19 22:58:15:221 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 4ms
2022-01-19 22:58:15:221 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 22:58:44:921 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 22:58:44:922 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 22:58:44:922 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 22:58:44:922 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 22:58:44:922 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 22:58:44:922 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 22:58:44:922 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=43createdate=Wed Jan 19 22:40:14 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/12.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='test@gg.com', nickname='sfsf', parentCommentNickname='null', content='sdfsdf', status='0'}}, CommentListVo{commentId=41createdate=Wed Jan 19 22:18:33 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/41.png, replyComments=[CommentListVo{commentId=47createdate=Wed Jan 19 22:57:40 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/11.png, replyComments=null, CommentVo=CommentVo{parentCommentId=41, articleId=10005, email='test@gg.com', nickname='sds', parentCommentNickname='suhuan', content='ssss', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='ivanliang25@gmail.com', nickname='suhuan', parentCommentNickname='null', content='hjksdjf', status='0'}}, CommentListVo{commentId=36createdate=Wed Jan 19 21:15:59 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/19.png, replyComments=[CommentListVo{commentId=37createdate=Wed Jan 19 21:16:11 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/46.png, replyComments=null, CommentVo=CommentVo{parentCommentId=36, articleId=10005, email='2sdf@dd.c', nickname='2', parentCommentNickname='1', content='2', status='0'}}, CommentListVo{commentId=38createdate=Wed Jan 19 21:16:27 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/95.png, replyComments=null, CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sdfsd@Ck.com', nickname='2.1', parentCommentNickname='2', content='2.1', status='0'}}, CommentListVo{commentId=39createdate=Wed Jan 19 22:03:07 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/86.png, replyComments=null, CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='2', content='ddddd', status='0'}}, CommentListVo{commentId=42createdate=Wed Jan 19 22:33:25 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/96.png, replyComments=null, CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='ivanliang25@gmail.com', nickname='test', parentCommentNickname='2', content='reply 2', status='0'}}, CommentListVo{commentId=40createdate=Wed Jan 19 22:04:30 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/88.png, replyComments=null, CommentVo=CommentVo{parentCommentId=38, articleId=10005, email='test@gg.com', nickname='sfs@ss.c', parentCommentNickname='2.1', content='sdfsf', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='1@11.com', nickname='1', parentCommentNickname='null', content='1', status='0'}}], total=6}
2022-01-19 22:58:44:922 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 6ms
2022-01-19 22:58:44:922 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 22:59:19:544 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 22:59:19:544 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 22:59:19:544 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 22:59:19:544 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 22:59:19:544 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 22:59:19:544 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 22:59:19:544 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 22:59:19:544 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/article/10005
2022-01-19 22:59:19:544 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 22:59:19:544 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 22:59:19:544 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.ArticleController.getPublicArticleDetail
2022-01-19 22:59:19:544 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 22:59:19:544 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=36createdate=Wed Jan 19 21:15:59 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/19.png, replyComments=[CommentListVo{commentId=37createdate=Wed Jan 19 21:16:11 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/46.png, replyComments=null, CommentVo=CommentVo{parentCommentId=36, articleId=10005, email='2sdf@dd.c', nickname='2', parentCommentNickname='1', content='2', status='0'}}, CommentListVo{commentId=38createdate=Wed Jan 19 21:16:27 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/95.png, replyComments=null, CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sdfsd@Ck.com', nickname='2.1', parentCommentNickname='2', content='2.1', status='0'}}, CommentListVo{commentId=39createdate=Wed Jan 19 22:03:07 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/86.png, replyComments=null, CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='2', content='ddddd', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='1@11.com', nickname='1', parentCommentNickname='null', content='1', status='0'}}], total=1}
2022-01-19 22:59:19:545 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 16ms
2022-01-19 22:59:19:545 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 22:59:19:545 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=ArticleVo{userInfo=UserInfoVo{userId=100001, nickName='ivan', userName='ivan', avatar='https://res-blog-public.s3.ca-central-1.amazonaws.com/default_avatar.jpg'}, category=CategoryVo{categoryId=1, name='Life ', articleCount=null}, BaseArticleVo{articleId=10005, status=1, type=1, title='dd', description='This is the doc of React markdown editor lite.
Enjoy!!', content='| Head | Head | Head | Head |
| --- | --- | --- | --- |
| Data | Data | Data | Data |
| Data | Data | Data | Data |

## 手把手教你写一个markdown编辑器

> 笔者在18年年末的时候接到一个开发任务——搭建一个AI项目的开放平台，其中的产品文档为转化为HTML格式的markdown文档。考虑到文档的即时更新，将文档信息做成了Ajax接口的形式。因此管理后台只需将textarea表单的内容通过markdown解析器进行HTML格式转化，然后将markdown内容和经转化的HTML文档都保存到数据库即可。
> 基本需求完成后，为了更好的用户体验，考虑将常用的编辑功能添加进来。改进版不仅支持了常用的文本编辑功能，还实现的UI界面的配置化，自定义语法解析器。本着造福伸手党的目的，以及积累些开源经验，笔者将该react 组件 [react-markdown-editor-lite](https://github.com/HarryChen0506/react-markdown-editor-lite) 进行了封装改造，并且发布到了开源社区。

### 预览
在线体验 [https://harrychen0506.github.io/react-markdown-editor-lite/](https://harrychen0506.github.io/react-markdown-editor-lite/)

![image](https://github.com//HarryChen0506/react-markdown-editor-lite/blob/master/image/react-markdown-editor-lite-v1.0.0.PNG?raw=true)

### 特点
* 轻量、基于React
* UI可配置, 如只显示编辑区或预览区
* 支持自定义markdown语法解析器,语法高亮等
* 支持常用的markdown编辑功能，如加粗，斜体等等...
* 支持功能按钮插拔化，用户可以自定义扩展组件
* 支持编辑区和预览区同步滚动

### 开发心得

- 文本编辑

  大多数常见的编辑器，包括富文本编辑器，利用了某些元素如div的contenteditable属性，配合selection、range、execCommand等API，实现了富文本编辑功能。这里面的实现比较复杂，所以有了"[为什么都说富文本编辑器是天坑？](https://www.zhihu.com/question/38699645)"这个说法。

  而markdown编辑器，核心的处理内容为简单语法的纯文本，复杂度相对来说比较低，并且input标签自带onSelect事件，可以很方便的获取选择信息（选择起始位置和选择文本值），因此要想实现编辑功能，只需将要改动的内容进行文本转换，然后进行重新拼接首尾，大功告成。
  
- markdown解析

  考察了几个社区流行的markdown解析器，比较流行的有[markdown](https://www.npmjs.com/package/markdown), [markdown-it](https://www.npmjs.com/package/markdown-it), [marked](https://www.npmjs.com/package/marked) 等等。综合考虑扩展性以及稳定性，笔者推荐使用markdown-it作为markdown的词法解析器，因为该解析器有比较多的插件，并且支持语法高亮。

- 同步滚动

  当选择分栏编辑的时候，滚动左侧的编辑区，右侧的预览区能自动滚动到对应的区域。方案参考了《[手把手教你用 100行代码实现基于 react的 markdown 输入 + 即时预览在线编辑器（一）](https://github.com/accforgit/blog-data/blob/master/%E5%9C%A8%E7%BA%BF%E7%BC%96%E8%BE%91%E5%99%A8/README/README1.md)》。只需先计算出输入框容器元素与预览框容器元素之间最大scroll范围的比例值，然后根据主动滚动元素自身的scrollTop做相应的比例换算，即可知道对方区域的scrollTop值。

- 关于UI
 
  - 项目的字体库选择了Font Awesome风格，并且只选取了项目所需要的一些图标。
  - 编辑器的整体css均可通过全局覆盖的形式进行自定义。目前暂时只支持灰色主题。
  - 编辑器的显示区域包括菜单栏，编辑器，预览区，工具栏，通过配置组件的config属性，可以选择默认的展示区域。
  
### Install

```js
npm install react-markdown-editor-lite --save
```

### Props

| Property | Description | Type | default | Remarks |
| --- | --- | --- | --- | --- |
| value | markdown content | String | '' | required |
| style | component container style | Object | {height: '100%'} | not required |
| config | component config | Object | {view: {...}, logger: {...}} | not required |
| onChange | emitting when editor has changed | Function | ({html, md}) => {} | not required |
| onImageUpload | when image uploaded, callback emitting will get image markdown text | (file: File, callback: (url: string) => void) => void; | ({file, callback}) => {} | not required |
| renderHTML | Render markdown text to HTML. You can return either string, function or Promise | (text: string) => string|function|Promise | none | **required** |

### Example

``` js
'use strict';
import React from 'react'
import ReactDOM from 'react-dom'
import MdEditor from 'react-markdown-editor-lite'
import MarkdownIt from 'markdown-it'
import emoji from 'markdown-it-emoji'
import subscript from 'markdown-it-sub'
import superscript from 'markdown-it-sup'
import footnote from 'markdown-it-footnote'
import deflist from 'markdown-it-deflist'
import abbreviation from 'markdown-it-abbr'
import insert from 'markdown-it-ins'
import mark from 'markdown-it-mark'
import tasklists from 'markdown-it-task-lists'
import hljs from 'highlight.js'
import 'highlight.js/styles/atom-one-light.css'
// import 'highlight.js/styles/github.css'
import './index.less';

const MOCK_DATA = "I Love React."
export default class Demo extends React.Component {
  mdEditor = null
  mdParser = null
  constructor(props) {
    super(props)
    // initial a parsera
    this.mdParser = new MarkdownIt({
      html: true,
      linkify: true,
      typographer: true,
      highlight: function (str, lang) {
        if (lang && hljs.getLanguage(lang)) {
          try {
            return hljs.highlight(lang, str).value
          } catch (__) {}
        }    
        return '' // use external default escaping
      }
    })
    .use(emoji)
    .use(subscript)
    .use(superscript)
    .use(footnote)
    .use(deflist)
    .use(abbreviation)
    .use(insert)
    .use(mark)
    .use(tasklists, { enabled: this.taskLists })
    this.renderHTML = this.renderHTML.bind(this)
  }
  handleEditorChange({html, md}) {
    console.log('handleEditorChange', html, md)
  }
  handleImageUpload(file, callback) {
    const reader = new FileReader()
    reader.onload = () => {      
      const convertBase64UrlToBlob = (urlData) => {  
        let arr = urlData.split(','), mime = arr[0].match(/:(.*?);/)[1]
        let bstr = atob(arr[1])
        let n = bstr.length
        let u8arr = new Uint8Array(n)
        while (n--) {
          u8arr[n] = bstr.charCodeAt(n)
        }
        return new Blob([u8arr], {type:mime})
      }
      const blob = convertBase64UrlToBlob(reader.result)
      setTimeout(() => {
        // setTimeout 模拟异步上传图片
        // 当异步上传获取图片地址后，执行calback回调（参数为imageUrl字符串），即可将图片地址写入markdown
        callback('https://avatars0.githubusercontent.com/u/21263805?s=40&v=4')
      }, 1000)
    }
    reader.readAsDataURL(file)
  }
  renderHTML(text) {
    // 模拟异步渲染Markdown
    return new Promise((resolve) => {
      setTimeout(() => {
        resolve(this.mdParser.render(text))
      }, 1000)
    })
  }
  handleGetMdValue = () => {   
    this.mdEditor && alert(this.mdEditor.getMdValue())      
  }
  handleGetHtmlValue = () => {    
    this.mdEditor && alert(this.mdEditor.getHtmlValue())
  }
  render() {
    return (      
      <div>
        <nav>
          <button onClick={this.handleGetMdValue} >getMdValue</button>  
          <button onClick={this.handleGetHtmlValue} >getHtmlValue</button>  
        </nav>
        <section style="height: 500px">
          <MdEditor 
            ref={node => this.mdEditor = node}
            value={MOCK_DATA}
            style={{height: '400px'}}
            renderHTML={this.renderHTML}
            config={{
              view: {
                menu: true,
                md: true,
                html: true
              },
              imageUrl: 'https://octodex.github.com/images/minion.png'
            }}
            onChange={this.handleEditorChange} 
            onImageUpload={this.handleImageUpload}
          />
        </section>                        
      </div>      
    )
  }
}
```

### 最后

   欢迎大家使用和反馈，[项目地址](https://github.com/HarryChen0506/react-markdown-editor-lite) (https://github.com/HarryChen0506/react-markdown-editor-lite)， 你的点赞将是我莫大的动力😊

![1.png](https://s3.ca-central-1.amazonaws.com/res-blog-public/res-dev/blog_1636946743939_1.png)', firstPicture='', viewCount=83, createDate='Sun Nov 07 14:09:29 EST 2021', updateDate='Tue Jan 18 22:54:08 EST 2022'}}, total=null}
2022-01-19 22:59:19:545 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 18ms
2022-01-19 22:59:19:545 [http-nio-8081-exec-7] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 22:59:19:549 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 22:59:19:549 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 22:59:19:549 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 22:59:19:549 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 22:59:19:549 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 22:59:19:549 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 22:59:19:549 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=36createdate=Wed Jan 19 21:15:59 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/19.png, replyComments=[CommentListVo{commentId=37createdate=Wed Jan 19 21:16:11 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/46.png, replyComments=null, CommentVo=CommentVo{parentCommentId=36, articleId=10005, email='2sdf@dd.c', nickname='2', parentCommentNickname='1', content='2', status='0'}}, CommentListVo{commentId=38createdate=Wed Jan 19 21:16:27 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/95.png, replyComments=null, CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sdfsd@Ck.com', nickname='2.1', parentCommentNickname='2', content='2.1', status='0'}}, CommentListVo{commentId=39createdate=Wed Jan 19 22:03:07 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/86.png, replyComments=null, CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='2', content='ddddd', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='1@11.com', nickname='1', parentCommentNickname='null', content='1', status='0'}}], total=1}
2022-01-19 22:59:19:549 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 21ms
2022-01-19 22:59:19:549 [http-nio-8081-exec-4] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 22:59:20:057 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 22:59:20:057 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 22:59:20:057 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 22:59:20:057 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 22:59:20:057 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 22:59:20:057 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 22:59:20:057 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=36createdate=Wed Jan 19 21:15:59 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/19.png, replyComments=[CommentListVo{commentId=37createdate=Wed Jan 19 21:16:11 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/46.png, replyComments=null, CommentVo=CommentVo{parentCommentId=36, articleId=10005, email='2sdf@dd.c', nickname='2', parentCommentNickname='1', content='2', status='0'}}, CommentListVo{commentId=38createdate=Wed Jan 19 21:16:27 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/95.png, replyComments=null, CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sdfsd@Ck.com', nickname='2.1', parentCommentNickname='2', content='2.1', status='0'}}, CommentListVo{commentId=39createdate=Wed Jan 19 22:03:07 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/86.png, replyComments=null, CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='2', content='ddddd', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='1@11.com', nickname='1', parentCommentNickname='null', content='1', status='0'}}], total=1}
2022-01-19 22:59:20:057 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 3ms
2022-01-19 22:59:20:057 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 22:59:33:125 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 22:59:33:125 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 22:59:33:125 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: POST
2022-01-19 22:59:33:125 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment
2022-01-19 22:59:33:125 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.postComment
2022-01-19 22:59:33:125 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: CommentVo{parentCommentId=39, articleId=10005, email='ljh19911025@gmail.com', nickname='sfsf', parentCommentNickname='sds', content='sfsdfsdf', status='null'}
2022-01-19 22:59:33:125 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=null, total=null}
2022-01-19 22:59:33:125 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 2ms
2022-01-19 22:59:33:125 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 22:59:33:183 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 22:59:33:183 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 22:59:33:183 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 22:59:33:183 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 22:59:33:183 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 22:59:33:183 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 22:59:33:183 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=36createdate=Wed Jan 19 21:15:59 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/19.png, replyComments=[CommentListVo{commentId=37createdate=Wed Jan 19 21:16:11 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/46.png, replyComments=null, CommentVo=CommentVo{parentCommentId=36, articleId=10005, email='2sdf@dd.c', nickname='2', parentCommentNickname='1', content='2', status='0'}}, CommentListVo{commentId=38createdate=Wed Jan 19 21:16:27 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/95.png, replyComments=null, CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sdfsd@Ck.com', nickname='2.1', parentCommentNickname='2', content='2.1', status='0'}}, CommentListVo{commentId=39createdate=Wed Jan 19 22:03:07 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/86.png, replyComments=null, CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='2', content='ddddd', status='0'}}, CommentListVo{commentId=50createdate=Wed Jan 19 22:59:33 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/38.png, replyComments=null, CommentVo=CommentVo{parentCommentId=39, articleId=10005, email='ljh19911025@gmail.com', nickname='sfsf', parentCommentNickname='sds', content='sfsdfsdf', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='1@11.com', nickname='1', parentCommentNickname='null', content='1', status='0'}}], total=1}
2022-01-19 22:59:33:183 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 4ms
2022-01-19 22:59:33:183 [http-nio-8081-exec-3] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 22:59:41:023 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 22:59:41:023 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 22:59:41:023 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: POST
2022-01-19 22:59:41:023 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment
2022-01-19 22:59:41:024 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.postComment
2022-01-19 22:59:41:024 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: CommentVo{parentCommentId=39, articleId=10005, email='ljh19911025@gmail.com', nickname='sds', parentCommentNickname='sds', content='fsfsdf', status='null'}
2022-01-19 22:59:41:024 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=null, total=null}
2022-01-19 22:59:41:024 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 2ms
2022-01-19 22:59:41:024 [http-nio-8081-exec-6] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 22:59:41:046 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 22:59:41:046 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 22:59:41:047 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 22:59:41:047 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 22:59:41:047 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 22:59:41:047 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 22:59:41:047 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=36createdate=Wed Jan 19 21:15:59 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/19.png, replyComments=[CommentListVo{commentId=37createdate=Wed Jan 19 21:16:11 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/46.png, replyComments=null, CommentVo=CommentVo{parentCommentId=36, articleId=10005, email='2sdf@dd.c', nickname='2', parentCommentNickname='1', content='2', status='0'}}, CommentListVo{commentId=38createdate=Wed Jan 19 21:16:27 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/95.png, replyComments=null, CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sdfsd@Ck.com', nickname='2.1', parentCommentNickname='2', content='2.1', status='0'}}, CommentListVo{commentId=39createdate=Wed Jan 19 22:03:07 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/86.png, replyComments=null, CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='2', content='ddddd', status='0'}}, CommentListVo{commentId=50createdate=Wed Jan 19 22:59:33 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/38.png, replyComments=null, CommentVo=CommentVo{parentCommentId=39, articleId=10005, email='ljh19911025@gmail.com', nickname='sfsf', parentCommentNickname='sds', content='sfsdfsdf', status='0'}}, CommentListVo{commentId=51createdate=Wed Jan 19 22:59:41 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/32.png, replyComments=null, CommentVo=CommentVo{parentCommentId=39, articleId=10005, email='ljh19911025@gmail.com', nickname='sds', parentCommentNickname='sds', content='fsfsdf', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='1@11.com', nickname='1', parentCommentNickname='null', content='1', status='0'}}], total=1}
2022-01-19 22:59:41:047 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 3ms
2022-01-19 22:59:41:047 [http-nio-8081-exec-9] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 22:59:49:560 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 22:59:49:560 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 22:59:49:560 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: POST
2022-01-19 22:59:49:560 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment
2022-01-19 22:59:49:561 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.postComment
2022-01-19 22:59:49:561 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: CommentVo{parentCommentId=38, articleId=10005, email='ivanliang25@gmail.com', nickname='test', parentCommentNickname='2.1', content='sdfsdf', status='null'}
2022-01-19 22:59:49:561 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=null, total=null}
2022-01-19 22:59:49:561 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 2ms
2022-01-19 22:59:49:561 [http-nio-8081-exec-10] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 22:59:49:585 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 22:59:49:585 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 22:59:49:585 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 22:59:49:585 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 22:59:49:585 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 22:59:49:585 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 22:59:49:585 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=36createdate=Wed Jan 19 21:15:59 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/19.png, replyComments=[CommentListVo{commentId=37createdate=Wed Jan 19 21:16:11 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/46.png, replyComments=null, CommentVo=CommentVo{parentCommentId=36, articleId=10005, email='2sdf@dd.c', nickname='2', parentCommentNickname='1', content='2', status='0'}}, CommentListVo{commentId=38createdate=Wed Jan 19 21:16:27 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/95.png, replyComments=null, CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sdfsd@Ck.com', nickname='2.1', parentCommentNickname='2', content='2.1', status='0'}}, CommentListVo{commentId=39createdate=Wed Jan 19 22:03:07 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/86.png, replyComments=null, CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='2', content='ddddd', status='0'}}, CommentListVo{commentId=52createdate=Wed Jan 19 22:59:49 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/7.png, replyComments=null, CommentVo=CommentVo{parentCommentId=38, articleId=10005, email='ivanliang25@gmail.com', nickname='test', parentCommentNickname='2.1', content='sdfsdf', status='0'}}, CommentListVo{commentId=50createdate=Wed Jan 19 22:59:33 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/38.png, replyComments=null, CommentVo=CommentVo{parentCommentId=39, articleId=10005, email='ljh19911025@gmail.com', nickname='sfsf', parentCommentNickname='sds', content='sfsdfsdf', status='0'}}, CommentListVo{commentId=51createdate=Wed Jan 19 22:59:41 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/32.png, replyComments=null, CommentVo=CommentVo{parentCommentId=39, articleId=10005, email='ljh19911025@gmail.com', nickname='sds', parentCommentNickname='sds', content='fsfsdf', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='1@11.com', nickname='1', parentCommentNickname='null', content='1', status='0'}}], total=1}
2022-01-19 22:59:49:585 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 3ms
2022-01-19 22:59:49:585 [http-nio-8081-exec-2] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 23:01:00:135 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 23:01:00:135 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 23:01:00:135 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: POST
2022-01-19 23:01:00:135 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment
2022-01-19 23:01:00:135 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.postComment
2022-01-19 23:01:00:135 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: CommentVo{parentCommentId=null, articleId=10005, email='test@gg.com', nickname='ivan', parentCommentNickname='null', content='weewf', status='null'}
2022-01-19 23:01:00:135 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=null, total=null}
2022-01-19 23:01:00:135 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 5ms
2022-01-19 23:01:00:135 [http-nio-8081-exec-5] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 23:01:00:167 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log starts =====
2022-01-19 23:01:00:167 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request succeed
2022-01-19 23:01:00:167 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request Method: GET
2022-01-19 23:01:00:167 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Request URI: /api/comment/10005
2022-01-19 23:01:00:167 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Method Name: com.ivan.sunnyblog.web.controller.CommentController.getComments
2022-01-19 23:01:00:167 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Params: 10005
2022-01-19 23:01:00:167 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Result: ResultInfo{info='null', status=0, data=[CommentListVo{commentId=53createdate=Wed Jan 19 23:01:00 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/64.png, replyComments=[], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='test@gg.com', nickname='ivan', parentCommentNickname='null', content='weewf', status='0'}}, CommentListVo{commentId=36createdate=Wed Jan 19 21:15:59 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/19.png, replyComments=[CommentListVo{commentId=37createdate=Wed Jan 19 21:16:11 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/46.png, replyComments=null, CommentVo=CommentVo{parentCommentId=36, articleId=10005, email='2sdf@dd.c', nickname='2', parentCommentNickname='1', content='2', status='0'}}, CommentListVo{commentId=38createdate=Wed Jan 19 21:16:27 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/95.png, replyComments=null, CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sdfsd@Ck.com', nickname='2.1', parentCommentNickname='2', content='2.1', status='0'}}, CommentListVo{commentId=39createdate=Wed Jan 19 22:03:07 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/86.png, replyComments=null, CommentVo=CommentVo{parentCommentId=37, articleId=10005, email='sfs@ss.c', nickname='sds', parentCommentNickname='2', content='ddddd', status='0'}}, CommentListVo{commentId=52createdate=Wed Jan 19 22:59:49 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/7.png, replyComments=null, CommentVo=CommentVo{parentCommentId=38, articleId=10005, email='ivanliang25@gmail.com', nickname='test', parentCommentNickname='2.1', content='sdfsdf', status='0'}}, CommentListVo{commentId=50createdate=Wed Jan 19 22:59:33 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/38.png, replyComments=null, CommentVo=CommentVo{parentCommentId=39, articleId=10005, email='ljh19911025@gmail.com', nickname='sfsf', parentCommentNickname='sds', content='sfsdfsdf', status='0'}}, CommentListVo{commentId=51createdate=Wed Jan 19 22:59:41 EST 2022, avatar=https://res-blog-public.s3.ca-central-1.amazonaws.com/avatar/32.png, replyComments=null, CommentVo=CommentVo{parentCommentId=39, articleId=10005, email='ljh19911025@gmail.com', nickname='sds', parentCommentNickname='sds', content='fsfsdf', status='0'}}], CommentVo=CommentVo{parentCommentId=0, articleId=10005, email='1@11.com', nickname='1', parentCommentNickname='null', content='1', status='0'}}], total=1}
2022-01-19 23:01:00:167 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect Process Time: 7ms
2022-01-19 23:01:00:167 [http-nio-8081-exec-8] INFO  com.ivan.sunnyblog.web.aop.ControllerAspect ===== log ends =====
2022-01-19 23:24:23:245 [HikariPool-1 housekeeper] WARN  com.zaxxer.hikari.pool.HikariPool HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=21m18s898ms).
